<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Conda使用指南（安装部署篇）</title>
      <link href="2020/11/10/conda/"/>
      <url>2020/11/10/conda/</url>
      
        <content type="html"><![CDATA[<h2 id="关于-conda">关于 Conda</h2><blockquote><p>Conda is an open source package management system and environment management system that runs on Windows, macOS and Linux. Conda quickly installs, runs and updates packages and their dependencies. Conda easily creates, saves, loads and switches between environments on your local computer. It was created for Python programs, but it can package and distribute software for any language.</p></blockquote><p>简单来说，Conda 就是专门用于管理 Python 包环境以及部署的工具。</p><h2 id="anacondaconda-miniconda">Anaconda、Conda 、Miniconda</h2><ul><li>Anaconda是一个包含180+的科学包及其依赖项的发行版本。其包含的科学包包括：conda, numpy, scipy, ipython notebook等。<br /></li><li>conda是包及其依赖项和环境的管理工具。适用多种语言（Python, R, Ruby, Lua等）</li><li>Miniconda是一个最小安装版本的conda，只包含了少量的依赖和软件包</li></ul><blockquote><p>一般来说，三者并没有那么明显，只是在于依赖等信息的囊括问题</p></blockquote><h2 id="安装-conda">安装 Conda</h2><p>都可以下载安装包进行安装</p><h2 id="conda使用">Conda使用</h2><h3 id="查看版本">查看版本</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda -V</span><br></pre></td></tr></table></figure><p>conda在安装时默认创建Base虚拟环境，并且自带了一系列包可以使用，可以使用<code>conda list</code> 查看当前环境中安装的包</p><blockquote><p>Base 虚拟环境:实际开发中，每个 Python 项目依赖的包都不同，Python 解释器版本也可能不同；每个Python 项目可能是你一人开发，也可能是多人开发；为了保证每个 Python 项目的环境（Python 解释器和项目依赖包）独立，互不干预，以及同一个Python 项目的所有人开发环境一致，Anaconda 可以为每一个项目单独配置Python 的开发和运行环境，也就是 Anaconda 中的虚拟环境（可以类比为仓库）</p></blockquote><h3 id="创建-conda-虚拟环境">创建 conda 虚拟环境</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda create -n test python=<span class="number">3.6</span></span><br></pre></td></tr></table></figure><h3 id="切换环境">切换环境</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda activate test</span><br></pre></td></tr></table></figure><h3 id="退出和删除环境">退出和删除环境</h3><p>退出当前环境回到默认的 Base</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda deactivate test</span><br></pre></td></tr></table></figure><p>删除环境</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda remove -n env_name –-all </span><br></pre></td></tr></table></figure><h3 id="查看系统中的所有环境">查看系统中的所有环境</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda info -e</span><br></pre></td></tr></table></figure><h2 id="环境安装包管理">环境安装包管理</h2><h3 id="安装指定环境的包">安装指定环境的包</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda install -n &lt;env_name&gt; &lt;package_name&gt;</span><br></pre></td></tr></table></figure><h3 id="当前环境安装包">当前环境安装包</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda install &lt;package_name&gt;</span><br></pre></td></tr></table></figure><h3 id="删除指定环境的包">删除指定环境的包</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda remove -n &lt;env_name&gt; &lt;package_name&gt;</span><br></pre></td></tr></table></figure><h3 id="删除指定环境的包-1">删除指定环境的包</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda remove &lt;package_name&gt;</span><br></pre></td></tr></table></figure><h3 id="更新当前环境的包">更新当前环境的包</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda update &lt;package_name&gt;</span><br></pre></td></tr></table></figure><h3 id="更新当前环境所有包">更新当前环境所有包</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda update --all</span><br></pre></td></tr></table></figure><h3 id="更新conda">更新conda</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda update conda</span><br></pre></td></tr></table></figure><h2 id="环境复制和导出">环境复制和导出</h2><h3 id="环境复制">环境复制</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda create --name new_env_name --clone copied_env_name</span><br></pre></td></tr></table></figure><h3 id="导出环境">导出环境</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda env export &gt; environment.yaml</span><br></pre></td></tr></table></figure><p>该命令会生成一个<code>environment.yaml</code>文件，包含了当前环境中的配置</p><h3 id="导入环境">导入环境</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda env create -f environment.yaml</span><br></pre></td></tr></table></figure><h2 id="修改conda镜像源">修改conda镜像源</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/ </span><br><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/ </span><br><span class="line">conda config --set show_channel_urls yes</span><br></pre></td></tr></table></figure><p>或者手动修改<code>.condarc</code>，可以使用<code>conda config --set show_channel_urls yes</code> 生成该文件之后再修改。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">channels:</span><br><span class="line">  - defaults</span><br><span class="line">show_channel_urls: true</span><br><span class="line">channel_alias: https://mirrors.tuna.tsinghua.edu.cn/anaconda</span><br><span class="line">default_channels:</span><br><span class="line">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main</span><br><span class="line">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free</span><br><span class="line">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r</span><br><span class="line">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/pro</span><br><span class="line">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2</span><br><span class="line">custom_channels:</span><br><span class="line">  conda-forge: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  msys2: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  bioconda: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  menpo: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  pytorch: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  simpleitk: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br></pre></td></tr></table></figure><h2 id="修改pip镜像">修改pip镜像</h2><h3 id="临时使用pip">临时使用pip</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -i https://pypi.tuna.tsinghua.edu.cn/simple some-package</span><br></pre></td></tr></table></figure><h3 id="设为默认">设为默认</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install pip -U</span><br><span class="line">pip config set <span class="keyword">global</span>.index-url https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure><h2 id="conda自动激活环境">conda自动激活环境</h2><p>安装conda后在进入终端时可能会自动激活base环境，有以下解决方法：</p><ul><li><p>每次在命令行通过<code>conda deactivate</code>退出base环境回到系统自带的环境</p></li><li><p>通过将<code>auto_activate_base</code>参数设置为<code>false</code>实现：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda config --set auto_activate_base false</span><br></pre></td></tr></table></figure><p>也可以设置为<code>ture</code>取消更改</p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> conda </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shell脚本构建的基本函数</title>
      <link href="2020/11/02/shell1/"/>
      <url>2020/11/02/shell1/</url>
      
        <content type="html"><![CDATA[<h2 id="shell脚本的构建">shell脚本的构建</h2><p>在创建脚本文件时，必须在文件的第一行指定要使用的shell，格式为：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br></pre></td></tr></table></figure><p>脚本文件的第一行中<code>#</code>后的惊叹号会告诉shell使用哪个shell来运行脚本，其他地方的<code>#</code>作为注释行使用。</p><p>为了运行shell脚本需要让编写的脚本被shell识别到，一般的做法有两种：</p><ol type="1"><li>将shell脚本文件所处的目录添加到<code>PATH</code>环境变量中；</li><li>在提示符中用绝对路径或相对路径来引用shell脚本文件。</li></ol><h2 id="消息显示">消息显示</h2><p>在<code>echo</code>命令后面加上一个字符串，就能显示出这个文本字符串。这种方式可以添加自己的文本消息来告诉脚本用户脚本正在做什么。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zhaoej2014@admin ~]$ <span class="built_in">echo</span> This is a <span class="built_in">test</span></span><br><span class="line">This is a <span class="built_in">test</span></span><br></pre></td></tr></table></figure><p>如果文本本身带有字符串，我们需要<strong>用单引号或双引号来划定文本字符串</strong>。</p><p><strong>如果想把文本字符串和命令输出显示在同一行中</strong>，可以用<code>echo</code>语句的<code>-n</code>参数。需要在字符串的两侧加上引号，并且保证字符串尾部有一个空格</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zhaoej2014@admin zej]$ <span class="built_in">echo</span> -n <span class="string">&quot;The time and date are: &quot;</span>; date</span><br><span class="line">The time and date are: Mon Nov  2 10:38:28 CST 2020</span><br></pre></td></tr></table></figure><h2 id="变量">变量</h2><p>变量允许我们临时性地将信息存储在shell脚本中，以便和脚本中的其他命令一起使用。</p><h3 id="环境变量">环境变量</h3><p>shell维护着一组环境变量，用来记录特定的系统信息。比如系统的名称、登录到系统上的用户名、用户的系统ID(也称为UID)、用户默认主目录以及shell查找程序的搜索路径。</p><p>在环境变量名称之前加上<code>$</code>可以使用这些环境变量。</p><h3 id="用户变量">用户变量</h3><p>用户变量指的是用户自定义的变量，一般通过<code>=</code>建立，如：<code>var1=5</code>。<strong>注意，在变量、等号和值之间不能出现空格！</strong></p><h2 id="命令替换">命令替换</h2><p>shell脚本最有用的特性之一就是可以从命令输出中提取信息，并将其赋给变量。</p><p>有两种方法可以将命令输出赋给变量：</p><ul><li>反引号字符(`)</li><li>$()格式</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">要么用一对反引号把整个命令行命令围起来：</span><br><span class="line">testing=`date`</span><br><span class="line">要么使用$()格式</span><br><span class="line">testing=$(date)</span><br></pre></td></tr></table></figure><h2 id="重定向">重定向</h2><h3 id="输出重定向">输出重定向</h3><p>使用<code>&gt;</code>符号将命令的输出结果定向。如果想要将命令的输出追加到已有文件中，需要用双大于号（<code>&gt;&gt;</code>）来追加数据。</p><h3 id="输入重定向">输入重定向</h3><p>输入重定向和输出重定向正好相反。输入重定向将文件的内容重定向到命令，而非将命令的输出重定向到文件。</p><p>使用<code>&gt;</code>进行输入的重定向</p><h2 id="管道">管道</h2><p>有时候需要将一个命令的输出作为另一个命令的输入。通过<code>|</code>符号分隔命令即可实现管道。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls | head -2 | sort -r</span><br></pre></td></tr></table></figure><h2 id="执行数学运算">执行数学运算</h2><h3 id="expr命令"><code>expr</code>命令</h3><p><code>expr</code>命令允许在命令行上处理数学表达式</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expr 1 + 5</span><br></pre></td></tr></table></figure><h3 id="使用方括号">使用方括号</h3><p>bash shell提供了一种更简单的方法来执行数学表达式。在bash中，在将一个数学运算结果赋给某个变量时，可以用美元符和方括号（$[operator]）将数学表达式围起来。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[zhaoej2014@admin zej]$ var1=$[1+5]</span><br><span class="line">[zhaoej2014@admin zej]$ <span class="built_in">echo</span> <span class="variable">$var1</span></span><br><span class="line">6</span><br></pre></td></tr></table></figure><blockquote><p>注意：bash shell只支持整数运算。对于浮点数可以使用内置的计算器进行运算，命令为<code>bc</code></p></blockquote><h2 id="退出脚本">退出脚本</h2><p>Linux提供了一个专门的变量<code>$?</code>来保存上个已执行命令的退出状态码。按照惯例，一个成功结束的命令的退出状态码是0。如果有错误，则显示一个正数值。</p><p>默认，shell脚本会以脚本最后的一个命令的退出状态码退出。但是<code>exit</code>命令允许在脚本结束时指定一个状态退出码。</p>]]></content>
      
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django 之 requirement.txt 依赖文件生成</title>
      <link href="2020/10/26/django/"/>
      <url>2020/10/26/django/</url>
      
        <content type="html"><![CDATA[<h2 id="背景">背景</h2><p>在对Django项目进行移植时，由于生成项目的时候是将依赖和解释信息以绝对路径的方式写入配置文件的， 所以从一台电脑移植到另一台电脑，直接通过拷贝的方式是行不通的，正确的做法是将依赖模块写入requirements.txt文件中， 这样在别人使用我们的项目时，不需要再一个个去安装所需模块，只需安装依赖文件即可。</p><h2 id="解决方法">解决方法</h2><h3 id="使用-pip-freeze">使用 <code>pip freeze</code></h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在项目根目录中，打开终端执行以下命令</span></span><br><span class="line"><span class="comment"># 生成 requirements.txt 文件</span></span><br><span class="line">pip freeze &gt; requirements.txt</span><br><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure><blockquote><p>该方法最好是在虚拟环境下进行的，否则会将整个环境中的包都列出来。</p></blockquote><h3 id="使用-pipreqs">使用 <code>pipreqs</code></h3><p>有时候并不需要将整个虚拟环境所有依赖都导出，有可能有几十上百个模块，而本项目只依赖其中几个，那么这时仅导出本项目所依赖文件即可。</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install pipreqs</span><br><span class="line">pipreqs /var/www/project  --encoding=utf8 <span class="comment">#项目目录</span></span><br><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Django </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>多组比较的box图</title>
      <link href="2020/10/13/multicompare/"/>
      <url>2020/10/13/multicompare/</url>
      
        <content type="html"><![CDATA[<h2 id="背景">背景</h2><p>我们经常会碰到连续变量的多组比较，比如比较基因在不同分组(如分期、分级和亚型等)的表达差异。两个分组之间的比较可以使用T检验或Wilcox秩和检验，三个及三个以上分组的比较可以使用方差检验和kruskal检验。同样的，我们可以将不同分组的差异结果进行可视化展示。</p><h2 id="绘图">绘图</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成数据</span></span><br><span class="line">set.seed(<span class="number">40</span>)</span><br><span class="line">data &lt;- data.frame(exp=c(rnorm(<span class="number">30</span>,<span class="number">0</span>,<span class="number">1.3</span>),rnorm(<span class="number">30</span>,<span class="number">0.5</span>,<span class="number">1.6</span>),</span><br><span class="line">                          rnorm(<span class="number">30</span>,<span class="number">1</span>,<span class="number">1.9</span>),rnorm(<span class="number">30</span>,<span class="number">1.5</span>,<span class="number">1.9</span>)),</span><br><span class="line">                   Stage=c(rep(paste0(<span class="string">&#x27;Stage-&#x27;</span>,<span class="number">1</span>:<span class="number">4</span>),each=<span class="number">30</span>)))</span><br><span class="line">data$Stage &lt;- factor(data$Stage, levels = c(<span class="string">&quot;Stage-1&quot;</span>, <span class="string">&quot;Stage-2&quot;</span>, <span class="string">&quot;Stage-3&quot;</span>, <span class="string">&quot;Stage-4&quot;</span>))</span><br><span class="line"><span class="comment"># 绘制图片</span></span><br><span class="line"><span class="keyword">library</span>(ggplot2)</span><br><span class="line"><span class="keyword">library</span>(ggsci)</span><br><span class="line"><span class="keyword">library</span>(ggpubr)</span><br><span class="line">ggplot(data,aes(Stage,exp,fill=Stage))+</span><br><span class="line">  geom_boxplot(outlier.colour = <span class="literal">NA</span>,notch = <span class="literal">T</span>,size = <span class="number">0.4</span>)+ <span class="comment"># 箱式图</span></span><br><span class="line">  geom_jitter(shape = <span class="number">21</span>,size=<span class="number">2</span>,width = <span class="number">0.2</span>)+             <span class="comment"># 散点</span></span><br><span class="line">  geom_violin(position = position_dodge(width = <span class="number">.75</span>),</span><br><span class="line">              size = <span class="number">0.4</span>,alpha = <span class="number">0.4</span>,trim = <span class="literal">T</span>)+           <span class="comment"># 小提琴图</span></span><br><span class="line">  theme_classic()+</span><br><span class="line">  theme(legend.position = <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">        axis.title.y = element_text(size=<span class="number">12</span>),</span><br><span class="line">        axis.text = element_text(size=<span class="number">12</span>),</span><br><span class="line">        axis.title.x = element_blank())+</span><br><span class="line">  scale_fill_npg()+</span><br><span class="line">  stat_compare_means(comparisons = split(t(combn(levels(data$Stage),<span class="number">2</span>)),<span class="number">1</span>:nrow(t(combn(levels(data$Stage),<span class="number">2</span>)))),</span><br><span class="line">                     label = <span class="string">&#x27;p.signif&#x27;</span>) +</span><br><span class="line">  stat_compare_means(label.y = max(data$exp)+<span class="number">5.7</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/multicompare/pic.jpg" /></p><p>如图分析：四组整体是存在显著的差异的,并且第一组和其他三组两两之间都有显著的差异；但是后三组两两之间的差异不明显。为了获得一个较优的选择，通过观察他们的中位值可以发现第四组的中位值是最高的，因此可能选择第四组作为最终的选择。</p>]]></content>
      
      
      
        <tags>
            
            <tag> ggplot2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Aspera的安装与使用</title>
      <link href="2020/10/09/aspera/"/>
      <url>2020/10/09/aspera/</url>
      
        <content type="html"><![CDATA[<p>当我们需要一些NGS数据时，一般会想到去NCBI或者EBI的数据库中下载。但是当我们使用wget进行下载时，真的是慢到令人发指。这时我们可以使用Aspera来下载NGS数据，来加速数据的下载。</p><h2 id="安装">安装</h2><ol type="1"><li><p>根据电脑版本下载对应aspera connect server，下载地址：https://www.ibm.com/products/aspera/downloads</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ./download</span><br><span class="line">wget http://download.asperasoft.com/download/sw/connect/3.7.4/aspera-connect-3.7.4.147727-linux-64.tar.gz</span><br></pre></td></tr></table></figure></li><li><p>下载获得的是shell脚本，解压安装</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar zxf aspera-connect-3.7.4.147727-linux-64.tar.gz</span><br><span class="line">bash aspera-connect-3.7.4.147727-linux-64.sh</span><br></pre></td></tr></table></figure></li><li><p>安装后找到home目录下的会有一个.aspera目录，里边包含密钥等信息，可以将其添加入环境变量中</p><blockquote><p>在.aspera的目录，有两个文件比较重要: 一个是ascp的可执行文件<code>~/.aspera/connect/bin/ascp</code>，另一个ascp的密钥文件<code>~/.aspera/connect/etc/asperaweb_id_dsa.putty</code>,可以把密钥备份到home目录当中</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;PATH=$PATH:/home/jeason/.aspera/connect/bin/&#x27;</span> &gt;&gt; ~/.bashrc</span><br><span class="line">cp ~/.aspera/connect/etc/asperaweb_id_dsa.putty ~/</span><br><span class="line"><span class="built_in">source</span> .bashrc</span><br></pre></td></tr></table></figure><p>重新source配置文件生效</p></li><li><p>使用<code>ascp --help</code>参看命令参数</p><p>常见参数：</p><ul><li><code>-v</code> verbose mode 唠叨模式，能让你实时知道程序在干啥，方便查错。<br /></li><li><code>-T</code> 取消加密，否则有时候数据下载不了 。<br /></li><li><code>-i</code> 提供私钥文件的地址，我也不知道干嘛的，反正不能少，地址一般是~/.aspera/connect/etc中的asperaweb_id_dsa.openssh文件<br /></li><li><code>-l</code> 设置最大传输速度，一般200m到500m，如果不设置，反而速度会比较低，可能有个较低的默认值<br /></li><li><code>-k</code> 断点续传，一般设置为值1</li></ul></li></ol><h2 id="下载sra数据">下载sra数据</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ascp -T -i ~/.aspera/connect/etc/asperaweb_id_dsa.openssh  -k 1 -l 200m anonftp@ftp-private.ncbi.nlm.nih.gov:/sra/sra-instant/reads/ByRun/sra/SRR/SRR620/SRR6208854/SRR6208854.sra ./</span><br></pre></td></tr></table></figure><blockquote><p>SRA数据库下载：首先记住，数据的存放地址是<code>ftp-private.ncbi.nlm.nih.gov</code>，SRA在Aspera的用户名是<code>anonftp</code></p></blockquote><h2 id="aspera批量下载sra文件">Aspera批量下载SRA文件</h2><p>很多时候需要同时下载多个SRA文件，ascp命令提供参数<code>--file-list</code>，用于批量下载SRA文件。</p><p>可以将下载列表写入sra.txt文件中，然后进行批量下载</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;sra&#x2F;sra-instant&#x2F;reads&#x2F;ByRun&#x2F;sra&#x2F;SRR&#x2F;SRR623&#x2F;SRR6232298&#x2F;SRR6232298.sra</span><br><span class="line">&#x2F;sra&#x2F;sra-instant&#x2F;reads&#x2F;ByRun&#x2F;sra&#x2F;SRR&#x2F;SRR623&#x2F;SRR6232299&#x2F;SRR6232299.sra</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ascp -T -i ~/.aspera/connect/etc/asperaweb_id_dsa.openssh  -k 1 -l 200m --mode recv --host ftp-private.ncbi.nlm.nih.gov --user anonftp --file-list ~/sra.txt ./</span><br></pre></td></tr></table></figure><blockquote><p>asprea同样可以下载ENA的数据，ENA在Aspera的用户名是<code>era-fasp</code>，数据的存放地址是<code>fasp.sra.ebi.ac.uk</code></p></blockquote><h2 id="报错">报错</h2><p>有时会遇到以下报错：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ascp: Failed to open TCP connection <span class="keyword">for</span> SSH, exiting.</span><br><span class="line"></span><br><span class="line">Session Stop (Error: Failed to open TCP connection <span class="keyword">for</span> SSH)</span><br></pre></td></tr></table></figure><p>官方回答：</p><blockquote><p>On many Linux systems the default firewall can be configured with iptables. You will have to allow all incoming and outgoing traffic on UDP port 33001 (or whatever your Aspera UDP port is), which you can do with the following commands:</p></blockquote><p>使用如下命令进行操作：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -I INPUT -p tcp --dport 33001 -j ACCEPT</span><br><span class="line">iptables -I OUTPUT -p tcp --dport 33001 -j ACCEPT</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> software </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>测序数据常见文件类型</title>
      <link href="2020/10/02/filetype/"/>
      <url>2020/10/02/filetype/</url>
      
        <content type="html"><![CDATA[<p>各行各业都有在自己的标准体系，生物信息学数据分析也不例外，各个厂商出品的芯片系列，还有各种NGS组学分析，都会涉及到不同的分析步骤，有着丰富多样的中间文件。其中一些常用的文件就被规定成文件格式。 文件格式那么多，都可以了解一二，当然，不需要背诵它们所有的细节，不过对下面我们单独拿出来详细介绍的还是尽量要耳熟能详。</p><p>简单来说，测序得到的是带有质量值的碱基序列(fastq格式)；参考基因组是(fasta格式)；用比对工具把fastq格式的序列回帖到对应的fasta格式的参考基因组序列，就可以产生sam格式的比对文件；把sam格式的文本文件压缩成二进制的bam文件可以节省空间；如果对参考基因组上面的各个区段标记它们的性质，比如哪些区域是外显子，内含子，UTR等等，这就是gtf/gff格式； 如果只是为了单纯描述某个基因组区域，就是bed格式文件，记录染色体号以及起始终止坐标，正负链即可；如果是记录某些位点或者区域碱基的变化，就是VCF文件格式；如果仅仅是为了追踪参考基因组的各个区域的覆盖度，测序深度就可以用bigwig/wig格式。上面是对这些生信中的数据格式进行简介，下面将对这些数据格式进行详述。</p><h2 id="fastq">FASTQ</h2><p><strong>简介</strong></p><p>FASTQ用于保存生物序列（通常是核酸序列）和其测序质量信息的标准格式。 其序列以及质量信息都是使用一个ASCII字符标示，最初由Sanger开发。 目的是将FASTA序列与质量数据放到一起，目前已经成为高通量测序结果的实施标准。</p><p><strong>一、定义和示例</strong></p><p>FASTQ文件中每个序列通常有四行：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">第一行是序列标识以及相关的描述信息，以‘@’开头 </span><br><span class="line">第二行是序列</span><br><span class="line">第三行以‘+’开头，后面是序列标示符、描述信息，或者什么也不加，但是“+”不能少。</span><br><span class="line">第四行，是质量信息，和第二行的序列相对应，每一个序列都有一个质量评分，根据评分体系的不同，每个字符的含义表示的数字也不相同。</span><br></pre></td></tr></table></figure><p>一个简单的示例如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@SEQ_ID</span><br><span class="line">GATTTGGGGTTCAAAGCAGTATCGATCAAATAGTAAATCCATTTGTTCAACTCACAGTTT</span><br><span class="line">+</span><br><span class="line">!&#39;&#39;*((((***+))%%%++)(%%%%).1***-+*&#39;&#39;))**55CCF&gt;&gt;&gt;&gt;&gt;&gt;CCCCCCC65</span><br></pre></td></tr></table></figure><p><strong>二、序列标识</strong></p><p>上面说到第一行是序列标识以及相关的描述信息，以‘@’开头。可以像上面的示例那么简单，但如果是正规测序仪下机的真实数据，通常会很复杂。比如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@EAS139:136:FC706VJ:2:2104:15343:197393 1:Y:18:ATCACG</span><br></pre></td></tr></table></figure><p>这个序列标识以及相关描述信息以冒号分割，每一个字段信息如下：</p><table><thead><tr class="header"><th>字段</th><th>解释</th></tr></thead><tbody><tr class="odd"><td>EAS139</td><td>the unique instrument name</td></tr><tr class="even"><td>136</td><td>the run id</td></tr><tr class="odd"><td>FC706VJ</td><td>the flowcell id</td></tr><tr class="even"><td>2</td><td>flowcell lane</td></tr><tr class="odd"><td>2104</td><td>tile number within the flowcell lane</td></tr><tr class="even"><td>15343</td><td>‘x’-coordinate of the cluster within the tile</td></tr><tr class="odd"><td>197393</td><td>‘y’-coordinate of the cluster within the tile</td></tr><tr class="even"><td>1</td><td>the member of a pair, 1 or 2 (paired-end or mate-pair reads only)</td></tr><tr class="odd"><td>Y</td><td>Y if the read fails filter (read is bad), N otherwise</td></tr><tr class="even"><td>18</td><td>0 when none of the control bits are on, otherwise it is an even number</td></tr><tr class="odd"><td>ATCACG</td><td>index sequence</td></tr></tbody></table><p>当然，上面的表格介绍的只是其中一个测序仪下机数据，如果是其它机器，产商可以自由定义标识符格式，因为fastq格式的第一行只需要以@符号开头即可。</p><p>不过，也有一些时候fastq数据并不是测序仪直接下机的，而且他人上传到了NCBI的SRA中心，我们下载下来解压后一般就没有了测序仪相关的标识，例子如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@SRR001666.1 071112_SLXA-EAS1_s_7:5:1:817:345 length&#x3D;36</span><br><span class="line">GGGTGATGGCCGCTGCCGATGGCGTCAAATCCCACC</span><br><span class="line">+SRR001666.1 071112_SLXA-EAS1_s_7:5:1:817:345 length&#x3D;36</span><br><span class="line">IIIIIIIIIIIIIIIIIIIIIIIIIIIIII9IG9IC</span><br></pre></td></tr></table></figure><p><strong>三、质量编码格式</strong></p><p>质量评分指的是一个碱基的错误概率的对数值。 其最初在Phred拼接软件中定义与使用，其后在许多软件中得到使用。 其质量得分与错误概率的对应关系见下表：</p><table><thead><tr class="header"><th>PHRED QUALITY SCORE</th><th>PROBABILITY OF INCORRECT BASE CALL</th><th>BASE CALL ACCURACY</th></tr></thead><tbody><tr class="odd"><td>10</td><td>1 in 10</td><td>90 %</td></tr><tr class="even"><td>20</td><td>1 in 100</td><td>99%</td></tr><tr class="odd"><td>30</td><td>1 in 1000</td><td>99.9%</td></tr><tr class="even"><td>40</td><td>1 in 10000</td><td>99.99%</td></tr><tr class="odd"><td>50</td><td>1 in 100000</td><td>99.999%</td></tr></tbody></table><blockquote><p>Phred quality scores Q are defined as a property which is logarithmically related to the base-calling error probabilities P. Q=-10lgP</p></blockquote><p>除了Phred质量得分换算标准，还有就是Solexa标准：是把P换成p/(1-p)</p><p>对于每个碱基的质量编码标示，不同的软件采用不同的方案，目前有5种方案：</p><ol type="1"><li>Sanger，Phred quality score，值的范围从0到92，对应的ASCII码从33到126，但是对于测序数据（raw read data）质量得分通常小于60，序列拼接或者mapping可能用到更大的分数。</li><li>Solexa/Illumina 1.0, Solexa/Illumina quality score，值的范围从-5到63，对应的ASCII码从59到126，对于测序数据，得分一般在-5到40之间。</li><li>Illumina 1.3+，Phred quality score，值的范围从0到62对应的ASCII码从64到126，低于测序数据，得分在0到40之间；</li><li>Illumina 1.5+，Phred quality score，但是0到2作为另外的标示。</li><li>Illumina 1.8+</li></ol><p>下面是更为直观的表示：</p><p><img src="/images/filtype/wiki-fastq-format.png" /></p><p><strong>四、文件后缀</strong></p><p>没有特别的规定，通常使用.fq, .fastq, .txt等。 但是要注意，这个文件格式主要指的是文本文件里面的每行每列的内容规则，并不是我们常见的计算机领域的mp3,mp4,avi,xls,doc等等。</p><p>其它注意事项:</p><ul><li>双端测序一般有两个文件（也可通过某种规则把两个文件合并成一个）。</li><li>第一个文件与第二个文件的行数完全一样，且测序序列的排列顺序完全一致。</li><li>在第一个文件中，描述信息的结尾是“/1”，表示是双端测序的一端；第二个文件中同样位置/行数的相对应的测序序列的描述信息则以“/2”结尾，表示是双端测序的另一端。（2.2.2的表2-5中有叙述）</li></ul><h2 id="fasta">FASTA</h2><p><strong>简介</strong></p><p>FASTA格式用于表示核苷酸序列或氨基酸序列的格式。 在这种格式中碱基对或氨基酸用单个字母来编码，且允许在序列前添加序列名及注释。 fasta序列格式是blast组织数据的基本格式，无论是数据库还是查询序列，大多数情况都使用fasta序列格式。 它要比上一小节介绍的FASTQ格式简明很多。</p><p><strong>一、定义和示例</strong></p><p>总的来说，Fasta格式开始于一个标识符："&gt;"，然后是一行描述，下面是的序列，直到下一个"&gt;",表示下一条。</p><p>下面是一个来源于NCBI的fasta格式序列：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;gi|187608668|ref|NM_001043364.2| Bombyx mori moricin (Mor), mRNA</span><br><span class="line">AAACCGCGCAGTTATTTAAAATATGAATATTTTAAAACTTTTCTTTGTTTTTA</span><br><span class="line">TTGTGGCAATGTCTCTGGTGTCATGTAGTACAGCCGCTCCAGCAAAAATACCT</span><br><span class="line">ATCAAGGCCATTAAGACTGTAGGAAAGGCAGTCGGTAAAGGTCTAAGAGCCAT </span><br><span class="line">ATCAAGGCCATTAA</span><br></pre></td></tr></table></figure><p>Fasta格式首先以大于号“&gt;”开头，接着是序列的标识符“gi|187608668|ref|NM_001043364.2|”，然后是序列的描述信息。 换行后是序列信息，序列中允许空格，换行，空行，直到下一个大于号，表示该序列的结束。 下面简单给一个表格说明序列来源的数据库与对应的标识符</p><table><colgroup><col style="width: 53%" /><col style="width: 46%" /></colgroup><thead><tr class="header"><th>Database Name数据库名称</th><th>Identifier Syntax 标识符</th></tr></thead><tbody><tr class="odd"><td>GenBank</td><td><code>gb                    | | EMBL Data Library            |</code>emb</td></tr><tr class="even"><td>DDBJ, DNA Database of Japan</td><td><code>dbj                  | | NBRF PIR                     |</code>pir</td></tr><tr class="odd"><td>Protein Research Foundation</td><td><code>prf                  | | SWISS-PROT                   |</code>sp</td></tr><tr class="even"><td>Brookhaven Protein Data Bank</td><td><code>pdb                   | | Patents                      |</code>pat</td></tr><tr class="odd"><td>GenInfo Backbone Id</td><td><code>bbs                  | | General database identifier  |</code> gnl</td></tr><tr class="even"><td>NCBI Reference Sequence</td><td><code>ref                  | | Local Sequence identifier    |</code>lcl</td></tr></tbody></table><p>通常情况下序列的标识符不会像上面的例子那样复杂，再复杂的标识符也是有规则的，上面的标识符是NCBI定义的，可以去其官网了解详情。</p><p><strong>二、序列中字母代表的含义</strong></p><p>FASTA格式支持的核苷酸代码如下：</p><table><thead><tr class="header"><th>核苷酸代码</th><th>意义</th></tr></thead><tbody><tr class="odd"><td>A</td><td>Adenosine</td></tr><tr class="even"><td>C</td><td>Cytosine</td></tr><tr class="odd"><td>G</td><td>Guanine</td></tr><tr class="even"><td>T</td><td>Thymidine</td></tr><tr class="odd"><td>U</td><td>Uracil</td></tr><tr class="even"><td>R</td><td>G A (puRine)</td></tr><tr class="odd"><td>Y</td><td>T C (pYrimidine)</td></tr><tr class="even"><td>K</td><td>G T (Ketone)</td></tr><tr class="odd"><td>M</td><td>A C (aMino group)</td></tr><tr class="even"><td>S</td><td>G C (Strong interaction)</td></tr><tr class="odd"><td>W</td><td>A T (Weak interaction)</td></tr><tr class="even"><td>B</td><td>G T C (not A) (B comes after A)</td></tr><tr class="odd"><td>D</td><td>G A T (not C) (D comes after C)</td></tr><tr class="even"><td>H</td><td>A C T (not G) (H comes after G)</td></tr><tr class="odd"><td>V</td><td>G C A (not T, not U) (V comes after U)</td></tr><tr class="even"><td>N</td><td>A G C T (aNy)</td></tr><tr class="odd"><td>X</td><td>masked</td></tr><tr class="even"><td>-</td><td>gap of indeterminate length</td></tr></tbody></table><p>FASTA格式支持的氨基酸代码如下：</p><table><thead><tr class="header"><th>氨基酸代码</th><th>意义</th></tr></thead><tbody><tr class="odd"><td>A</td><td>Alanine</td></tr><tr class="even"><td>B</td><td>Aspartic acid or Asparagine</td></tr><tr class="odd"><td>C</td><td>Cysteine</td></tr><tr class="even"><td>D</td><td>Aspartic acid</td></tr><tr class="odd"><td>E</td><td>Glutamic acid</td></tr><tr class="even"><td>F</td><td>Phenylalanine</td></tr><tr class="odd"><td>G</td><td>Glycine</td></tr><tr class="even"><td>H</td><td>Histidine</td></tr><tr class="odd"><td>I</td><td>Isoleucine</td></tr><tr class="even"><td>K</td><td>Lysine</td></tr><tr class="odd"><td>L</td><td>Leucine</td></tr><tr class="even"><td>M</td><td>Methionine</td></tr><tr class="odd"><td>N</td><td>Asparagine</td></tr><tr class="even"><td>O</td><td>Pyrrolysine</td></tr><tr class="odd"><td>P</td><td>Proline</td></tr><tr class="even"><td>Q</td><td>Glutamine</td></tr><tr class="odd"><td>R</td><td>Arginine</td></tr><tr class="even"><td>S</td><td>Serine</td></tr><tr class="odd"><td>T</td><td>Threonine</td></tr><tr class="even"><td>U</td><td>Selenocysteine</td></tr><tr class="odd"><td>V</td><td>Valine</td></tr><tr class="even"><td>W</td><td>Tryptophan</td></tr><tr class="odd"><td>Y</td><td>Tyrosine</td></tr><tr class="even"><td>Z</td><td>Glutamic acid or Glutamine</td></tr><tr class="odd"><td>X</td><td>any</td></tr><tr class="even"><td>*</td><td>translation stop</td></tr><tr class="odd"><td>-</td><td>gap of indeterminate length</td></tr></tbody></table><p><strong>注意事项：</strong></p><p>对于自己构建的序列数据库（序列不是来源与NCBI或其他数据），可以采用“gnl|database|identifier”或者“lcl|identifier”格式，以保证可以使用blast的所有功能。 database或者identifier是需要指定的数据库的标识和序列标识，指定的名称可以用大小写字母、数字、下划线“_”、破折号“-”或者点号“.”。 注意名称是区分大小写的，同时不能出现空格，空格表示序列标识符结束。</p><p>数据库中的序列标识符必须保证唯一，许多时候格式数据库是formatdb报告错误，就是因为标示符重复，还有一点需要强调的是序列不能为空，否则也会报错。</p><h2 id="sam格式">SAM格式</h2><p><strong>简介</strong></p><p>SAM格式主要应用于测序序列mapping到基因组上的结果表示，当然也可以表示任意的多重比对结果。 SAM是一种序列比对格式标准，由sanger制定，是以TAB为分割符的文本格式。 SAM的全称是sequence alignment/map format。</p><p><strong>一、定义和示例</strong></p><p>SAM分为两部分，注释信息（header section ）和比对结果部分 （alignment section）。 通常是把FASTQ文件格式的测序数据比对到对应的参考基因组版本得到的。 注释信息并不是SAM文件的重点，是该SAM文件产生以及被处理过程的一个记录，规定以@开头，用不同的tag表示不同的信息，主要有：</p><ul><li><span class="citation" data-cites="HD">@HD</span>，说明符合标准的版本、对比序列的排列顺序；</li><li><span class="citation" data-cites="SQ">@SQ</span>，参考序列说明；</li><li><span class="citation" data-cites="RG">@RG</span>，比对上的序列（read）说明；</li><li><span class="citation" data-cites="PG">@PG</span>，使用的程序说明；</li><li><span class="citation" data-cites="CO">@CO</span>，任意的说明信息。</li></ul><p>一个简单的SAM文件例子如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@HD VN:1.0 SO:unsorted</span><br><span class="line">@SQ SN:chr1 LN:249250621</span><br><span class="line">@SQ SN:chr2 LN:243199373</span><br><span class="line">@PG ID:Bowtie VN:1.0.0 CL:&quot;bowtie genome&#x2F;hg19 -q reads&#x2F;SRR3101251.fastq -m 1 -p 4 -S&quot;</span><br><span class="line">SRR3101251.1 0 chr19 9486878 255 49M * 0 0 NTACTCCCACTACTCTCAGATTCAAGCAATCCTCCCACCCTAGCCCACC #1&#x3D;DDDFFHHHHHIHHIJJJHIJIIJIHIFHJIIJJJJJJJIIJJJJJJ XA:i:1 MD:Z:0A48 NM:i:1</span><br><span class="line">SRR3101251.5 16 chr2 240279787 255 49M * 0 0 CCTGAATCCATCAGAGCAGCCGGGCTGTGACACTCACTGTCATGATGTT JIJJIHIIIIJJJJJJJJJGHJJJJIIHJHICJIGCHHHHHFFFFFCCC XA:i:0 MD:Z:49 NM:i:0</span><br><span class="line">SRR3101251.6 4 * 0 0 * * 0 0 NATTCCCACCTATGAGTGAGAATATGCGGTGTTTGGTTTTTTGTTCTTG #1&#x3D;DDDFFHHHHHJJJGHIJJJJJJJJJJCGGIIJJIIJJJIJHJIIJJ XM:i:1</span><br></pre></td></tr></table></figure><p>前四行是注释信息，其后是比对结果，下面对比对结果进行解释，它是SAM格式文件的精华部分。</p><p><strong>二、比对结果详解</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SRR035022.2621862 163 16 59999 37 22S54M &#x3D; 60102 179 CCAACCCAACCCTAACCCTAACCCTAACCCTAACCCTAACCCTAACCCTAACCCTAACCGACCCTCACCCTCACCC &gt;AAA&#x3D;&gt;?AA&gt;@@B@B?AABAB?AABAB?AAC@B?@AB@A?A&gt;A@A?AAAAB??ABAB?79A?AAB;B?@?@&lt;&#x3D;8:8 XT:A:M XN:i:2 SM:i:37 AM:i:37 XM:i:0 XO:i:0 XG:i:0 RG:Z:SRR035022 NM:i:2 MD:Z:0N0N52 OQ:Z:CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCBCCCCCCBBCC@CCCCCCCCCCACCCCC;CCCBBC?CCCACCACA@</span><br></pre></td></tr></table></figure><p>所以在我们的例子中，每一个字段的说明如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">QNAMESRR035022.2621862</span><br><span class="line">FLAG163</span><br><span class="line">RNAME16</span><br><span class="line">POS59999</span><br><span class="line">MAQ37</span><br><span class="line">CIGAR22S54M</span><br><span class="line">MRNM&#x3D;</span><br><span class="line">MPOS60102</span><br><span class="line">ISIZE179</span><br><span class="line">SEQCCAACCCAACCCTAACCCTAACCCTAACCCTAACCCTAACCCTAACCCTAACCCTAACCGACCCTCACCCTCACCC</span><br><span class="line">QUAL&gt;AAA&#x3D;&gt;?AA&gt;@@B@B?AABAB?AABAB?AAC@B?@AB@A?A&gt;A@A?AAAAB??ABAB?79A?AAB;B?@?@&lt;&#x3D;8:8</span><br><span class="line">TAGXT:A:M</span><br><span class="line">TAGXN:i:2</span><br><span class="line">TAGSM:i:37</span><br><span class="line">TAGAM:i:37</span><br><span class="line">TAGXM:i:0</span><br><span class="line">TAGXO:i:0</span><br><span class="line">TAGXG:i:0</span><br><span class="line">TAGRG:Z:SRR035022</span><br><span class="line">TAGNM:i:2</span><br><span class="line">TAGMD:Z:0N0N52</span><br><span class="line">TAGOQ:Z:CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCBCCCCCCBBCC@CCCCCCCCCCACCCCC;CCCBBC?CCCACCACA</span><br></pre></td></tr></table></figure><p>比对结果部分（alignment section），每一行表示一个片段（segment）的比对信息，包括11个必须的字段（mandatory fields）和一个可选的字段，字段之间用tag分割。</p><p>必须的字段有11个，顺序固定，不可自行改动，根据字段定义，可以为’0‘或者’*‘，这是11个字段包括：</p><ol type="1"><li>QNAME，比对片段的（template）的编号；</li><li>FLAG，位标识，template mapping情况的数字表示，每一个数字代表一种比对情况，这里的值是符合情况的数字相加总和； （picard专门有一个工具解读sam的flag:http://broadinstitute.github.io/picard/explain-flags.html）</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1The read is one of a pair  read是pair中的一条（read表示本条read，mate表示pair中的另一条read）</span><br><span class="line">2The alignment is one end of a proper paired-end alignment  pair一正一负完美的比对上</span><br><span class="line">4The read has no reported alignments  这条read没有比对上</span><br><span class="line">8The read is one of a pair and has no reported alignments  mate没有比对上</span><br><span class="line">16The alignment is to the reverse reference strand  这条read反向比对</span><br><span class="line">32The other mate in the paired-end alignment is aligned to the reverse reference strand   mate反向比对</span><br><span class="line">64The read is the first (#1) mate in a pair  这条read是read1</span><br><span class="line">128The read is the second (#2) mate in a pair  这条read是read2</span><br></pre></td></tr></table></figure><ol type="1"><li>RNAME，参考序列的编号，如果注释中对SQ-SN进行了定义，这里必须和其保持一致，另外对于没有mapping上的序列，这里是’*‘；</li><li>POS，比对上的位置，注意是从1开始计数，没有比对上，此处为0；</li><li>MAPQ，mappint的质量；</li><li>CIGAR，简要比对信息表达式（Compact Idiosyncratic Gapped Alignment Report），其以参考序列为基础，使用数字加字母表示比对结果，比如3S6M1P1I4M，前三个碱基被剪切去除了，然后6个比对上了，然后打开了一个缺口，有一个碱基插入，最后是4个比对上了，是按照顺序的；</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">“M”表示 match或 mismatch；</span><br><span class="line">“I”表示 insert；</span><br><span class="line">“D”表示 deletion；</span><br><span class="line">“N”表示 skipped（跳过这段区域）；</span><br><span class="line">“S”表示 soft clipping（被剪切的序列存在于序列中）；</span><br><span class="line">“H”表示 hard clipping（被剪切的序列不存在于序列中）；</span><br><span class="line">“P”表示 padding；</span><br><span class="line">“&#x3D;”表示 match；</span><br><span class="line">“X”表示 mismatch（错配，位置是一一对应的）；</span><br></pre></td></tr></table></figure><ol type="1"><li>RNEXT，下一个片段比对上的参考序列的编号，没有另外的片段，这里是’*‘，同一个片段，用’=‘；</li><li>PNEXT，下一个片段比对上的位置，如果不可用，此处为0；</li><li>TLEN，Template的长度，最左边得为正，最右边的为负，中间的不用定义正负，不分区段（single-segment)的比对上，或者不可用时，此处为0；</li><li>SEQ，序列片段的序列信息，如果不存储此类信息，此处为’*‘，注意CIGAR中M/I/S/=/X对应数字的和要等于序列长度；</li><li>QUAL，序列的质量信息，格式同FASTQ一样。read质量的ASCII编码。</li><li>可选字段（optional fields)，格式如：TAG:TYPE:VALUE，其中TAG有两个大写字母组成，每个TAG代表一类信息，每一行一个TAG只能出现一次，TYPE表示TAG对应值的类型，可以是字符串、整数、字节、数组等。</li></ol><p><strong>三、SAM要处理好的问题</strong></p><ul><li>非常多序列（read)，mapping到多个参考基因组（reference）上</li><li>同一条序列，分多段（segment）比对到参考基因组上</li><li>无限量的，结构化信息表示，包括错配、删除、插入等比对信息</li></ul><p>要注意的几个概念，以及与之对应的模型：</p><ul><li>reference</li><li>read</li><li>segment</li><li>template（参考序列和比对上的序列共同组成的序列为template）</li><li>alignment</li><li>seq</li></ul><h2 id="bam-格式">BAM 格式</h2><p><strong>简介</strong></p><p>本质上就是二进制压缩的SAM文件，大部分生物信息学流程都需要这个格式，为了节省存储空间以及方便索引。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># BiocInstaller::biocLite(&#39;Rsamtools&#39;)</span><br><span class="line">library(Rsamtools) </span><br><span class="line">test_bam_file &lt;- &#39;data&#x2F;CHIP-seq.bam&#39; </span><br><span class="line">#fileter bam</span><br><span class="line">filter &lt;- FilterRules(list(MinWidth &#x3D; function(x) width(x$seq) &gt; 35))</span><br><span class="line">res &lt;- scanBam(test_bam_file, filter&#x3D;filter)[[1]]</span><br><span class="line">sapply(res, head)</span><br></pre></td></tr></table></figure><p>从上面的例子（需要在R里面运行）可以看到BAM文件需要用特殊的方法来读取，可以是R里面的Rsamtools包，也可以是linux环境下安装好的samtools软件，因为它是二进制文件，不能像普通的文本文件那样来打开。</p><p>我们用R里面的head函数查看了该BAM文件的前6行，比对的flag分别是<code>16 0 16 16 0 0</code>,说明有3条序列没有成功比对到基因组。width信息说明该序列长度都是36bp。序列的碱基以及对应的碱基质量也如上所述。</p><h2 id="vcf">VCF</h2><p><strong>简介</strong></p><p>Variant Call Format（VCF）是一个用于存储基因序列突变信息的文本格式。 可以表示单碱基突变, 插入/缺失, 拷贝数变异和结构变异等。 通常是对BAM文件格式的比对结果进行处理得到的。 BCF格式文件是VCF格式的二进制文件。</p><p><strong>一、定义和示例</strong></p><p><img src="/images/filtype/vcf_variation_class.jpg" /></p><p>如上图所示，vcf记录的即为各类型的变异。例如：点突变，拷贝数变异，插入，缺失等结构变异。</p><p>VCF分为两部分，注释信息和变异位点记录信息。</p><p>注释信息通常以#开头，会描述该VCF版本，目前以4.2居多，然后会一行行记录变异位点信息里面会出现的所有TAG。</p><p>下面这个是NCBI的dbSNP数据库里面的人类的vcf文件的部分截取：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">##fileformat&#x3D;VCFv4.0</span><br><span class="line">##fileDate&#x3D;20160601</span><br><span class="line">##source&#x3D;dbSNP</span><br><span class="line">##dbSNP_BUILD_ID&#x3D;147</span><br><span class="line">##reference&#x3D;GRCh37.p13</span><br><span class="line">##phasing&#x3D;partial</span><br><span class="line">##variationPropertyDocumentationUrl&#x3D;ftp:&#x2F;&#x2F;ftp.ncbi.nlm.nih.gov&#x2F;snp&#x2F;specs&#x2F;dbSNP_BitField_latest.pdf      </span><br><span class="line">##INFO&#x3D;&lt;ID&#x3D;RS,Number&#x3D;1,Type&#x3D;Integer,Description&#x3D;&quot;dbSNP ID (i.e. rs number)&quot;&gt;</span><br><span class="line">##INFO&#x3D;&lt;ID&#x3D;RSPOS,Number&#x3D;1,Type&#x3D;Integer,Description&#x3D;&quot;Chr position reported in dbSNP&quot;&gt;</span><br><span class="line">##INFO&#x3D;&lt;ID&#x3D;RV,Number&#x3D;0,Type&#x3D;Flag,Description&#x3D;&quot;RS orientation is reversed&quot;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#CHROM  POS     ID      REF     ALT     QUAL    FILTER  INFO</span><br><span class="line">1       10177   rs201752861     A       C       .       .       RS&#x3D;201752861;RSPOS&#x3D;10177;dbSNPBuildID&#x3D;137;SSR&#x3D;0;SAO&#x3D;0;VP&#x3D;0x050000020005000002000100;GENEINFO&#x3D;DDX11L1:100287102;WGT&#x3D;1;VC&#x3D;SNV;R5;ASP</span><br><span class="line">1       10177   rs367896724     A       AC      .       .       RS&#x3D;367896724;RSPOS&#x3D;10177;dbSNPBuildID&#x3D;138;SSR&#x3D;0;SAO&#x3D;0;VP&#x3D;0x050000020005170026000200;GENEINFO&#x3D;DDX11L1:100287102;WGT&#x3D;1;VC&#x3D;DIV;R5;ASP;VLD;G5A;G5;KGPhase3;CAF&#x3D;0.5747,0.4253;COMMON&#x3D;1</span><br><span class="line">1       10228   rs143255646     TA      T       .       .       RS&#x3D;143255646;RSPOS&#x3D;10229;dbSNPBuildID&#x3D;134;SSR&#x3D;0;SAO&#x3D;0;VP&#x3D;0x050000020005000002000200;GENEINFO&#x3D;DDX11L1:100287102;WGT&#x3D;1;VC&#x3D;DIV;R5;ASP</span><br><span class="line">1       10228   rs200462216     TAACCCCTAACCCTAACCCTAAACCCTA    T       .       .       RS&#x3D;200462216;RSPOS&#x3D;10229;dbSNPBuildID&#x3D;137;SSR&#x3D;0;SAO&#x3D;0;VP&#x3D;0x050000020005000002000200;GENEINFO&#x3D;DDX11L1:100287102;WGT&#x3D;1;VC&#x3D;DIV;R5;ASP</span><br><span class="line">1       10230   rs775928745     AC      A       .       .       RS&#x3D;775928745;RSPOS&#x3D;10231;dbSNPBuildID&#x3D;144;SSR&#x3D;0;SAO&#x3D;0;VP&#x3D;0x050000020005000002000200;GENEINFO&#x3D;DDX11L1:100287102;WGT&#x3D;1;VC&#x3D;DIV;R5;ASP</span><br><span class="line">1       10231   rs200279319     C       A       .       .       RS&#x3D;200279319;RSPOS&#x3D;10231;dbSNPBuildID&#x3D;137;SSR&#x3D;0;SAO&#x3D;0;VP&#x3D;0x050000020005000002000100;GENEINFO&#x3D;DDX11L1:100287102;WGT&#x3D;1;VC&#x3D;SNV;R5;ASP</span><br><span class="line">1       10234   rs145599635     C       T       .       .       RS&#x3D;145599635;RSPOS&#x3D;10234;dbSNPBuildID&#x3D;134;SSR&#x3D;0;SAO&#x3D;0;VP&#x3D;0x050100020005000002000100;GENEINFO&#x3D;DDX11L1:100287102;WGT&#x3D;1;VC&#x3D;SNV;SLO;R5;ASP</span><br><span class="line">1       10235   rs540431307     T       TA      .       .       RS&#x3D;540431307;RSPOS&#x3D;10235;dbSNPBuildID&#x3D;142;SSR&#x3D;0;SAO&#x3D;0;VP&#x3D;0x050000020005040024000200;GENEINFO&#x3D;DDX11L1:100287102;WGT&#x3D;1;VC&#x3D;DIV;R5;ASP;VLD;KGPhase3;CAF&#x3D;0.9988,0.001198;COMMON&#x3D;0</span><br><span class="line">1       10247   rs796996180     T       C       .       .       RS&#x3D;796996180;RSPOS&#x3D;10247;dbSNPBuildID&#x3D;146;SSR&#x3D;0;SAO&#x3D;0;VP&#x3D;0x050100020005000002000100;GENEINFO&#x3D;DDX11L1:100287102;WGT&#x3D;1;VC&#x3D;SNV;SLO;R5;ASP</span><br></pre></td></tr></table></figure><p>限于文章篇幅限制，我只是截取了该VCF文件的部分注释信息，很明显可以看到注释信息刚刚开始的几行其实是没有规则的，只需要以##开头即可，描述一些必备信息，包括参考基因组版本，得到该VCF文件的命令是什么等等。</p><p>后面的都是以INFO=&lt;ID=······&gt;的形式来介绍一个个TAG，这些TAG都是会在VCF的正文，变异位点记录里面用到的。而且每个tag都很容易理解，就是对应的英文描述而已。</p><p>接下来我们看看比较复杂的正文部分，就是变异位点记录信息。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#CHROM  POS     ID      REF     ALT     QUAL    FILTER  INFO    FORMAT  sample1</span><br><span class="line">1       858691  .       TG      T       222     .       INDEL;IDV&#x3D;37;IMF&#x3D;0.486842;DP&#x3D;76;VDB&#x3D;0.110516;SGB&#x3D;-0.693139;MQSB&#x3D;1;MQ0F&#x3D;0;ICB&#x3D;1;HOB&#x3D;0.5;AC&#x3D;1;AN&#x3D;2;DP4&#x3D;12,24,14,22;MQ&#x3D;60  GT:PL   0&#x2F;1:255,0,255</span><br><span class="line">1       858801  .       A       G       222     .       DP&#x3D;59;VDB&#x3D;0.728126;SGB&#x3D;-0.692717;RPB&#x3D;0.748623;MQB&#x3D;1;MQSB&#x3D;1;BQB&#x3D;0.963908;MQ0F&#x3D;0;ICB&#x3D;1;HOB&#x3D;0.5;AC&#x3D;1;AN&#x3D;2;DP4&#x3D;14,17,11,12;MQ&#x3D;60    GT:PL   0&#x2F;1:255,0,255</span><br><span class="line">1       859404  .       C       G       222     .       DP&#x3D;81;VDB&#x3D;0.0896228;SGB&#x3D;-0.693132;RPB&#x3D;0.849598;MQB&#x3D;1;MQSB&#x3D;1;BQB&#x3D;0.486963;MQ0F&#x3D;0;ICB&#x3D;1;HOB&#x3D;0.5;AC&#x3D;1;AN&#x3D;2;DP4&#x3D;17,15,18,16;MQ&#x3D;60   GT:PL   0&#x2F;1:255,0,255</span><br><span class="line">1       859690  .       C       G       222     .       DP&#x3D;75;VDB&#x3D;0.0662538;SGB&#x3D;-0.69312;RPB&#x3D;0.959181;MQB&#x3D;1;MQSB&#x3D;1;BQB&#x3D;0.962588;MQ0F&#x3D;0;ICB&#x3D;1;HOB&#x3D;0.5;AC&#x3D;1;AN&#x3D;2;DP4&#x3D;20,15,18,14;MQ&#x3D;60    GT:PL   0&#x2F;1:255,0,255</span><br><span class="line">1       859701  .       C       G       222     .       DP&#x3D;74;VDB&#x3D;0.274853;SGB&#x3D;-0.693127;RPB&#x3D;0.97201;MQB&#x3D;1;MQSB&#x3D;1;BQB&#x3D;0.717302;MQ0F&#x3D;0;ICB&#x3D;1;HOB&#x3D;0.5;AC&#x3D;1;AN&#x3D;2;DP4&#x3D;19,15,19,14;MQ&#x3D;60     GT:PL   0&#x2F;1:255,0,255</span><br><span class="line">1       859913  .       A       G       222     .       DP&#x3D;67;VDB&#x3D;0.756546;SGB&#x3D;-0.693139;RPB&#x3D;0.950685;MQB&#x3D;1;MQSB&#x3D;1;BQB&#x3D;0.662934;MQ0F&#x3D;0;ICB&#x3D;1;HOB&#x3D;0.5;AC&#x3D;1;AN&#x3D;2;DP4&#x3D;18,10,19,17;MQ&#x3D;60    GT:PL   0&#x2F;1:255,0,255</span><br><span class="line">1       860416  .       G       A       222     .       DP&#x3D;79;VDB&#x3D;0.673886;SGB&#x3D;-0.693144;RPB&#x3D;0.11919;MQB&#x3D;1;MQSB&#x3D;1;BQB&#x3D;0.992984;MQ0F&#x3D;0;ICB&#x3D;1;HOB&#x3D;0.5;AC&#x3D;1;AN&#x3D;2;DP4&#x3D;18,15,24,15;MQ&#x3D;60     GT:PL   0&#x2F;1:255,0,255</span><br></pre></td></tr></table></figure><p>每一行代表一个Variant的信息。</p><p>CHROM 和 POS：代表参考序列名和variant的位置；如果是INDEL的话，位置是INDEL的第一个碱基位置。</p><p>ID：variant的ID。比如在dbSNP中有该SNP的id，则会在此行给出(这个需要自己下载dbSNP数据库文件进行注释才有的)。 若没有或者注释不上，则用’.'表示其为一个novel variant。</p><p>REF 和 ALT：参考序列的碱基 和 Variant的碱基。</p><p>QUAL：Phred格式(Phred_scaled)的质量值，表示在该位点存在variant的可能性；该值越高，则variant的可能性越大； 计算方法：Phred值 = -10 * log (1-p) p为variant存在的概率; 通过计算公式可以看出值为10的表示错误概率为0.1，该位点为variant的概率为90%。</p><p>FILTER：使用上一个QUAL值来进行过滤的话，是不够的。GATK能使用其它的方法来进行过滤，过滤结果中通过则该值为”PASS”;若variant不可靠，则该项不为”PASS”或”.”。</p><p>INFO： 这一行是variant的详细信息，内容很多，以下再具体详述。</p><p>FORMAT 和 sample1 ：这两行合起来提供了 sample1 这个sample的基因型的信息。’sample1′代表这该名称的样品，是由SAM/BAM文件中的@RG下的 SM 标签决定的。 (当然并不是所有的VCF都是由一个BAM文件产生，比如数据库dbSNP提供的vcf文件，就没有样本信息啦)</p><p><strong>1、第8列的INFO</strong></p><p>该列信息最多了，都是以 “TAG=Value”, 并使用”;”分隔的形式 。 其中 很多的注释信息在VCF文件的头部注释中给出。以下是这些TAG的解释</p><p>AC，AF 和 AN：AC(Allele Count) 表示该Allele的数目；AF(Allele Frequency) 表示Allele的频率； AN(Allele Number) 表示Allele的总数目。对于1个diploid sample而言：则基因型 0/1 表示sample为杂合子，Allele数为1(双倍体的sample在该位点只有1个等位基因发生了突变)，Allele的频率为0.5(双倍体的 sample在该位点只有50%的等位基因发生了突变)，总的Allele为2； 基因型 1/1 则表示sample为纯合的，Allele数为2，Allele的频率为1，总的Allele为2。</p><p>DP：reads覆盖度。是一些reads被过滤掉后的覆盖度。</p><p>Dels：Fraction of Reads Containing Spanning Deletions。进行SNP和INDEL calling的结果中，有该TAG并且值为0表示该位点为SNP，没有则为INDEL。</p><p>FS：使用Fisher’s精确检验来检测strand bias而得到的Fhred格式的p值。该值越小越好。一般进行filter的时候，可以设置 FS &lt; 10～20。</p><p>HaplotypeScore：Consistency of the site with at most two segregating haplotypes</p><p>InbreedingCoeff：Inbreeding coefficient as estimated from the genotype likelihoods per-sample when compared against the Hard-Weinberg expectation</p><p>MLEAC：Maximum likelihood expectation (MLE) for the allele counts (not necessarily the same as the AC), for each ALT allele, in the same order as listed</p><p>MLEAF：Maximum likelihood expectation (MLE) for the allele frequency (not necessarily the same as the AF), for each ALT alle in the same order as listed</p><p>MQ：RMS Mapping Quality</p><p>MQ0：Total Mapping Quality Zero Reads</p><p>MQRankSum：Z-score From Wilcoxon rank sum test of Alt vs. Ref read mapping qualities</p><p>QD：Variant Confidence/Quality by Depth</p><p>RPA：Number of times tandem repeat unit is repeated, for each allele (including reference)</p><p>RU：Tandem repeat unit (bases)</p><p>ReadPosRankSum：Z-score from Wilcoxon rank sum test of Alt vs. Ref read position bias</p><p>STR：Variant is a short tandem repeat</p><p><strong>2、9和10列代表基因型</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GT:AD:DP:GQ:PL 0&#x2F;1:173,141:282:99:255,0,255 </span><br><span class="line">GT:AD:DP:GQ:PL 0&#x2F;1:1,3:4:25.92:103,0,26</span><br></pre></td></tr></table></figure><p>看上面最后两列数据，这两列数据是对应的，前者为格式，后者为格式对应的数据。这些TAG也是可以在VCF的头文件找到的</p><p>GT：样品的基因型（genotype）。两个数字中间用’/'分开，这两个数字表示双倍体的sample的基因型。0 表示样品中有ref的allele； 1 表示样品中variant的allele； 2表示有第二个variant的allele。因此： 0/0 表示sample中该位点为纯合的，和ref一致； 0/1 表示sample中该位点为杂合的，有ref和variant两个基因型； 1/1 表示sample中该位点为纯合的，和variant一致。</p><p>AD 和 DP：AD(Allele Depth)为sample中每一种allele的reads覆盖度，在diploid中则是用逗号分割的两个值，前者对应ref基因型，后者对应variant基因型。</p><p>DP（Depth）为sample中该位点的测序深度。</p><p>GQ：基因型的质量值(Genotype Quality)。Phred格式(Phred_scaled)的质量值，表示在该位点该基因型存在的可能性；该值越高，则Genotype的可能性越大；计算方法：Phred值 = -10 * log (1-p) p为基因型存在的概率。</p><p>PL：指定的三种基因型的质量值(provieds the likelihoods of the given genotypes)。这三种指定的基因型为(0/0,0/1,1/1)，这三种基因型的概率总和为1。和之前不一致，该值越大，表明为该种基因型的可能性越小。 Phred值 = -10 * log (p) p为基因型存在的概率。</p><p><img src="/images/filtype/vcf_file_format.jpg" /></p><h2 id="gtf和gff">GTF和GFF</h2><p><strong>简介</strong></p><p>GFF全称为general feature format，这种格式主要是用来注释基因组。 GTF全称为gene transfer format，主要是用来对基因进行注释。 GTF和GFF格式是Sanger研究所定义，是一种简单的、方便的对于DNA、RNA以及蛋白质序列的特征进行描述的一种数据格式. 比如序列的哪里到哪里是基因，是转录本，是外显子，内含子或者CDS等等，已经成为序列注释的通用格式，许多软件都支持输入或者输出gff格式。</p><p><strong>一、定义和示例</strong></p><p>gff由tab键隔开的9列组成，以下是各列的说明：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Column 1: “seqid”</span><br><span class="line">序列的编号，编号的有效字符[a-zA-Z0-9.:^*$@!+_?-|]</span><br><span class="line">Column 2: “source”</span><br><span class="line">注释信息的来源，比如”Genescan”、”Genbank” 等，可以为空，为空用”.”点号代替</span><br><span class="line">Column 3: “type”</span><br><span class="line">注释信息的类型，比如Gene、cDNA、mRNA等，或者是SO对应的编号</span><br><span class="line">Columns 4 &amp; 5: “start” and “end”</span><br><span class="line">开始与结束的位置，注意计数是从1开始的。结束位置不能大于序列的长度</span><br><span class="line">Column 6: “score”</span><br><span class="line">得分，数字，是注释信息可能性的说明，可以是序列相似性比对时的E-values值或者基因预测是的P-values值。”.”表示为空。</span><br><span class="line">Column 7: “strand”</span><br><span class="line">序列的方向， +表示正义链, -反义链 , ? 表示未知.</span><br><span class="line">Column 8: “phase”</span><br><span class="line">仅对注释类型为 “CDS”有效，表示起始编码的位置，有效值为0、1、2。</span><br><span class="line">Column 9: “attributes”</span><br><span class="line">以多个键值对组成的注释信息描述，键与值之间用”&#x3D;“，不同的键值用”;“隔开，一个键可以有多个值，不同值用”,“分割。注意如果描述中包括tab键以及”,&#x3D;;”，要用URL转义规则进行转义，如tab键用 %09代替。键是区分大小写的，以大写字母开头的键是预先定义好的，在后面可能被其他注释信息所调用。</span><br></pre></td></tr></table></figure><p>预先定义的键包括：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ID 注释信息的编号，在一个GFF文件中必须唯一；</span><br><span class="line">Name 注释信息的名称，可以重复；</span><br><span class="line">Alias 别名</span><br><span class="line">Parent Indicates 该注释所属的注释，值为注释信息的编号，比如外显子所属的转录组编号，转录组所属的基因的编号。值可以为多个。</span><br><span class="line">Target Indicates： the target of a nucleotide-to-nucleotide or protein-to-nucleotide alignment.（核苷酸对核苷酸或蛋白质至核苷酸比对的靶点。）</span><br><span class="line">Gap：The alignment of the feature to the target if the two are not collinear (e.g. contain gaps).（如果两者不共线（例如包含间隙），则该特征与目标的对准）</span><br><span class="line">Derives_from：Used to disambiguate the relationship between one feature and another when the relationship is a temporal one rather than a purely structural “part of” one. This is needed for polycistronic genes.（用于消除一个特征与另一个特征之间的关系，当关系是一个时间的关系，而不是纯粹的结构“一部分”时。 这是多顺反子基因所必需的。）</span><br><span class="line">Note： 备注</span><br><span class="line">Dbxref ：数据库索引</span><br><span class="line">Ontology_term： A cross reference to an ontology term.</span><br></pre></td></tr></table></figure><p>下面是一个简单的实例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">##gff-version 3</span><br><span class="line">##sequence-region ctg123 1 1497228</span><br><span class="line">ctg123 . gene 1000 9000 . + . ID&#x3D;gene00001;Name&#x3D;EDEN</span><br><span class="line">ctg123 . TF_binding_site 1000 1012 . + . Parent&#x3D;gene00001</span><br><span class="line">ctg123 . mRNA 1050 9000 . + . ID&#x3D;mRNA00001;Parent&#x3D;gene00001</span><br><span class="line">ctg123 . mRNA 1050 9000 . + . ID&#x3D;mRNA00002;Parent&#x3D;gene00001 ctg123 . mRNA 1300 9000 . + . ID&#x3D;mRNA00003;Parent&#x3D;gene00001 ctg123 . exon 1300 1500 . + . Parent&#x3D;mRNA00003</span><br><span class="line">ctg123 . exon 1050 1500 . + . Parent&#x3D;mRNA00001,mRNA00002</span><br><span class="line">ctg123 . exon 3000 3902 . + . Parent&#x3D;mRNA00001,mRNA00003</span><br><span class="line">ctg123 . exon 5000 5500 . + . Parent&#x3D;mRNA00001,mRNA00002,mRNA00003</span><br><span class="line">ctg123 . exon 7000 9000 . + . Parent&#x3D;mRNA00001,mRNA00002,mRNA00003</span><br><span class="line">ctg123 . CDS 1201 1500 . + 0 ID&#x3D;cds00001;Parent&#x3D;mRNA00001</span><br><span class="line">ctg123 . CDS 3000 3902 . + 0 ID&#x3D;cds00001;Parent&#x3D;mRNA00001</span><br><span class="line">ctg123 . CDS 5000 5500 . + 0 ID&#x3D;cds00001;Parent&#x3D;mRNA00001</span><br><span class="line">ctg123 . CDS 7000 7600 . + 0 ID&#x3D;cds00001;Parent&#x3D;mRNA00001</span><br><span class="line">ctg123 . CDS 1201 1500 . + 0 ID&#x3D;cds00002;Parent&#x3D;mRNA00002</span><br><span class="line">ctg123 . CDS 5000 5500 . + 0 ID&#x3D;cds00002;Parent&#x3D;mRNA00002</span><br><span class="line">ctg123 . CDS 7000 7600 . + 0 ID&#x3D;cds00002;Parent&#x3D;mRNA00002</span><br><span class="line">ctg123 . CDS 3301 3902 . + 0 ID&#x3D;cds00003;Parent&#x3D;mRNA00003</span><br><span class="line">ctg123 . CDS 5000 5500 . + 2 ID&#x3D;cds00003;Parent&#x3D;mRNA00003</span><br><span class="line">ctg123 . CDS 7000 7600 . + 2 ID&#x3D;cds00003;Parent&#x3D;mRNA00003</span><br><span class="line">ctg123 . CDS 3391 3902 . + 0 ID&#x3D;cds00004;Parent&#x3D;mRNA00003</span><br><span class="line">ctg123 . CDS 5000 5500 . + 2 ID&#x3D;cds00004;Parent&#x3D;mRNA00003</span><br><span class="line">ctg123 . CDS 7000 7600 . + 2 ID&#x3D;cds00004;Parent&#x3D;mRNA00003</span><br></pre></td></tr></table></figure><p>可以看到第9列其实是可以无限扩展的，只需要以封号进行分割即可。</p><p><strong>二、GTF 与GFF的差异</strong></p><p>GTF文件以及GFF文件都由9列数据组成，这两种文件的前8列都是相同的（一些小的差别），它们的差别重点在第9列。</p><p>GTF文件的第9列同GFF文件不同，虽然同样是标签与值配对的情况，但标签与值之间以空格分开,而不是GFF里面的=号 且每个特征之后都要有分号，（包括最后一个特征）. 下面看一个GTF的实例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">17havanafive_prime_utr76873777687427.-.gene_id &quot;ENSG00000141510&quot;; gene_version &quot;16&quot;; transcript_id &quot;ENST00000503591&quot;; transcript_version &quot;1&quot;; gene_name &quot;TP53&quot;; gene_source &quot;ensembl_havana&quot;; gene_biotype &quot;protein_coding&quot;; havana_gene &quot;OTTHUMG00000162125&quot;; havana_gene_version &quot;10&quot;; transcript_name &quot;TP53-003&quot;; transcript_source &quot;havana&quot;; transcript_biotype &quot;protein_coding&quot;; havana_transcript &quot;OTTHUMT00000367399&quot;; havana_transcript_version &quot;2&quot;; tag &quot;cds_end_NF&quot;; tag &quot;mRNA_end_NF&quot;; transcript_support_level &quot;5&quot;;</span><br><span class="line">17havanafive_prime_utr76773257677427.-.gene_id &quot;ENSG00000141510&quot;; gene_version &quot;16&quot;; transcript_id &quot;ENST00000503591&quot;; transcript_version &quot;1&quot;; gene_name &quot;TP53&quot;; gene_source &quot;ensembl_havana&quot;; gene_biotype &quot;protein_coding&quot;; havana_gene &quot;OTTHUMG00000162125&quot;; havana_gene_version &quot;10&quot;; transcript_name &quot;TP53-003&quot;; transcript_source &quot;havana&quot;; transcript_biotype &quot;protein_coding&quot;; havana_transcript &quot;OTTHUMT00000367399&quot;; havana_transcript_version &quot;2&quot;; tag &quot;cds_end_NF&quot;; tag &quot;mRNA_end_NF&quot;; transcript_support_level &quot;5&quot;;</span><br><span class="line">17havanafive_prime_utr76765957676622.-.gene_id &quot;ENSG00000141510&quot;; gene_version &quot;16&quot;; transcript_id &quot;ENST00000503591&quot;; transcript_version &quot;1&quot;; gene_name &quot;TP53&quot;; gene_source &quot;ensembl_havana&quot;; gene_biotype &quot;protein_coding&quot;; havana_gene &quot;OTTHUMG00000162125&quot;; havana_gene_version &quot;10&quot;; transcript_name &quot;TP53-003&quot;; transcript_source &quot;havana&quot;; transcript_biotype &quot;protein_coding&quot;; havana_transcript &quot;OTTHUMT00000367399&quot;; havana_transcript_version &quot;2&quot;; tag &quot;cds_end_NF&quot;; tag &quot;mRNA_end_NF&quot;; transcript_support_level &quot;5&quot;;</span><br></pre></td></tr></table></figure><h2 id="genepred">GenePred</h2><p><strong>简介</strong></p><p>GenePred格式主要用于基因浏览器中基因预测的track。 如果有可变剪切的情况，那表格的每一行就是一个 transcript 的全部信息。</p><p><strong>一、定义和示例</strong></p><p>每一行的具体解释如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">table genePred</span><br><span class="line">&quot;A gene prediction.&quot;</span><br><span class="line">    (</span><br><span class="line">    string  name;               &quot;Name of gene&quot;</span><br><span class="line">    string  chrom;              &quot;Chromosome name&quot;</span><br><span class="line">    char[1] strand;             &quot;+ or - for strand&quot;</span><br><span class="line">    uint    txStart;            &quot;Transcription start position&quot;</span><br><span class="line">    uint    txEnd;              &quot;Transcription end position&quot;</span><br><span class="line">    uint    cdsStart;           &quot;Coding region start&quot;</span><br><span class="line">    uint    cdsEnd;             &quot;Coding region end&quot;</span><br><span class="line">    uint    exonCount;          &quot;Number of exons&quot;</span><br><span class="line">    uint[exonCount] exonStarts; &quot;Exon start positions&quot;</span><br><span class="line">    uint[exonCount] exonEnds;   &quot;Exon end positions&quot;</span><br><span class="line">    )</span><br></pre></td></tr></table></figure><p>如果觉得抽象，我们可以用示例来进行一下对比。小编在这里首先将模式植物拟南芥的gtf文件转化为gpd格式。<code>head -n 1</code> 看一下gpd文件第一行的样式。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#gpd</span><br><span class="line">AT1G01010.1Chr1+363058993759563063630,3995,4485,4705,5173,5438,3913,4276,4605,5095,5326,5899</span><br></pre></td></tr></table></figure><p>再来<code>grep</code>一下gtf文件中有<strong>AT1G01010.1</strong>信息的那些行是什么样</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#gtf</span><br><span class="line">Chr1Araport115UTR36313759.+.transcript_id &quot;AT1G01010.1&quot;; gene_id &quot;AT1G01010&quot;</span><br><span class="line">Chr1Araport11exon36313913.+.transcript_id &quot;AT1G01010.1&quot;; gene_id &quot;AT1G01010&quot;</span><br><span class="line">Chr1Araport11start_codon37603762.+.transcript_id &quot;AT1G01010.1&quot;; gene_id &quot;AT1G01010&quot;</span><br><span class="line">Chr1Araport11CDS37603913.+0transcript_id &quot;AT1G01010.1&quot;; gene_id &quot;AT1G01010&quot;</span><br><span class="line">Chr1Araport11exon39964276.+.transcript_id &quot;AT1G01010.1&quot;; gene_id &quot;AT1G01010&quot;</span><br><span class="line">Chr1Araport11CDS39964276.+2transcript_id &quot;AT1G01010.1&quot;; gene_id &quot;AT1G01010&quot;</span><br><span class="line">Chr1Araport11exon44864605.+.transcript_id &quot;AT1G01010.1&quot;; gene_id &quot;AT1G01010&quot;</span><br><span class="line">Chr1Araport11CDS44864605.+0transcript_id &quot;AT1G01010.1&quot;; gene_id &quot;AT1G01010&quot;</span><br><span class="line">Chr1Araport11exon47065095.+.transcript_id &quot;AT1G01010.1&quot;; gene_id &quot;AT1G01010&quot;</span><br><span class="line">Chr1Araport11CDS47065095.+0transcript_id &quot;AT1G01010.1&quot;; gene_id &quot;AT1G01010&quot;</span><br><span class="line">Chr1Araport11exon51745326.+.transcript_id &quot;AT1G01010.1&quot;; gene_id &quot;AT1G01010&quot;</span><br><span class="line">Chr1Araport11CDS51745326.+0transcript_id &quot;AT1G01010.1&quot;; gene_id &quot;AT1G01010&quot;</span><br><span class="line">Chr1Araport11CDS54395630.+0transcript_id &quot;AT1G01010.1&quot;; gene_id &quot;AT1G01010&quot;</span><br><span class="line">Chr1Araport11exon54395899.+.transcript_id &quot;AT1G01010.1&quot;; gene_id &quot;AT1G01010&quot;</span><br><span class="line">Chr1Araport11stop_codon56285630.+.transcript_id &quot;AT1G01010.1&quot;; gene_id &quot;AT1G01010&quot;</span><br><span class="line">Chr1Araport113UTR56315899.+.transcript_id &quot;AT1G01010.1&quot;; gene_id &quot;AT1G01010&quot;</span><br></pre></td></tr></table></figure><p>我们可以看出，在GTF中，AT1G01010.1这个transcript共有6个CDS，那么对应到相应gpd文件AT1G01010.1这一行的第8列就是6，而第9列和第10列则是这6个CDS对应的起始和终止位置。</p><p>细心的朋友可能会发现，GTF文件中CDS起始位置在GenePred table中统统少了1，这其实就是两种文件的起始位置从1开始还是从0开始计数的区别。</p><p>GTF的产生和流行有其历史的原因。但是从技术角度来讲，这个文件格式是个非常差劲的格式。</p><p>GTF格式非常冗余。以人类转录组为例，Gencode V22的GTF文件为1.2G，压缩之后只有40M。大家知道压缩软件的压缩比是和软件的冗余程度。很少有文件能够压缩到1/30的大小。可见GTF格式多么冗余。GTF格式（及其早期版本GFF等）有很好的替代格式。从信息量上来讲：GTF 等价于 GenePred （Bed12) + Gene_Anno_table。</p><p>GenePred是Jimmy Kent创建UCSC genome browser的时候建立的文件格式。UCSC的文件格式定义是非常smart的，包括之后我可能会讲到的2bit，bigwig格式。</p><p><strong>二、GTF vs GenePred</strong></p><ul><li>从文件大小上来看，压缩前：GTF（1.2G) &gt;&gt; Genepred(23M) + Gene_Anno_table (2.8M)。压缩后：GTF(40M) &gt;&gt; GenePred(7.8M) +Gene_Anno_table (580K)</li><li>从可读性来讲，GTF是以gene interval 为单位（行），每行可以是gene，transcript，exon，intron，utr等各种信息，看起来什么都在里面，很全面，其实可读性非常差，而且容易产生各种错误。GenePred格式是以transcript为单位，每行就是一个transcript，简洁直观。</li><li>从程序处理的角度来讲：以GTF文件作为输入的程序，如果换成以GenePred格式为输入，编程的难度会降低一个数量级，运算时间会快很多，代码的可读性强很多。</li></ul><p>GTF 转换成GenePred：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gtfToGenePred -genePredExt -ignoreGroupsWithoutExons -geneNameAsName2 test.gtf test.gpd</span><br></pre></td></tr></table></figure><p>Gene_Anno_table: 其实就是把GTF的所有transcript行的第9列转换变成一个表格。</p><h2 id="bed">BED</h2><p><strong>简介</strong></p><p>BED 文件格式提供了一种灵活的方式来定义的数据行，用于描述注释的信息。 跟GTF/GFF格式一样，也可以用来描述基因组特征。但没有GTF/GFF格式那么正规，通常用来描述 任何人为定义的区间。 但没有GTF/GFF格式那么正规，通常用来描述任何人为定义的区间。 所以BED格式最重要的就是染色体加上起始终止坐标这3列。</p><p><strong>一、定义和示例</strong></p><p>BED行有3个必须的列和9个额外可选的列。 每行的数据格式要求一致。</p><p><strong>1、必须包含的3列是：</strong></p><ol type="1"><li>chrom, 染色体或scafflold 的名字(eg chr3， chrY, chr2_random, scaffold0671 )</li><li>chromStart 染色体或scaffold的起始位置，染色体第一个碱基的位置是0</li><li>chromEnd 染色体或scaffold的结束位置，染色体的末端位置没有包含到显示信息里面。例如，首先得100个碱基的染色体定义为chromStart =0 . chromEnd=100, 碱基的数目是0-99</li></ol><p><strong>2、9 个额外的可选列:</strong></p><ol type="1"><li>name 指定BED行的名字，这个名字标签会展示在基因组浏览器中的bed行的左侧。</li><li>score 0到1000的分值，如果在注释数据的设定中将原始基线设置为１，那么这个分值会决定现示灰度水平（数字越大，灰度越高）</li><li>strand 定义链的方向，''+” 或者”-”</li><li>thickStart 起始位置（The starting position at which the feature is drawn thickly）(例如，基因起始编码位置）</li><li>thickEnd 终止位置（The ending position at which the feature is drawn thickly）（例如：基因终止编码位置）　</li><li>itemRGB 是一个RGB值的形式, R, G, B (eg. 255, 0, 0), 如果itemRgb设置为'On”, 这个RBG值将决定数据的显示的颜色。</li><li>blockCount BED行中的block数目，也就是外显子数目</li><li>blockSize 用逗号分割的外显子的大小,这个item的数目对应于BlockCount的数目</li><li>blockStarts- 用逗号分割的列表, 所有外显子的起始位置，数目也与blockCount数目对应.</li></ol><p><strong>3、一个简单的示例如下：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">track name&#x3D;pairedReads description&#x3D;&quot;Clone Paired Reads&quot; useScore&#x3D;1</span><br><span class="line">chr22 1000 5000 cloneA 960 + 1000 5000 0 2 567,488, 0,3512</span><br><span class="line">chr22 2000 6000 cloneB 900 - 2000 6000 0 2 433,399, 0,3601</span><br></pre></td></tr></table></figure><p>bed格式有相应的软件来处理这类格式的文件，如bedtools。</p><ul><li><p>注意：用于在GBrowse上展示相关注释的bed格式通常第一行有一个关于track的描述信息。</p><p><strong>速记：</strong></p></li><li><p>bed不是床，缺了主要3列就得黄~</p></li><li><p>9列可选列，看了不会胡略略~</p></li></ul><p><strong>二、BED 与GFF的差异</strong></p><p>BED文件中起始坐标为0，结束坐标至少是1,</p><p>GFF中起始坐标是1而结束坐标至少是1。</p><h2 id="maf">MAF</h2><p><strong>简介</strong></p><p>MAF格式通常用于记录体细胞突变。 MAF本来并不是一个常见的文本文件格式，只是因为癌症研究实在是太热门了，对它的理解也变得需求旺盛起来了。</p><p><strong>一、MAF的说明</strong></p><p>这些文件应该使用下面描述的突变注释格式（MAF）进行格式化。另外下文中有文件命名规范。</p><p>以下几种类型的体细胞突变会在MAF文件中出现：</p><ul><li>错义突变及无义突变 <em>剪接位点，其定义为剪接位点2 bp以内的SNP </em>沉默突变 <em>与基因的编码区、剪接位点或遗传元件目标区域重叠的引物。 </em>移码突变 *调控区突变</li></ul><p>大部分MAF提交提交的是原始数据。这些原始数据中在体细胞中标记的位点与已知的变异类型相重合的。为避免有可能出现的细胞系污染，MAF规定了一定的下细胞过滤标准。根据现行政策，可开放获取MAF资料应满足：</p><ul><li>包括所有已验证的体细胞突变名称 <em>包括与编码区域或剪接位点重叠的所有未验证的体细胞突变名称 </em>排除所有其他类型的突变（即非体细胞突变、不在编码区域或剪接位点的未验证体的细胞突变以及未在dbSNP、COSMIC或OMIM中注释为体细胞的dbSNP位点）</li></ul><p>我们提交给DCC MAF存档的数据包括两种：Somatic MAF（named .somatic.maf）的开放访问数据以及不经过筛选的包含原始数据的Protected MAF（named.protected.maf）。所有数据将使用MAF标准进行格式化。</p><p><strong>二、MAF文件字段</strong></p><p>MAF文件的格式是以制表符分隔的列。这些列都在表1中进行了详细注释，每个MAF文件中都必须按照相应格式进行处理，DCC将验证每列的顺序是否符合标注。每列的标题和值有时需要区分大小写。列中允许出现空值（即空白单元格）或枚举值。验证器将查找是否存在一个符合规范（例如#version 2.4）的标题，如果没有，验证将会失败。除了出现在表1中的列外，也可以选择附加其他列。可选列不经过DCC验证，可以按任何顺序进行。</p><p>MAF文件可能有两种格式 ，可能是47列，或者120列，第一行一般都是 头文件，注释着每一列的信息，的确，信息量有点略大。如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line">     1Hugo_Symbol</span><br><span class="line">     2Entrez_Gene_Id</span><br><span class="line">     3Center</span><br><span class="line">     4NCBI_Build</span><br><span class="line">     5Chromosome</span><br><span class="line">     6Start_Position</span><br><span class="line">     7End_Position</span><br><span class="line">     8Strand</span><br><span class="line">     9Consequence</span><br><span class="line">    10Variant_Classification</span><br><span class="line">    11Variant_Type</span><br><span class="line">    12Reference_Allele</span><br><span class="line">    13Tumor_Seq_Allele1</span><br><span class="line">    14Tumor_Seq_Allele2</span><br><span class="line">    15dbSNP_RS</span><br><span class="line">    16dbSNP_Val_Status</span><br><span class="line">    17Tumor_Sample_Barcode</span><br><span class="line">    18Matched_Norm_Sample_Barcode</span><br><span class="line">    19Match_Norm_Seq_Allele1</span><br><span class="line">    20Match_Norm_Seq_Allele2</span><br><span class="line">    21Tumor_Validation_Allele1</span><br><span class="line">    22Tumor_Validation_Allele2</span><br><span class="line">    23Match_Norm_Validation_Allele1</span><br><span class="line">    24Match_Norm_Validation_Allele2</span><br><span class="line">    25Verification_Status</span><br><span class="line">    26Validation_Status</span><br><span class="line">    27Mutation_Status</span><br><span class="line">    28Sequencing_Phase</span><br><span class="line">    29Sequence_Source</span><br><span class="line">    30Validation_Method</span><br><span class="line">    31Score</span><br><span class="line">    32BAM_File</span><br><span class="line">    33Sequencer</span><br><span class="line">    34t_ref_count</span><br><span class="line">    35t_alt_count</span><br><span class="line">    36n_ref_count</span><br><span class="line">    37n_alt_count</span><br><span class="line">    38HGVSc</span><br><span class="line">    39HGVSp</span><br><span class="line">    40HGVSp_Short</span><br><span class="line">    41Transcript_ID</span><br><span class="line">    42RefSeq</span><br><span class="line">    43Protein_position</span><br><span class="line">    44Codons</span><br><span class="line">    45Hotspot</span><br><span class="line">    46cDNA_change</span><br><span class="line">    47Amino_Acid_Change</span><br><span class="line">     1Hugo_Symbol</span><br><span class="line">     2Entrez_Gene_Id</span><br><span class="line">     3Center</span><br><span class="line">     4NCBI_Build</span><br><span class="line">     5Chromosome</span><br><span class="line">     6Start_Position</span><br><span class="line">     7End_Position</span><br><span class="line">     8Strand</span><br><span class="line">     9Variant_Classification</span><br><span class="line">    10Variant_Type</span><br><span class="line">    11Reference_Allele</span><br><span class="line">    12Tumor_Seq_Allele1</span><br><span class="line">    13Tumor_Seq_Allele2</span><br><span class="line">    14dbSNP_RS</span><br><span class="line">    15dbSNP_Val_Status</span><br><span class="line">    16Tumor_Sample_Barcode</span><br><span class="line">    17Matched_Norm_Sample_Barcode</span><br><span class="line">    18Match_Norm_Seq_Allele1</span><br><span class="line">    19Match_Norm_Seq_Allele2</span><br><span class="line">    20Tumor_Validation_Allele1</span><br><span class="line">    21Tumor_Validation_Allele2</span><br><span class="line">    22Match_Norm_Validation_Allele1</span><br><span class="line">    23Match_Norm_Validation_Allele2</span><br><span class="line">    24Verification_Status</span><br><span class="line">    25Validation_Status</span><br><span class="line">    26Mutation_Status</span><br><span class="line">    27Sequencing_Phase</span><br><span class="line">    28Sequence_Source</span><br><span class="line">    29Validation_Method</span><br><span class="line">    30Score</span><br><span class="line">    31BAM_File</span><br><span class="line">    32Sequencer</span><br><span class="line">    33Tumor_Sample_UUID</span><br><span class="line">    34Matched_Norm_Sample_UUID</span><br><span class="line">    35HGVSc</span><br><span class="line">    36HGVSp</span><br><span class="line">    37HGVSp_Short</span><br><span class="line">    38Transcript_ID</span><br><span class="line">    39Exon_Number</span><br><span class="line">    40t_depth</span><br><span class="line">    41t_ref_count</span><br><span class="line">    42t_alt_count</span><br><span class="line">    43n_depth</span><br><span class="line">    44n_ref_count</span><br><span class="line">    45n_alt_count</span><br><span class="line">    46all_effects</span><br><span class="line">    47Allele</span><br><span class="line">    48Gene</span><br><span class="line">    49Feature</span><br><span class="line">    50Feature_type</span><br><span class="line">    51One_Consequence</span><br><span class="line">    52Consequence</span><br><span class="line">    53cDNA_position</span><br><span class="line">    54CDS_position</span><br><span class="line">    55Protein_position</span><br><span class="line">    56Amino_acids</span><br><span class="line">    57Codons</span><br><span class="line">    58Existing_variation</span><br><span class="line">    59ALLELE_NUM</span><br><span class="line">    60DISTANCE</span><br><span class="line">    61TRANSCRIPT_STRAND</span><br><span class="line">    62SYMBOL</span><br><span class="line">    63SYMBOL_SOURCE</span><br><span class="line">    64HGNC_ID</span><br><span class="line">    65BIOTYPE</span><br><span class="line">    66CANONICAL</span><br><span class="line">    67CCDS</span><br><span class="line">    68ENSP</span><br><span class="line">    69SWISSPROT</span><br><span class="line">    70TREMBL</span><br><span class="line">    71UNIPARC</span><br><span class="line">    72RefSeq</span><br><span class="line">    73SIFT</span><br><span class="line">    74PolyPhen</span><br><span class="line">    75EXON</span><br><span class="line">    76INTRON</span><br><span class="line">    77DOMAINS</span><br><span class="line">    78GMAF</span><br><span class="line">    79AFR_MAF</span><br><span class="line">    80AMR_MAF</span><br><span class="line">    81ASN_MAF</span><br><span class="line">    82EAS_MAF</span><br><span class="line">    83EUR_MAF</span><br><span class="line">    84SAS_MAF</span><br><span class="line">    85AA_MAF</span><br><span class="line">    86EA_MAF</span><br><span class="line">    87CLIN_SIG</span><br><span class="line">    88SOMATIC</span><br><span class="line">    89PUBMED</span><br><span class="line">    90MOTIF_NAME</span><br><span class="line">    91MOTIF_POS</span><br><span class="line">    92HIGH_INF_POS</span><br><span class="line">    93MOTIF_SCORE_CHANGE</span><br><span class="line">    94IMPACT</span><br><span class="line">    95PICK</span><br><span class="line">    96VARIANT_CLASS</span><br><span class="line">    97TSL</span><br><span class="line">    98HGVS_OFFSET</span><br><span class="line">    99PHENO</span><br><span class="line">   100MINIMISED</span><br><span class="line">   101ExAC_AF</span><br><span class="line">   102ExAC_AF_Adj</span><br><span class="line">   103ExAC_AF_AFR</span><br><span class="line">   104ExAC_AF_AMR</span><br><span class="line">   105ExAC_AF_EAS</span><br><span class="line">   106ExAC_AF_FIN</span><br><span class="line">   107ExAC_AF_NFE</span><br><span class="line">   108ExAC_AF_OTH</span><br><span class="line">   109ExAC_AF_SAS</span><br><span class="line">   110GENE_PHENO</span><br><span class="line">   111FILTER</span><br><span class="line">   112CONTEXT</span><br><span class="line">   113src_vcf_id</span><br><span class="line">   114tumor_bam_uuid</span><br><span class="line">   115normal_bam_uuid</span><br><span class="line">   116case_id</span><br><span class="line">   117GDC_FILTER</span><br><span class="line">   118COSMIC</span><br><span class="line">   119MC3_Overlap</span><br><span class="line">   120GDC_Validation_Status</span><br><span class="line">重要标准</span><br><span class="line">列表中每列的顺序最好与索引列相同。</span><br><span class="line">标有“Case Sensitive“的列所有标题都需要区分大小写。</span><br><span class="line">标有”Null“的列表示允许具有空值。</span><br><span class="line">标有“Enumerated column”的列表示具有指定的值，比如“Enumerated value” 是&quot;No&quot;表示该列没有指定的值；其他值表示允许列出的具体值; “Set”表示该列的值来自指定的一组已知值（例如HUGO基因符号）</span><br></pre></td></tr></table></figure><p><strong>三、MAF文件检查</strong></p><p>DCC 档案验证器将检查MAF文件的完整性。如果MAF文件中的任何一项出现错误，验证将失败：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">1.列标题文本（包括大小写）和顺序必须与表1完全一致</span><br><span class="line">2.表1中列出的列标题下的值不是空值时必须具有相应的值</span><br><span class="line">3.表1中指定为“Case Sensitive”的值必须区分大小写。</span><br><span class="line">4.如果列标题在规范中列出为具有枚举值（即“Enumerated”列的“Yes”），则这些列中的值必须来自“Enumerated”下列出的枚举值。</span><br><span class="line">5.如果规范中列标题具有设置值（即“Enumerated”列的“Set”），则那些列下的值必须来自该域的枚举值（例如，HUGO基因符号）。</span><br><span class="line">6.所有Allele-based列必须包含 –(deletion)或由以下大写字母组成的字符串：A，T，G，C。</span><br><span class="line">7.如果Validation_Status &#x3D;&#x3D; &quot;Untested&quot; 那么Tumor_Validation_Allele1, Tumor_Validation_Allele2, Match_Norm_Validation_Allele1, Match_Norm_Validation_Allele2 可以是空值(由 Validation_Status决定).</span><br><span class="line">a)如果Validation_Status &#x3D;&#x3D; &quot;Inconclusive&quot; 那么Tumor_Validation_Allele1, Tumor_Validation_Allele2, Match_Norm_Validation_Allele1, Match_Norm_Validation_Allele2 可以是空值(由 Validation_Status决定)</span><br><span class="line">8.如果Validation_Status &#x3D;&#x3D; Valid, 那么Validated_Tumor_Allele1 and Validated_Tumor_Allele2一定要是 A, C, G, T, 或“-“中的一种</span><br><span class="line"></span><br><span class="line">a)如果Validation_Status  &#x3D;&#x3D; &quot;Valid&quot; 那么Tumor_Validation_Allele1, Tumor_Validation_Allele2, Match_Norm_Validation_Allele1, Match_Norm_Validation_Allele2 不可以是空值</span><br><span class="line"></span><br><span class="line">b) 如果Validation_Status &#x3D;&#x3D; &quot;Invalid&quot; 那么Tumor_Validation_Allele1, Tumor_Validation_Allele2, Match_Norm_Validation_Allele1, Match_Norm_Validation_Allele2 不可以是空值Tumor_Validation_Allelle1 &#x3D;&#x3D; Match_Norm_Validation_Allele1 </span><br><span class="line">Tumor_Validation_Allelle2 &#x3D;&#x3D; Match_Norm_Validation_Allele2  (出现错误时，增加以替代8a)</span><br><span class="line"></span><br><span class="line">9.检查Mutation_Status的等位基因值:</span><br><span class="line">检查Validation_status的等位基因值:</span><br><span class="line"></span><br><span class="line">a)如果Mutation_Status &#x3D;&#x3D; &quot;Germline&quot; and Validation_Status &#x3D;&#x3D; &quot;Valid&quot;, 那么Tumor_Validation_Allele1 &#x3D;&#x3D; Match_Norm_Validation_Allele1 Tumor_Validation_Allele2 &#x3D;&#x3D; Match_Norm_Validation_Allele2.</span><br><span class="line"></span><br><span class="line">b)如果Mutation_Status &#x3D;&#x3D; &quot;Somatic&quot; ，Validation_Status &#x3D;&#x3D; &quot;Valid&quot;, 那么Match_Norm_Validation_Allele1 &#x3D;&#x3D; Match_Norm_Validation_Allele2 &#x3D;&#x3D; Reference_Allele 且(Tumor_Validation_Allele1 or Tumor_Validation_Allele2) !&#x3D; Reference_Allele</span><br><span class="line"></span><br><span class="line">c)如果Mutation_Status &#x3D;&#x3D; &quot;LOH&quot; and Validation_Status&#x3D;&#x3D;&quot;Valid&quot;, 那么Tumor_Validation_Allele1 &#x3D;&#x3D; Tumor_Validation_Allele2 Match_Norm_Validation_Allele1 !&#x3D; Match_Norm_Validation_Allele2 and Tumor_Validation_Allele1 &#x3D;&#x3D; (Match_Norm_Validation_Allele1 or Match_Norm_Validation_Allele2).</span><br><span class="line">10.检查 Start_position &lt;&#x3D; End_position</span><br><span class="line">11.根据Variant_Type检查Start_position和End_position: </span><br><span class="line">a)如果Variant_Type &#x3D;&#x3D; &quot;INS&quot;, 那么(End_position - Start_position + 1 &#x3D;&#x3D; length (Reference_Allele) 或End_position - Start_position &#x3D;&#x3D; 1) 且length(Reference_Allele) &lt;&#x3D; length(Tumor_Seq_Allele1 and Tumor_Seq_Allele2)</span><br><span class="line">b)如果Variant_Type &#x3D;&#x3D; &quot;DEL&quot;, 那么End_position - Start_position + 1 &#x3D;&#x3D; length (Reference_Allele), </span><br><span class="line">且length(Reference_Allele) &gt;&#x3D; length(Tumor_Seq_Allele1 and Tumor_Seq_Allele2)</span><br><span class="line">c)如果Variant_Type &#x3D;&#x3D; &quot;SNP&quot;, 那么length(Reference_Allele and Tumor_Seq_Allele1 and Tumor_Seq_Allele2) &#x3D;&#x3D;  1 且(Reference_Allele and Tumor_Seq_Allele1 and Tumor_Seq_Allele2) !&#x3D; &quot;-&quot;</span><br><span class="line">d)如果Variant_Type &#x3D;&#x3D; &quot;DNP&quot;, 那么length(Reference_Allele 和Tumor_Seq_Allele1 and Tumor_Seq_Allele2) &#x3D;&#x3D;  2 且(Reference_Allele and Tumor_Seq_Allele1 andTumor_Seq_Allele2) !contain &quot;-&quot;</span><br><span class="line">e)如果Variant_Type &#x3D;&#x3D; &quot;TNP&quot;, 那么length(Reference_Allele and Tumor_Seq_Allele1 and Tumor_Seq_Allele2) &#x3D;&#x3D;  3 且(Reference_Allele and Tumor_Seq_Allele1 and Tumor_Seq_Allele2) !contain &quot;-&quot;</span><br><span class="line">f)如果Variant_Type &#x3D;&#x3D; &quot;ONP&quot;, 那么length(Reference_Allele) &#x3D;&#x3D; length(Tumor_Seq_Allele1) &#x3D;&#x3D; length(Tumor_Seq_Allele2) &gt; 3 且(Reference_Allele and Tumor_Seq_Allele1 and Tumor_Seq_Allele2) !contain &quot;-&quot;</span><br><span class="line">12.基于UUID的文件的验证: </span><br><span class="line">a)列＃33必须包含肿瘤样本的BCR等分试样的UUID的Tumor_Sample_UUID</span><br><span class="line">b)列＃34必须是Matched_Norm_Sample_UUID，其中包含用于匹配正常样本的BCR等份的UUID</span><br><span class="line">c)由Tumor_Sample_Barcode和Matched_Norm_Sample_Barcode表示的元数据应分别对应于分配给Tumor_Sample_UUID和Matched_Norm_Sample_UUID的UUID</span><br></pre></td></tr></table></figure><p><strong>三、MAF命名协议</strong></p><p>在上传到DCC的档案中，MAF文件名应与以下方式与包含档案名称相关： 如果存档名称是：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;domain&gt;_&lt;disease_abbrev&gt;.&lt;platform&gt;.Level_2.&lt;serial_index&gt;.&lt;revision&gt;.0.tar.gz</span><br><span class="line">那么具有存档的公开的MAF文件命名依据为：</span><br><span class="line">&lt;domain&gt;_&lt;disease_abbrev&gt;.&lt;platform&gt;.Level_2.&lt;serial_index&gt;[.&lt;optional_tag&gt;].somatic.maf</span><br><span class="line">具有存档的受保护的MAF文件命名依据为：</span><br><span class="line">&lt;domain&gt;_&lt;disease_abbrev&gt;.&lt;platform&gt;.Level_2.&lt;serial_index&gt;[.&lt;optional_tag&gt;].protected.maf</span><br><span class="line">&lt;optional_tag&gt;可能包含字母数字字符、破折号或下划线，但不能有空格或句号。&lt;optional_tag&gt;可以省略。使用&lt;optional_tag&gt;的目的是给出一些简短的注释。</span><br><span class="line">例如，对于文件</span><br><span class="line">genome.wustl.edu_OV.IlluminaGA_DNASeq.Level_2.7.6.0.tar.gz</span><br></pre></td></tr></table></figure><p>有效的MAF名称的为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">genome.wustl.edu_OV.IlluminaGA_DNASeq.Level_2.7.preliminary.somatic.maf</span><br><span class="line">genome.wustl.edu_OV.IlluminaGA_DNASeq.Level_2.7.protected.maf</span><br></pre></td></tr></table></figure><h1 id="wigglebigwig和bedgraph">Wiggle、BigWig和bedgraph</h1><p><strong>简介</strong></p><p>Wiggle、BigWig和bedgraph仅仅用于追踪参考基因组的各个区域的覆盖度，测序深度。与sam/bam格式文件不同，bam或者bed格式的文件主要是为了追踪我们的reads到底比对到了参考基因组的哪些区域。注意这几者的差别。 Wiggle、BigWig和bedgraph均由UCSC规定的文件格式，可以无缝连接到UCSC的Genome Browser工具里面进行可视化。 wig和bigWig文件的优势在于可以体现出数据大小的变化和高低，例如组蛋白修饰的峰值等。</p><p><strong>一、定义</strong></p><p><strong>Bigwig：</strong>简写为bw，它规定了全基因组数据的每个坐标区间的测序深度，bigWig是通过wig格式的文件转换的二进制压缩文件，是一种全基因组计算或实验信号数据的压缩的，索引的二进制格式，使用该格式更加节省空间。 <strong>Wiggle</strong>：简写为wig，表示基因组上一个区域的信号，可以上传至UCSC上进行可视化。而wig文件也是和BED文件类似的包含区域信息的文件，一般使用MACS峰值探测后可以产生wig格式的文件。</p><p><strong>二、Wiggle文件示例</strong></p><p>Wig是一种比较老的格式，展示连续值的数据，比如GC百分比，转录组数据等，Wig的数据被压缩的，储存在128个独特的仓中，当导出为其他格式时，会有很小的损失。</p><p>在UCSC中具体使用哪种数据格式，细节见：http://genomewiki.ucsc.edu/index.php/Selecting_a_graphing_track_data_format。以UCSC给的Wig参考文件为例，Wig的数据是面向行的，第一行定义了track的属性，比如track type=wiggle_0，指定track为Wig track，为默认选项。其余为可选。一般不用管这些参数，除非你已经很熟悉UCSC的Genome Browser工具。下面是wiggle文件示例。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">track type&#x3D;wiggle_0 name&#x3D;&quot;variableStep&quot; description&#x3D;&quot;variableStep format&quot; visibility&#x3D;full autoScale&#x3D;off viewLimits&#x3D;0.0:25.0 color&#x3D;50,150,255 yLineMark&#x3D;11.76 yLineOnOff&#x3D;on priority&#x3D;10</span><br><span class="line">variableStep chrom&#x3D;chr19 span&#x3D;150</span><br><span class="line">49304701 10.0</span><br><span class="line">49304901 12.5</span><br><span class="line">49305401 15.0</span><br><span class="line">49305601 17.5</span><br><span class="line">49305901 20.0</span><br><span class="line">49306081 17.5</span><br><span class="line">49306301 15.0</span><br><span class="line">49306691 12.5</span><br><span class="line">49307871 10.0</span><br><span class="line">#200 base wide points graph at every 300 bases, 50 pixel high graph</span><br><span class="line">#autoScale off and viewing range set to [0:1000]</span><br><span class="line">#priority &#x3D; 20 positions this as the second graph</span><br><span class="line">#Note, one-relative coordinate system in use for this format</span><br><span class="line">track type&#x3D;wiggle_0 name&#x3D;&quot;fixedStep&quot; description&#x3D;&quot;fixedStep format&quot; visibility&#x3D;full autoScale&#x3D;off viewLimits&#x3D;0:1000 color&#x3D;0,200,100 maxHeightPixels&#x3D;100:50:20 graphType&#x3D;points priority&#x3D;20</span><br><span class="line">fixedStep chrom&#x3D;chr19 start&#x3D;49307401 step&#x3D;300 span&#x3D;200</span><br><span class="line">1000</span><br><span class="line"> 900</span><br><span class="line"> 800</span><br><span class="line"> 700</span><br><span class="line"> 600</span><br><span class="line"> 500</span><br><span class="line"> 400</span><br><span class="line"> 300</span><br><span class="line"> 200</span><br><span class="line"> 100</span><br></pre></td></tr></table></figure><p><strong>三、Wig文件详解</strong></p><p>Wig文件主要由两部分格式组成，<strong>variableStep format*<em>和*</em>fixedStep format</strong>。<strong>variableStep format</strong>以一个声明开始，明确了染色体的序号，跨度(span)。后面跟两列数据，染色体开始的碱基位置，数据的值value（可以理解为覆盖度）。span参数可以将含有相同value的连续碱基包含在一起，使数据更加简洁。如下，variableStep format span=150，包含的第一行数据49304701 10.0表示49304701-49304851有相同的value，为10.0。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">variableStep chrom&#x3D;chr2</span><br><span class="line">300701 12.5</span><br><span class="line">300702 12.5</span><br><span class="line">300703 12.5</span><br><span class="line">300704 12.5</span><br><span class="line">300705 12.5 </span><br></pre></td></tr></table></figure><p>等价于：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">variableStep chrom&#x3D;chr2 span&#x3D;5</span><br><span class="line">300701 12.5</span><br></pre></td></tr></table></figure><p>都表示在2号染色体300701-300705位置上有相同的value，且value=12.5。</p><p>第二部分为<strong>fixedStep format，</strong> 由声明和单列数据组成。声明部分和variableStep format中各变量的意义一样。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fixedStep chrom&#x3D;chr3 start&#x3D;400601 step&#x3D;100 span&#x3D;5</span><br><span class="line">11</span><br><span class="line">22</span><br><span class="line">33 </span><br></pre></td></tr></table></figure><p>表示在3号染色体400601-400605, 400701-400705, and 400801-400805三个区域，value值分别为11, 22, 和 33。Wig中的value值可以是整数，实数，正数或者负数。只有指定的位置有value值，没有制定的位置则没有value，且不会在UCSU Genome Browser中作出图。</p><p>其实对我们的bam文件，用samtools软件也可以很容易得到基因组区域的覆盖度和测序深度，比如：</p><p>samtools depth -r <strong>chr12:126073855-126073965</strong> Ip.sorted.bam</p><blockquote><p>chr12 126073855 5</p><p>chr12 126073856 15</p><p>chr12 126073857 31</p><p>chr12 126073858 40</p><p>chr12 126073859 44</p><p>chr12 126073860 52</p><p>...其余省略输出...</p></blockquote><p>这其实就是wig文件的雏形，但是wig文件会更复杂一点！</p><p>首先它不需要第一列了，因为全部是重复字段，只需要在每个染色体的第一行定义好染色体即可。</p><p><strong>四、文件转换示例</strong></p><p>BigWig格式是wig格式文件的二进制压缩版本，用于密集连续的数据，并在基因组浏览器中进行可视化，是UCSC推荐的一种格式。BigWig文件是由原始的Wig格式通过wigToBigWig工具转换过来， 转换工具命令示例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># create the chrom.sizes file for the UCSC database (e.g., hg19).</span><br><span class="line">fetchChromSizes  hg19 &gt; chrSize.txt</span><br><span class="line"># Convert wig to big wig:  </span><br><span class="line">wigToBigWig input.wig chrSize.txt myBigWig.bw</span><br></pre></td></tr></table></figure><p>输出的BigWig文件大约比原始Wig文件多占用50%的内存（UCSC数据格式转换代码见：http://barcwiki.wi.mit.edu/wiki/SOPs/coordinates）。也可以由bedGraph 格式通过bedGraphToBigWig转换，这里不作展开。BigWig的主要优点是仅将显示特定区域所需的部分传输到UCSC，所以对于大数据集的文件，BigWig比Wig文件速度快。BigWig主要存在用户可以获得的网页上(http, https or ftp)，而不在UCSC服务器上，只有当前正在查看的染色体位置所需的文件部分在本地缓存为一个“稀疏文件”。</p><p><strong>五、BedGraph文件示例</strong></p><p>最后顺便讲讲BedGraph ，它的trace type和Wig文件很像，不过后面的数据和bed文件很类似，ChIPseq数据做完peak calling后的bed文件最短只有三列，染色体序号，染色体起始位置和结束位置。如下图，前面的声明和Wig类似，后面的四列分别表示染色体序号，起始位置，结束位置和value值。相当于为bed文件的延伸格式。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">browser position chr19:49302001-49304701</span><br><span class="line">browser hide all</span><br><span class="line">browser pack refGene encodeRegions</span><br><span class="line">browser full altGraph</span><br><span class="line">#300 base wide bar graph, autoScale is on by default &#x3D;&#x3D; graphing</span><br><span class="line">#limits will dynamically change to always show full range of data</span><br><span class="line">#in viewing window, priority &#x3D; 20 positions this as the second graph</span><br><span class="line">#Note, zero-relative, half-open coordinate system in use for bedGraph format</span><br><span class="line">track type&#x3D;bedGraph name&#x3D;&quot;BedGraph Format&quot; description&#x3D;&quot;BedGraph format&quot; visibility&#x3D;full color&#x3D;200,100,0 altColor&#x3D;0,100,200 priority&#x3D;20</span><br><span class="line">chr19 49302000 49302300 -1.0</span><br><span class="line">chr19 49302300 49302600 -0.75</span><br><span class="line">chr19 49302600 49302900 -0.50</span><br><span class="line">chr19 49302900 49303200 -0.25</span><br><span class="line">chr19 49303200 49303500 0.0</span><br><span class="line">chr19 49303500 49303800 0.25</span><br><span class="line">chr19 49303800 49304100 0.50</span><br><span class="line">chr19 49304100 49304400 0.75</span><br><span class="line">chr19 49304400 49304700 1.00</span><br></pre></td></tr></table></figure><p><strong>文件格式选择</strong></p><p>Wig数据的元素大小必须是一样的。</p><p>如果数据大小不一样，应该使用bedGraph格式，如果数据过大，就转换为bigWig。</p>]]></content>
      
      
      <categories>
          
          <category> NGS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NGS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hemberg-lab单细胞转录组数据分析（五）</title>
      <link href="2020/09/28/hemberg-lab5/"/>
      <url>2020/09/28/hemberg-lab5/</url>
      
        <content type="html"><![CDATA[<h2 id="数据可视化">数据可视化</h2><p>我们继续使用上一步生成的<code>Tung</code>数据集。我们将探索不同的数据可视化方式来让你意识到质控后发生了什么。<code>scater</code>包提供了几个有用的简化可视化的函数。</p><p>scRNA-seq分析的一个重要方面是控制<code>批次效应</code>。批次效应是实验过程中引入的技术偏差。例如两个不同实验室准备的样品或同一实验室不同时间准备的样品，同时或同地准备的样品相似度更高。最差的情况，批次效应引入的差异可能大于生物本身的偏差，进而获得错误结果。因为样品处理过程记录详细，所以<code>Tung</code>数据集将允许我们探索这一现象。理想上，如果同一个体来源的细胞聚在一起，分组的数目与个体是对应的，就说明存在批次效应。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(SingleCellExperiment)</span><br><span class="line"><span class="keyword">library</span>(scater)</span><br><span class="line">options(stringsAsFactors = <span class="literal">FALSE</span>)</span><br><span class="line">umi &lt;- readRDS(<span class="string">&quot;data/tung/umi.rds&quot;</span>)</span><br><span class="line">umi.qc &lt;- umi[rowData(umi)$use, colData(umi)$use]</span><br><span class="line">endog_genes &lt;- !rowData(umi.qc)$is_feature_control</span><br></pre></td></tr></table></figure><h3 id="pca分析">PCA分析</h3><p>查看数据整体分布的最简单方式是<a href="https://mp.weixin.qq.com/s?__biz=MzI5MTcwNjA4NQ==&amp;mid=2247484036&amp;idx=1&amp;sn=22ee356d0c9680d56dada1b777985ed2&amp;scene=21#wechat_redirect">PCA主成分分析</a>,在其前两个主成分轴查看数据的分布。</p><p>主成分分析 (PCA)是一种数学降维方法, 利用正交变换 (orthogonal transformation)把一系列可能线性相关的变量转换为一组线性不相关的新变量，也称为主成分，从而利用新变量在更小的维度下展示数据的特征。</p><p>PCA分析不是简单地选取2个或3个变化最大的基因，而是先把原始的变量做一个评估，计算各个变量各自的变异度(方差)和两两变量的相关度（协方差），得到一个协方差矩阵。在这个协方差矩阵中，对角线的值为每一个变量的方差，其它值为每两个变量的协方差。随后对原变量的协方差矩阵对角化处理，即求解其特征值和特征向量。原变量与特征向量的乘积（对原始变量的线性组合）即为新变量（回顾下线性代数中的矩阵乘法）；新变量的协方差矩阵为对角协方差矩阵且对角线上的方差由大到小排列；然后从新变量中选择信息最丰富也就是方差最大的的前2个或前3个新变量也就是主成分用以可视化。</p><p><img src="/images/lab5/pca.png" /></p><h4 id="qc前">QC前</h4><p>不进行log转换:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">umi_endog &lt;- runPCA(umi_endog, exprs_values = <span class="string">&quot;counts&quot;</span>)</span><br><span class="line">scater::plotPCA(</span><br><span class="line">    umi_endog,</span><br><span class="line">    by_exprs_values = <span class="string">&quot;counts&quot;</span>,</span><br><span class="line">    colour_by = <span class="string">&quot;batch&quot;</span>,</span><br><span class="line">    size_by = <span class="string">&quot;total_features_by_counts&quot;</span>,</span><br><span class="line">    shape_by = <span class="string">&quot;individual&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><img src="/images/lab5/expr-overview-pca-before-qc1-1.png" /></p><p>log转化后</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">tmp &lt;- runPCA(</span><br><span class="line">  umi[endog_genes, ],</span><br><span class="line">  exprs_values = <span class="string">&quot;logcounts_raw&quot;</span></span><br><span class="line">)</span><br><span class="line">plotPCA(</span><br><span class="line">    tmp,</span><br><span class="line">    colour_by = <span class="string">&quot;batch&quot;</span>,</span><br><span class="line">    size_by = <span class="string">&quot;total_features_by_counts&quot;</span>,</span><br><span class="line">    shape_by = <span class="string">&quot;individual&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><img src="/images/lab5/expr-overview-pca-before-qc2-1.png" /></p><p>从图中可以看出，<code>log</code>转换更适合我们的数据，降低了第一主成分的变化，数据点的分布散开了些。对数转换可以使表达值更符合正态分布，在后续的分析中，我们都是使用对数转换后的数据。</p><p><strong>请注意,只是对数转换不足以屏蔽掉细胞之间不同的技术因子如测序深度带来的差异。因此实际分析时不要使用<code>logcounts_raw</code>,至少使用<code>SingleCellExperiment</code>对象中<code>logcounts</code>通道的值，这是CPM标准化后的log转换的值。</strong></p><h4 id="qc后">QC后</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">tmp &lt;- runPCA(</span><br><span class="line">  umi.qc[endog_genes, ],</span><br><span class="line">  exprs_values = <span class="string">&quot;logcounts_raw&quot;</span></span><br><span class="line">)</span><br><span class="line">plotPCA(</span><br><span class="line">    tmp,</span><br><span class="line">    colour_by = <span class="string">&quot;batch&quot;</span>,</span><br><span class="line">    size_by = <span class="string">&quot;total_features_by_counts&quot;</span>,</span><br><span class="line">    shape_by = <span class="string">&quot;individual&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><img src="/images/lab5/expr-overview-pca-after-qc-1.png" /></p><p>比较发现质控后<code>NA19098.r2</code>细胞不再成为离群组.</p><p>默认，<code>runPCA</code>函数只用了前500个在细胞之间表达变化最大的基因做PCA分析。可以通过参数<code>ntop</code>进行修改。</p><h3 id="tsne聚类">tSNE聚类</h3><p>scRNA-seq中另一个常用的可视化方法是<code>tSNE</code>。tSNE (t-Distributed Stochastic Neighbor Embedding) 通过组合降维（如PCA）和最近邻网络随机行走算法在保留细胞的局部距离的基础上实现高维数据（14000维基因表达）到二维空间的映射。与PCA不同，<code>tSNE</code>算法有随机性，每次运行结果都会不同。因为它的非线性和随机性特征，<code>tSNE</code>结果难以直观解释。为了保证重复性，我们固定一个随机数种子使得每次结果都一致。</p><p>PCA线性降维算法在集中将不相似的数据点放置在较低维度区域时，尽可能多的保留原始数据的差异，因此导致小部分数据点相距甚远，大部分数据重叠放置。tSNE把点的高维空间的<code>距离</code>转换成点的<code>相似度的概率</code>，维持高维空间和低维空间中一对点之间的<code>条件概率差值总和最小</code>。同时使用<code>t-分布的长尾性解决高维数据映射到低维时的重叠问题</code>。t-SNE算法定义了数据的局部和全局结构之间的软边界，既可以使点在局部分散，又在全局聚集，同时照顾近距离和远距离的点。其性能优于任何非线性降维算法。</p><h4 id="qc前tsne">QC前TSNE</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">set.seed(<span class="number">123456</span>)</span><br><span class="line">tmp &lt;- runTSNE(</span><br><span class="line">    umi[endog_genes, ],</span><br><span class="line">    exprs_values = <span class="string">&quot;logcounts_raw&quot;</span>,</span><br><span class="line">    perplexity = <span class="number">130</span></span><br><span class="line">)</span><br><span class="line">plotTSNE(</span><br><span class="line">    tmp,</span><br><span class="line">    colour_by = <span class="string">&quot;batch&quot;</span>,</span><br><span class="line">    size_by = <span class="string">&quot;total_features_by_counts&quot;</span>,</span><br><span class="line">    shape_by = <span class="string">&quot;individual&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><img src="/images/lab5/expr-overview-tsne-before-qc-1.png" /></p><h4 id="qc后tsne">QC后TSNE</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">set.seed(<span class="number">123456</span>)</span><br><span class="line">tmp &lt;- runTSNE(</span><br><span class="line">    umi.qc[endog_genes, ],</span><br><span class="line">    exprs_values = <span class="string">&quot;logcounts_raw&quot;</span>,</span><br><span class="line">    perplexity = <span class="number">130</span></span><br><span class="line">)</span><br><span class="line">plotTSNE(</span><br><span class="line">    tmp,</span><br><span class="line">    colour_by = <span class="string">&quot;batch&quot;</span>,</span><br><span class="line">    size_by = <span class="string">&quot;total_features_by_counts&quot;</span>,</span><br><span class="line">    shape_by = <span class="string">&quot;individual&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><img src="/images/lab5/expr-overview-tsne-after-qc-1.png" /></p><p>比较两张图可以发现质控过滤后<code>NA19098.r2</code>来源的细胞不再是异常值。</p><p><code>tSNE</code>要求提供一个<code>perplexity</code>参数用于指定构建最近邻网络的邻居数，这个值越高网络越致密细胞越成团围抱；这个值越小网络会越稀疏使得细胞不同的相似度分组相对分散。<code>scater</code>默认的<code>perplexity</code>值是细胞总数除以5（不能整除的部分舍去）。</p>]]></content>
      
      
      <categories>
          
          <category> SingleCell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SingleCell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hemberg-lab单细胞转录组数据分析（四）</title>
      <link href="2020/09/28/hemberg-lab4/"/>
      <url>2020/09/28/hemberg-lab4/</url>
      
        <content type="html"><![CDATA[<h1 id="umi表达定量-umi">UMI表达定量 (UMI)</h1><h2 id="umi表达定量-umi-1">UMI表达定量 (UMI)</h2><h3 id="umi表达定量简介">UMI表达定量简介</h3><p>基因定量后会整理成一个行为基因（或转录本）列为细胞的<strong>表达矩阵</strong>。虽然前面做了原始数据质控和测序数据质控移除了一部分从reads数层面就不合格的细胞，还需要进一步根据表达矩阵移除其它类型低质量细胞。如果未能识别并移除低质量细胞会混淆下游分析中的有意义的生物信息。</p><p>鉴于scRNASeq还没有标准方法，后续用到的质控质量值的标准会因为实验方法不同而有很大变化。因此，执行质控时，我们是通过数据集内部比较找到异常细胞，而不是依赖于其它独立的质量标准。因此比较不同的建库方法获得的不同数据集时需要格外注意。</p><h3 id="tung数据集">Tung数据集</h3><p>我们使用芝加哥大学<code>Yoav Gilad</code>实验室的3个不同来源的诱导多能性干细胞 (iPSC)的数据集。细胞分选采用<code>Fluidigm C1</code>微流控台，同时使用<code>UMIs</code>和<code>ERCC spike in</code>进行质控为了保证可重复性，数据是2016年3月15生成的原始数据的拷贝，存储于tung文件夹下。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(SingleCellExperiment)</span><br><span class="line"><span class="keyword">library</span>(scater)</span><br><span class="line">options(stringsAsFactors = <span class="literal">FALSE</span>)</span><br></pre></td></tr></table></figure><p>读入数据和注释：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">molecules &lt;- read.table(<span class="string">&quot;tung/molecules.txt&quot;</span>, sep = <span class="string">&quot;\t&quot;</span>)</span><br><span class="line">anno &lt;- read.table(<span class="string">&quot;tung/annotation.txt&quot;</span>, sep = <span class="string">&quot;\t&quot;</span>, header = <span class="literal">TRUE</span>)</span><br></pre></td></tr></table></figure><p>查看读入的数据：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">head(molecules[ , <span class="number">1</span>:<span class="number">3</span>])</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##                 NA19098.r1.A01 NA19098.r1.A02 NA19098.r1.A03</span></span><br><span class="line"><span class="comment">## ENSG00000237683              0              0              0</span></span><br><span class="line"><span class="comment">## ENSG00000187634              0              0              0</span></span><br><span class="line"><span class="comment">## ENSG00000188976              3              6              1</span></span><br><span class="line"><span class="comment">## ENSG00000187961              0              0              0</span></span><br><span class="line"><span class="comment">## ENSG00000187583              0              0              0</span></span><br><span class="line"><span class="comment">## ENSG00000187642              0              0              0</span></span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">head(anno)</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##   individual replicate well      batch      sample_id</span></span><br><span class="line"><span class="comment">## 1    NA19098        r1  A01 NA19098.r1 NA19098.r1.A01</span></span><br><span class="line"><span class="comment">## 2    NA19098        r1  A02 NA19098.r1 NA19098.r1.A02</span></span><br><span class="line"><span class="comment">## 3    NA19098        r1  A03 NA19098.r1 NA19098.r1.A03</span></span><br><span class="line"><span class="comment">## 4    NA19098        r1  A04 NA19098.r1 NA19098.r1.A04</span></span><br><span class="line"><span class="comment">## 5    NA19098        r1  A05 NA19098.r1 NA19098.r1.A05</span></span><br><span class="line"><span class="comment">## 6    NA19098        r1  A06 NA19098.r1 NA19098.r1.A06</span></span><br></pre></td></tr></table></figure><p>数据包含 3个个体，3次重复和9个批次。</p><p>通过使用<code>SingleCellExperiment</code> (SCE) 和<code>scater</code>包标准化分析过程。首先构建<code>SCE</code>对象:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">umi &lt;- SingleCellExperiment(</span><br><span class="line">    assays = list(counts = as.matrix(molecules)), </span><br><span class="line">    colData = anno</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>移除不在任何细胞表达的基因:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">keep_feature &lt;- rowSums(counts(umi) &gt; <span class="number">0</span>) &gt; <span class="number">0</span></span><br><span class="line">umi &lt;- umi[keep_feature, ]</span><br></pre></td></tr></table></figure><p>定义对照特征基因集：<code>ERCC spike-ins</code>和线粒体基因</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">isSpike(umi, <span class="string">&quot;ERCC&quot;</span>) &lt;- grepl(<span class="string">&quot;^ERCC-&quot;</span>, rownames(umi))</span><br><span class="line">isSpike(umi, <span class="string">&quot;MT&quot;</span>) &lt;- rownames(umi) %<span class="keyword">in</span>% </span><br><span class="line">    c(<span class="string">&quot;ENSG00000198899&quot;</span>, <span class="string">&quot;ENSG00000198727&quot;</span>, <span class="string">&quot;ENSG00000198888&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ENSG00000198886&quot;</span>, <span class="string">&quot;ENSG00000212907&quot;</span>, <span class="string">&quot;ENSG00000198786&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ENSG00000198695&quot;</span>, <span class="string">&quot;ENSG00000198712&quot;</span>, <span class="string">&quot;ENSG00000198804&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ENSG00000198763&quot;</span>, <span class="string">&quot;ENSG00000228253&quot;</span>, <span class="string">&quot;ENSG00000198938&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ENSG00000198840&quot;</span>)</span><br></pre></td></tr></table></figure><p>计算质量矩阵:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">umi &lt;- calculateQCMetrics(</span><br><span class="line">    umi,</span><br><span class="line">    feature_controls = list(</span><br><span class="line">        ERCC = isSpike(umi, <span class="string">&quot;ERCC&quot;</span>), </span><br><span class="line">        MT = isSpike(umi, <span class="string">&quot;MT&quot;</span>)</span><br><span class="line">    )</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><code>SingleCellExperiment</code>对象结构。<code>str</code> (structure)是一个很好的工具，可以用来查看数据的结构组成。</p><p>如下面的展示<code>SingleCellExperiment</code>有10个数据槽 (<code>slots</code>)，使用<code>@</code>索引。比如想获得降维后的结果，使用<code>umi@reduceDims</code>，使用<code>umi@colData</code>可以获取质控信息，都有哪些质控变量，进一步的使用<code>umi@colData@listData$total_features_by_counts</code>可以获得每个细胞的基因数。<code>umi@rowRanges@elementMetadata@listData</code>基因的属性信息。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">head(umi@assays$data@listData$counts)[,<span class="number">1</span>:<span class="number">3</span>]</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##                 NA19098.r1.A01 NA19098.r1.A02 NA19098.r1.A03</span></span><br><span class="line"><span class="comment">## ENSG00000237683              0              0              0</span></span><br><span class="line"><span class="comment">## ENSG00000187634              0              0              0</span></span><br><span class="line"><span class="comment">## ENSG00000188976              3              6              1</span></span><br><span class="line"><span class="comment">## ENSG00000187961              0              0              0</span></span><br><span class="line"><span class="comment">## ENSG00000187583              0              0              0</span></span><br><span class="line"><span class="comment">## ENSG00000187642              0              0              0</span></span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str(umi)</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Formal class &#x27;SingleCellExperiment&#x27; [package &quot;SingleCellExperiment&quot;] with 10 slots##   ..@ int_elementMetadata:Formal class &#x27;DataFrame&#x27; [package &quot;S4Vectors&quot;] with 6 slots</span></span><br><span class="line"><span class="comment">##   .. .. ..@ rownames       : NULL</span></span><br><span class="line"><span class="comment">##   .. .. ..@ nrows          : int 18726</span></span><br><span class="line"><span class="comment">##   .. .. ..@ listData       :List of 3</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ is_spike_ERCC: logi [1:18726] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ is_spike     : logi [1:18726] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ is_spike_MT  : logi [1:18726] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span><br><span class="line"><span class="comment">##   .. .. ..@ elementType    : chr &quot;ANY&quot;</span></span><br><span class="line"><span class="comment">##   .. .. ..@ elementMetadata: NULL</span></span><br><span class="line"><span class="comment">##   .. .. ..@ metadata       : list()</span></span><br><span class="line"><span class="comment">##   ..@ int_colData        :Formal class &#x27;DataFrame&#x27; [package &quot;S4Vectors&quot;] with 6 slots</span></span><br><span class="line"><span class="comment">##   .. .. ..@ rownames       : NULL</span></span><br><span class="line"><span class="comment">##   .. .. ..@ nrows          : int 864</span></span><br><span class="line"><span class="comment">##   .. .. ..@ listData       : Named list()</span></span><br><span class="line"><span class="comment">##   .. .. ..@ elementType    : chr &quot;ANY&quot;</span></span><br><span class="line"><span class="comment">##   .. .. ..@ elementMetadata: NULL</span></span><br><span class="line"><span class="comment">##   .. .. ..@ metadata       : list()</span></span><br><span class="line"><span class="comment">##   ..@ int_metadata       :List of 3</span></span><br><span class="line"><span class="comment">##   .. ..$ version          :Classes &#x27;package_version&#x27;, &#x27;numeric_version&#x27;  hidden list of 1</span></span><br><span class="line"><span class="comment">##   .. .. ..$ : int [1:3] 1 4 1</span></span><br><span class="line"><span class="comment">##   .. ..$ spike_names      : chr [1:2] &quot;ERCC&quot; &quot;MT&quot;</span></span><br><span class="line"><span class="comment">##   .. ..$ size_factor_names: chr(0) </span></span><br><span class="line"><span class="comment">##   ..@ reducedDims        :Formal class &#x27;SimpleList&#x27; [package &quot;S4Vectors&quot;] with 4 slots</span></span><br><span class="line"><span class="comment">##   .. .. ..@ listData       : Named list()</span></span><br><span class="line"><span class="comment">##   .. .. ..@ elementType    : chr &quot;ANY&quot;</span></span><br><span class="line"><span class="comment">##   .. .. ..@ elementMetadata: NULL</span></span><br><span class="line"><span class="comment">##   .. .. ..@ metadata       : list()</span></span><br><span class="line"><span class="comment">##   ..@ rowRanges          :Formal class &#x27;CompressedGRangesList&#x27; [package &quot;GenomicRanges&quot;] with 5 slots</span></span><br><span class="line"><span class="comment">##   .. .. ..@ unlistData     :Formal class &#x27;GRanges&#x27; [package &quot;GenomicRanges&quot;] with 7 slots</span></span><br><span class="line"><span class="comment">##   .. .. .. .. ..@ seqnames       :Formal class &#x27;Rle&#x27; [package &quot;S4Vectors&quot;] with 4 slots</span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. .. ..@ values         : Factor w/ 0 levels: </span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. .. ..@ lengths        : int(0) </span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. .. ..@ elementMetadata: NULL</span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. .. ..@ metadata       : list()</span></span><br><span class="line"><span class="comment">##   .. .. .. .. ..@ ranges         :Formal class &#x27;IRanges&#x27; [package &quot;IRanges&quot;] with 6 slots</span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. .. ..@ start          : int(0) </span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. .. ..@ width          : int(0) </span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. .. ..@ NAMES          : NULL</span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. .. ..@ elementType    : chr &quot;ANY&quot;</span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. .. ..@ elementMetadata: NULL</span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. .. ..@ metadata       : list()</span></span><br><span class="line"><span class="comment">##   .. .. .. .. ..@ strand         :Formal class &#x27;Rle&#x27; [package &quot;S4Vectors&quot;] with 4 slots</span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. .. ..@ values         : Factor w/ 3 levels &quot;+&quot;,&quot;-&quot;,&quot;*&quot;: </span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. .. ..@ lengths        : int(0) </span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. .. ..@ elementMetadata: NULL</span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. .. ..@ metadata       : list()</span></span><br><span class="line"><span class="comment">##   .. .. .. .. ..@ seqinfo        :Formal class &#x27;Seqinfo&#x27; [package &quot;GenomeInfoDb&quot;] with 4 slots</span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. .. ..@ seqnames   : chr(0) </span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. .. ..@ seqlengths : int(0) </span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. .. ..@ is_circular: logi(0) </span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. .. ..@ genome     : chr(0) </span></span><br><span class="line"><span class="comment">##   .. .. .. .. ..@ elementMetadata:Formal class &#x27;DataFrame&#x27; [package &quot;S4Vectors&quot;] with 6 slots</span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. .. ..@ rownames       : NULL</span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. .. ..@ nrows          : int 0</span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. .. ..@ listData       : Named list()</span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. .. ..@ elementType    : chr &quot;ANY&quot;</span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. .. ..@ elementMetadata: NULL</span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. .. ..@ metadata       : list()</span></span><br><span class="line"><span class="comment">##   .. .. .. .. ..@ elementType    : chr &quot;ANY&quot;</span></span><br><span class="line"><span class="comment">##   .. .. .. .. ..@ metadata       : list()</span></span><br><span class="line"><span class="comment">##   .. .. ..@ elementMetadata:Formal class &#x27;DataFrame&#x27; [package &quot;S4Vectors&quot;] with 6 slots</span></span><br><span class="line"><span class="comment">##   .. .. .. .. ..@ rownames       : NULL</span></span><br><span class="line"><span class="comment">##   .. .. .. .. ..@ nrows          : int 18726</span></span><br><span class="line"><span class="comment">##   .. .. .. .. ..@ listData       :List of 9</span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. ..$ is_feature_control     : logi [1:18726] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. ..$ is_feature_control_ERCC: logi [1:18726] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. ..$ is_feature_control_MT  : logi [1:18726] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. ..$ mean_counts            : num [1:18726] 0.2824 0.0301 2.6389 0.2384 0.0116 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. ..$ log10_mean_counts      : num [1:18726] 0.108 0.0129 0.561 0.0929 0.005 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. ..$ n_cells_by_counts      : int [1:18726] 201 24 728 178 10 11 20 632 798 19 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. ..$ pct_dropout_by_counts  : num [1:18726] 76.7 97.2 15.7 79.4 98.8 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. ..$ total_counts           : int [1:18726] 244 26 2280 206 10 11 21 1638 2873 19 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. .. .. ..$ log10_total_counts     : num [1:18726] 2.39 1.43 3.36 2.32 1.04 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. .. ..@ elementType    : chr &quot;ANY&quot;</span></span><br><span class="line"><span class="comment">##   .. .. .. .. ..@ elementMetadata: NULL</span></span><br><span class="line"><span class="comment">##   .. .. .. .. ..@ metadata       : list()</span></span><br><span class="line"><span class="comment">##   .. .. ..@ elementType    : chr &quot;GRanges&quot;</span></span><br><span class="line"><span class="comment">##   .. .. ..@ metadata       : list()</span></span><br><span class="line"><span class="comment">##   .. .. ..@ partitioning   :Formal class &#x27;PartitioningByEnd&#x27; [package &quot;IRanges&quot;] with 5 slots</span></span><br><span class="line"><span class="comment">##   .. .. .. .. ..@ end            : int [1:18726] 0 0 0 0 0 0 0 0 0 0 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. .. ..@ NAMES          : chr [1:18726] &quot;ENSG00000237683&quot; &quot;ENSG00000187634&quot; &quot;ENSG00000188976&quot; &quot;ENSG00000187961&quot; ...</span></span><br><span class="line"><span class="comment">##   .. .. .. .. ..@ elementType    : chr &quot;ANY&quot;</span></span><br><span class="line"><span class="comment">##   .. .. .. .. ..@ elementMetadata: NULL</span></span><br><span class="line"><span class="comment">##   .. .. .. .. ..@ metadata       : list()</span></span><br><span class="line"><span class="comment">##   ..@ colData            :Formal class &#x27;DataFrame&#x27; [package &quot;S4Vectors&quot;] with 6 slots</span></span><br><span class="line"><span class="comment">##   .. .. ..@ rownames       : chr [1:864] &quot;NA19098.r1.A01&quot; &quot;NA19098.r1.A02&quot; &quot;NA19098.r1.A03&quot; &quot;NA19098.r1.A04&quot; ...</span></span><br><span class="line"><span class="comment">##   .. .. ..@ nrows          : int 864</span></span><br><span class="line"><span class="comment">##   .. .. ..@ listData       :List of 50</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ individual                                    : chr [1:864] &quot;NA19098&quot; &quot;NA19098&quot; &quot;NA19098&quot; &quot;NA19098&quot; ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ replicate                                     : chr [1:864] &quot;r1&quot; &quot;r1&quot; &quot;r1&quot; &quot;r1&quot; ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ well                                          : chr [1:864] &quot;A01&quot; &quot;A02&quot; &quot;A03&quot; &quot;A04&quot; ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ batch                                         : chr [1:864] &quot;NA19098.r1&quot; &quot;NA19098.r1&quot; &quot;NA19098.r1&quot; &quot;NA19098.r1&quot; ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ sample_id                                     : chr [1:864] &quot;NA19098.r1.A01&quot; &quot;NA19098.r1.A02&quot; &quot;NA19098.r1.A03&quot; &quot;NA19098.r1.A04&quot; ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ is_cell_control                               : logi [1:864] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ total_features_by_counts                      : int [1:864] 8368 8234 7289 7985 8619 8659 8054 9429 8243 9407 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ log10_total_features_by_counts                : num [1:864] 3.92 3.92 3.86 3.9 3.94 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ total_counts                                  : int [1:864] 63322 63976 43630 53922 70887 68051 58069 89082 60053 87489 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ log10_total_counts                            : num [1:864] 4.8 4.81 4.64 4.73 4.85 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ pct_counts_in_top_50_features                 : num [1:864] 17.6 16.5 18.2 16.8 16.2 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ pct_counts_in_top_100_features                : num [1:864] 25.2 24.4 26.1 24.4 24.1 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ pct_counts_in_top_200_features                : num [1:864] 34.9 34.5 36 34.1 34 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ pct_counts_in_top_500_features                : num [1:864] 50.2 50.5 51.5 49.8 50 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ total_features_by_counts_endogenous           : int [1:864] 8324 8190 7248 7942 8573 8616 8009 9384 8201 9361 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ log10_total_features_by_counts_endogenous     : num [1:864] 3.92 3.91 3.86 3.9 3.93 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ total_counts_endogenous                       : int [1:864] 57252 58967 39420 49076 65244 63508 53456 83920 56280 82287 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ log10_total_counts_endogenous                 : num [1:864] 4.76 4.77 4.6 4.69 4.81 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ pct_counts_endogenous                         : num [1:864] 90.4 92.2 90.4 91 92 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ pct_counts_in_top_50_features_endogenous      : num [1:864] 12.5 13 13.1 12.3 12.5 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ pct_counts_in_top_100_features_endogenous     : num [1:864] 20 20.7 21 19.8 20.2 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ pct_counts_in_top_200_features_endogenous     : num [1:864] 29.8 30.8 31.1 29.5 30.1 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ pct_counts_in_top_500_features_endogenous     : num [1:864] 45.9 47.3 47.4 45.9 46.7 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ total_features_by_counts_feature_control      : int [1:864] 44 44 41 43 46 43 45 45 42 46 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ log10_total_features_by_counts_feature_control: num [1:864] 1.65 1.65 1.62 1.64 1.67 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ total_counts_feature_control                  : int [1:864] 6070 5009 4210 4846 5643 4543 4613 5162 3773 5202 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ log10_total_counts_feature_control            : num [1:864] 3.78 3.7 3.62 3.69 3.75 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ pct_counts_feature_control                    : num [1:864] 9.59 7.83 9.65 8.99 7.96 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ pct_counts_in_top_50_features_feature_control : num [1:864] 100 100 100 100 100 100 100 100 100 100 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ pct_counts_in_top_100_features_feature_control: num [1:864] 100 100 100 100 100 100 100 100 100 100 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ pct_counts_in_top_200_features_feature_control: num [1:864] 100 100 100 100 100 100 100 100 100 100 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ pct_counts_in_top_500_features_feature_control: num [1:864] 100 100 100 100 100 100 100 100 100 100 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ total_features_by_counts_ERCC                 : int [1:864] 31 31 28 30 33 30 32 32 29 33 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ log10_total_features_by_counts_ERCC           : num [1:864] 1.51 1.51 1.46 1.49 1.53 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ total_counts_ERCC                             : int [1:864] 1187 1277 1121 1240 1262 1308 1203 1217 1217 1339 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ log10_total_counts_ERCC                       : num [1:864] 3.07 3.11 3.05 3.09 3.1 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ pct_counts_ERCC                               : num [1:864] 1.87 2 2.57 2.3 1.78 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ pct_counts_in_top_50_features_ERCC            : num [1:864] 100 100 100 100 100 100 100 100 100 100 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ pct_counts_in_top_100_features_ERCC           : num [1:864] 100 100 100 100 100 100 100 100 100 100 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ pct_counts_in_top_200_features_ERCC           : num [1:864] 100 100 100 100 100 100 100 100 100 100 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ pct_counts_in_top_500_features_ERCC           : num [1:864] 100 100 100 100 100 100 100 100 100 100 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ total_features_by_counts_MT                   : int [1:864] 13 13 13 13 13 13 13 13 13 13 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ log10_total_features_by_counts_MT             : num [1:864] 1.15 1.15 1.15 1.15 1.15 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ total_counts_MT                               : int [1:864] 4883 3732 3089 3606 4381 3235 3410 3945 2556 3863 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ log10_total_counts_MT                         : num [1:864] 3.69 3.57 3.49 3.56 3.64 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ pct_counts_MT                                 : num [1:864] 7.71 5.83 7.08 6.69 6.18 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ pct_counts_in_top_50_features_MT              : num [1:864] 100 100 100 100 100 100 100 100 100 100 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ pct_counts_in_top_100_features_MT             : num [1:864] 100 100 100 100 100 100 100 100 100 100 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ pct_counts_in_top_200_features_MT             : num [1:864] 100 100 100 100 100 100 100 100 100 100 ...</span></span><br><span class="line"><span class="comment">##   .. .. .. ..$ pct_counts_in_top_500_features_MT             : num [1:864] 100 100 100 100 100 100 100 100 100 100 ...</span></span><br><span class="line"><span class="comment">##   .. .. ..@ elementType    : chr &quot;ANY&quot;</span></span><br><span class="line"><span class="comment">##   .. .. ..@ elementMetadata: NULL</span></span><br><span class="line"><span class="comment">##   .. .. ..@ metadata       : list()</span></span><br><span class="line"><span class="comment">##   ..@ assays             :Reference class &#x27;ShallowSimpleListAssays&#x27; [package &quot;SummarizedExperiment&quot;] with 1 field</span></span><br><span class="line"><span class="comment">##   .. ..$ data: NULL</span></span><br><span class="line"><span class="comment">##   .. ..and 14 methods.</span></span><br><span class="line"><span class="comment">##   ..@ NAMES              : NULL</span></span><br><span class="line"><span class="comment">##   ..@ elementMetadata    :Formal class &#x27;DataFrame&#x27; [package &quot;S4Vectors&quot;] with 6 slots</span></span><br><span class="line"><span class="comment">##   .. .. ..@ rownames       : NULL</span></span><br><span class="line"><span class="comment">##   .. .. ..@ nrows          : int 18726</span></span><br><span class="line"><span class="comment">##   .. .. ..@ listData       : Named list()</span></span><br><span class="line"><span class="comment">##   .. .. ..@ elementType    : chr &quot;ANY&quot;</span></span><br><span class="line"><span class="comment">##   .. .. ..@ elementMetadata: NULL</span></span><br><span class="line"><span class="comment">##   .. .. ..@ metadata       : list()</span></span><br><span class="line"><span class="comment">##   ..@ metadata           : list()</span></span><br></pre></td></tr></table></figure><h3 id="细胞质控">细胞质控</h3><h4 id="文库大小">文库大小</h4><p>查看每个样品(细胞）检测到的总分子数 (<code>UMI count</code>)或总reads数 (<code>reads count</code>)，拥有很少的reads或分子数的样品可能是细胞破损或捕获失败，应该移除。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hist(umi$total_counts, breaks = <span class="number">100</span>)</span><br><span class="line">abline(v = <span class="number">25000</span>, col = <span class="string">&quot;red&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/lab4/total-counts-hist-1.png" /></p><h4 id="检测到的基因数">检测到的基因数</h4><p>除了确保每个样品的测序深度，也需要保证测序reads在转录本中分布均衡，而不是集中在少数高表达的基因上。每个样品检测到的基因数也是衡量样品质量好坏的一个标准。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hist(umi$total_features_by_counts, breaks = <span class="number">100</span>)</span><br><span class="line">abline(v = <span class="number">7000</span>, col = <span class="string">&quot;red&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/lab4/total-features-hist-1.png" /></p><p>从图中可以看出，大部分细胞能检测到<code>7,000-10,000</code>基因，这对高深度<code>scRNA-seq</code>是正常的。当然这个受测序深度和实验方法的影响。比如居于<code>droplet</code>的方法或样品测序深度低时每个细胞检测到的基因数要少一些，表现在图上是，左侧拖尾严重。如果细胞之间的基因检出率相当，应该符合正态分布。因此选择移除分布尾部的细胞 (本例中是检测出的基因数少于7000的细胞)。</p><h4 id="erccs和mts">ERCCs和MTs</h4><p>另外一个测量细胞质量的方式是比较<code>ERCC spike-in</code>测到的reads数与内源转录本测到的reads数的比例，可以衡量捕获到的内源性RNA的总量。如果<code>spike in</code>的reads数很高，则表示起始内源性RNA总量低，可能是由于细胞死亡或胁迫诱导的RNA降解导致的，也有可能是细胞体积小。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plotColData(umi, x = <span class="string">&quot;total_features_by_counts&quot;</span>, y = <span class="string">&quot;pct_counts_MT&quot;</span>, colour = <span class="string">&quot;batch&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/lab4/mt-vs-counts-1.png" /></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">plotColData(</span><br><span class="line">    umi,</span><br><span class="line">    x = <span class="string">&quot;total_features_by_counts&quot;</span>,</span><br><span class="line">    y = <span class="string">&quot;pct_counts_ERCC&quot;</span>,</span><br><span class="line">    colour = <span class="string">&quot;batch&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><img src="/images/lab4/ercc-vs-counts-1.png" /></p><p>上图显示来源于<code>NA19098.r2</code>批次的细胞有较高的<code>ERCC/内源RNA</code>比例。作者在文章中证实这一点，说这个批次的细胞体积小。</p><h3 id="细胞过滤">细胞过滤</h3><h4 id="手动过滤">手动过滤</h4><p>基于前面的分析定义一个过滤器，不满足任何一个条件的细胞都过滤掉:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">umi$use &lt;- (</span><br><span class="line">    <span class="comment"># sufficient features (genes)</span></span><br><span class="line">    filter_by_expr_features &amp;</span><br><span class="line">    <span class="comment"># sufficient molecules counted</span></span><br><span class="line">    filter_by_total_counts &amp;</span><br><span class="line">    <span class="comment"># sufficient endogenous RNA</span></span><br><span class="line">    filter_by_ERCC &amp;</span><br><span class="line">    <span class="comment"># remove cells with unusual number of reads in MT genes</span></span><br><span class="line">    filter_by_MT</span><br><span class="line">)</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">table(umi$use)</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## FALSE  TRUE </span></span><br><span class="line"><span class="comment">##   207   657</span></span><br></pre></td></tr></table></figure><h4 id="自动过滤">自动过滤</h4><p><code>scater</code>提供了一个根据质控数据进行PCA分析进而自动挑出异常细胞的方法。默认，下面这些统计量将用于PCA异常细胞检测的分析：</p><ul><li><strong>pct_counts_top_100_features</strong></li><li><strong>total_features_by_counts</strong></li><li><strong>pct_counts_feature_controls</strong></li><li><strong>n_detected_feature_controls</strong></li><li><strong>log10_counts_endogenous_features</strong></li><li><strong>log10_counts_feature_controls</strong></li></ul><p><code>scater</code>首先生成一个行是细胞，列是细胞中对应的上述质控数据的值，然后使用<code>mvoutlier</code>包筛选质控数据与大部分细胞不同的样品定义为低质量细胞。 package on the QC metrics for all cells. This will identify cells that have substantially different QC metrics from the others, possibly corresponding to low-quality cells. We can visualize any outliers using a principal components plot as shown below:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">umi &lt;- runPCA(umi, use_coldata = <span class="literal">TRUE</span>, </span><br><span class="line">              detect_outliers = <span class="literal">TRUE</span>)</span><br><span class="line">reducedDimNames(umi)</span><br><span class="line"><span class="comment">## [1] &quot;PCA_coldata&quot;</span></span><br></pre></td></tr></table></figure><p>鉴定结果存储于<code>umi</code>变量的<code>$outlier</code>部分，指示细胞是否被判断未异常细胞。自动异常细胞检测是很有意义的，可以作为工厂化大批量模式使用，但特异性的手动检测数据集和根据结果、实验调整过滤是推荐的方式。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">table(umi$outlier)</span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## FALSE  TRUE </span></span><br><span class="line"><span class="comment">##   791    73</span></span><br></pre></td></tr></table></figure><p>绘制PCA结果展示异常细胞分布：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plotReducedDim(umi, use_dimred = <span class="string">&quot;PCA_coldata&quot;</span>,</span><br><span class="line">               size_by = <span class="string">&quot;total_features_by_counts&quot;</span>, shape_by = <span class="string">&quot;use&quot;</span>, </span><br><span class="line">               colour_by=<span class="string">&quot;outlier&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/lab4/unnamed-chunk-15-1.png" /></p><h4 id="手动过滤和自动过滤比较">手动过滤和自动过滤比较</h4><p><img src="/images/lab4/cell-filt-comp-1.png" /></p><h3 id="基因分析">基因分析</h3><h4 id="基因表达">基因表达</h4><p>除了移除低质量的细胞，也会排除受技术操作影响较大的一部分基因。而且查看基因表达结果，可以帮助改进实验操作。</p><p>通常会看<code>top 50</code>表达的基因占据了多少reads。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plotHighestExprs(umi, exprs_values = <span class="string">&quot;counts&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/lab4/top50-gene-expr-1.png" /></p><p>表达最高的50个基因的reads分布相对平缓，且比例不大，在一定程度上反应了测序对整个转录组覆盖较好。但是最高表达的15个基因里面有4个<code>ERCC spikein</code>，表明下次重复时可以稀释下<code>spike in</code>的浓度，把测序的机会更多留给内源性基因。</p><h4 id="基因过滤">基因过滤</h4><p>通常建议移除那些表达水平极低以至于可以视为”未检测出”的基因。这里针对UMI数据，“检出”定义为至少有2个细胞检测到某个基因存在多于一个转录本。如果是reads counts数据, “检出”可以定义为至少有2个细胞检测到某个基因有至少5个reads count支持。请注意，对两种表达量计算方式，阈值的选择都与测序深度有关。自己的数据可以做相应的修改。另外一个需要注意的点是基因的过滤必须在细胞过滤后面，因为部分基因可能只在低质量细胞中能检测的到 (注意下面的<code>colData(umi)$use</code>过滤).</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">keep_feature &lt;- nexprs(umi[,colData(umi)$use], byrow=<span class="literal">TRUE</span>, </span><br><span class="line">                       detection_limit=<span class="number">1</span>) &gt;= <span class="number">2</span></span><br><span class="line">rowData(umi)$use &lt;- keep_feature</span><br><span class="line">table(keep_feature)</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## keep_feature</span></span><br><span class="line"><span class="comment">## FALSE  TRUE </span></span><br><span class="line"><span class="comment">##  4660 14066</span></span><br></pre></td></tr></table></figure><p>细胞类型，建库方案，测序深度都会影响阈值选择，勿硬套。</p><h3 id="存储过滤后的数据">存储过滤后的数据</h3><p>查看过滤后的数据集中保留的基因数和细胞数:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dim(umi[rowData(umi)$use, colData(umi)$use])</span><br><span class="line"><span class="comment">## [1] 14066   657</span></span><br></pre></td></tr></table></figure><p>获取对数转换的原始count值，供下一章节使用，并且移除PCA的结果：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">assay(umi, <span class="string">&quot;logcounts_raw&quot;</span>) &lt;- log2(counts(umi) + <span class="number">1</span>)</span><br><span class="line">reducedDim(umi) &lt;- <span class="literal">NULL</span></span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">saveRDS(umi, file = <span class="string">&quot;data/tung/umi.rds&quot;</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> SingleCell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SingleCell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hemberg-lab单细胞转录组数据分析（三）</title>
      <link href="2020/09/28/hemberg-lab3/"/>
      <url>2020/09/28/hemberg-lab3/</url>
      
        <content type="html"><![CDATA[<p>我们使用 Tabula Muris最开始释放的数据做为测试数据来完成完整的单细胞数据分析。<code>The Tabula Muris</code>是一个国际合作组织，目的是采用标准方法生成小鼠每个细胞的图谱。建库测序方法包括通量高覆盖率低的<code>10X</code>数据和通量低覆盖率高的<code>FACS</code>筛选+<code>Smartseq2</code>建库技术。</p><p>原始数据于2017年12月20日释放，包含<code>20</code>个组织/器官的<code>100,000</code>细胞的转录组图谱。</p><h2 id="下载数据">下载数据</h2><p>下载FACS数据:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget https://ndownloader.figshare.com/files/10038307</span><br><span class="line">unzip 10038307</span><br><span class="line">wget https://ndownloader.figshare.com/files/10038310</span><br><span class="line">mv 10038310 FACS_metadata.csv</span><br><span class="line">wget https://ndownloader.figshare.com/files/10039267</span><br><span class="line">mv 10039267 FACS_annotations.csv</span><br></pre></td></tr></table></figure><p>下载10X数据:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget https://ndownloader.figshare.com/files/10038325</span><br><span class="line">unzip 10038325</span><br><span class="line">wget https://ndownloader.figshare.com/files/10038328</span><br><span class="line">mv 10038328 droplet_metadata.csv</span><br><span class="line">wget https://ndownloader.figshare.com/files/10039264</span><br><span class="line">mv 10039264 droplet_annotation.csv</span><br></pre></td></tr></table></figure><p>现在应该有两个文件夹: <code>FACS</code>和<code>droplet</code>，每个对应一个<code>annotation</code>和<code>metadata</code>文件。使用<code>head</code>命令查看前10行：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">head -n 10 droplet_metadata.csv</span><br></pre></td></tr></table></figure><p>使用<code>wc -l</code>查看文件的行数:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wc -l droplet_annotation.csv</span><br></pre></td></tr></table></figure><h2 id="读入数据-smartseq2">读入数据 (Smartseq2)</h2><p>读入逗号分隔的<code>count matrix</code>，存储为数据框:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dat = read.delim(<span class="string">&quot;FACS/Kidney-counts.csv&quot;</span>, sep=<span class="string">&quot;,&quot;</span>, header=<span class="literal">TRUE</span>)</span><br><span class="line">dat[<span class="number">1</span>:<span class="number">5</span>,<span class="number">1</span>:<span class="number">5</span>]</span><br></pre></td></tr></table></figure><p>数据库第一列是基因名字，把它移除作为列名字：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dim(dat)</span><br><span class="line">rownames(dat) &lt;- dat[,<span class="number">1</span>]</span><br><span class="line">dat &lt;- dat[,-<span class="number">1</span>]</span><br></pre></td></tr></table></figure><p>这是<code>Smartseq2</code>数据集，可能含有<code>spike-ins</code>:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rownames(dat)[grep(<span class="string">&quot;^ERCC-&quot;</span>, rownames(dat))]</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[1] &quot;ERCC-00002&quot; &quot;ERCC-00003&quot; &quot;ERCC-00004&quot; &quot;ERCC-00009&quot; &quot;ERCC-00012&quot;</span><br><span class="line"> [6] &quot;ERCC-00013&quot; &quot;ERCC-00014&quot; &quot;ERCC-00016&quot; &quot;ERCC-00017&quot; &quot;ERCC-00019&quot;</span><br><span class="line">[11] &quot;ERCC-00022&quot; &quot;ERCC-00024&quot; &quot;ERCC-00025&quot; &quot;ERCC-00028&quot; &quot;ERCC-00031&quot;</span><br><span class="line">[16] &quot;ERCC-00033&quot; &quot;ERCC-00034&quot; &quot;ERCC-00035&quot; &quot;ERCC-00039&quot; &quot;ERCC-00040&quot;</span><br><span class="line">[21] &quot;ERCC-00041&quot; &quot;ERCC-00042&quot; &quot;ERCC-00043&quot; &quot;ERCC-00044&quot; &quot;ERCC-00046&quot;</span><br><span class="line">[26] &quot;ERCC-00048&quot; &quot;ERCC-00051&quot; &quot;ERCC-00053&quot; &quot;ERCC-00054&quot; &quot;ERCC-00057&quot;</span><br><span class="line">[31] &quot;ERCC-00058&quot; &quot;ERCC-00059&quot; &quot;ERCC-00060&quot; &quot;ERCC-00061&quot; &quot;ERCC-00062&quot;</span><br><span class="line">[36] &quot;ERCC-00067&quot; &quot;ERCC-00069&quot; &quot;ERCC-00071&quot; &quot;ERCC-00073&quot; &quot;ERCC-00074&quot;</span><br><span class="line">[41] &quot;ERCC-00075&quot; &quot;ERCC-00076&quot; &quot;ERCC-00077&quot; &quot;ERCC-00078&quot; &quot;ERCC-00079&quot;</span><br><span class="line">[46] &quot;ERCC-00081&quot; &quot;ERCC-00083&quot; &quot;ERCC-00084&quot; &quot;ERCC-00085&quot; &quot;ERCC-00086&quot;</span><br><span class="line">[51] &quot;ERCC-00092&quot; &quot;ERCC-00095&quot; &quot;ERCC-00096&quot; &quot;ERCC-00097&quot; &quot;ERCC-00098&quot;</span><br><span class="line">[56] &quot;ERCC-00099&quot; &quot;ERCC-00104&quot; &quot;ERCC-00108&quot; &quot;ERCC-00109&quot; &quot;ERCC-00111&quot;</span><br><span class="line">[61] &quot;ERCC-00112&quot; &quot;ERCC-00113&quot; &quot;ERCC-00116&quot; &quot;ERCC-00117&quot; &quot;ERCC-00120&quot;</span><br><span class="line">[66] &quot;ERCC-00123&quot; &quot;ERCC-00126&quot; &quot;ERCC-00130&quot; &quot;ERCC-00131&quot; &quot;ERCC-00134&quot;</span><br><span class="line">[71] &quot;ERCC-00136&quot; &quot;ERCC-00137&quot; &quot;ERCC-00138&quot; &quot;ERCC-00142&quot; &quot;ERCC-00143&quot;</span><br><span class="line">[76] &quot;ERCC-00144&quot; &quot;ERCC-00145&quot; &quot;ERCC-00147&quot; &quot;ERCC-00148&quot; &quot;ERCC-00150&quot;</span><br><span class="line">[81] &quot;ERCC-00154&quot; &quot;ERCC-00156&quot; &quot;ERCC-00157&quot; &quot;ERCC-00158&quot; &quot;ERCC-00160&quot;</span><br><span class="line">[86] &quot;ERCC-00162&quot; &quot;ERCC-00163&quot; &quot;ERCC-00164&quot; &quot;ERCC-00165&quot; &quot;ERCC-00168&quot;</span><br><span class="line">[91] &quot;ERCC-00170&quot; &quot;ERCC-00171&quot;</span><br></pre></td></tr></table></figure><p>从列名字中提取<code>metadata</code>信息:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cellIDs &lt;- colnames(dat)</span><br><span class="line">cell_info &lt;- strsplit(cellIDs, <span class="string">&quot;\\.&quot;</span>)</span><br><span class="line">Well &lt;- unlist(lapply(cell_info, <span class="keyword">function</span>(x)&#123;x[<span class="number">1</span>]&#125;))</span><br><span class="line">Plate &lt;- unlist(lapply(cell_info, <span class="keyword">function</span>(x)&#123;x[<span class="number">2</span>]&#125;))</span><br><span class="line">Mouse &lt;- unlist(lapply(cell_info, <span class="keyword">function</span>(x)&#123;x[<span class="number">3</span>]&#125;))</span><br></pre></td></tr></table></figure><p>检测每种<code>metadata</code>类型的数据分布：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">summary(factor(Mouse))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">3_10_M 3_11_M 3_38_F 3_39_F  3_8_M  3_9_M</span><br><span class="line">   104    196    237    169     82     77</span><br></pre></td></tr></table></figure><p>查看有没有技术因子是<code>cofounded</code>，实验批次与供体小鼠批次一致:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">table(Mouse, Plate)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">        Plate</span><br><span class="line">Mouse    B001717 B002775 MAA000545 MAA000752 MAA000801 MAA000922</span><br><span class="line">  3_10_M       0       0         0       104         0         0</span><br><span class="line">  3_11_M       0       0         0         0       196         0</span><br><span class="line">  3_38_F     237       0         0         0         0         0</span><br><span class="line">  3_39_F       0     169         0         0         0         0</span><br><span class="line">  3_8_M        0       0        82         0         0         0</span><br><span class="line">  3_9_M        0       0         0         0         0        77</span><br></pre></td></tr></table></figure><p>最后读入计算预测的细胞类型注释，并与表达矩阵中的细胞注释做比较:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ann &lt;- read.table(<span class="string">&quot;FACS_annotations.csv&quot;</span>, sep=<span class="string">&quot;,&quot;</span>, header=<span class="literal">TRUE</span>)</span><br><span class="line">ann &lt;- ann[match(cellIDs, ann[,<span class="number">1</span>]),]</span><br><span class="line">celltype &lt;- ann[,<span class="number">3</span>]</span><br><span class="line">table(celltype)</span><br></pre></td></tr></table></figure><h2 id="构建scater对象">构建scater对象</h2><p>为了构建<code>SingleCellExperiment</code>对象，先把所有的细胞注释放到一个数据框中。因为实验批次(<code>pcr plate</code>)和供体小鼠完全重合，所以只保留一个信息。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">suppressMessages(<span class="keyword">require</span>(<span class="string">&quot;SingleCellExperiment&quot;</span>))</span><br><span class="line">suppressMessages(<span class="keyword">require</span>(<span class="string">&quot;scater&quot;</span>))</span><br><span class="line">cell_anns &lt;- data.frame(mouse = Mouse, well=Well, type=celltype)</span><br><span class="line">rownames(cell_anns) &lt;- colnames(dat)</span><br><span class="line">sceset &lt;- SingleCellExperiment(assays = list(counts = as.matrix(dat)), colData=cell_anns)</span><br><span class="line">str(sceset)</span><br></pre></td></tr></table></figure><p>如果数据集包含<code>spike-ins</code>，我们在<code>SingleCellExperiment</code>对象中定义一个变量记录它们。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">isSpike(sceset, <span class="string">&quot;ERCC&quot;</span>) &lt;- grepl(<span class="string">&quot;ERCC-&quot;</span>, rownames(sceset))</span><br><span class="line">str(sceset)</span><br></pre></td></tr></table></figure><h2 id="读入10x的数据">读入10X的数据</h2><p>因为<code>10X</code>技术细胞通量高但测序覆盖度低，所以其count matrix是一个大的稀疏矩阵(矩阵中高达90%的数据的数值为0)。CellRanger默认的输出格式是<code>.mtx</code>文件用于存储这个稀疏矩阵，第一列是基因的坐标（0-based），第二列是细胞的坐标（0-based），第三列是大于0的表达值 (<em>长表格形式</em>)。 打开<code>.mtx</code>文件会看到两行标题行后面是包含总行数 (<em>基因数</em>)、列数 (<em>样本数</em>)和稀疏矩阵总行数 (<em>所有细胞中表达不为0的基因的总和</em>)的一行数据。</p><p>鉴于<code>.mtx</code>文件中只存储了基因和样品名字的坐标，而实际的基因和样品的名字必须单独存储到文件<code>genes.tsv</code>和<code>barcodes.tsv</code>。</p><p>下面使用<code>Matrix</code>包读入稀疏矩阵：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">suppressMessages(<span class="keyword">require</span>(<span class="string">&quot;Matrix&quot;</span>))</span><br><span class="line">cellbarcodes &lt;- read.table(<span class="string">&quot;droplet/Kidney-10X_P4_5/barcodes.tsv&quot;</span>)</span><br><span class="line">genenames &lt;- read.table(<span class="string">&quot;droplet/Kidney-10X_P4_5/genes.tsv&quot;</span>)</span><br><span class="line">molecules &lt;- Matrix::readMM(<span class="string">&quot;droplet/Kidney-10X_P4_5/matrix.mtx&quot;</span>)</span><br></pre></td></tr></table></figure><p>下一步增加合适的行或列的名字。首先查看read的<code>cellbarcode</code>信息会发现这个文件只有<code>barcode</code>序列。考虑到<code>10X</code>数据每一批的<code>cellbarcode</code>是有重叠的，所以在合并数据前，需要把批次信息与barcode信息合并一起。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">head(cellbarcodes)</span><br><span class="line">rownames(molecules) &lt;- genenames[,<span class="number">1</span>]</span><br><span class="line">colnames(molecules) &lt;- paste(<span class="string">&quot;10X_P4_5&quot;</span>, cellbarcodes[,<span class="number">1</span>], sep=<span class="string">&quot;_&quot;</span>)</span><br></pre></td></tr></table></figure><p>读入计算注释的细胞类型信息:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">meta &lt;- read.delim(<span class="string">&quot;droplet_metadata.csv&quot;</span>, sep=<span class="string">&quot;,&quot;</span>, header=<span class="literal">TRUE</span>)</span><br><span class="line">head(meta)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">   channel mouse.id  tissue   subtissue mouse.sex</span><br><span class="line">1 10X_P4_0    3-M-8  Tongue        &lt;NA&gt;         M</span><br><span class="line">2 10X_P4_1    3-M-9  Tongue        &lt;NA&gt;         M</span><br><span class="line">3 10X_P4_2  3-M-8&#x2F;9   Liver hepatocytes         M</span><br><span class="line">4 10X_P4_3    3-M-8 Bladder        &lt;NA&gt;         M</span><br><span class="line">5 10X_P4_4    3-M-9 Bladder        &lt;NA&gt;         M</span><br><span class="line">6 10X_P4_5    3-M-8  Kidney        &lt;NA&gt;         M</span><br></pre></td></tr></table></figure><p>我们需要用<code>10X_P4_5</code>获得这批数据对应的<code>metadata</code>信息。这时需要注意<code>metadata</code>表格中<code>mouse ID</code>与前面<code>plate-based (FACS SmartSeq2)</code>数据集的<code>mouse ID</code>不同，这里用<code>-</code>而非<code>_</code>作为分隔符，并且性别在中间。通过查阅文献中的描述得知<code>droplet (10X)</code>和<code>plate-based (FACS SmartSeq2)</code>的技术用了同样的8只老鼠。所以对数据做下修正，使得<code>10X</code>与<code>FACS</code>的数据一致。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">meta[meta$channel == <span class="string">&quot;10X_P4_5&quot;</span>,]</span><br><span class="line">mouseID &lt;- <span class="string">&quot;3_8_M&quot;</span></span><br></pre></td></tr></table></figure><p><strong><em>注意</em></strong>：有些组织的<code>10X</code>数据可能来源于多个小鼠的样品，如<code>mouse id = 3-M-5/6</code>。也需要格式化这些信息，但可能这些与<code>FACS</code>数据的<code>mouse id</code>会不一致，进而影响下游分析。如果小鼠不是纯系，可能需要通过<code>exonic-SNP</code>把细胞和对应的小鼠联系起来。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ann &lt;- read.delim(<span class="string">&quot;droplet_annotation.csv&quot;</span>, sep=<span class="string">&quot;,&quot;</span>, header=<span class="literal">TRUE</span>)</span><br><span class="line">head(ann)</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">                       cell  tissue cell_ontology_class                    cell_ontology_term_iri cell_ontology_id</span><br><span class="line"><span class="number">1</span> 10X_P4_3_AAAGTAGAGATGCCAG Bladder    mesenchymal cell http://purl.obolibrary.org/obo/CL_0008019       CL:<span class="number">0008019</span></span><br><span class="line"><span class="number">2</span> 10X_P4_3_AACCGCGTCCAACCAA Bladder    mesenchymal cell http://purl.obolibrary.org/obo/CL_0008019       CL:<span class="number">0008019</span></span><br><span class="line"><span class="number">3</span> 10X_P4_3_AACTCCCGTCGGGTCT Bladder    mesenchymal cell http://purl.obolibrary.org/obo/CL_0008019       CL:<span class="number">0008019</span></span><br><span class="line"><span class="number">4</span> 10X_P4_3_AACTCTTAGTTGCAGG Bladder        bladder cell http://purl.obolibrary.org/obo/CL_1001319       CL:<span class="number">1001319</span></span><br><span class="line"><span class="number">5</span> 10X_P4_3_AACTCTTTCATAACCG Bladder    mesenchymal cell http://purl.obolibrary.org/obo/CL_0008019       CL:<span class="number">0008019</span></span><br><span class="line"><span class="number">6</span> 10X_P4_3_AAGACCTAGATCCGAG Bladder    endothelial cell http://purl.obolibrary.org/obo/CL_0000115       CL:<span class="number">0000115</span></span><br></pre></td></tr></table></figure><p>注释中的<code>cellID</code>和<code>cellbarcodes</code>也存在细微差别，少了最后的<code>-1</code>，在匹配前需要做下校正。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ann[,<span class="number">1</span>] &lt;- paste(ann[,<span class="number">1</span>], <span class="string">&quot;-1&quot;</span>, sep=<span class="string">&quot;&quot;</span>)</span><br><span class="line">ann_subset &lt;- ann[match(colnames(molecules), ann[,<span class="number">1</span>]),]</span><br><span class="line">celltype &lt;- ann_subset[,<span class="number">3</span>]</span><br></pre></td></tr></table></figure><p>构建<code>cell-metadata</code>数据框:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cell_anns &lt;- data.frame(mouse = rep(mouseID, times=ncol(molecules)), type=celltype)</span><br><span class="line">rownames(cell_anns) &lt;- colnames(molecules)</span><br><span class="line">head(cell_anns)</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">                            mouse                        type</span><br><span class="line">10X_P4_5_AAACCTGAGATGCCAG-<span class="number">1</span> 3_8_M                   leukocyte</span><br><span class="line">10X_P4_5_AAACCTGAGTGTCCAT-<span class="number">1</span> 3_8_M            fenestrated cell</span><br><span class="line">10X_P4_5_AAACCTGCAAGGCTCC-<span class="number">1</span> 3_8_M          smooth muscle cell</span><br><span class="line">10X_P4_5_AAACCTGTCCTTGCCA-<span class="number">1</span> 3_8_M          kidney tubule cell</span><br><span class="line">10X_P4_5_AAACGGGAGCTGAACG-<span class="number">1</span> 3_8_M kidney collecting duct cell</span><br><span class="line">10X_P4_5_AAACGGGCAGGACCCT-<span class="number">1</span> 3_8_M          kidney tubule cell</span><br></pre></td></tr></table></figure><h2 id="创建scater对象">创建<code>scater</code>对象</h2><p>现在读入了多个批次的<code>10X</code>数据，把它们组合成一个<code>SingleCellExperiment object</code>对象。首先检查不同批次数据的基因名字是否一致:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">identical(rownames(molecules1), rownames(molecules2))</span><br><span class="line">identical(rownames(molecules1), rownames(molecules3))</span><br></pre></td></tr></table></figure><p>确认没有重复的细胞ID:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sum(colnames(molecules1) %<span class="keyword">in</span>% colnames(molecules2))</span><br><span class="line">sum(colnames(molecules1) %<span class="keyword">in</span>% colnames(molecules3))</span><br><span class="line">sum(colnames(molecules2) %<span class="keyword">in</span>% colnames(molecules3))</span><br></pre></td></tr></table></figure><p>检查无误，把它们组合起来:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获得大的表达矩阵</span></span><br><span class="line">all_molecules &lt;- cbind(molecules1, molecules2, molecules3)</span><br><span class="line"><span class="comment"># 获得大的数据矩阵</span></span><br><span class="line">all_cell_anns &lt;- as.data.frame(rbind(cell_anns1, cell_anns2, cell_anns3))</span><br><span class="line"><span class="comment"># 增加批次信息</span></span><br><span class="line">all_cell_anns$batch &lt;- rep(c(<span class="string">&quot;10X_P4_5&quot;</span>, <span class="string">&quot;10X_P4_6&quot;</span>,<span class="string">&quot;10X_P7_5&quot;</span>), times = c(nrow(cell_anns1), nrow(cell_anns2), nrow(cell_anns3)))</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> SingleCell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SingleCell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>测序质控软件trim_galore安装</title>
      <link href="2020/09/23/trim-galore/"/>
      <url>2020/09/23/trim-galore/</url>
      
        <content type="html"><![CDATA[<p><code>trim_galore</code>可以用来对原始的测序数据进行质控</p><p>安装<code>trim_galore</code>需要提前安装两个依赖软件：<code>Fastqc</code>和<code>cutadapt</code></p><p><code>Fastqc</code>的安装已经提及，这里不再详述</p><p><code>cutadapt</code>的安装过程如下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install python3-pip <span class="comment"># install pip3</span></span><br><span class="line">python3 -m pip install --user --upgrade cutadapt  <span class="comment"># install cutadapt</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;export PATH=<span class="variable">$PATH</span>:<span class="variable">$HOME</span>/.local/bin&quot;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure><p><code>trim_galore</code> 安装</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Check that cutadapt is installed</span></span><br><span class="line">cutadapt --version</span><br><span class="line"><span class="comment"># Check that FastQC is installed</span></span><br><span class="line">fastqc -v</span><br><span class="line"><span class="comment"># Install Trim Galore</span></span><br><span class="line"><span class="built_in">cd</span> ~/software</span><br><span class="line">curl -fsSL https://github.com/FelixKrueger/TrimGalore/archive/0.6.6.tar.gz -o trim_galore.tar.gz</span><br><span class="line">tar xvzf trim_galore.tar.gz </span><br><span class="line"><span class="comment"># soft link</span></span><br><span class="line">sudo ln -s /home/ubuntu/software/trim_galore/trim_galore /usr/bin/trim_galore</span><br></pre></td></tr></table></figure><p>使用示例：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/SingleCell</span><br><span class="line">mkdir fastqc_trimmed_results</span><br><span class="line">trim_galore --nextera -o fastqc_trimmed_results Share/ERR522959_1.fastq Share/ERR522959_2.fastq</span><br></pre></td></tr></table></figure><p><strong>参数说明：</strong></p><blockquote><p>--quality：设定Phred quality score阈值，默认为20。 --phred33：：选择-phred33或者-phred64，表示测序平台使用的Phred quality score。 --adapter：输入adapter序列。也可以不输入，Trim Galore会自动寻找可能性最高的平台对应的adapter。自动搜选的平台三个，也直接显式输入这三种平台，即--illumina、--nextera和--small_rna。一般使用fastqc软件能够判断出来，sanger/illumina 1.9为phred33，illumina 1.3/1.5为phred64。 --stringency：设定可以忍受的前后adapter重叠的碱基数，默认为1（非常苛刻）。可以适度放宽，因为后一个adapter几乎不可能被测序仪读到。 --length：设定输出reads长度阈值，小于设定值会被抛弃。 --paired：对于双端测序结果，一对reads中，如果有一个被剔除，那么另一个会被同样抛弃，而不管是否达到标准。 --retain_unpaired：对于双端测序结果，一对reads中，如果一个read达到标准，但是对应的另一个要被抛弃，达到标准的read会被单独保存为一个文件。 --gzip和--dont_gzip：清洗后的数据zip打包或者不打包。 --output_dir：输入目录。需要提前建立目录，否则运行会报错。 -- trim-n : 移除read一端的reads</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> software </category>
          
      </categories>
      
      
        <tags>
            
            <tag> software </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FastQC安装与使用</title>
      <link href="2020/09/23/fastqc/"/>
      <url>2020/09/23/fastqc/</url>
      
        <content type="html"><![CDATA[<p>FastQC是一款用于对RNA-seq数据进行质量检测和控制的软件（对单细胞和bulk的测序数据都适用）</p><h2 id="fastqc安装">fastqc安装</h2><p>首先需要从官网下载FastQC的安装文件<br />http://www.bioinformatics.babraham.ac.uk/projects/download.html#fastqc</p><p>将下载到的<code>.zip</code>文件解压在特定的安装位置</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/sofware</span><br><span class="line">unzip ~/download/fastqc_v0.11.9.zip</span><br></pre></td></tr></table></figure><p>解压之后需要将其中的<code>fastqc</code>文件改成可执行文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ./FastQC</span><br><span class="line">chmod 755 fastqc</span><br></pre></td></tr></table></figure><p>为了能在任意文件夹下运行程序，创建fastqc的软连接</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -s /home/ubuntu/software/FastQC/fastqc /usr/<span class="built_in">local</span>/bin/fastqc <span class="comment"># 文件地址必须是绝对路径</span></span><br></pre></td></tr></table></figure><p>就此安装成功，可以运行<code>fastqc -h</code>查看命令参数</p><h2 id="fastqc使用">fastqc使用</h2><p><strong>FastQC参数</strong></p><p>-o --outdir:输出路径 --extract：结果文件解压缩 --noextract：结果文件压缩 -f --format:输入文件格式.支持bam,sam,fastq文件格式 -t --threads:线程数 -c --contaminants：制定污染序列。文件格式 name[tab]sequence -a --adapters：指定接头序列。文件格式name[tab]sequence -k --kmers：指定kmers长度（2-10bp,默认7bp） -q --quiet： 安静模式</p><p>示例：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/SingleCell</span><br><span class="line">mkdir fastqc_results</span><br><span class="line">fastqc -t 30 -o fastqc_results Share/ERR522959_1.fastq Share/ERR522959_2.fastq</span><br></pre></td></tr></table></figure><h2 id="fastqc结果查看">fastqc结果查看</h2><p>fastqc产生两个结果文件：</p><p><strong>html：</strong>网页版结果 <strong>zip：</strong>本地结果压缩文件</p><p>需要重点关注的信息有：</p><ul><li>Basic Statistics：对数据量的概览<br /></li><li>Per base sequence quality：reads每个位置测序质量最直接的展示<br /></li><li>Per sequence quality scores：总体reads测序质量趋势<br /></li><li>Per base sequence content：ATGC含量估计测序是否存在偏差<br /></li><li>Sequence Duplication Levels：影响测序的因素太多，查看是否存在污染，数据处理时是否需要去冗余；现在数据量都可以满足需求，因此前期数据处理时，尽量高标准，严格质控</li></ul><p>网页结果汇总如下 ：</p><p><img src="/images/fastqc/summary.jpg" /></p><p><strong>各种颜色是各项标准分析结果：绿色代表"PASS"；黄色代表"WARN"；红色代表"FAIL"。</strong></p><p><img src="/images/fastqc/basic.jpg" /></p><p><strong>reads上每个位置碱基质量</strong> 质量分数使用Fred quality，Q=-10*log10(p)，p为碱基测序错误概率。 横轴碱基的位置，纵轴是质量分数。红色表示中位数，黄色是25%-75%区间，触须是10%-90%区间，蓝线是平均数。 平均每个碱基的测序质量boxplot下四分位线在30分以上，则认为测序质量非常好；一般情况下，reads首尾质量较差。 若任一位置的下四分位数低于10或中位数低于25，报"WARN"； 若任一位置的下四分位数低于5或中位数低于20，报"FAIL"。</p><p><img src="/images/fastqc/quality.jpg" /></p><p><strong>每条序列的测序质量分布</strong> 横轴为序列测序质量，纵轴是reads数目。一般认为90%的reads测序质量在35分以上，则认为该测序质量非常好。 当测序质量峰值小于27（错误率0.2%）时报"WARN"; 当峰值小于20（错误率1%）时报"FAIL"。</p><p><img src="/images/fastqc/seq.jpg" /></p><p><strong>统计reads每个位置ATCG四种碱基的分布：</strong> 横轴为碱基位置，纵轴为百分比。因为随机的文库中，正常情况下所有位置出现某种碱基的概率是相近的，因此好的测序结果中四条线应该平行且接近。当部分位置碱基的比例出现bias时，即四条线在某些位置纷乱交织，往往提示我们有overrepresented sequence的污染。当所有位置的碱基比例一致的表现出bias时，即四条线平行但分开，往往代表文库有bias (建库过程或本身特点)，或者是测序中的系统误差。 当任一位置的A/T比例与G/C比例相差超过10%，报"WARN"； 当任一位置的A/T比例与G/C比例相差超过20%，报"FAIL"。</p><p><img src="/images/fastqc/base.jpg" /></p><p><strong>统计reads的平均GC含量分布</strong> 红线是实际情况，蓝线是理论分布（正态分布，均值不一定在50%，而是由平均GC含量推断的）。 曲线形状的偏差往往是由于文库的污染或是部分reads构成的子集有偏差（overrepresented reads）。形状接近正态但偏离理论分布的情况提示我们可能有系统偏差。偏离理论分布的reads超过15%时，报"WARN"；偏离理论分布的reads超过30%时，报"FAIL"。</p><p><img src="/images/fastqc/gc.jpg" /></p><p><strong>统计reads每个位置N的比率</strong> reads某个位置无法确定是何种碱基时，使用N代替； 正常情况下，N的比例是很小的，所以图上常常看到一条直线，但放大Y轴之后会发现还是有N的存在，这不算问题。当Y轴在0%-100%的范围内也能看到“鼓包”时，说明测序系统出了问题。 当任意位置的N的比例超过5%，报"WARN"； 当任意位置的N的比例超过20%，报"FAIL"。</p><p><img src="/images/fastqc/n.jpg" /></p><p><strong>reads长度分布</strong> 为了防止建库或者测序时有一些不规则长度的序列也被进行测序而进行的一个对长度的统计，当所有序列的长度不一样，fastqc就会警告。 当reads长度不一致时报"WARN"； 当有长度为0的read时报“FAIL”。</p><p><img src="/images/fastqc/length.jpg" /></p><p>统计reads重复水平 测序本身就会产生重复reads,测序深度越高,reads重复数越大；如果重复出现峰值，就提示可能b存在偏差（如建库过程中的PCR duplication）。 横坐标是重复的次数，纵坐标是duplicated reads占unique reads种数百分比。</p><p>fastqc抽取reads文件前200,000条reads统计其重复情况。重复数目大于等于10的reads被合并统计，这也是为什么我们看到上图的最右侧略有上扬。大于75bp的reads只取50bp进行比较。由于reads越长错误率越高，所以其重复程度仍有可能被低估。 当非unique的reads占总数的比例大于20%时，报"WARN"； 当非unique的reads占总数的比例大于50%时，报"FAIL“。</p><p><img src="/images/fastqc/level.jpg" /></p><p><strong>过度重复出现的序列的统计信息</strong></p><p><img src="/images/fastqc/over.jpg" /></p><p><strong>Adapter序列在reads中出现概率</strong> 接头序列统计，&gt;5%时是Warning，&gt;10%时是Failure。</p><p><img src="/images/fastqc/adapter.jpg" /></p><hr /><p>参考：</p><p>https://www.jianshu.com/p/835fd925d6ee</p><p>https://www.jianshu.com/p/a1eb03d63083</p>]]></content>
      
      
      <categories>
          
          <category> software </category>
          
      </categories>
      
      
        <tags>
            
            <tag> software </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ggplot2常用theme参数参考</title>
      <link href="2020/09/23/ggplottheme/"/>
      <url>2020/09/23/ggplottheme/</url>
      
        <content type="html"><![CDATA[<p>大佬总结的ggplot2常用调节参数<br /><img src="/images/ggplottheme/20200627183728.png" /><br /><img src="/images/ggplottheme/20200627183936.png" /></p>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
          <category> ggplot2 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
            <tag> ggplot2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hemberg-lab单细胞转录组数据分析（二）</title>
      <link href="2020/09/23/hemberg-lab2/"/>
      <url>2020/09/23/hemberg-lab2/</url>
      
        <content type="html"><![CDATA[<h2 id="scrna-seq原始数据处理">scRNA-seq原始数据处理</h2><h3 id="fastqc">FastQC</h3><p>得到单细胞RNA-seq测序数据后，首先检查测序reads的质量。为了完成这个任务，我们使用的工具是FastQC。FastQC是一款质控工具，能对bulk RNA-seq和单细胞RNA-seq的原始数据进行质量控制 (<em>其他类型的高通量测序结果也适用</em>)。FastQC以原始测序reads为输入(fastq格式)，输出序列质量报告。复制粘贴下面的链接到你的浏览器进入FastQC官网：</p><p>https://www.bioinformatics.babraham.ac.uk/projects/fastqc/</p><p>这个网址包含下载和安装FastQC及示例报告文件的链接。向下滚动页面到<code>Example Reports</code>并点击<code>Good Illumina Data</code>，会看到高质量Illumina测序Reads的理想质控结果。</p><p>现在让我们自己来做一个FastQC报告。</p><p>我们可以从 https://www.ebi.ac.uk/arrayexpress/experiments/E-MTAB-2600/ 下载<code>ERR522959_1.fastq</code>和<code>ERR522959_2.fastq</code> 原始测序文件。</p><p>使用<code>less</code>命令查看数据</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">less Share/ERR522959_1.fastq</span><br><span class="line">less Share/ERR522959_2.fastq</span><br></pre></td></tr></table></figure><p>使用FastQC生成报告</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir fastqc_results</span><br><span class="line">fastqc -o fastqc_results Share/ERR522959_1.fastq Share/ERR522959_2.fastq</span><br></pre></td></tr></table></figure><p>命令执行完成后，可以得到四个文件—每端reads对应一个<code>zip</code>文件和一个<code>html</code>文件。</p><p>大概浏览一下文件，记住要看双端<code>reads</code>的报告！</p><h3 id="移除接头和低质量碱基">移除接头和低质量碱基</h3><p><code>TrimGalore!</code>工具是对<code>cutadapt</code>软件的封装，用于移除测序接头序列或测序序列末端低质量碱基。</p><p>鉴于上一步FastQC报告中有一些接头污染，因此需要去除接头部分。</p><p>现在让我们尝试用<code>Trim Galore!</code>去除那些麻烦的接头序列，去除接头后，最好再运行FastQC查看接头是否去除干净。</p><p>可以用下面的命令来去除<code>Nextera</code>序列接头：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p fastqc_trimmed_results</span><br><span class="line">trim_galore --nextera -o fastqc_trimmed_results Share/ERR522959_1.fastq Share/ERR522959_2.fastq</span><br></pre></td></tr></table></figure><p>记住为<code>trimmed reads</code>文件生成新的FastQC报告！在报告里应该可以看到你的reads的<code>Adaptor Content</code>结果为<code>PASS</code>了</p><p>现在已经生成了reads质量报告并实行了接头去除，下一步，我们会用<code>STAR</code> (STAR有soft-clip机制，理论上只要文库质量不太差，不进行质控也可以)和<code>Kallisto</code>把质控后的reads比对到参考转录组。</p><h3 id="文件格式">文件格式</h3><h4 id="fastq">FastQ</h4><p>FastQ是<code>scRNASeq</code>数据中最原始数据的格式。所有的<code>scRNA-seq</code>方案都会进行双端测序，根据文库构建方法不同，条形码序列 (barcodes)可能出现在测序的左端或右端序列。但是使用唯一分子标签 (UMIs)的测序方案会产生包含细胞和<code>UMI barcode</code>再加接头序列但没有转录本序列的<code>reads</code>。因此reads虽然是双端测序，但比对时按单端reads对待。</p><p>FastQ文件格式如下</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;ReadID</span><br><span class="line">READ SEQUENCE</span><br><span class="line">+</span><br><span class="line">SEQUENCING QUALITY SCORES</span><br></pre></td></tr></table></figure><h4 id="bam">BAM</h4><p>BAM文件是存储比对结果的标准有效的高度压缩的二进制格式，其文本格式<code>SAM</code>是直接可读的。BAM/SAM文件包含一个头部，记录样本准备、测序和比对的信息；后面是每个reads的比对结果，<code>tab</code>作为列分隔符。</p><p>比对行有下列标准格式：</p><ol type="1"><li>QNAME：read编号（如果是UMI文库，通常包含UMI条形码）</li><li>FLAG：数字标记指示reads比对的”类型”，如reads是否比对上，是否为<code>properly paired</code>等，Picard网站可以在”类型”和对应的数字之间进行转换，有更详细阐述。</li><li>RNAME：参考序列编号（比如比对到的染色体名字）。</li><li>POS：最左边的比对位置。</li><li>MAPQ：比对质量</li><li>CIGAR：表示reads的匹配/不匹配部分 (可能包括soft-clipping)</li><li>RNEXT：mate/next reads比对到的参考序列编号</li><li>PNEXT：mate/next reads比对到的第一个碱基位置</li><li>TLEN：模板长度（read比对到的参考区域的长度）</li><li>SEQ：read序列信息</li><li>QUAL：read质量信息</li></ol><p>BAM/SAM文件可以用<code>samtools</code>互相转换。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 新版本samtools中-S选项忽略，不需要再加，会自己判断输入的是bam还是sam格式</span><br><span class="line">samtools view -S -b file.sam &gt; file.bam</span><br><span class="line"># -h:包含header</span><br><span class="line">samtools view -h file.bam &gt; file.sam</span><br></pre></td></tr></table></figure><p>一些测序服务机构会自动把测序reads比对到标准基因组并提供<code>BAM</code>或<code>CRAM</code>格式文件，通常这些基因组不会包含<code>ERCC</code>序列，继而不会有<code>ERCC reads</code>比对到<code>BAM/CRAM</code>文件中。为了量化<code>ERCCs</code>（或序列有任何其他遗传变异或外源表达需要考虑时），或者如果想使用不同于标准流程中的比对算法，那你需要把<code>BAM/CRAM</code>文件转回<code>FastQ</code>:</p><p><code>bedtools</code>可以把<code>BAM</code>文件转成<code>FastQ</code>，为了避免把比对到多个基因组位置的同一个reads转换为FASTQ中的多条reads，需要先把BAM文件按read名称排序，并使用Samtools删除次级比对 (<code>secondary alignments</code>)。此外Picard里也有把<code>BAM</code>转成<code>FastQ</code>文件的方法。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sort reads by name</span></span><br><span class="line">samtools sort -n original.bam -o sorted_by_name.bam</span><br><span class="line"><span class="comment"># remove secondary alignments</span></span><br><span class="line">samtools view -b -F 256 sorted_by_name.bam -o primary_alignment_only.bam</span><br><span class="line"><span class="comment"># convert to fastq</span></span><br><span class="line">bedtools bamtofastq -i primary_alignment_only.bam -fq read1.fq -fq2 read2.fq</span><br></pre></td></tr></table></figure><h4 id="cram">CRAM</h4><p>CRAM文件与BAM文件类似，只是header中包含比对用到的参考基因组的信息。这使得每个read中与参考基因组相同的碱基可以被进一步压缩。CRAM也支持一些有损数据压缩方式来进一步优化储存，CRAMs格式主要是Sanger/EBI测序机构在使用。</p><p>CRAM和BAM文件可以用最新一版的<code>samtools(&gt;=v1.0)</code>相互转换。然而这个转换需要预先下载并缓存参考基因组。可以从CRAM文件的头部元数据中获得参考基因组信息自行下载，具体按下面的操作进行转换：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> REF_CACHE=/path_to/cache_directory_for_reference_genome</span><br><span class="line">samtools view -b -h -T reference_genome.fasta file.cram -o file.bam</span><br><span class="line">samtools view -C -h -T reference_genome.fasta file.bam -o file.cram</span><br></pre></td></tr></table></figure><h4 id="手动查看文件">手动查看文件</h4><p>一些时候，需要自己查看文件，比如查看下文件的<code>header</code>信息是否正确。<code>less</code>和<code>more</code>可以用来在命令行查看任意大小文本文件 (<em>个人更常用<code>less</code></em>)。管道符<code>|</code>可以在多个命令之间传输数据，省却把中间数据存储多个拷贝的过程，既简洁又快速。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">less file.txt</span><br><span class="line">more file.txt</span><br><span class="line"><span class="comment"># counts the number of lines in file.txt</span></span><br><span class="line">wc -l file.txt</span><br><span class="line">samtools view -h file.[cram/bam] | more</span><br><span class="line"><span class="comment"># counts the number of lines in the samtools output</span></span><br><span class="line">samtools view -h file.[cram/bam] | wc -l</span><br></pre></td></tr></table></figure><p><strong>练习</strong></p><p>假如你已经有了一个小的<code>cram</code>格式文件：<code>EXAMPLE.cram</code></p><ul><li><em>任务1</em>：这个文件是怎么获得的？用了什么比对软件?基因组的版本是什么？（提示：检查头部文件）</li><li><em>任务2</em>: 有多少reads比对或没比对上？文件共有多少短序列？<code>secondary alignments</code>有多少？（提示：用FLAG）</li><li><em>任务3</em>：将CRAM格式转成Fastq文件。转换后的每条read都是只有一个拷贝吗？（转换后的文件命名为 <code>10cells_read1.fastq</code> <code>10cells_read2.fastq</code>）</li></ul><p>小技巧：如果运行某个软件的帮助命令卡住时，直接输入命令，看看有无提示信息？</p><p><strong>答案</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">samtools view -T 2000_reference.transcripts.fa -H EXAMPLE.cram | less</span><br><span class="line">samtools view -T 2000_reference.transcripts.fa -f 4 EXAMPLE.cram | wc -l <span class="comment"># unmapped</span></span><br><span class="line">samtools view -T 2000_reference.transcripts.fa -F 260 EXAMPLE.cram | wc -l <span class="comment"># mapped</span></span><br><span class="line">samtools view -T 2000_reference.transcripts.fa -F 256 EXAMPLE.cram | wc -l <span class="comment"># total</span></span><br><span class="line">samtools view -T 2000_reference.transcripts.fa -f 256 EXAMPLE.cram | wc -l <span class="comment"># secondary alignments</span></span><br><span class="line"></span><br><span class="line">samtools view -b -h -T 2000_reference.transcripts.fa EXAMPLE.cram -o EXAMPLE.bam</span><br><span class="line">samtools sort -n EXAMPLE.bam -o sorted_EXAMPLE.bam</span><br><span class="line">samtools view -b -F 256 sorted_EXAMPLE.bam -o primary_EXAMPLE.bam </span><br><span class="line"><span class="comment"># convert to fastq</span></span><br><span class="line">bedtools bamtofastq -i primary_EXAMPLE.bam -fq 10cells_read1.fq -fq2 10cells_read2.fq</span><br></pre></td></tr></table></figure><h4 id="基因组和基因注释fastagtf">基因组和基因注释（FASTA,GTF）</h4><p>为了进行序列比对，需要参考基因组和/或基因组注释文件（<code>GTF</code>格式或<code>GFF</code>格式）。模式生物的基因组可以从任何主要的数据库下载：Ensembl, NCBI,或者UCSC Genome Browser。</p><p>GTF文件有基因、转录本和外显子的注释,他们必定包含：</p><ol type="1"><li>seq_id：序列的编号，一般为chr或scafold编号；</li><li>source: 注释的来源，一般为数据库或者注释的机构，如果未知，则用点<code>.</code>代替；</li><li>type: 注释信息的类型，比如Gene、cDNA、mRNA、CDS等;</li><li>start: 该基因或转录本在参考序列上的起始位置 (从1开始，包含);</li><li>end: 该基因或转录本在参考序列上的终止位置 (从1开始，包含);</li><li>score: 得分，数字，是注释信息可能性的说明，可以是序列相似性比对时的E-values值或者基因预测是的P-values值，<code>.</code>表示为空;</li><li>strand: 该基因或转录本位于参考序列的正链(+)或负链(-)上;</li><li>phase: 仅对注释类型为<code>CDS</code>有效，表示起始编码的位置，有效值为<code>0,1,2</code>。(对于编码蛋白质的CDS来说，本列指定下一个密码子开始的位置。每3个核苷酸翻译一个氨基酸，从0开始，CDS的起始位置，除以3，余数就是这个值，表示到达下一个密码子需要跳过的碱基个数。<code>0</code>表示该编码框的第一个密码子第一个碱基位于其5’末端；<code>1</code>表示该编码框的第一个密码子的第一个碱基位于该编码区外；<code>2</code>表示该编码框的第一个密码子的第一、二个碱基位于该编码区外；)；</li><li>attributes: 一个包含众多属性的列表，格式为<code>标签 值</code>(<code>tag value</code>)，以多个键值对组成的注释信息描述，键与值之间用`<code>(空格分割)，不同的键值用</code>;<code>隔开，如</code>gene_id “gene”; transcript_id “geneA.1”; database_id “0012”; modified_by “Damian”; duplicate 0`。</li></ol><p>根据我们的经验，Ensembl是最容易使用的，并且具有最大的注释集。NCBI往往更严格，仅包含高可信度的基因注释。而UCSC包含多个使用不同标准的基因注释。</p><p>如果你的实验系统含有非标准序列 (比如<code>ERCC spike-ins</code>)，那么这些序列必须加到基因组<code>fasta</code>和<code>gtf</code>上来定量它们的表达。另外，对CRISPR相关序列或其他过表达/报告载体也必须进行相同的操作。</p><p>为了获得最大的可用性和灵活性，我们建议为任何添加的非标准序列创建完整详细的<code>fasta</code>序列文件和<code>gtf</code>文件。</p><p>目前还没有标准化的方法来做到这一点。下面是我们写的一个<code>perl</code>脚本，可以把<code>ERCC</code>序列转成对应的<code>gtf</code>和<code>fasta</code>文件，以便附加到标准基因组中。如果要量化内含子reads时，您可能还需要更改<code>gtf</code>文件以处理内含子中的重复元件。任何脚本语言甚至是<code>awk</code>或一些文本编辑器都可以相对有效地完成这项任务，但它们超出了本次课程的范围。</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Converts the Annotation file from </span></span><br><span class="line"><span class="comment"># https://www.thermofisher.com/order/catalog/product/4456740 to </span></span><br><span class="line"><span class="comment"># gtf and fasta files that can be added to existing genome fasta &amp; gtf files.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">my</span> @FASTAlines = ();</span><br><span class="line"><span class="keyword">my</span> @GTFlines = ();</span><br><span class="line"><span class="keyword">open</span> (<span class="keyword">my</span> $ifh, <span class="string">&quot;ERCC_Controls_Annotation.txt&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span> $!;</span><br><span class="line">&lt;$ifh&gt;; <span class="comment">#header</span></span><br><span class="line"><span class="keyword">while</span> (&lt;$ifh&gt;) &#123;</span><br><span class="line">    <span class="comment"># Do all the important stuff</span></span><br><span class="line">    <span class="keyword">chomp</span>;</span><br><span class="line">    <span class="keyword">my</span> @record = <span class="keyword">split</span>(<span class="regexp">/\t/</span>);</span><br><span class="line">    <span class="keyword">my</span> $sequence = $record[<span class="number">4</span>];</span><br><span class="line">    $sequence =~ <span class="regexp">s/\s+//g</span>; <span class="comment"># get rid of any preceeding/tailing white space</span></span><br><span class="line">    $sequence = $sequence.<span class="string">&quot;NNNN&quot;</span>;</span><br><span class="line">    <span class="keyword">my</span> $name = $record[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">my</span> $genbank = $record[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">push</span>(@FASTAlines, <span class="string">&quot;&gt;$name\n$sequence\n&quot;</span>);</span><br><span class="line"><span class="comment"># is GTF 1 indexed or 0 indexed? -&gt; it is 1 indexed</span></span><br><span class="line"><span class="comment"># + or - strand?</span></span><br><span class="line">    <span class="keyword">push</span>(@GTFlines, <span class="string">&quot;$name\tERCC\tgene\t1\t&quot;</span>.(<span class="keyword">length</span>($sequence)-<span class="number">2</span>).<span class="string">&quot;\t.\t+\t.\tgene_id \&quot;$name-$genbank\&quot;; transcript_id \&quot;$name-$genbank\&quot;; exon_number \&quot;1\&quot;; gene_name \&quot;ERCC $name-$genbank\&quot;\n&quot;</span>);</span><br><span class="line">    <span class="keyword">push</span>(@GTFlines, <span class="string">&quot;$name\tERCC\ttranscript\t1\t&quot;</span>.(<span class="keyword">length</span>($sequence)-<span class="number">2</span>).<span class="string">&quot;\t.\t+\t.\tgene_id \&quot;$name-$genbank\&quot;; transcript_id \&quot;$name-$genbank\&quot;; exon_number \&quot;1\&quot;; gene_name \&quot;ERCC $name-$genbank\&quot;\n&quot;</span>);</span><br><span class="line">    <span class="keyword">push</span>(@GTFlines, <span class="string">&quot;$name\tERCC\texon\t1\t&quot;</span>.(<span class="keyword">length</span>($sequence)-<span class="number">2</span>).<span class="string">&quot;\t.\t+\t.\tgene_id \&quot;$name-$genbank\&quot;; transcript_id \&quot;$name-$genbank\&quot;; exon_number \&quot;1\&quot;; gene_name \&quot;ERCC $name-$genbank\&quot;\n&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">close</span>($ifh);</span><br><span class="line"></span><br><span class="line"><span class="comment"># Write output</span></span><br><span class="line"><span class="keyword">open</span>(<span class="keyword">my</span> $ofh, <span class="string">&quot;&gt;&quot;</span>, <span class="string">&quot;ERCC_Controls.fa&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span> $!;</span><br><span class="line"><span class="keyword">foreach</span> <span class="keyword">my</span> $line (@FASTAlines) &#123;</span><br><span class="line">    <span class="keyword">print</span> $ofh $line;</span><br><span class="line">&#125; <span class="keyword">close</span> ($ofh);</span><br><span class="line"></span><br><span class="line"><span class="keyword">open</span>($ofh, <span class="string">&quot;&gt;&quot;</span>, <span class="string">&quot;ERCC_Controls.gtf&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span> $!;</span><br><span class="line"><span class="keyword">foreach</span> <span class="keyword">my</span> $line (@GTFlines) &#123;</span><br><span class="line">    <span class="keyword">print</span> $ofh $line;</span><br><span class="line">&#125; <span class="keyword">close</span> ($ofh);</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面两个awk命令可以实现perl脚本的功能</span></span><br><span class="line"><span class="comment"># 如果是windows的文件，替换下末尾的换行符</span></span><br><span class="line">sed -i <span class="string">&#x27;s/^M//&#x27;</span> ERCC_Controls_Annotation.txt</span><br><span class="line"><span class="comment"># 转成FASTA序列</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;OFS=FS=&quot;\t&quot;&#125;&#123;if(FNR&gt;1) print &quot;&gt;&quot;$1&quot;\n&quot;$NF&quot;NNNN&quot;&#125;&#x27;</span> ERCC_Controls_Annotation.txt &gt;ERCC.fa</span><br><span class="line"><span class="comment"># 转成GTF</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;OFS=FS=&quot;\t&quot;&#125;&#123;if(FNR&gt;1) &#123;seq_len=length($NF)+2; attr=&quot;gene_id \&quot;&quot;$1&quot;-&quot;$2&quot;\&quot;; transcript_id \&quot;&quot;$1&quot;-&quot;$2&quot;\&quot;; exon_number \&quot;1\&quot;; gene_name \&quot;&quot;$1&quot;-&quot;$2&quot;\&quot;&quot;; print $1,&quot;ERCC&quot;,&quot;gene&quot;,1,seq_len,&quot;.&quot;,&quot;+&quot;,&quot;.&quot;,attr; print $1,&quot;ERCC&quot;,&quot;transcript&quot;,1,seq_len,&quot;.&quot;,&quot;+&quot;,&quot;.&quot;,attr; print $1,&quot;ERCC&quot;,&quot;exon&quot;,1,seq_len,&quot;.&quot;,&quot;+&quot;,&quot;.&quot;,attr;&#125;&#125;&#x27;</span> ERCC_Controls_Annotation.txt &gt;ERCC.gtf</span><br></pre></td></tr></table></figure><h3 id="测序文库拆分-demultiplexing">测序文库拆分 (Demultiplexing)</h3><p>文库拆分因使用的前期Protocol不同或构建的流程不同需要有对应的处理方式。我们认为最灵活可用的文库拆分工具是<a href="https://github.com/sdparekh/zUMIs/wiki/Usage">zUMIs</a>，可以用来拆分和比对大部分基于UMI的建库方式。对于<code>Smartseq2</code>或其他双端全长转录本方案，数据通常已经拆分好了。例如GEO或ArrayExpress之类的公共数据存储库会要求小规模或<code>plate-based scRNASeq</code>数据拆分好再上传，并且很多测序服务商提供的数据都是自动拆分好的。如果使用的分析流程依赖于拆分好的数据但测序服务商提供的数据没有拆分时就需要自己拆分。因为不同的建库方案引入的<code>barcode</code>序列的长度和位置不同，通常都需要自己写脚本解决。</p><p>对于所有数据类型，”文库拆分”涉及从一端或双端短序列中识别和移除细胞条形码序列 (<code>cell barcode</code>)。如果提前知道加入的细胞条形码，比如数据来自基于PCR板的方案，只需要找到条形码并与条形码库作比对，归类于与之最相似的那个就可以 (根据条形码的设计，一般允许最多1-2个错配)。这些数据通常在比对之前先做拆分，从而可以并行比对，提高效率。</p><p>我们有公开可用 (&lt;&gt;)的 perl脚本，可以拆分任何<code>plate-based</code>的建库方案生成的数据，不管有没有<code>UMI</code>。操作如下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://github.com/tallulandrews/scRNASeqPipeline</span></span><br><span class="line"><span class="comment"># perl 1_Flexible_UMI_Demultiplexing.pl read1.fq read2.fq b_structure index mismatch prefix\n&quot;;</span></span><br><span class="line"><span class="comment">#    print STDERR &quot;</span></span><br><span class="line"><span class="comment">#    read1.fq : barcode/umi containing read</span></span><br><span class="line"><span class="comment">#    read2.fq : non-barcode containing read</span></span><br><span class="line"><span class="comment">#    b_structure : a single string of the format C##U# or U#C## </span></span><br><span class="line"><span class="comment">#        where C## is the cell-barcode and U# is the UMI.</span></span><br><span class="line"><span class="comment">#        e.g. C10U4 = a 10bp cell barcode followed by a 4bp UMI</span></span><br><span class="line"><span class="comment">#    index : file containg a single column of expected cell-barcodes.</span></span><br><span class="line"><span class="comment">#        if equal to \&quot;UNKNOWN\&quot; script will output read counts for each unique barcode.</span></span><br><span class="line"><span class="comment">#    mismatch : maximum number of permitted mismatches (recommend 2)</span></span><br><span class="line"><span class="comment">#    prefix : prefix for output fastq files.</span></span><br><span class="line">perl 1_Flexible_UMI_Demultiplexing.pl 10cells_read1.fq 10cells_read2.fq <span class="string">&quot;C12U8&quot;</span> 10cells_barcodes.txt 2 Ex</span><br></pre></td></tr></table></figure><p>运行过程输出如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">## </span><br><span class="line">##  Doesn&#39;t match any cell: 0</span><br><span class="line">##  Ambiguous: 0</span><br><span class="line">##  Exact Matches: 400</span><br><span class="line">##  Contain mismatches: 0</span><br><span class="line">##  Input Reads: 400</span><br><span class="line">##  Output Reads: 400</span><br><span class="line">## Barcode Structure: 12 bp CellID followed by 8 bp UMI</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl utils/1_Flexible_FullTranscript_Demultiplexing.pl data/10cells_read1.fq data/10cells_read2.fq <span class="string">&quot;start&quot;</span> 12 data/10cells_barcodes.txt 2 Ex</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">## </span><br><span class="line">## Doesn&#39;t match any cell: 0</span><br><span class="line">## Ambiguous: 0</span><br><span class="line">## Exact Matches: 400</span><br><span class="line">## Contain Mismatches: 0</span><br><span class="line">## Input Reads: 400</span><br><span class="line">## Output Reads: 400</span><br></pre></td></tr></table></figure><p>对于包含<code>UMI</code>的数据，文库拆分包含把<code>UMI code</code>加到来源于基因区的序列的名字上。如果数据来源于<code>droplet-based protocol</code>或者<code>SeqWell</code>，实际加入的<code>barcode</code>序列的种类多于捕获到的细胞数时，为了避免生成特别多的文件，一般也把<code>cell-barcode</code>加到测序reads的名字后面。在这种情况下，文库拆分是在定量过程中进行的，有利于识别来源于完整细胞而不是背景噪声中的<code>cell-barcode</code>序列。</p><h4 id="鉴定含有细胞的液滴微孔">鉴定含有细胞的液滴/微孔</h4><p>液滴型scRNA-seq方法中只有一小部分的液滴包含珠状物和一个完整细胞。然而生物实验不会那么理想，有些RNA会从死细胞或破损细胞中漏出来。所以没有完整细胞的液滴有可能捕获周围环境游离出的少了RNA并且走完测序环节出现在最终测序结果中。液滴大小、扩增效率和测序环节中的波动会导致”背景”和真实细胞最终获得的文库大小变化很大，使得区分哪些文库来源于背景哪些来源于真实细胞变得复杂。</p><p>液滴型scRNA-seq方法中只有一小部分的液滴包含珠状物和一个完整细胞。然而生物实验不会那么理想，有些RNA会从死细胞或破损细胞中漏出来。所以没有完整细胞的液滴有可能捕获周围环境游离出的少了RNA并且走完测序环节出现在最终测序结果中。液滴大小、扩增效率和测序环节中的波动会导致”背景”和真实细胞最终获得的文库大小变化很大，使得区分哪些文库来源于背景哪些来源于真实细胞变得复杂。</p><p>大多数方法使用每个<code>barcode</code>对应的总分子数(如果是UMI)或总reads数的分布来寻找一个”break point”区分来自于真实细胞的较大的文库和来自于背景的较小的文库。下面加载一些包含大细胞和细胞的模拟数据实际操作下：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">umi_per_barcode &lt;- read.table(<span class="string">&quot;droplet_id_example_per_barcode.txt.gz&quot;</span>)</span><br><span class="line">truth &lt;- read.delim(<span class="string">&quot;droplet_id_example_truth.gz&quot;</span>, sep=<span class="string">&quot;,&quot;</span>)</span><br></pre></td></tr></table></figure><p><em>练习</em>: 有多少唯一的条形码被检测到？数据里多少来自真细胞？为了简化计算，写代码排除掉少于10个分子的条形码。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dim(umi_per_barcode)[<span class="number">1</span>]</span><br><span class="line">dim(truth)[<span class="number">1</span>]</span><br><span class="line">umi_per_barcode &lt;- umi_per_barcode[umi_per_barcode[,<span class="number">2</span>] &gt; <span class="number">10</span>,]</span><br></pre></td></tr></table></figure><p>一个找寻每个条形码对应的分子数突然下降的拐点的方法：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">barcode_rank &lt;- rank(-umi_per_barcode[,<span class="number">2</span>])</span><br><span class="line">plot(barcode_rank, umi_per_barcode[,<span class="number">2</span>], xlim=c(<span class="number">1</span>,<span class="number">8000</span>))</span><br></pre></td></tr></table></figure><p><img src="/images/lab2/unnamed-chunk-11-1.png" /></p><p>可以看到文库大小分布类似一条指数曲线，为了看的更清楚，对数据进行<code>log</code>转换。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">log_lib_size &lt;- log10(umi_per_barcode[,<span class="number">2</span>])</span><br><span class="line">plot(barcode_rank, log_lib_size, xlim=c(<span class="number">1</span>,<span class="number">8000</span>))</span><br></pre></td></tr></table></figure><p><img src="/images/lab2/unnamed-chunk-12-1.png" /></p><p>转换后，拐点更明显了，我们可以手动估计拐点的位置来区分背景噪音和真实细胞，但是用算法来识别要更精确，可重用性更强。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># inflection point</span></span><br><span class="line">o &lt;- order(barcode_rank)</span><br><span class="line">log_lib_size &lt;- log_lib_size[o]</span><br><span class="line">barcode_rank &lt;- barcode_rank[o]</span><br><span class="line"></span><br><span class="line">rawdiff &lt;- diff(log_lib_size)/diff(barcode_rank)</span><br><span class="line">inflection &lt;- which(rawdiff == min(rawdiff[<span class="number">100</span>:length(rawdiff)], na.rm=<span class="literal">TRUE</span>))</span><br><span class="line"></span><br><span class="line">plot(barcode_rank, log_lib_size, xlim=c(<span class="number">1</span>,<span class="number">8000</span>))</span><br><span class="line">abline(v=inflection, col=<span class="string">&quot;red&quot;</span>, lwd=<span class="number">2</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/lab2/unnamed-chunk-13-1.png" /></p><p>另一种方法是构建混合模型，找出较高和较低分布相交的位置。但是数据可能不会像假定的分布那么好：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">set.seed(-<span class="number">92497</span>)</span><br><span class="line"><span class="comment"># mixture model</span></span><br><span class="line"><span class="keyword">require</span>(<span class="string">&quot;mixtools&quot;</span>)</span><br><span class="line"></span><br><span class="line">mix &lt;- normalmixEM(log_lib_size)</span><br><span class="line"><span class="comment">## number of iterations= 43</span></span><br><span class="line">plot(mix, which=<span class="number">2</span>, xlab2=<span class="string">&quot;log(mol per cell)&quot;</span>)</span><br><span class="line"></span><br><span class="line">p1 &lt;- dnorm(log_lib_size, mean=mix$mu[<span class="number">1</span>], sd=mix$sigma[<span class="number">1</span>])</span><br><span class="line">p2 &lt;- dnorm(log_lib_size, mean=mix$mu[<span class="number">2</span>], sd=mix$sigma[<span class="number">2</span>])</span><br><span class="line"><span class="keyword">if</span> (mix$mu[<span class="number">1</span>] &lt; mix$mu[<span class="number">2</span>]) &#123;</span><br><span class="line">    split &lt;- min(log_lib_size[p2 &gt; p1])</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    split &lt;- min(log_lib_size[p1 &gt; p2])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/images/lab2/unnamed-chunk-14-1.png" /></p><p>第三种方法，CellRanger假设真实细胞文库大小变化在10倍以内，用期望的细胞数目估计区间的分布。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">n_cells &lt;- length(truth[,<span class="number">1</span>])</span><br><span class="line"><span class="comment"># CellRanger</span></span><br><span class="line">totals &lt;- umi_per_barcode[,<span class="number">2</span>]</span><br><span class="line">totals &lt;- sort(totals, decreasing = <span class="literal">TRUE</span>)</span><br><span class="line"><span class="comment"># 99th percentile of top n_cells divided by 10</span></span><br><span class="line">thresh = totals[round(<span class="number">0.01</span>*n_cells)]/<span class="number">10</span></span><br><span class="line">plot(totals, xlim=c(<span class="number">1</span>,<span class="number">8000</span>))</span><br><span class="line">abline(h=thresh, col=<span class="string">&quot;red&quot;</span>, lwd=<span class="number">2</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/lab2/unnamed-chunk-16-1.png" /></p><h3 id="使用star比对read">使用STAR比对read</h3><p>现在我们已经对测序原始数据进行了质控，获得了高质量的<code>Clean data</code>，下一步就是把它们比对到参考基因组。如果我们想定量基因表达或鉴定样本之间差异表达的基因，则通常需要某种形式的比对。</p><p>用于短序列比对的工具已经开发了很多，但今天我们主要涉及两个。第一个工具是STAR。对于测序数据中的每条reads，STAR尝试找到能与参考基因组中一个或多个位置匹配的最长可能序列。例如，在下图中，有一个短序列（蓝色），它跨越两个外显子和一个选择性剪接点（紫色）。STAR能够发现短序列的第一部分与第一外显子的序列匹配，而第二部分与第二外显子中的序列匹配。因为<code>STAR</code>能够用这种方式识别剪接事件，所以它被称为<code>splice aware</code>的比对工具</p><p><img src="/images/lab2/640.jpg" /></p><p>通常<code>STAR</code>把短序列比对到参考基因组时允许检测新的剪接事件或染色体重排事件。然而，STAR的一个问题是它需要大量的内存，尤其是参考基因组很大（例如老鼠和人类，大约需要30 G内存）的时候。为了加速今天的分析，我们将使用STAR把<code>reads</code>比对到只包含<code>2000</code>个转录本的参考转录组上。<strong>请注意</strong>，这<strong>不</strong>是常用或推荐的做法，只是考虑时间问题才这样做。我们通常建议比对到参考基因组 (但过程与此类似)。</p><p>执行STAR比对需要两个步骤。在第一步中，用户向STAR提供参考基因组序列（FASTA）和注释（GTF）,来创建基因组索引。第二步，STAR将用户的短序列数据比对到基因组索引。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 实际应用时比对到基因组</span></span><br><span class="line"><span class="comment"># 命令如下</span></span><br><span class="line">mkdir -p star_GRCh38</span><br><span class="line"><span class="comment"># --runThreadN 2: 指定使用2个线程</span></span><br><span class="line"><span class="comment"># --sjdbOverhang 100: 默认</span></span><br><span class="line">STAR --runMode genomeGenerate --runThreadN 2 --genomeDir star_GRCh38 \</span><br><span class="line">     --genomeFastaFiles GRCh38.fa --sjdbGTFfile GRCh38.gtf</span><br><span class="line"><span class="comment"># 输出文件如下，注意看下输出文件的大小，有无空文件，基因数是否对。</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">ls -sh star_GRCh38</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 总用量 2.1G</span></span><br><span class="line"><span class="comment"># 4.0K chrLength.txt      368K exonInfo.tab          1.5G SAindex</span></span><br><span class="line"><span class="comment"># 4.0K chrNameLength.txt   24K geneInfo.tab          204K sjdbInfo.txt</span></span><br><span class="line"><span class="comment"># 4.0K chrName.txt         64M Genome                204K sjdbList.fromGTF.out.tab</span></span><br><span class="line"><span class="comment"># 4.0K chrStart.txt       4.0K genomeParameters.txt  204K sjdbList.out.tab</span></span><br><span class="line"><span class="comment"># 732K exonGeTrInfo.tab   516M SA                    224K transcriptInfo.tab</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># STAR解析后的基因数</span></span><br><span class="line">wc -l star_GRCh38/geneInfo.tab</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 原始GTF的基因数</span></span><br><span class="line">grep -cP <span class="string">&#x27;\tgene\t&#x27;</span> GRCh38.gtf</span><br></pre></td></tr></table></figure><p>现在完成了索引创建，执行比对步骤</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir results</span><br><span class="line">mkdir results/STAR</span><br><span class="line"></span><br><span class="line">STAR --runThreadN 4 --genomeDir indices/STAR --readFilesIn Share/ERR522959_1.fastq Share/ERR522959_2.fastq --outFileNamePrefix results/STAR/</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p trt_N061011</span><br><span class="line"><span class="comment"># --runThreadN 4: 使用4个线程</span></span><br><span class="line"><span class="comment"># --readFilesIn: 输入文件，左端和右端</span></span><br><span class="line"><span class="comment"># --readFilesCommand zcat：gzip压缩，指定解压方式</span></span><br><span class="line"><span class="comment"># --genomeDir：基因组索引目录的位置</span></span><br><span class="line"><span class="comment"># -S: 指定输出文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 动物一般写 1000000，植物一般写5000</span></span><br><span class="line">max_intron_size=100000</span><br><span class="line"></span><br><span class="line"><span class="comment"># --genomeLoad LoadAndKeep : 共享内存</span></span><br><span class="line"><span class="comment"># 其他参数自己对着star的帮助手册看</span></span><br><span class="line">star_p=<span class="string">&quot; --outFilterType BySJout --outSAMattributes NH HI AS NM MD \</span></span><br><span class="line"><span class="string">       --outFilterMultimapNmax 20 --alignSJoverhangMin 8 --alignSJDBoverhangMin 1 \</span></span><br><span class="line"><span class="string">       --alignIntronMin 20 --alignIntronMax <span class="variable">$&#123;max_intron_size&#125;</span> \</span></span><br><span class="line"><span class="string">                --alignMatesGapMax <span class="variable">$&#123;max_intron_size&#125;</span> \</span></span><br><span class="line"><span class="string">                --outFilterMatchNminOverLread 0.66 --outFilterScoreMinOverLread 0.66 \</span></span><br><span class="line"><span class="string">                --winAnchorMultimapNmax 70 --seedSearchStartLmax 45 \</span></span><br><span class="line"><span class="string">                --outSAMattrIHstart 0 --outSAMstrandField intronMotif \</span></span><br><span class="line"><span class="string">                --genomeLoad LoadAndKeep --outReadsUnmapped Fastx \</span></span><br><span class="line"><span class="string">                --outSAMtype BAM Unsorted --quantMode TranscriptomeSAM GeneCounts&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># STAR比对单个样品                </span></span><br><span class="line">STAR --runMode alignReads --runThreadN 4 \</span><br><span class="line">        --readFilesIn trt_N061011_1.fq.gz trt_N061011_2.fq.gz \</span><br><span class="line">        --readFilesCommand zcat --genomeDir genome/star_GRCh38 \</span><br><span class="line">        --outFileNamePrefix trt_N061011/trt_N061011. <span class="variable">$&#123;star_p&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># STAR比对单个样品                </span></span><br><span class="line">STAR --runMode alignReads --runThreadN 4 \</span><br><span class="line">        --readFilesIn trt_N061011_1.fq.gz trt_N061011_2.fq.gz \</span><br><span class="line">        --readFilesCommand zcat --genomeDir genome/star_GRCh38 \</span><br><span class="line">        --outFileNamePrefix trt_N061011/trt_N061011. <span class="variable">$&#123;star_p&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Aug 03 11:44:27 ..... started STAR run</span></span><br><span class="line"><span class="comment"># Aug 03 11:44:27 ..... loading genome</span></span><br><span class="line"><span class="comment"># Aug 03 11:44:30 ..... started mapping</span></span><br><span class="line"><span class="comment"># Aug 03 11:44:48 ..... finished successfully</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出文件</span></span><br><span class="line"></span><br><span class="line">ls -sh trt_N061011/*</span><br><span class="line"></span><br><span class="line"><span class="comment"># trt_N061011.Aligned.out.bam: 比对到基因组的bam文件</span></span><br><span class="line"><span class="comment"># trt_N061011.Aligned.toTranscriptome.out.bam：比对到转录组的bam文件，供RSEM计算TPM使用 </span></span><br><span class="line"><span class="comment"># trt_N061011.Log.final.out: reads比对日志</span></span><br><span class="line"><span class="comment"># trt_N061011.Log.out: 运行参数和过程</span></span><br><span class="line"><span class="comment"># trt_N061011.Log.progress.out: 运行日志</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># trt_N061011.ReadsPerGene.out.tab: 每个基因的reads count，链非特异性RNASeq选第2列.</span></span><br><span class="line"><span class="comment"># column 1: gene ID</span></span><br><span class="line"><span class="comment"># column 2: counts for unstranded RNA-seq</span></span><br><span class="line"><span class="comment"># column 3: counts for the 1st read strand aligned with RNA (htseq-count option -s yes)</span></span><br><span class="line"><span class="comment"># column 4: counts for the 2nd read strand aligned with RNA (htseq-count option -s reverse)</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># Select the output according to the strandedness of your data. Note, that if you have stranded data and choose one of the columns 3 or 4, the other column (4 or 3) will give you the count of antisense reads. </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># trt_N061011.SJ.out.tab: Junction reads</span></span><br><span class="line"><span class="comment"># trt_N061011.Unmapped.out.mate1：未比对上的reads</span></span><br><span class="line"><span class="comment"># trt_N061011.Unmapped.out.mate2：未比对上的reads</span></span><br></pre></td></tr></table></figure><h3 id="kallisto和pseudo-alignment">Kallisto和Pseudo-Alignment</h3><p><code>STAR</code>是序列比对工具，而<code>Kallisto</code>是伪比对工具。它们的区别是：比对工具是把reads比对回参考基因组或转录组，而伪比对工具是把<code>k-mers</code>比对到参考转录组。</p><h4 id="什么是k-mer">什么是k-mer</h4><p><code>k-mer</code>是来源于测序短序列中的长度为<code>k</code>的子序列。例如，假设有短序列<code>ATCCCGGGTTAT</code>，想从中获得<code>7-mer</code>。为此，我们将提取前七个碱基作为第一个<code>7-mer</code>，然后向下移动一个碱基获得第二个<code>7-mer</code>，以此类推。</p><h4 id="为什么比对k-mers而不是reads">为什么比对k-mers而不是reads</h4><ol type="1"><li>伪比对工具利用算法技巧使得比对<code>k-mers</code>比比对<code>reads</code>速度快很多<br /></li><li>在某些情况下，伪对齐工具可能比传统比对工具更好的处理测序错误问题。例如，假设序列上第一个碱基中存在测序错误，本来是<code>T</code>却测序成了<code>A</code>。对伪比对工具来说，只会影响第一个<code>7-mer</code>而不会影响后续<code>7-mer</code>的比对。</li></ol><h4 id="kallisto的伪比对模式">Kallisto的伪比对模式</h4><p>Kallisto有一个为单细胞转录组特别设计的伪比对模式。和<code>STAR</code>不同，Kallisto比对到的是参考转录组而不是参考基因组，意味着<code>Kallisto</code>是将序列比对到剪接异构体而不是基因上，对单细胞来讲，这是有挑战性的：</p><ul><li>单细胞RNA-seq的覆盖率低于<code>bulk RNA-seq</code>，这意味着可以从序列中获得的信息总量减少了。</li><li>许多单细胞RNA-seq方案具有<code>3'</code>覆盖偏好性，如果两种剪接异构体只在5’末端不同，则很难确定序列来源于哪个剪接异构体。</li><li>一些单细胞RNA-seq方案测序读长短，也难以区分来源于哪个剪接异构体。</li></ul><p>Kallisto的伪模式采用了略微不同的伪比对方法。它不与剪接异构体比对，而是与等价类 (<code>equivalence classes</code>)比对。所以如果read比对到多个异构体，Kallisto会记录read比对到包含有所有异构体的等价类，因此可以使用等价类计数而非基因或转录本计数用于下游的聚类等分析。具体见下图：</p><p><img src="/images/lab2/642.webp" /></p><p>今天我们只用一个细胞来展示伪比对，但是Kallisto其实可以同时对大量细胞进行伪比对，并且可以使用<code>UMIs</code>的信息。</p><p>类似于<code>STAR</code>，伪比对前也需要为<code>Kallisto</code>生成一个索引。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir results/Kallisto</span><br><span class="line">kallisto pseudo -i indices/Kallisto/transcripts.idx -o results/Kallisto -b batch.txt</span><br></pre></td></tr></table></figure><p>参考 https://pachterlab.github.io/kallisto/manual 构建<code>batch.txt</code>。</p><p><code>batch.txt</code>文件格式如下：第一列是细胞的名字<code>ID</code>, 后面两列是对应的<code>PE reads</code>。所有<code>#</code>开头的行都忽略。如果是单端测序，命令行参数指定为<code>--single -l -s</code>，<code>batch.txt</code>只需提供一个<code>fastq</code>文件。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#id file1 file 2</span></span><br><span class="line">cell1 cell1_1.fastq.gz cell1_2.fastq.gz</span><br><span class="line">cell2 cell2_1.fastq.gz cell2_2.fastq.gz</span><br><span class="line">cell3 cell3_1.fastq.gz cell3_2.fastq.gz</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>如果使用了<code>--umi</code>参数，<code>batch.txt</code>文件格式如下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#id umi-file file-1</span></span><br><span class="line">cell1 cell_1.umi cell_1.fastq.gz</span><br><span class="line">cell2 cell_2.umi cell_2.fastq.gz</span><br><span class="line">cell3 cell_3.umi cell_3.fastq.gz</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><code>umi-file</code>是文本文件，每行是一个read的<code>UMI</code>序列，必须与<code>fastq</code>中<code>reads</code>的顺序一致。即便<code>UMI</code>数据是单端，也不会用到测序片段的长度信息。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">TTACACTGAC</span><br><span class="line">CCACTCTATG</span><br><span class="line">CAGGAAATCG</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><code>kallisto</code>在<code>UMI</code>模式下，不是计算每个<code>equivalence class</code>的<code>reads count</code>，而是使用测序reads做<code>pseudoalign</code>获得<code>equivalence class</code>, 计算每个<code>equivalence class</code>上的UMIs个数。</p><h4 id="理解kallisto的输出结果">理解Kallisto的输出结果</h4><p>上面命令会生成4个文件-<code>matrix.cells</code>, <code>matrix.ec</code>, <code>matrix.tsv</code> 和 <code>run_info.json</code>.</p><ul><li><code>matrix.cell</code> 为细胞ID列表，测试数据只用了一个细胞，这个文件应该只包含“ERR522959”</li><li><code>matrix.ec</code> 含有所有用到的等价类信息。每一行的第一个数字是等价类<code>ID</code>，第二个数字对应等价类的转录文本<code>ID</code>。举个例子，<code>10 1,2,3</code>表示等价类<code>10</code>包含转录文本ID <code>1</code>, <code>2</code>和<code>3</code>。ID号对应于转录本在<code>reference.transcripts.fa</code>中出现的顺序。第一个出现的转录本ID为<code>0</code>，转录本ID <code>1</code>, <code>2</code>和<code>3</code>对应于<code>reference.transcripts.fa</code>中的第二，第三和第四条转录本。</li><li><code>matrix.tsv</code> 表示每个等价类在不同细胞中的<code>reads count</code>信息。第一个数字是等价类ID，和<code>matrix.ec</code>中的定义一样。第二个数字是<code>细胞ID</code>，和<code>matrix.cell</code>文件中的细胞名字顺序一一对应。第三个数字是等价类在该细胞中的<code>reads count</code>。举个例子，<code>5 1 3</code>指细胞<code>1</code>中有<code>3</code>个reads比对到等价类<code>5</code>。细胞ID同样是<strong>零</strong>起始的索引，所以细胞<code>1</code>指<code>matrix.cells</code>中的第二个细胞。</li><li><code>run_info.json</code> 含有关于<code>Kallisto</code>执行的信息，一般可忽略。</li></ul>]]></content>
      
      
      <categories>
          
          <category> SingleCell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SingleCell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GO富集圈圈图</title>
      <link href="2020/09/23/goplot/"/>
      <url>2020/09/23/goplot/</url>
      
        <content type="html"><![CDATA[<h2 id="绘制go富集的圈圈图实例">绘制GO富集的圈圈图实例</h2><p>载入R包</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(clusterProfiler)</span><br><span class="line"><span class="keyword">library</span>(org.Hs.eg.db)</span><br><span class="line"><span class="keyword">library</span>(GOplot)</span><br><span class="line"><span class="keyword">library</span>(stringr)</span><br></pre></td></tr></table></figure><p>载入差异表达数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## Warning in readChar(con, 5L, useBytes &#x3D; TRUE): cannot open compressed file &#39;F:&#x2F;</span><br><span class="line">## diff_expr.Rdata&#39;, probable reason &#39;No such file or directory&#39;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## Error in readChar(con, 5L, useBytes &#x3D; TRUE): cannot open the connection</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">##       logFC   AveExpr         t      P.Value    adj.P.Val        B probe_id symbol change</span><br><span class="line">## 1 -5.780170  7.370282 -82.94833 3.495205e-12 1.163798e-07 16.32898  8133876   CD36   down</span><br><span class="line">## 2  4.212683  9.106625  68.40113 1.437468e-11 2.393169e-07 15.71739  7965335  DUSP6     up</span><br><span class="line">## 3 -5.633027  8.763220 -57.61985 5.053466e-11 4.431880e-07 15.04752  7972259    DCT   down</span><br><span class="line">## 4  3.801663  9.726468  57.21112 5.324059e-11 4.431880e-07 15.01709  7972217  SPRY2     up</span><br><span class="line">## 5 -3.263063 10.171635 -50.51733 1.324638e-10 8.821294e-07 14.45166  8129573  MOXD1   down</span><br><span class="line">## 6  3.843247  9.667077  45.87910 2.681063e-10 1.487856e-06 13.97123  8015806   ETV4     up</span><br><span class="line">##   ENTREZID</span><br><span class="line">## 1      948</span><br><span class="line">## 2     1848</span><br><span class="line">## 3     1638</span><br><span class="line">## 4    10253</span><br><span class="line">## 5    26002</span><br><span class="line">## 6     2118</span><br></pre></td></tr></table></figure><p>保留差异表达基因</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">diff_expr = diff_expr[diff_expr$change!=<span class="string">&quot;stable&quot;</span>,]</span><br><span class="line">diff_expr = diff_expr[<span class="number">1</span>:<span class="number">100</span>,]</span><br><span class="line">gene_diff = diff_expr$symbol</span><br></pre></td></tr></table></figure><p>富集分析</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">enrich_BP &lt;- enrichGO(gene = gene_diff, keyType = <span class="string">&quot;SYMBOL&quot;</span>, OrgDb= org.Hs.eg.db,</span><br><span class="line">                      ont = <span class="string">&quot;BP&quot;</span>, pAdjustMethod = <span class="string">&quot;BH&quot;</span>, minGSSize = <span class="number">1</span>,</span><br><span class="line">                      pvalueCutoff = <span class="number">0.05</span>, qvalueCutoff = <span class="number">0.05</span>)</span><br><span class="line">class(enrich_BP)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">## [1] &quot;enrichResult&quot;</span><br><span class="line">## attr(,&quot;package&quot;)</span><br><span class="line">## [1] &quot;DOSE&quot;</span><br></pre></td></tr></table></figure><p>提取图像绘制需要的输入数据</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">enrich &lt;- data.frame(enrich_BP) </span><br><span class="line">colnames(enrich)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## [1] &quot;ID&quot;          &quot;Description&quot; &quot;GeneRatio&quot;   &quot;BgRatio&quot;     &quot;pvalue&quot;      &quot;p.adjust&quot;   </span><br><span class="line">## [7] &quot;qvalue&quot;      &quot;geneID&quot;      &quot;Count&quot;</span><br></pre></td></tr></table></figure><p>数据整理</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">enrich &lt;- enrich[<span class="number">1</span>:<span class="number">10</span>,c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">6</span>)] </span><br><span class="line"></span><br><span class="line">enrich$geneID &lt;- str_replace_all(enrich$geneID,<span class="string">&quot;/&quot;</span>,<span class="string">&quot;,&quot;</span>) </span><br><span class="line">names(enrich)=c(<span class="string">&quot;ID&quot;</span>,<span class="string">&quot;Term&quot;</span>,<span class="string">&quot;Genes&quot;</span>,<span class="string">&quot;adj_pval&quot;</span>)</span><br><span class="line">enrich$Category = <span class="string">&quot;BP&quot;</span></span><br><span class="line">head(enrich)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">##                    ID                                                       Term</span><br><span class="line">## GO:0050730 GO:0050730            regulation of peptidyl-tyrosine phosphorylation</span><br><span class="line">## GO:0048732 GO:0048732                                          gland development</span><br><span class="line">## GO:0018108 GO:0018108                          peptidyl-tyrosine phosphorylation</span><br><span class="line">## GO:0018212 GO:0018212                             peptidyl-tyrosine modification</span><br><span class="line">## GO:1901992 GO:1901992 positive regulation of mitotic cell cycle phase transition</span><br><span class="line">## GO:0042326 GO:0042326                     negative regulation of phosphorylation</span><br><span class="line">##                                                                                   Genes</span><br><span class="line">## GO:0050730                CD36,AREG,TGFA,CD24,SFRP1,ITGB3,MIR221,SH2B3,CNTN1,INPP5F,MVP</span><br><span class="line">## GO:0048732   ETV5,CCND1,AREG,SERPINF1,SFRP1,IGFBP5,JUN,SEMA3C,SOX2,SNAI2,PBX1,E2F7,RARB</span><br><span class="line">## GO:0018108          CD36,AREG,TGFA,CD24,SFRP1,ITGB3,MIR221,EPHA5,SH2B3,CNTN1,INPP5F,MVP</span><br><span class="line">## GO:0018212          CD36,AREG,TGFA,CD24,SFRP1,ITGB3,MIR221,EPHA5,SH2B3,CNTN1,INPP5F,MVP</span><br><span class="line">## GO:1901992                                     DTL,CCND1,CDCA5,CDC25A,MIR221,PBX1,CDC45</span><br><span class="line">## GO:0042326 DUSP6,SPRY2,NUPR1,SPRY4,UBASH3B,SFRP1,JUN,TLR4,TIMP3,MIR221,SH2B3,INPP5F,MVP</span><br><span class="line">##                adj_pval Category</span><br><span class="line">## GO:0050730 0.0001172193       BP</span><br><span class="line">## GO:0048732 0.0001314734       BP</span><br><span class="line">## GO:0018108 0.0001314734       BP</span><br><span class="line">## GO:0018212 0.0001314734       BP</span><br><span class="line">## GO:1901992 0.0001567831       BP</span><br><span class="line">## GO:0042326 0.0001741554       BP</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">genes &lt;- data.frame(ID = diff_expr$symbol, logFC = diff_expr$logFC)</span><br><span class="line">head(genes)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">##      ID     logFC</span><br><span class="line">## 1  CD36 -5.780170</span><br><span class="line">## 2 DUSP6  4.212683</span><br><span class="line">## 3   DCT -5.633027</span><br><span class="line">## 4 SPRY2  3.801663</span><br><span class="line">## 5 MOXD1 -3.263063</span><br><span class="line">## 6  ETV4  3.843247</span><br></pre></td></tr></table></figure><p>转化成输入数据</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">circ &lt;- circle_dat(enrich,genes)</span><br><span class="line">head(circ)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">##   category         ID                                            term count genes     logFC</span><br><span class="line">## 1       BP GO:0050730 regulation of peptidyl-tyrosine phosphorylation    11  CD36 -5.780170</span><br><span class="line">## 2       BP GO:0050730 regulation of peptidyl-tyrosine phosphorylation    11  AREG  3.095910</span><br><span class="line">## 3       BP GO:0050730 regulation of peptidyl-tyrosine phosphorylation    11  TGFA  2.518930</span><br><span class="line">## 4       BP GO:0050730 regulation of peptidyl-tyrosine phosphorylation    11  CD24 -3.322533</span><br><span class="line">## 5       BP GO:0050730 regulation of peptidyl-tyrosine phosphorylation    11 SFRP1  2.103767</span><br><span class="line">## 6       BP GO:0050730 regulation of peptidyl-tyrosine phosphorylation    11 ITGB3  3.162000</span><br><span class="line">##       adj_pval   zscore</span><br><span class="line">## 1 0.0001172193 0.904534</span><br><span class="line">## 2 0.0001172193 0.904534</span><br><span class="line">## 3 0.0001172193 0.904534</span><br><span class="line">## 4 0.0001172193 0.904534</span><br><span class="line">## 5 0.0001172193 0.904534</span><br><span class="line">## 6 0.0001172193 0.904534</span><br></pre></td></tr></table></figure><p>绘制图像</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GOCircle(circ)</span><br></pre></td></tr></table></figure><p><img src="/images/goplot/unnamed-chunk-16-1.png" /></p>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
            <tag> enrichment </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ggplot2小部件参考</title>
      <link href="2020/09/22/ggplot2/"/>
      <url>2020/09/22/ggplot2/</url>
      
        <content type="html"><![CDATA[<h3 id="添加原件">添加原件</h3><ul><li><p>添加竖线或者横线</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">geom_abline(mapping = <span class="literal">NULL</span>, data = <span class="literal">NULL</span>, <span class="keyword">...</span>, slope, intercept, na.rm = <span class="literal">FALSE</span>, show.legend = <span class="literal">NA</span>)</span><br><span class="line">geom_hline(mapping = <span class="literal">NULL</span>, data = <span class="literal">NULL</span>, <span class="keyword">...</span>, yintercept, na.rm = <span class="literal">FALSE</span>, show.legend = <span class="literal">NA</span>)</span><br><span class="line">geom_vline(mapping = <span class="literal">NULL</span>, data = <span class="literal">NULL</span>, <span class="keyword">...</span>, xintercept, na.rm = <span class="literal">FALSE</span>, show.legend = <span class="literal">NA</span>)</span><br></pre></td></tr></table></figure><p>三个函数的作用分别是，geom_abline添加斜线， geom_hline添加水平线，geom_vline添加垂直线</p><p>参数slope 表示斜率 intercept表示截距</p><p>参数yintercept 表示y轴截距或直线所在位置</p><p>参数xintercept 表示x轴截距或直线所在位置</p></li><li><p>添加线段</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geom_segment(aes(x = x1, y = y1, xend = x2, yend = y2)</span><br></pre></td></tr></table></figure><p>x, y控制线段起始位置，xend，yend控制线段终止位置</p></li></ul><h3 id="背景布局">背景布局</h3><ul><li><p>去掉网格</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">theme(panel.grid = element_blank())</span><br></pre></td></tr></table></figure></li><li><p>使用与plot相似的背景</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">theme_classic()</span><br></pre></td></tr></table></figure></li><li><p>x，y轴转换</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">coord_flip()</span><br></pre></td></tr></table></figure></li><li><p>去掉图形和坐标轴间隙</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scale_y_continuous(expand = c(<span class="number">0</span>,<span class="number">0</span>))//这个可以去掉与X轴间隙</span><br><span class="line">scale_x_continuous(expand = c(<span class="number">0</span>,<span class="number">0</span>))//这个可以去掉与Y轴间隙</span><br></pre></td></tr></table></figure></li></ul><h3 id="添加阴影">添加阴影</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">geom_ribbon(mapping = <span class="literal">NULL</span>, data = <span class="literal">NULL</span>, stat = <span class="string">&quot;identity&quot;</span>, position = <span class="string">&quot;identity&quot;</span>, <span class="keyword">...</span>, na.rm = <span class="literal">FALSE</span>, orientation = <span class="literal">NA</span>,</span><br><span class="line">show.legend = <span class="literal">NA</span>, inherit.aes = <span class="literal">TRUE</span>,outline.type = <span class="string">&quot;both&quot;</span>)</span><br><span class="line"></span><br><span class="line">geom_area(mapping = <span class="literal">NULL</span>, data = <span class="literal">NULL</span>, stat = <span class="string">&quot;identity&quot;</span>, position = <span class="string">&quot;stack&quot;</span>, na.rm = <span class="literal">FALSE</span>, orientation = <span class="literal">NA</span>, show.legend = <span class="literal">NA</span>, inherit.aes = <span class="literal">TRUE</span>, <span class="keyword">...</span>, outline.type = <span class="string">&quot;upper&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="添加箭头和线段">添加箭头和线段</h3><p>添加箭头或线段需要使用<code>annotate('segment')</code></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">annotate(<span class="string">&#x27;segment&#x27;</span>, x=<span class="comment">#, xend=#, y=#, yend=#, arrow=arrow())</span></span><br></pre></td></tr></table></figure><ul><li>没有添加<code>arrow</code>参数时是绘制线段<br /></li><li>如果添加了<code>arrow</code>参数，需要提前加载<code>library(grid)</code>包才能调用<code>arrow()</code>函数</li></ul><h3 id="画图理解">画图理解</h3><ul><li>使用ggplot绘图，图层是最重要的，要弄清参数是否写进了图层里。只有在图层中的对象才能进行后续的修改和操作。</li></ul><h3 id="标题居中">标题居中</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">theme(plot.title = element_text(hjust = <span class="number">0.5</span>))</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> ggplot2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WGCNA教程</title>
      <link href="2020/08/15/wgcna/"/>
      <url>2020/08/15/wgcna/</url>
      
        <content type="html"><![CDATA[<p>WGCNA的基本原理和操作</p><a id="more"></a><h1 id="wgcna-分析">WGCNA 分析</h1><h2 id="wgcna基本概念">WGCNA基本概念</h2><p>加权基因共表达网络分析 (WGCNA, Weighted correlation network analysis)是用来描述不同样品之间基因关联模式的系统生物学方法，可以用来鉴定高度<strong>协同变化</strong>的基因集。并根据基因集的内连性和基因集与表型之间的关联鉴定候补生物标记基因或治疗靶点。</p><p>相比于只关注差异表达的基因，WGCNA利用数千或近万个变化最大的基因或全部基因的信息识别感兴趣的基因集，并与表型进行显著性关联分析。一是充分利用了信息，二是把数千个基因与表型的关联转换为数个基因集与表型的关联，免去了多重假设检验校正的问题。</p><h2 id="wgcna常见术语">WGCNA常见术语</h2><ul><li>共表达网络（Co-expression network）：定义为加权基因网络。点代表基因，边代表基因表达相关性。加权是指对<strong>相关性值进行冥次运算</strong>。 (冥次的值也就是<strong>软阈值</strong> (<code>power</code>, <code>/post/2020-08-15-wgcna_fileskSoftThreshold</code>这个函数所做的就是确定合适的<code>power</code>))。无向网络的边属性计算方式为 <code>abs(cor(genex, geney)) ^ power</code>；有向网络的边属性计算方式为<code>(1+cor(genex, geney)/2) ^ power</code>; <code>sign hybrid</code>的边属性计算方式为<code>cor(genex, geney)^power if cor&gt;0 else 0</code>。这种处理方式强化了强相关，弱化了弱相关或负相关，使得相关性数值更符合<code>无标度网络</code>特征，更具有生物意义。如果没有合适的<strong>power</strong>，一般是由于部分样品与其它样品因为某种原因差别太大导致的，可根据具体问题移除部分样品或查看后面的<code>经验值</code>。<br /></li><li>模块（Module）：高度內连的基因集。在无向网络中，模块内是高度<strong>相关</strong>的基因。在有向网络中，模块内是高度<strong>正相关</strong>的基因。把基因聚类成模块后，可以对每个模块进行三个层次的分析：<ol type="1"><li>功能富集分析查看其功能特征是否与研究目的相符；</li><li>模块与性状进行关联分析，找出与关注性状相关度最高的模块；</li><li>模块与样本进行关联分析，找到样品特异高表达的模块。</li></ol></li><li>连接度（Connectivity）：类似于网络中 "度"(degree)的概念。每个基因的连接度是与其他网络基因的连接度。 在共表达网络中，连接度衡量的是一个基因与其他的网络基因有多相关。</li><li>模块内连接度（Intramodular connectivity）: 模块内连接度衡量的是给定基因相对于特定模块的基因是如何连接或共同表达的。模内连接性可以解释为模块成员关系的度量。<br /></li><li>Module eigengene E: 给定模型的第一主成分，代表<strong>整个模型的基因表达谱</strong>。<br /></li><li>Module membership: 给定基因表达谱与给定模型的eigengene的相关性。<br /></li><li>Hub gene: 关键基因 (连接度最多或连接多个模块的基因)。<br /></li><li>Adjacency matrix ：基因和基因之间的加权相关性值构成的矩阵。<br /></li><li>TOM (Topological overlap matrix)：把邻接矩阵转换为拓扑重叠矩阵，以降低噪音和假相关，获得的新距离矩阵，这个信息可拿来构建网络或绘制TOM图。<br /></li><li>Gene signifcance GS：基因表达模式与某样本特质之间的相关，一般相关值越大，表示该基因越重要，有时候也用<code>-log（p）</code>来量化<br /></li><li>Module signifcance：该模块中所有基因相关绝对值的均值。当基因相关是基于基因表达模式与样本特质之间的相关值时，该测量与模块特征基因和样本特质之间存在高相关。</li></ul><h2 id="基本分析流程">基本分析流程</h2><p><img src="/images/wgcna/wgcna.png" /></p><ol type="1"><li>构建基因共表达网络：使用加权的表达相关性。基本目的是充分利用基因间的交互模式；采用相关系数作为共表达的测量。<br /></li><li>识别基因集：基于加权相关性，进行层级聚类分析，并根据设定标准切分聚类结果，获得不同的基因模块，用聚类树的分枝和不同颜色表示。可以采用层次聚类（hierarchical clustering）或动态树切分（dynamic tree cut）实现。<br /></li><li>将模块与外部信息关联。其中外部信息包括基于阵列的临床数据（clinical data），多态性数据（SNPs）和蛋白组数据（proteomics）；基因信息包括ontology和功能富集（functional enrichment）。基本目的是发现具有生物学意义的模块。<br /></li><li>研究模型之间的关系，从系统层面查看不同模型的互作网络。基本目的是生物数据降维，并提供系统水平的视角（system-level view）；采用eigengene网络实现。<br /></li><li>最后发现感兴趣模块的关键驱动子（key drivers）。基本目的是实验验证并明确生物标记（biomarker）；采用的手段可以是模块内连接（intramodular connectivity）以及因果检验（causality testing）。</li></ol><h2 id="wgcna包实战">WGCNA包实战</h2><p>R包<code>WGCNA</code>是用于计算各种加权关联分析的功能集合，可用于网络构建，基因筛选，基因簇鉴定，拓扑特征计算，数据模拟和可视化等。</p><h3 id="准备工作">准备工作</h3><ol type="1"><li>WGCNA本质是基于相关系数的网络分析方法，适用于多样品数据模式，一般要求样本数多于<strong>15</strong>个。样本数多于<strong>20</strong>时效果更好，样本越多，结果越稳定。<br /></li><li>基因表达矩阵: 常规表达矩阵即可，即基因在行，样品在列，进入分析前做一个转置。RPKM、FPKM或其它标准化方法影响不大。<br /></li><li>安装WGCNA</li></ol><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(WGCNA)</span><br><span class="line">Loading required package: dynamicTreeCut</span><br><span class="line">Loading required package: fastcluster</span><br><span class="line"></span><br><span class="line">Attaching package: ‘fastcluster’</span><br><span class="line"></span><br><span class="line">The following object is masked from ‘package:stats’:</span><br><span class="line"></span><br><span class="line">    hclust</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Attaching package: ‘WGCNA’</span><br><span class="line"></span><br><span class="line">The following object is masked from ‘package:stats’:</span><br><span class="line"></span><br><span class="line">    cor</span><br><span class="line"></span><br><span class="line">options(stringsAsFactors = <span class="literal">FALSE</span>)</span><br><span class="line"><span class="comment"># 开启多线程</span></span><br><span class="line">enableWGCNAThreads()</span><br><span class="line">Allowing parallel execution with up to <span class="number">7</span> working processes.</span><br><span class="line"></span><br><span class="line">load(<span class="string">&quot;./data.RData&quot;</span>)</span><br><span class="line">head(datTraits)  </span><br><span class="line">                  gsm cellline       subtype</span><br><span class="line">GSM1172844 GSM1172844    184A1 Non-malignant</span><br><span class="line">GSM1172845 GSM1172845    184B5 Non-malignant</span><br><span class="line">GSM1172846 GSM1172846    21MT1         Basal</span><br><span class="line">GSM1172847 GSM1172847    21MT2         Basal</span><br><span class="line">GSM1172848 GSM1172848     21NT         Basal</span><br><span class="line">GSM1172849 GSM1172849     21PT         Basal</span><br><span class="line">fpkm[<span class="number">1</span>:<span class="number">4</span>,<span class="number">1</span>:<span class="number">4</span>]  </span><br><span class="line">                GSM1172844 GSM1172845 GSM1172846  GSM1172847</span><br><span class="line">ENSG00000000003   <span class="number">95.21255</span>   <span class="number">95.69868</span>   <span class="number">19.99467</span>  <span class="number">65.6863763</span></span><br><span class="line">ENSG00000000005    <span class="number">0.00000</span>    <span class="number">0.00000</span>    <span class="number">0.00000</span>   <span class="number">0.1492021</span></span><br><span class="line">ENSG00000000419  <span class="number">453.20831</span>  <span class="number">243.64804</span>  <span class="number">142.05818</span> <span class="number">200.4131493</span></span><br><span class="line">ENSG00000000457   <span class="number">18.10439</span>   <span class="number">26.56661</span>   <span class="number">16.12776</span>  <span class="number">12.0873135</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 选取前5000高变异的基因计算WGCNA</span></span><br><span class="line">datExpr &lt;- t(fpkm[order(apply(fpkm,<span class="number">1</span>,mad), decreasing = <span class="literal">T</span>)[<span class="number">1</span>:<span class="number">5000</span>],])</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="确定最佳beta值">1. 确定最佳beta值</h3><blockquote><p>在这里选取的软阈值是为了构建最有效的无尺度网络。</p></blockquote><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">powers = c(c(<span class="number">1</span>:<span class="number">10</span>), seq(from = <span class="number">12</span>, to=<span class="number">20</span>, by=<span class="number">2</span>))</span><br><span class="line"><span class="comment">## 批量计算多个power值的R方</span></span><br><span class="line">sft = pickSoftThreshold(datExpr, powerVector = powers, RsquaredCut = <span class="number">0.85</span>, verbose = <span class="number">5</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">pickSoftThreshold: will use block size <span class="number">5000.</span></span><br><span class="line"> pickSoftThreshold: calculating connectivity <span class="keyword">for</span> given powers...</span><br><span class="line">   ..working on genes <span class="number">1</span> through <span class="number">5000</span> of <span class="number">5000</span></span><br><span class="line">   Power SFT.R.sq  slope truncated.R.sq  mean.k. median.k.  max.k.</span><br><span class="line"><span class="number">1</span>      <span class="number">1</span>   <span class="number">0.0944</span> -<span class="number">0.904</span>          <span class="number">0.885</span> <span class="number">1040.000</span>  <span class="number">1.02e+03</span> <span class="number">1810.00</span></span><br><span class="line"><span class="number">2</span>      <span class="number">2</span>   <span class="number">0.4910</span> -<span class="number">1.580</span>          <span class="number">0.952</span>  <span class="number">328.000</span>  <span class="number">3.03e+02</span>  <span class="number">866.00</span></span><br><span class="line"><span class="number">3</span>      <span class="number">3</span>   <span class="number">0.7030</span> -<span class="number">1.860</span>          <span class="number">0.983</span>  <span class="number">128.000</span>  <span class="number">1.08e+02</span>  <span class="number">474.00</span></span><br><span class="line"><span class="number">4</span>      <span class="number">4</span>   <span class="number">0.7920</span> -<span class="number">2.000</span>          <span class="number">0.991</span>   <span class="number">57.300</span>  <span class="number">4.38e+01</span>  <span class="number">283.00</span></span><br><span class="line"><span class="number">5</span>      <span class="number">5</span>   <span class="number">0.8490</span> -<span class="number">2.060</span>          <span class="number">0.996</span>   <span class="number">28.400</span>  <span class="number">1.95e+01</span>  <span class="number">179.00</span></span><br><span class="line"><span class="number">6</span>      <span class="number">6</span>   <span class="number">0.8810</span> -<span class="number">2.090</span>          <span class="number">0.991</span>   <span class="number">15.200</span>  <span class="number">9.45e+00</span>  <span class="number">118.00</span></span><br><span class="line"><span class="number">7</span>      <span class="number">7</span>   <span class="number">0.9040</span> -<span class="number">2.070</span>          <span class="number">0.990</span>    <span class="number">8.640</span>  <span class="number">4.89e+00</span>   <span class="number">80.60</span></span><br><span class="line"><span class="number">8</span>      <span class="number">8</span>   <span class="number">0.9220</span> -<span class="number">2.040</span>          <span class="number">0.994</span>    <span class="number">5.170</span>  <span class="number">2.67e+00</span>   <span class="number">56.40</span></span><br><span class="line"><span class="number">9</span>      <span class="number">9</span>   <span class="number">0.9330</span> -<span class="number">2.030</span>          <span class="number">0.995</span>    <span class="number">3.240</span>  <span class="number">1.54e+00</span>   <span class="number">40.50</span></span><br><span class="line"><span class="number">10</span>    <span class="number">10</span>   <span class="number">0.9350</span> -<span class="number">2.020</span>          <span class="number">0.989</span>    <span class="number">2.100</span>  <span class="number">9.29e-01</span>   <span class="number">30.00</span></span><br><span class="line"><span class="number">11</span>    <span class="number">12</span>   <span class="number">0.9250</span> -<span class="number">2.030</span>          <span class="number">0.977</span>    <span class="number">0.971</span>  <span class="number">3.63e-01</span>   <span class="number">17.30</span></span><br><span class="line"><span class="number">12</span>    <span class="number">14</span>   <span class="number">0.9210</span> -<span class="number">2.020</span>          <span class="number">0.982</span>    <span class="number">0.496</span>  <span class="number">1.56e-01</span>   <span class="number">10.50</span></span><br><span class="line"><span class="number">13</span>    <span class="number">16</span>   <span class="number">0.9250</span> -<span class="number">1.970</span>          <span class="number">0.992</span>    <span class="number">0.275</span>  <span class="number">7.04e-02</span>    <span class="number">6.61</span></span><br><span class="line"><span class="number">14</span>    <span class="number">18</span>   <span class="number">0.8940</span> -<span class="number">1.960</span>          <span class="number">0.973</span>    <span class="number">0.163</span>  <span class="number">3.31e-02</span>    <span class="number">4.31</span></span><br><span class="line"><span class="number">15</span>    <span class="number">20</span>   <span class="number">0.9220</span> -<span class="number">1.820</span>          <span class="number">0.986</span>    <span class="number">0.102</span>  <span class="number">1.63e-02</span>    <span class="number">2.89</span></span><br><span class="line">power = sft$powerEstimate</span><br><span class="line">power</span><br><span class="line">[<span class="number">1</span>] <span class="number">6</span></span><br></pre></td></tr></table></figure><blockquote><p>由以上结果可以看出在power = 6时首次达到R方的cut阈值0.85，因此选取6作为合适的power值</p></blockquote><p>通过绘图更加直观的观察阈值的选取：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">par(mfrow = c(<span class="number">1</span>,<span class="number">2</span>));</span><br><span class="line">cex1 = <span class="number">0.9</span>;</span><br><span class="line"><span class="comment"># Scale-free topology fit index as a function of the soft-thresholding power</span></span><br><span class="line">plot(sft$fitIndices[,<span class="number">1</span>], -sign(sft$fitIndices[,<span class="number">3</span>])*sft$fitIndices[,<span class="number">2</span>],</span><br><span class="line">      xlab=<span class="string">&quot;Soft Threshold (power)&quot;</span>,ylab=<span class="string">&quot;Scale Free Topology Model Fit,signed R^2&quot;</span>,type=<span class="string">&quot;n&quot;</span>,</span><br><span class="line">      main = paste(<span class="string">&quot;Scale independence&quot;</span>));</span><br><span class="line">text(sft$fitIndices[,<span class="number">1</span>], -sign(sft$fitIndices[,<span class="number">3</span>])*sft$fitIndices[,<span class="number">2</span>],</span><br><span class="line">      labels=powers,cex=cex1,col=<span class="string">&quot;red&quot;</span>);</span><br><span class="line"><span class="comment"># this line corresponds to using an R^2 cut-off of h</span></span><br><span class="line">abline(h=<span class="number">0.85</span>,col=<span class="string">&quot;red&quot;</span>)</span><br><span class="line"><span class="comment"># Mean connectivity as a function of the soft-thresholding power</span></span><br><span class="line">plot(sft$fitIndices[,<span class="number">1</span>], sft$fitIndices[,<span class="number">5</span>],</span><br><span class="line">      xlab=<span class="string">&quot;Soft Threshold (power)&quot;</span>,ylab=<span class="string">&quot;Mean Connectivity&quot;</span>, type=<span class="string">&quot;n&quot;</span>,</span><br><span class="line">      main = paste(<span class="string">&quot;Mean connectivity&quot;</span>))</span><br><span class="line">text(sft$fitIndices[,<span class="number">1</span>], sft$fitIndices[,<span class="number">5</span>], labels=powers, cex=cex1,col=<span class="string">&quot;red&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/wgcna/soft.png" /></p><blockquote><p>假如没有合适的阈值，在官方文档中说，如果是unsigned的就选6，如果是signed的就选12.</p></blockquote><h3 id="网络构建">2. 网络构建</h3><h4 id="一步法构建">一步法构建</h4><p><code>WGCNA</code>提供了<code>blockwiseModules</code>函数可以一步计算出所有的模块</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##一步法网络构建：One-step network construction and module detection</span></span><br><span class="line"><span class="comment"># numericLabels: 返回数字而不是颜色作为模块的名字，后面可以再转换为颜色</span></span><br><span class="line"><span class="comment"># saveTOMs：最耗费时间的计算，存储起来，供后续使用</span></span><br><span class="line"><span class="comment"># mergeCutHeight: 合并模块的阈值，越大模块越</span></span><br><span class="line">net = blockwiseModules(datExpr, power = power, maxBlockSize = <span class="number">6000</span>,</span><br><span class="line">                       TOMType = type, minModuleSize = <span class="number">30</span>,</span><br><span class="line">                       reassignThreshold = <span class="number">0</span>, mergeCutHeight = <span class="number">0.25</span>,</span><br><span class="line">                       numericLabels = <span class="literal">TRUE</span>, pamRespectsDendro = <span class="literal">FALSE</span>,</span><br><span class="line">                       saveTOMs=<span class="literal">TRUE</span>, corType = corType, </span><br><span class="line">                       maxPOutliers=maxPOutliers, loadTOMs=<span class="literal">TRUE</span>,</span><br><span class="line">                       saveTOMFileBase = paste0(exprMat, <span class="string">&quot;.tom&quot;</span>), <span class="comment">## 保存tom矩阵</span></span><br><span class="line">                       verbose = <span class="number">3</span>)</span><br></pre></td></tr></table></figure><p>展示最终层级聚类的结果</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 灰色的为未分到模块的基因。</span></span><br><span class="line"><span class="comment"># Convert labels to colors for plotting</span></span><br><span class="line">moduleLabels = net$colors</span><br><span class="line">moduleColors = labels2colors(moduleLabels)</span><br><span class="line"><span class="comment"># Plot the dendrogram and the module colors underneath</span></span><br><span class="line">plotDendroAndColors(net$dendrograms[[<span class="number">1</span>]], moduleColors[net$blockGenes[[<span class="number">1</span>]]],</span><br><span class="line">                    <span class="string">&quot;Module colors&quot;</span>,</span><br><span class="line">                    dendroLabels = <span class="literal">FALSE</span>, hang = <span class="number">0.03</span>,</span><br><span class="line">                    addGuide = <span class="literal">TRUE</span>, guideHang = <span class="number">0.05</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/wgcna/cluster.png" /></p><h4 id="分步构建">分步构建</h4><p>首先计算邻接矩阵</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># calculate the adjacency</span></span><br><span class="line">softPower = <span class="number">6</span>;</span><br><span class="line">adjacency = adjacency(datExpr, power = softPower);</span><br></pre></td></tr></table></figure><p>将邻接矩阵转换成拓扑重叠矩阵</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Turn adjacency into topological overlap</span></span><br><span class="line">TOM = TOMsimilarity(adjacency);</span><br><span class="line">dissTOM = <span class="number">1</span>-TOM</span><br></pre></td></tr></table></figure><p>对TOM进行聚类</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Call the hierarchical clustering function</span></span><br><span class="line">geneTree = hclust(as.dist(dissTOM), method = <span class="string">&quot;average&quot;</span>);</span><br><span class="line"><span class="comment"># Plot the resulting clustering tree (dendrogram)</span></span><br><span class="line">plot(geneTree, xlab=<span class="string">&quot;&quot;</span>, sub=<span class="string">&quot;&quot;</span>, main = <span class="string">&quot;Gene clustering on TOM-based dissimilarity&quot;</span>,</span><br><span class="line">     labels = <span class="literal">FALSE</span>, hang = <span class="number">0.04</span>);</span><br></pre></td></tr></table></figure><p><img src="/images/wgcna/tree.png" /></p><p>上面得到了基因聚类的树，我们对这棵树进行剪枝得到不同的模块</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># We like large modules, so we set the minimum module size relatively high:</span></span><br><span class="line">minModuleSize = <span class="number">30</span>;</span><br><span class="line"><span class="comment"># Module identification using dynamic tree cut:</span></span><br><span class="line">dynamicMods = cutreeDynamic(dendro = geneTree, distM = dissTOM,</span><br><span class="line">                            deepSplit = <span class="number">2</span>, pamRespectsDendro = <span class="literal">FALSE</span>,</span><br><span class="line">                            minClusterSize = minModuleSize);</span><br><span class="line">table(dynamicMods)</span><br></pre></td></tr></table></figure><p>得到模块后我们就可以看到不同的模块表示</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Convert numeric lables into colors</span></span><br><span class="line">dynamicColors = labels2colors(dynamicMods)</span><br><span class="line">table(dynamicColors)</span><br><span class="line"><span class="comment"># Plot the dendrogram and colors underneath</span></span><br><span class="line">plotDendroAndColors(geneTree, dynamicColors, <span class="string">&quot;Dynamic Tree Cut&quot;</span>,</span><br><span class="line">                    dendroLabels = <span class="literal">FALSE</span>, hang = <span class="number">0.03</span>,</span><br><span class="line">                    addGuide = <span class="literal">TRUE</span>, guideHang = <span class="number">0.05</span>,</span><br><span class="line">                    main = <span class="string">&quot;Gene dendrogram and module colors&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/wgcna/cuttree.png" /></p><p>这样我们就得到了不同的基因表达模块。然而在这时某些模块之间也有可能具有很高的相似性，为了进一步衡量这些模块之间的共表达相似性，我们计算了eigengenes然后计算他们之间的相似性。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">MEList = moduleEigengenes(datExpr, colors = dynamicColors)</span><br><span class="line">MEs = MEList$eigengenes</span><br><span class="line"><span class="comment"># Calculate dissimilarity of module eigengenes</span></span><br><span class="line">MEDiss = <span class="number">1</span>-cor(MEs);</span><br><span class="line"><span class="comment"># Cluster module eigengenes</span></span><br><span class="line">METree = hclust(as.dist(MEDiss), method = <span class="string">&quot;average&quot;</span>);</span><br><span class="line"><span class="comment"># Plot the result</span></span><br><span class="line">plot(METree, main = <span class="string">&quot;Clustering of module eigengenes&quot;</span>,</span><br><span class="line">xlab = <span class="string">&quot;&quot;</span>, sub = <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="comment"># 在这里选取0.25作为阈值对eigengenes进行合并  </span></span><br><span class="line">MEDissThres = <span class="number">0.25</span></span><br><span class="line"><span class="comment"># Plot the cut line into the dendrogram</span></span><br><span class="line">abline(h=MEDissThres, col = <span class="string">&quot;red&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/wgcna/eigengenes.png" /></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Call an automatic merging function</span></span><br><span class="line">merge = mergeCloseModules(datExpr, dynamicColors, cutHeight = MEDissThres, verbose = <span class="number">3</span>)</span><br><span class="line"><span class="comment"># The merged module colors</span></span><br><span class="line">mergedColors = merge$colors;</span><br><span class="line"><span class="comment"># Eigengenes of the new merged modules:</span></span><br><span class="line">mergedMEs = merge$newMEs;</span><br><span class="line">plotDendroAndColors(geneTree, cbind(dynamicColors, mergedColors),</span><br><span class="line">                    c(<span class="string">&quot;Dynamic Tree Cut&quot;</span>, <span class="string">&quot;Merged dynamic&quot;</span>),</span><br><span class="line">                    dendroLabels = <span class="literal">FALSE</span>, hang = <span class="number">0.03</span>,</span><br><span class="line">                    addGuide = <span class="literal">TRUE</span>, guideHang = <span class="number">0.05</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/wgcna/mergetree.png" /></p><blockquote><p>这个结果其实和一步计算的结果基本一致,得到模块数目相同</p></blockquote><h3 id="模块之间的相关性">3. 模块之间的相关性</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># module eigengene, 可以绘制线图，作为每个模块的基因表达趋势的展示</span></span><br><span class="line">MEs = net$MEs</span><br><span class="line">MEs_col = MEs</span><br><span class="line">colnames(MEs_col) = paste0(<span class="string">&quot;ME&quot;</span>, labels2colors(</span><br><span class="line">  as.numeric(str_replace_all(colnames(MEs),<span class="string">&quot;ME&quot;</span>,<span class="string">&quot;&quot;</span>))))</span><br><span class="line">MEs_col = orderMEs(MEs_col)</span><br><span class="line"><span class="comment"># marDendro/marHeatmap 设置下、左、上、右的边距</span></span><br><span class="line">plotEigengeneNetworks(MEs_col, <span class="string">&quot;Eigengene adjacency heatmap&quot;</span>, </span><br><span class="line">                      marDendro = c(<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">4</span>),</span><br><span class="line">                      marHeatmap = c(<span class="number">3</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">2</span>), plotDendrograms = <span class="literal">T</span>, </span><br><span class="line">                      xLabelsAngle = <span class="number">90</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/wgcna/eiheatmap.png" /></p><h3 id="样本和性状的聚类关系">4. 样本和性状的聚类关系</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">nGenes = ncol(datExpr)</span><br><span class="line">nSamples = nrow(datExpr)</span><br><span class="line"><span class="comment">#首先针对样本做个系统聚类</span></span><br><span class="line">datExpr_tree&lt;-hclust(dist(datExpr), method = <span class="string">&quot;average&quot;</span>)</span><br><span class="line">sample_colors &lt;- numbers2colors(as.numeric(factor(datTraits$subtype)), </span><br><span class="line">                                colors = c(<span class="string">&quot;white&quot;</span>,<span class="string">&quot;blue&quot;</span>,<span class="string">&quot;red&quot;</span>,<span class="string">&quot;green&quot;</span>),signed = <span class="literal">FALSE</span>)</span><br><span class="line">par(mar = c(<span class="number">1</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">1</span>),cex=<span class="number">0.8</span>)</span><br><span class="line">plotDendroAndColors(datExpr_tree, sample_colors,</span><br><span class="line">                      groupLabels = colnames(sample),</span><br><span class="line">                      cex.dendroLabels = <span class="number">0.8</span>,</span><br><span class="line">                      marAll = c(<span class="number">1</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>),</span><br><span class="line">                      cex.rowText = <span class="number">0.01</span>,</span><br><span class="line">                      main = <span class="string">&quot;Sample dendrogram and trait heatmap&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/wgcna/sample-subtype-cluster.png" /></p><p>条形图展示</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Luminal = as.data.frame(design[,<span class="number">3</span>]);</span><br><span class="line">names(Luminal) = <span class="string">&quot;Luminal&quot;</span></span><br><span class="line">y=Luminal</span><br><span class="line">GS1=as.numeric(cor(y,datExpr, use=<span class="string">&quot;p&quot;</span>))</span><br><span class="line">GeneSignificance=abs(GS1)</span><br><span class="line"><span class="comment"># Next module significance is defined as average gene significance.</span></span><br><span class="line">ModuleSignificance=tapply(GeneSignificance,</span><br><span class="line">                          moduleColors, mean, na.rm=<span class="literal">T</span>)</span><br><span class="line">sizeGrWindow(<span class="number">8</span>,<span class="number">7</span>)</span><br><span class="line">par(mfrow = c(<span class="number">1</span>,<span class="number">1</span>))</span><br><span class="line"><span class="comment"># 如果模块太多，下面的展示就不友好</span></span><br><span class="line"><span class="comment"># 不过，我们可以自定义出图。</span></span><br><span class="line">plotModuleSignificance(GeneSignificance,moduleColors)</span><br></pre></td></tr></table></figure><p><img src="/images/wgcna/bar.png" /></p><h3 id="可视化基因网络">5. 可视化基因网络</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">nSelect = <span class="number">400</span></span><br><span class="line"><span class="comment"># For reproducibility, we set the random seed</span></span><br><span class="line">set.seed(<span class="number">10</span>);</span><br><span class="line">select = sample(nGenes, size = nSelect);</span><br><span class="line">selectTOM = dissTOM[select, select];</span><br><span class="line"><span class="comment"># There’s no simple way of restricting a clustering tree to a subset of genes, so we must re-cluster.</span></span><br><span class="line">selectTree = hclust(as.dist(selectTOM), method = <span class="string">&quot;average&quot;</span>)</span><br><span class="line">selectColors = moduleColors[select];</span><br><span class="line">plotDiss = selectTOM^<span class="number">7</span>;</span><br><span class="line">diag(plotDiss) = <span class="literal">NA</span>;</span><br><span class="line">TOMplot(plotDiss, selectTree, selectColors, main = <span class="string">&quot;Network heatmap plot, selected genes&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/wgcna/geneheatmap.png" /></p><h3 id="模块和性状的关系">6. 模块和性状的关系</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">nGenes = ncol(datExpr)</span><br><span class="line">nSamples = nrow(datExpr)</span><br><span class="line">design=model.matrix(~<span class="number">0</span>+ datTraits$subtype)</span><br><span class="line">colnames(design)=levels(datTraits$subtype)</span><br><span class="line">moduleColors &lt;- labels2colors(net$colors)</span><br><span class="line"><span class="comment"># Recalculate MEs with color labels</span></span><br><span class="line">MEs0 = moduleEigengenes(datExpr, moduleColors)$eigengenes</span><br><span class="line">MEs = orderMEs(MEs0); <span class="comment">##不同颜色的模块的ME值矩 (样本vs模块)</span></span><br><span class="line">moduleTraitCor = cor(MEs, design , use = <span class="string">&quot;p&quot;</span>);</span><br><span class="line">moduleTraitPvalue = corPvalueStudent(moduleTraitCor, nSamples)</span><br><span class="line"></span><br><span class="line">sizeGrWindow(<span class="number">10</span>,<span class="number">6</span>)</span><br><span class="line"><span class="comment"># Will display correlations and their p-values</span></span><br><span class="line">textMatrix = paste(signif(moduleTraitCor, <span class="number">2</span>), <span class="string">&quot;\n(&quot;</span>,</span><br><span class="line">                   signif(moduleTraitPvalue, <span class="number">1</span>), <span class="string">&quot;)&quot;</span>, sep = <span class="string">&quot;&quot;</span>);</span><br><span class="line">dim(textMatrix) = dim(moduleTraitCor)</span><br><span class="line">par(mar = c(<span class="number">6</span>, <span class="number">8.5</span>, <span class="number">3</span>, <span class="number">3</span>));</span><br><span class="line"><span class="comment"># Display the correlation values within a heatmap plot</span></span><br><span class="line">labeledHeatmap(Matrix = moduleTraitCor,</span><br><span class="line">               xLabels = colnames(design),</span><br><span class="line">               yLabels = names(MEs),</span><br><span class="line">               ySymbols = names(MEs),</span><br><span class="line">               colorLabels = <span class="literal">FALSE</span>,</span><br><span class="line">               colors = greenWhiteRed(<span class="number">50</span>),</span><br><span class="line">               textMatrix = textMatrix,</span><br><span class="line">               setStdMargins = <span class="literal">FALSE</span>,</span><br><span class="line">               cex.text = <span class="number">0.5</span>,</span><br><span class="line">               zlim = c(-<span class="number">1</span>,<span class="number">1</span>),</span><br><span class="line">               main = paste(<span class="string">&quot;Module-trait relationships&quot;</span>))</span><br></pre></td></tr></table></figure><p><img src="/images/wgcna/Module-trait-relationships.png" /></p><p>从上图已经可以看到跟乳腺癌分类相关的基因模块了，包括<code>Basal</code> 、<code>Claudin-low</code> 、<code>Luminal</code> 、<code>Non-malignant</code>、<code>unknown</code> 这5类所对应的不同模块的基因列表。可以看到每一种乳腺癌都有跟它强烈相关的模块，可以作为它的表达signature，模块里面的基因可以拿去做下游分析。我们看到<strong>Luminal表型</strong>跟<strong>棕色的模块</strong>相关性高达0.86，而且极其显著的相关，所以值得我们挖掘，这<strong>个模块里面的基因是什么，为什么如此的相关呢？</strong></p><h3 id="感兴趣模块的具体分析">7. 感兴趣模块的具体分析</h3><p>性状跟模块虽然求出了相关性，可以挑选最相关的那些模块来分析，但是模块本身仍然包含非常多的基因，还需进一步的寻找最重要的基因。所有的模块都可以跟基因算出相关系数，所有的连续型性状也可以跟基因的表达值算出相关系数。 <strong>如果跟性状显著相关基因也跟某个模块显著相关，那么这些基因可能就非常重要</strong>。</p><h4 id="计算模块与基因的相关性矩阵">计算模块与基因的相关性矩阵</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># names (colors) of the modules</span></span><br><span class="line">modNames = substring(names(MEs), <span class="number">3</span>)</span><br><span class="line"><span class="comment">## 算出每个模块跟基因的皮尔森相关系数矩阵</span></span><br><span class="line">geneModuleMembership = as.data.frame(cor(datExpr, MEs, use = <span class="string">&quot;p&quot;</span>));</span><br><span class="line">MMPvalue = as.data.frame(corPvalueStudent(as.matrix(geneModuleMembership), nSamples));</span><br><span class="line">names(geneModuleMembership) = paste(<span class="string">&quot;MM&quot;</span>, modNames, sep=<span class="string">&quot;&quot;</span>);</span><br><span class="line">names(MMPvalue) = paste(<span class="string">&quot;p.MM&quot;</span>, modNames, sep=<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="计算性状与基因的相关性矩阵">计算性状与基因的相关性矩阵</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 只有连续型性状才能只有计算</span></span><br><span class="line"><span class="comment">## 这里把是否属于 Luminal 表型这个变量用0,1进行数值化。</span></span><br><span class="line">Luminal = as.data.frame(design[,<span class="number">3</span>]);</span><br><span class="line">names(Luminal) = <span class="string">&quot;Luminal&quot;</span></span><br><span class="line">geneTraitSignificance = as.data.frame(cor(datExpr, Luminal, use = <span class="string">&quot;p&quot;</span>));</span><br><span class="line">GSPvalue = as.data.frame(corPvalueStudent(as.matrix(geneTraitSignificance), nSamples));</span><br><span class="line">names(geneTraitSignificance) = paste(<span class="string">&quot;GS.&quot;</span>, names(Luminal), sep=<span class="string">&quot;&quot;</span>);</span><br><span class="line">names(GSPvalue) = paste(<span class="string">&quot;p.GS.&quot;</span>, names(Luminal), sep=<span class="string">&quot;&quot;</span>);</span><br></pre></td></tr></table></figure><h4 id="指定感兴趣模块进行分析">指定感兴趣模块进行分析</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">module = <span class="string">&quot;brown&quot;</span></span><br><span class="line">column = match(module, modNames);</span><br><span class="line">moduleGenes = moduleColors==module;</span><br><span class="line">sizeGrWindow(<span class="number">7</span>, <span class="number">7</span>)</span><br><span class="line">par(mfrow = c(<span class="number">1</span>,<span class="number">1</span>))</span><br><span class="line">verboseScatterplot(abs(geneModuleMembership[moduleGenes, column]),</span><br><span class="line">                     abs(geneTraitSignificance[moduleGenes, <span class="number">1</span>]),</span><br><span class="line">                     xlab = paste(<span class="string">&quot;Module Membership in&quot;</span>, module, <span class="string">&quot;module&quot;</span>),</span><br><span class="line">                     ylab = <span class="string">&quot;Gene significance for Luminal&quot;</span>,</span><br><span class="line">                     main = paste(<span class="string">&quot;Module membership vs. gene significance\n&quot;</span>),</span><br><span class="line">                     cex.main = <span class="number">1.2</span>, cex.lab = <span class="number">1.2</span>, cex.axis = <span class="number">1.2</span>, col = module)</span><br></pre></td></tr></table></figure><p><img src="/images/wgcna/cor.png" /></p><p>可以看到这些基因不仅仅是跟其对应的模块高度相关，而且是跟其对应的性状高度相关，进一步说明了基因值得深度探究。</p><h3 id="提取指定模块的基因名">8. 提取指定模块的基因名</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Select module</span></span><br><span class="line">module = <span class="string">&quot;brown&quot;</span>;</span><br><span class="line"><span class="comment"># Select module probes</span></span><br><span class="line">probes = colnames(datExpr) <span class="comment">## 我们例子里面的probe就是基因</span></span><br><span class="line">inModule = (moduleColors==module);</span><br><span class="line">modProbes = probes[inModule]; </span><br><span class="line">head(modProbes)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果使用WGCNA包自带的热图就很丑。</span></span><br><span class="line">which.module=<span class="string">&quot;brown&quot;</span>;</span><br><span class="line">dat=datExpr[,moduleColors==which.module ] </span><br><span class="line">plotMat(t(scale(dat)),nrgcols=<span class="number">30</span>,rlabels=<span class="literal">T</span>,</span><br><span class="line">        clabels=<span class="literal">T</span>,rcols=which.module,</span><br><span class="line">        title=which.module )</span><br><span class="line">datExpr[<span class="number">1</span>:<span class="number">4</span>,<span class="number">1</span>:<span class="number">4</span>]</span><br><span class="line">dat=t(datExpr[,moduleColors==which.module ] )</span><br><span class="line"><span class="keyword">library</span>(pheatmap)</span><br><span class="line">pheatmap(dat ,show_colnames =<span class="literal">F</span>,show_rownames = <span class="literal">F</span>) <span class="comment">#对那些提取出来的1000个基因所在的每一行取出，组合起来为一个新的表达矩阵</span></span><br><span class="line">n=t(scale(t(log(dat+<span class="number">1</span>)))) <span class="comment"># &#x27;scale&#x27;可以对log-ratio数值进行归一化</span></span><br><span class="line">n[n&gt;<span class="number">2</span>]=<span class="number">2</span> </span><br><span class="line">n[n&lt; -<span class="number">2</span>]= -<span class="number">2</span></span><br><span class="line">n[<span class="number">1</span>:<span class="number">4</span>,<span class="number">1</span>:<span class="number">4</span>]</span><br><span class="line">pheatmap(n,show_colnames =<span class="literal">F</span>,show_rownames = <span class="literal">F</span>)</span><br><span class="line">group_list=datTraits$subtype</span><br><span class="line">ac=data.frame(g=group_list)</span><br><span class="line">rownames(ac)=colnames(n) </span><br><span class="line">pheatmap(n,show_colnames =<span class="literal">F</span>,show_rownames = <span class="literal">F</span>,</span><br><span class="line">         annotation_col=ac )</span><br><span class="line"><span class="comment"># 可以很清晰的看到，所有的形状相关的模块基因</span></span><br><span class="line"><span class="comment"># 其实未必就不是差异表达基因。</span></span><br></pre></td></tr></table></figure><p><img src="/images/wgcna/heatmap.png" /></p><p>有了基因信息，后边就可以进行GO/KEGG等功能数据库的注释</p><h3 id="模块导出">9. 模块导出</h3><p>主要模块里面的基因直接的相互作用关系信息可以导出到<strong>cytoscape</strong>,<strong>VisANT</strong>等网络可视化软件。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Select module</span></span><br><span class="line">module = <span class="string">&quot;brown&quot;</span>;</span><br><span class="line"><span class="comment"># Select module probes</span></span><br><span class="line">probes = colnames(datExpr) <span class="comment">## 我们例子里面的probe就是基因名</span></span><br><span class="line">inModule = (moduleColors==module);</span><br><span class="line">modProbes = probes[inModule]; </span><br><span class="line"><span class="comment">## 也是提取指定模块的基因名</span></span><br><span class="line"><span class="comment"># Select the corresponding Topological Overlap</span></span><br><span class="line">modTOM = TOM[inModule, inModule];</span><br><span class="line">dimnames(modTOM) = list(modProbes, modProbes)</span><br></pre></td></tr></table></figure><p>导出到<strong>cytoscape</strong></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cyt = exportNetworkToCytoscape(</span><br><span class="line">      modTOM,</span><br><span class="line">     edgeFile = paste(<span class="string">&quot;CytoscapeInput-edges-&quot;</span>, paste(module, collapse=<span class="string">&quot;-&quot;</span>), <span class="string">&quot;.txt&quot;</span>, sep=<span class="string">&quot;&quot;</span>),</span><br><span class="line">     nodeFile = paste(<span class="string">&quot;CytoscapeInput-nodes-&quot;</span>, paste(module, collapse=<span class="string">&quot;-&quot;</span>), <span class="string">&quot;.txt&quot;</span>, sep=<span class="string">&quot;&quot;</span>),</span><br><span class="line">     weighted = <span class="literal">TRUE</span>,</span><br><span class="line">     threshold = <span class="number">0.02</span>,</span><br><span class="line">     nodeNames = modProbes, </span><br><span class="line">     nodeAttr = moduleColors[inModule]);</span><br></pre></td></tr></table></figure><h3 id="reference">Reference</h3><ol type="1"><li><a href="https://www.jianshu.com/p/e9cc3f43441d">WGCNA分析，简单全面的最新教程</a><br /></li><li>https://horvath.genetics.ucla.edu/html/CoexpressionNetwork/</li></ol>]]></content>
      
      
      <categories>
          
          <category> WGCNA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WGCNA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Orchestrating Single-Cell Analysis (二)</title>
      <link href="2020/08/12/single-cell-i/"/>
      <url>2020/08/12/single-cell-i/</url>
      
        <content type="html"><![CDATA[<p>scRNA-seq analysis workflow</p><a id="more"></a><p><img src="/images/single-cell-i/Workflow.png" /></p><p>这是一个经典的单细胞分析流程，主要分为以下几个步骤：</p><h2 id="实验设计">实验设计</h2><p>在正式分析之前，关于实验问题的探讨是很有必要的，<strong>最重要的一个就是技术的选择：</strong></p><ul><li><strong>Droplet-based</strong>: 10X Genomics, inDrop, Drop-seq</li><li>Plate-based with unique molecular identifiers (<strong>UMIs</strong>): CEL-seq, MARS-seq</li><li>Plate-based with <strong>reads</strong>: Smart-seq2</li><li>Other: sci-RNA-seq, Seq-Well</li></ul><p>每种方法都有优劣（Mereu et al. 2019; Ziegenhain et al. 2017)，目前以10X为代表的droplet-based方法由于高通量和低细胞成本成为了约定俗成的技术；Plate-based方法可以捕获其他的一些表型信息（如细胞形态），另外可以根据实验目的进行调整，灵活性比较好；Read-based方法可以覆盖全转录本，在分析可变剪切、外显子突变等方面很有用；UMI-based方法可以减轻PCR扩增偏差。</p><p><strong>下一个问题就是：到底要捕获多少细胞？测序要测多深？</strong></p><p>答案很清晰： As much as you can afford to spend.</p><p>再补充一下这个答案就是：想要发现罕见细胞类群，就要多获得细胞；想要探索潜在的微小差异，就要加大测序深度。目前常用的droplet-based仪器可以捕获1万到10万细胞，测序深度是每个细胞1000到10000 UMIs，在经济条件一定的前提下，它们之间一般是成反比。另外它还要权衡高细胞捕获通量和影响捕获效率的“双细胞比例”。</p><p><strong>实验设计和常规转录组类似</strong>，也是要考虑一个实验条件下多个生物重复，而且实验条件最好不要混杂批次。需要注意的是：生物重复不是指的单个细胞，而是指的提供细胞的供体（donors）或者细胞培养体系（cultures）</p><h2 id="获得表达矩阵">获得表达矩阵</h2><p>和常规转录组一样，单细胞转录组也是需要得到表达矩阵，才能进行下游分析。表达矩阵包含的信息就是：每个细胞中比对到每个基因的UMIs或者reads数。有一点需要注意：<strong>它的定量方法和具体的实验技术相关</strong></p><ul><li>10X的数据：使用<code>CellRanger</code> 软件，基于STAR比对到参考基因组，然后统计每个基因的UMIs数量<br /></li><li>Pseudo-alignment方法（如<code>alevin</code>）：不需要比对参考基因组，节省时间、内存<br /></li><li>对于一些高度multiplexed的方法：可以使用<code>scPipe</code> 包：提供了一套综合的分析流程，利用<code>Rsubread</code>比对，然后统计每个基因的UMIs数量<br /></li><li>CEL-seq、CEL-seq2数据：<code>scruff</code> 包可以专门分析<br /></li><li>read-based方法：可以使用常规bulk 转录组定量的流程（比如smartseq2就可以用hisat2+featureCounts）</li><li>任何包含spike-in转录本的数据：spike-in序列都要在比对、定量之前加到参考基因组中</li></ul><blockquote><p>multiplexed：翻译叫做”多路复用“，即：large numbers of libraries to be pooled and sequenced simultaneously during a single run，可以节省成本和时间</p></blockquote><p>定量结束后，一般是先导入表达矩阵然后创建一个<code>SingleCellExperiment</code>对象（例如：<code>read.table() + SingleCellExperiment()</code>）。除此以外，还有一些特定的文件格式需要用特定的包，比如DropletUtils可以分析10X数据，<code>tximport/tximeta</code> 可以分析pseudo-alignment数据</p><p><strong>需要注意的点</strong>：</p><ul><li>一些定量工具会统计表达矩阵中的reads比对率，会存在一些未必对的情况。尽管这些信息可以用作质控，但这些数值如果被误认为是表达量信息，那么就会干扰下游分析。因此在进行下游分析之前，这部分信息可以去掉或者保存在<code>colData</code>中</li><li>如果分析的是人类数据并且加入了ERCC，<strong>我们很多时候直接用<code>^ERCC</code>在行名中进行正则匹配，但是这时要小心</strong>，因为<strong>ERCC基因家族在人类基因组注释中确实存在</strong>，很有可能将真的基因作为外源转录本进行分析。这个问题可以通过将表达矩阵的行名设置为Ensembl,或Entrez来解决</li></ul><h2 id="数据处理与下游分析">数据处理与下游分析</h2><ol type="1"><li><strong>quality control</strong>：去掉低质量细胞。这些细胞可能在建库环节被破坏，可能没有被有效捕获（这就是所谓的“dropout”）。一般会统计：每个细胞的全部count数、spike-in或线粒体reads比例、检测到基因的数量<br /></li><li><strong>normalized expression value</strong>：为了减小细胞文库的偏差（可能由于细胞捕获效率不同、测序深度的差异而造成文库大小差异），把细胞们放在同一起跑线上，才能进行下面的细胞相似性比较，后面再根据相似性进行细胞分群。一般是基于log转换（当然有的函数也涉及了一些size factor的计算），从而对均值-方差进行校正<br /></li><li><strong>feature selection</strong>：一般选取高变异基因（Highly Variable Genes）进行后续分析，使用HVGs不用全部基因的原因一是为了减少计算量，二是减少不感兴趣基因（比如在细胞之间没什么差异）对分析产生的噪音<br /></li><li><strong>dimensionality reduction</strong>：让数据更“紧凑”，一般是线性降维PCA+非线性降维tSNE/umap。PCA一般是先获得初步的低维数据（可能会挑出几十个主成分），然后传给t-SNE进一步压缩，进行可视化<br /></li><li><strong>clustering</strong>：根据细胞归一化后的表达量相似性分成组，然后根据每个组marker基因（可理解为这一群细胞的标志性基因）的差异表达对分群进行生物学定义</li></ol><h2 id="演示">演示</h2><p>用<code>scRNAseq</code>包的droplet-based的视网膜数据【Macosko et al. (2015)】进行演示。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(scRNAseq)</span><br><span class="line">sce &lt;- MacoskoRetinaData()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Quality control.</span></span><br><span class="line"><span class="keyword">library</span>(scater)</span><br><span class="line">is.mito &lt;- grepl(<span class="string">&quot;^MT-&quot;</span>, rownames(sce))</span><br><span class="line">qcstats &lt;- perCellQCMetrics(sce, subsets=list(Mito=is.mito))</span><br><span class="line">filtered &lt;- quickPerCellQC(qcstats, percent_subsets=<span class="string">&quot;subsets_Mito_percent&quot;</span>)</span><br><span class="line">sce &lt;- sce[, !filtered$discard]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Normalization.</span></span><br><span class="line">sce &lt;- logNormCounts(sce)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Feature selection.</span></span><br><span class="line"><span class="keyword">library</span>(scran)</span><br><span class="line">dec &lt;- modelGeneVar(sce)</span><br><span class="line">hvg &lt;- getTopHVGs(dec, prop=<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Dimensionality reduction.</span></span><br><span class="line">set.seed(<span class="number">1234</span>)</span><br><span class="line">sce &lt;- runPCA(sce, ncomponents=<span class="number">25</span>, subset_row=hvg)</span><br><span class="line">sce &lt;- runUMAP(sce, dimred = <span class="string">&#x27;PCA&#x27;</span>, external_neighbors=<span class="literal">TRUE</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Clustering.</span></span><br><span class="line">g &lt;- buildSNNGraph(sce, use.dimred = <span class="string">&#x27;PCA&#x27;</span>)</span><br><span class="line">colLabels(sce) &lt;- factor(igraph::cluster_louvain(g)$membership)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Visualization.</span></span><br><span class="line">plotUMAP(sce, colour_by=<span class="string">&quot;label&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/single-cell-i/quick-start-umap-1.png" /></p><hr /><h4 id="reference">Reference</h4><p><a href="https://osca.bioconductor.org/">Orchestrating Single-Cell Analysis with Bioconductor</a></p>]]></content>
      
      
      <categories>
          
          <category> SingleCell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SingleCell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>scRNA的细胞质控</title>
      <link href="2020/08/12/quality-control/"/>
      <url>2020/08/12/quality-control/</url>
      
        <content type="html"><![CDATA[<p>Quality Control</p><a id="more"></a><h2 id="动机">动机</h2><p>scRNA-seq数据的低质量文库可能来自于：细胞分选环节的破坏、文库制备失误（没有足够的反转录或PCR次数）… 表现在：细胞总表达量低、基本没有表达的基因、高线粒体或spike-in占比。</p><p>这些低质量的库是有问题的，因为它们可能在下游分析中导致误导的结果 。</p><ul><li><strong>聚类问题：</strong> 低质量的细胞会聚集成一群，对结果的解释造成干扰，因为从这群细胞中得不到什么有用的信息，但是它的确也是一群。这种现象产生的原因有可能是：细胞破坏以后，线粒体或核RNAs占比升高。 最差的情况就是：不同类型的低质量细胞，也能聚在一起，因为相比于固有的生物差异，更相似的低质量让它们相依相偎。除此以外，本来非常小的细胞文库也能聚成一群，因为log转换后它们的平均表达量会发生很大的变化(A. Lun <a href="https://osca.bioconductor.org/quality-control.html#ref-lun2018overcoming">2018</a>).</li><li><strong>方差估计或主成分分析</strong>:首先在PCA分析时，低质量和高质量之间的差异相比于生物学差异会体现更明显，占据主要的成分，减少降维结果的可靠性。另外，某个基因可能在两个细胞之间没什么表达差异，但是如果所处环境差异很大（一个细胞质量很低，另一个细胞质量正常），那么在差异估算过程中，就会把这个差异也会被当成差异表达基因。例如：一个低质量细胞文库的总表达量非常低（接近0），但恰巧还存在一个基因有表达量，那么这个基因的表达量在后续的文库归一化过程中就会尤为突出<br /></li><li><strong>奇怪的转录本上调</strong>：实验难免会混入外源的污染转录本，但这个量很少并且在所有细胞中都应该是差不多水平的。但如果某个细胞质量低，文库小，那么在校正文库差异过程中，其中的污染转录本表达量就会“突飞猛进”，看起来是一些明显上调的“奇怪基因”。实际上，这些奇怪的基因依然在其他细胞中存在，并且真实的表达量差不多，并且是不应该占据主体地位的。</li></ul><p>为了最大程度避免上面一种或多种情况的发生，应该在归一化之前去掉这些低质量的细胞，这个过程就是<strong>细胞的质控 </strong></p><p>使用A. T. L. Lun et al. (2017)的小型scRNA数据（未进行QC）进行测试</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#--- loading ---#</span></span><br><span class="line"><span class="keyword">library</span>(scRNAseq)</span><br><span class="line">sce.416b &lt;- LunSpikeInData(which=<span class="string">&quot;416b&quot;</span>) </span><br><span class="line">table(sce.416b$block)</span><br><span class="line"><span class="number">20160113</span> <span class="number">20160325</span> </span><br><span class="line">      <span class="number">96</span>       <span class="number">96</span> </span><br><span class="line">sce.416b$block &lt;- factor(sce.416b$block)</span><br><span class="line">sce.416b</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## class: SingleCellExperiment </span></span><br><span class="line"><span class="comment">## dim: 46604 192 </span></span><br><span class="line"><span class="comment">## metadata(0):</span></span><br><span class="line"><span class="comment">## assays(1): counts</span></span><br><span class="line"><span class="comment">## rownames(46604): ENSMUSG00000102693 ENSMUSG00000064842 ...</span></span><br><span class="line"><span class="comment">##   ENSMUSG00000095742 CBFB-MYH11-mcherry</span></span><br><span class="line"><span class="comment">## rowData names(1): Length</span></span><br><span class="line"><span class="comment">## colnames(192): SLX-9555.N701_S502.C89V9ANXX.s_1.r_1</span></span><br><span class="line"><span class="comment">##   SLX-9555.N701_S503.C89V9ANXX.s_1.r_1 ...</span></span><br><span class="line"><span class="comment">##   SLX-11312.N712_S508.H5H5YBBXX.s_8.r_1</span></span><br><span class="line"><span class="comment">##   SLX-11312.N712_S517.H5H5YBBXX.s_8.r_1</span></span><br><span class="line"><span class="comment">## colData names(9): Source Name cell line ... spike-in addition block</span></span><br><span class="line"><span class="comment">## reducedDimNames(0):</span></span><br><span class="line"><span class="comment">## altExpNames(2): ERCC SIRV</span></span><br></pre></td></tr></table></figure><h2 id="qc指标的选择">QC指标的选择</h2><p>鉴定细胞是否是低质量的，需要用到几个指标。虽然下面这些指标是使用SMART-seq2数据进行展示的，但依然适用于UMI数据（比如MARS-seq、droplet-based技术）</p><ul><li><strong>文库大小（library size）</strong> ：指的是每个细胞中所有基因的表达量之和。细胞的文库如果很小，说明在文库制备过程中存在RNA的损失，要么是由于细胞裂解，要么是cDNA捕获不足导致后续的扩增量少<br /></li><li><strong>每个细胞中表达基因的数目（number of expressed features in each cell）</strong>：指的是细胞中非0表达量的基因数量。如果细胞中基本没有基因表达，很可能是转录本捕获失败<br /></li><li><strong>比对到spike-in转录本的reads比例（proportion of reads mapped to spike-in transcripts）</strong>：计算方法是：<code>spike-in counts / all features (including spike-ins) for each cell</code>。每个细胞都应该加入等量的外源转录本（spike-in），如果哪个细胞的spike-in比例提高了，说明它的内源RNA含量减少（比如在细胞分选阶段出现的细胞裂解或者RNA降解）<br /></li><li><strong>比对到线粒体基因组的reads比例（proportion of reads mapped to genes in the mitochondrial genome）</strong> ：如果没有spike-in，那么使用线粒体指标也是能说明问题的(Islam et al. 2014; Ilicic et al. 2016)。比对到线粒体的reads增多，说明细胞质中的RNA减少，可能存在细胞穿孔的情况，而这个孔的大小，可能只是将细胞质中存在的mRNA流出去，但线粒体的体积超过了孔的大小，所以还留在了细胞中，造成一定程度的富集，导致线粒体RNA占比升高。</li></ul><p>对于每个细胞，可以用scater包的<code>perCellQCMetrics()</code>函数进行计算，其中<code>sum</code>这一列表示每个细胞的文库大小；<code>detected</code>这一列表示检测到的基因数量；<code>subsets_Mito_percent</code>这一列表示比对到线粒体基因组的reads占比；<code>altexps_ERCC_percent</code>表示比对到ERCC spike-in的reads占比</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Retrieving the mitochondrial transcripts using genomic locations included in</span></span><br><span class="line"><span class="comment"># the row-level annotation for the SingleCellExperiment.</span></span><br><span class="line">location &lt;- rowRanges(sce.416b)</span><br><span class="line">is.mito &lt;- any(seqnames(location)==<span class="string">&quot;MT&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ALTERNATIVELY: using resources in AnnotationHub to retrieve chromosomal</span></span><br><span class="line"><span class="comment"># locations given the Ensembl IDs; this should yield the same result.</span></span><br><span class="line"><span class="keyword">library</span>(AnnotationHub)</span><br><span class="line">ens.mm.v97 &lt;- AnnotationHub()[[<span class="string">&quot;AH73905&quot;</span>]]</span><br><span class="line">chr.loc &lt;- mapIds(ens.mm.v97, keys=rownames(sce.416b),</span><br><span class="line">    keytype=<span class="string">&quot;GENEID&quot;</span>, column=<span class="string">&quot;SEQNAME&quot;</span>)</span><br><span class="line">is.mito.alt &lt;- which(chr.loc==<span class="string">&quot;MT&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">library</span>(scater)</span><br><span class="line">df &lt;- perCellQCMetrics(sce.416b, subsets=list(Mito=is.mito))</span><br><span class="line">df</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## DataFrame with 192 rows and 16 columns</span></span><br><span class="line"><span class="comment">##           sum  detected percent_top_50 percent_top_100 percent_top_200</span></span><br><span class="line"><span class="comment">##     &lt;integer&gt; &lt;integer&gt;      &lt;numeric&gt;       &lt;numeric&gt;       &lt;numeric&gt;</span></span><br><span class="line"><span class="comment">## 1      865936      7618        26.7218         32.2773         39.7208</span></span><br><span class="line"><span class="comment">## 2     1076277      7521        29.4043         35.0354         42.2581</span></span><br><span class="line"><span class="comment">## 3     1180138      8306        27.3454         32.4770         39.3296</span></span><br><span class="line"><span class="comment">## 4     1342593      8143        35.8092         40.2666         46.2460</span></span><br><span class="line"><span class="comment">## 5     1668311      7154        34.1198         39.0901         45.6660</span></span><br><span class="line"><span class="comment">## ...       ...       ...            ...             ...             ...</span></span><br><span class="line"><span class="comment">## 188    776622      8174        45.9362         49.7010         54.6101</span></span><br><span class="line"><span class="comment">## 189   1299950      8956        38.0829         42.8930         49.0622</span></span><br><span class="line"><span class="comment">## 190   1800696      9530        30.6675         35.5839         41.8550</span></span><br><span class="line"><span class="comment">## 191     46731      6649        32.2998         37.9149         44.5999</span></span><br><span class="line"><span class="comment">## 192   1866692     10964        26.6632         31.2584         37.5608</span></span><br><span class="line"><span class="comment">##     percent_top_500 subsets_Mito_sum subsets_Mito_detected subsets_Mito_percent</span></span><br><span class="line"><span class="comment">##           &lt;numeric&gt;        &lt;integer&gt;             &lt;integer&gt;            &lt;numeric&gt;</span></span><br><span class="line"><span class="comment">## 1           52.9038            78790                    20              9.09882</span></span><br><span class="line"><span class="comment">## 2           55.7454            98613                    20              9.16242</span></span><br><span class="line"><span class="comment">## 3           51.9337           100341                    19              8.50248</span></span><br><span class="line"><span class="comment">## 4           57.1210           104882                    20              7.81190</span></span><br><span class="line"><span class="comment">## 5           58.2004           129559                    22              7.76588</span></span><br><span class="line"><span class="comment">## ...             ...              ...                   ...                  ...</span></span><br><span class="line"><span class="comment">## 188         64.4249            48126                    20              6.19684</span></span><br><span class="line"><span class="comment">## 189         60.6675           112225                    25              8.63302</span></span><br><span class="line"><span class="comment">## 190         53.6781           135693                    23              7.53559</span></span><br><span class="line"><span class="comment">## 191         56.5235             3505                    16              7.50037</span></span><br><span class="line"><span class="comment">## 192         48.9489           150375                    29              8.05569</span></span><br><span class="line"><span class="comment">##     altexps_ERCC_sum altexps_ERCC_detected altexps_ERCC_percent</span></span><br><span class="line"><span class="comment">##            &lt;integer&gt;             &lt;integer&gt;            &lt;numeric&gt;</span></span><br><span class="line"><span class="comment">## 1              65278                    39              6.80658</span></span><br><span class="line"><span class="comment">## 2              74748                    40              6.28030</span></span><br><span class="line"><span class="comment">## 3              60878                    42              4.78949</span></span><br><span class="line"><span class="comment">## 4              60073                    42              4.18567</span></span><br><span class="line"><span class="comment">## 5             136810                    44              7.28887</span></span><br><span class="line"><span class="comment">## ...              ...                   ...                  ...</span></span><br><span class="line"><span class="comment">## 188            61575                    39              7.17620</span></span><br><span class="line"><span class="comment">## 189            94982                    41              6.65764</span></span><br><span class="line"><span class="comment">## 190           113707                    40              5.81467</span></span><br><span class="line"><span class="comment">## 191             7580                    44             13.48898</span></span><br><span class="line"><span class="comment">## 192            48664                    39              2.51930</span></span><br><span class="line"><span class="comment">##     altexps_SIRV_sum altexps_SIRV_detected altexps_SIRV_percent     total</span></span><br><span class="line"><span class="comment">##            &lt;integer&gt;             &lt;integer&gt;            &lt;numeric&gt; &lt;integer&gt;</span></span><br><span class="line"><span class="comment">## 1              27828                     7              2.90165    959042</span></span><br><span class="line"><span class="comment">## 2              39173                     7              3.29130   1190198</span></span><br><span class="line"><span class="comment">## 3              30058                     7              2.36477   1271074</span></span><br><span class="line"><span class="comment">## 4              32542                     7              2.26741   1435208</span></span><br><span class="line"><span class="comment">## 5              71850                     7              3.82798   1876971</span></span><br><span class="line"><span class="comment">## ...              ...                   ...                  ...       ...</span></span><br><span class="line"><span class="comment">## 188            19848                     7             2.313165    858045</span></span><br><span class="line"><span class="comment">## 189            31729                     7             2.224004   1426661</span></span><br><span class="line"><span class="comment">## 190            41116                     7             2.102562   1955519</span></span><br><span class="line"><span class="comment">## 191             1883                     7             3.350892     56194</span></span><br><span class="line"><span class="comment">## 192            16289                     7             0.843271   1931645</span></span><br></pre></td></tr></table></figure><p>另外，还可以使用<code>addPerCellQC()</code>，它会把每个细胞的QC指标加到<code>SingleCellExperiment</code>对象的<code>colData</code>中，方便后面调取</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sce.416b &lt;- addPerCellQC(sce.416b, subsets=list(Mito=is.mito))</span><br><span class="line">colnames(colData(sce.416b))</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##  [1] &quot;Source Name&quot;              &quot;cell line&quot;               </span></span><br><span class="line"><span class="comment">##  [3] &quot;cell type&quot;                &quot;single cell well quality&quot;</span></span><br><span class="line"><span class="comment">##  [5] &quot;genotype&quot;                 &quot;phenotype&quot;               </span></span><br><span class="line"><span class="comment">##  [7] &quot;strain&quot;                   &quot;spike-in addition&quot;       </span></span><br><span class="line"><span class="comment">##  [9] &quot;block&quot;                    &quot;sum&quot;                     </span></span><br><span class="line"><span class="comment">## [11] &quot;detected&quot;                 &quot;percent_top_50&quot;          </span></span><br><span class="line"><span class="comment">## [13] &quot;percent_top_100&quot;          &quot;percent_top_200&quot;         </span></span><br><span class="line"><span class="comment">## [15] &quot;percent_top_500&quot;          &quot;subsets_Mito_sum&quot;        </span></span><br><span class="line"><span class="comment">## [17] &quot;subsets_Mito_detected&quot;    &quot;subsets_Mito_percent&quot;    </span></span><br><span class="line"><span class="comment">## [19] &quot;altexps_ERCC_sum&quot;         &quot;altexps_ERCC_detected&quot;   </span></span><br><span class="line"><span class="comment">## [21] &quot;altexps_ERCC_percent&quot;     &quot;altexps_SIRV_sum&quot;        </span></span><br><span class="line"><span class="comment">## [23] &quot;altexps_SIRV_detected&quot;    &quot;altexps_SIRV_percent&quot;    </span></span><br><span class="line"><span class="comment">## [25] &quot;total&quot;</span></span><br></pre></td></tr></table></figure><p>当然，这里做QC统计的前提假设是：每个细胞的qc指标都是独立于生物学状态的。也就是说，qc指标不会那么智能地识别细胞类型然后进行判断。它会认为（如文库太小、高线粒体占比）都是由技术误差引起的，而非生物因素。但是有一个问题，<strong>如果某些细胞类型本身的RNA含量就很低，或者它们本来就含有很多的线粒体转录本呢？再根据这个指标进行过滤，会不会损失一些细胞类型呢？</strong></p><h2 id="识别低质量细胞">识别低质量细胞</h2><h3 id="使用固定的阈值">1. 使用固定的阈值</h3><p>识别低质量细胞最简单方法是在QC度量上应用阈值。例如设定文库低于10万reads的细胞是低质量的，或者表达基因数量少于5000个，spike-in或线粒体占比高于10%。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">qc.lib &lt;- df$sum &lt; <span class="number">1e5</span></span><br><span class="line">qc.nexprs &lt;- df$detected &lt; <span class="number">5e3</span></span><br><span class="line">qc.spike &lt;- df$altexps_ERCC_percent &gt; <span class="number">10</span></span><br><span class="line">qc.mito &lt;- df$subsets_Mito_percent &gt; <span class="number">10</span></span><br><span class="line">discard &lt;- qc.lib | qc.nexprs | qc.spike | qc.mito</span><br><span class="line"></span><br><span class="line"><span class="comment"># Summarize the number of cells removed for each reason.</span></span><br><span class="line">DataFrame(LibSize=sum(qc.lib), NExprs=sum(qc.nexprs),</span><br><span class="line">    SpikeProp=sum(qc.spike), MitoProp=sum(qc.mito), Total=sum(discard))</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## DataFrame with 1 row and 5 columns</span></span><br><span class="line"><span class="comment">##     LibSize    NExprs SpikeProp  MitoProp     Total</span></span><br><span class="line"><span class="comment">##   &lt;integer&gt; &lt;integer&gt; &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span></span><br><span class="line"><span class="comment">## 1         3         0        19        14        33</span></span><br></pre></td></tr></table></figure><p>虽然看起来简单，但使用这种方法需要丰富的经验，了解实验设计和细胞状态；另外即使使用同一种文库制备方法，但由于细胞捕获效率和测序深度的不同，这个阈值依然需要适时调整。因此对于研究人员要求很高。</p><h3 id="使用相对阈值">2. 使用相对阈值</h3><h4 id="鉴定离群点">鉴定离群点</h4><p>为了获得相对阈值，先假设大部分细胞都是高质量的，然后去找离群点作为低质量。那么按照什么方法找离群点呢？常用的一个函数<code>isOutlier</code>使用的是MAD指标（绝对中位差来估计方差,先计算出数据与它们的中位数之间的偏差，然后这些偏差的绝对值的中位数就是MAD，median absolute deviation）。如果<strong>超过中位数3倍MAD的值就是离群值</strong>。</p><p>使用<code>isOutlier</code>时，如果要相减（例如：<code>df$sum - 3* MAD</code>），就用<code>type="lower"</code>，此时一般还要做个log转换<code>log=TRUE</code> ，保证得到的结果不是负数</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">qc.lib2 &lt;- isOutlier(df$sum, log=<span class="literal">TRUE</span>, type=<span class="string">&quot;lower&quot;</span>)</span><br><span class="line">qc.nexprs2 &lt;- isOutlier(df$detected, log=<span class="literal">TRUE</span>, type=<span class="string">&quot;lower&quot;</span>)</span><br><span class="line">qc.spike2 &lt;- isOutlier(df$altexps_ERCC_percent, type=<span class="string">&quot;higher&quot;</span>)</span><br><span class="line">qc.mito2 &lt;- isOutlier(df$subsets_Mito_percent, type=<span class="string">&quot;higher&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">attr(qc.lib2, <span class="string">&quot;thresholds&quot;</span>)</span><br><span class="line">   lower   higher </span><br><span class="line"><span class="number">434082.9</span>      <span class="literal">Inf</span> </span><br><span class="line">attr(qc.nexprs2, <span class="string">&quot;thresholds&quot;</span>)</span><br><span class="line">   lower   higher </span><br><span class="line"><span class="number">5231.468</span>      <span class="literal">Inf</span> </span><br><span class="line">attr(qc.spike2, <span class="string">&quot;thresholds&quot;</span>)</span><br><span class="line">   lower   higher </span><br><span class="line">    -<span class="literal">Inf</span> <span class="number">14.15371</span> </span><br><span class="line">attr(qc.mito2, <span class="string">&quot;thresholds&quot;</span>)</span><br><span class="line">   lower   higher </span><br><span class="line">    -<span class="literal">Inf</span> <span class="number">11.91734</span> </span><br></pre></td></tr></table></figure><p>用相对阈值过滤的细胞数量统计：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">discard2 &lt;- qc.lib2 | qc.nexprs2 | qc.spike2 | qc.mito2</span><br><span class="line"></span><br><span class="line"><span class="comment"># Summarize the number of cells removed for each reason.</span></span><br><span class="line">DataFrame(LibSize=sum(qc.lib2), NExprs=sum(qc.nexprs2),</span><br><span class="line">    SpikeProp=sum(qc.spike2), MitoProp=sum(qc.mito2), Total=sum(discard2))</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## DataFrame with 1 row and 5 columns</span></span><br><span class="line"><span class="comment">##     LibSize    NExprs SpikeProp  MitoProp     Total</span></span><br><span class="line"><span class="comment">##   &lt;integer&gt; &lt;integer&gt; &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span></span><br><span class="line"><span class="comment">## 1         4         0         1         2         6</span></span><br></pre></td></tr></table></figure><p><strong>除此以外，还有一种更快的计算方法，一步整合了上面的操作：</strong></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">reasons &lt;- quickPerCellQC(df, percent_subsets=c(<span class="string">&quot;subsets_Mito_percent&quot;</span>,</span><br><span class="line">    <span class="string">&quot;altexps_ERCC_percent&quot;</span>))</span><br><span class="line">colSums(as.matrix(reasons))</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##              low_lib_size            low_n_features high_subsets_Mito_percent </span></span><br><span class="line"><span class="comment">##                         4                         0                         2 </span></span><br><span class="line"><span class="comment">## high_altexps_ERCC_percent                   discard </span></span><br><span class="line"><span class="comment">##                         1                         6</span></span><br></pre></td></tr></table></figure><p>使用”相对“的阈值一个好处就是可以根据测序深度、cDNA捕获效率、线粒体含量等等进行阈值的调整，在经验不是足够丰富的时候，可以辅助判断。但仍需要注意的是，<strong>使用相对阈值是有前提的，那就是：认为大部分细胞都是高质量的</strong></p><h3 id="离群点检测的假设">离群点检测的假设</h3><ul><li>离群点的检测的假设是<strong>大部分细胞的质量都不错</strong>。这一点假设可以通过实验去验证（比如肉眼检查细胞完整性）。<strong>但当大部分细胞质量都很低，使用相对阈值结果就对大量的低质量细胞无计可施</strong>。因为它使用了MAD值，和中位数有关系，那么可以试想：如果一堆数都不合格，那么它们的中位数也不合格，因此原来正确的值，其实在这群不合格的数值中，就是“离群”的。<br /></li><li>另一个假设就是：<strong>每个细胞的qc指标都是独立于生物学状态的</strong>。也就是说，qc指标不会那么智能地识别细胞类型然后进行判断。在异质性很高的组织中， 就是存在内源RNA含量低，而线粒体基因占比高的细胞。如果使用”一刀切“的固定阈值，它们就很可能会被当成离群点被过滤。而是用MAD计算方法检测的结果可能就是：虽然一堆细胞的某个qc指标差异很大，但中位数也在变，随之变化的还有MAD值，这样最后的结果不至于和真实生物学情况差太多</li></ul><h3 id="考虑实验的因素">考虑实验的因素</h3><p>很多大型的实验都包含多个细胞系，而且可能采用的实验方法不同（比如选用不同的测序深度），这就产生了实验的不同批次。<strong>这种情况下， 应该对每个批次分别进行检测。</strong></p><p>如果每个批次都是一个<code>SingleCellExperiment</code>对象，那么<code>isOutlier()</code>函数可以按上面的方法直接使用；但是如果不同批次的细胞已经混合成一整个<code>SingleCellExperiment</code>对象，那么<code>batch=</code>这个参数就派上用场了。</p><p>同样以这个416B数据集为例，他包含了两种不同的实验类型。然后我们就可以使用<code>batch=</code>参数去进行质控。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">batch &lt;- paste0(sce.416b$phenotype, <span class="string">&quot;-&quot;</span>, sce.416b$Plate)</span><br><span class="line">batch.reasons &lt;- quickPerCellQC(df, percent_subsets=c(<span class="string">&quot;subsets_Mito_percent&quot;</span>,</span><br><span class="line">    <span class="string">&quot;altexps_ERCC_percent&quot;</span>), batch=batch)</span><br><span class="line">colSums(as.matrix(batch.reasons))</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##              low_lib_size            low_n_features high_subsets_Mito_percent </span></span><br><span class="line"><span class="comment">##                         4                         2                         2 </span></span><br><span class="line"><span class="comment">## high_altexps_ERCC_percent                   discard </span></span><br><span class="line"><span class="comment">##                         4                         7</span></span><br></pre></td></tr></table></figure><p><strong>但是，<code>batch</code>参数不是万能的</strong>，之前也说过，这种相对阈值需要一个<strong>假设：每个批次的大部分细胞都是高质量的</strong>。当某个批次的细胞整体质量偏低，离群点检测很有可能失败</p><p>例如，在Grun et al. (2016)的数据集中有两个donor的实验是失败的。它们的ERCC含量相对其他批次高，增加了中位数和MAD值，导致过滤低质量细胞失败。因此这种情况下，可以先算其他几个批次的中位数和MAD值，然后参考这些值去对有问题的批次进行过滤。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(scRNAseq)</span><br><span class="line">sce.grun &lt;- GrunPancreasData()</span><br><span class="line">sce.grun &lt;- addPerCellQC(sce.grun)</span><br><span class="line"></span><br><span class="line"><span class="comment"># First attempt with batch-specific thresholds.</span></span><br><span class="line">discard.ercc &lt;- isOutlier(sce.grun$altexps_ERCC_percent,</span><br><span class="line">    type=<span class="string">&quot;higher&quot;</span>, batch=sce.grun$donor)</span><br><span class="line">with.blocking &lt;- plotColData(sce.grun, x=<span class="string">&quot;donor&quot;</span>, y=<span class="string">&quot;altexps_ERCC_percent&quot;</span>,</span><br><span class="line">    colour_by=I(discard.ercc))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Second attempt, sharing information across batches</span></span><br><span class="line"><span class="comment"># to avoid dramatically different thresholds for unusual batches.</span></span><br><span class="line">discard.ercc2 &lt;- isOutlier(sce.grun$altexps_ERCC_percent,</span><br><span class="line">    type=<span class="string">&quot;higher&quot;</span>, batch=sce.grun$donor,</span><br><span class="line">    subset=sce.grun$donor %<span class="keyword">in</span>% c(<span class="string">&quot;D17&quot;</span>, <span class="string">&quot;D2&quot;</span>, <span class="string">&quot;D7&quot;</span>))</span><br><span class="line">without.blocking &lt;- plotColData(sce.grun, x=<span class="string">&quot;donor&quot;</span>, y=<span class="string">&quot;altexps_ERCC_percent&quot;</span>,</span><br><span class="line">    colour_by=I(discard.ercc2))</span><br><span class="line"></span><br><span class="line">gridExtra::grid.arrange(with.blocking, without.blocking, ncol=<span class="number">2</span>) </span><br></pre></td></tr></table></figure><p><img src="/images/quality-control/qc-plot-pancreas-1.png" /></p><blockquote><p>注：可以看到，左图是按照每个批次分别鉴定的离群点；右图是用质量好的批次计算的阈值，然后运用到差的批次上的结果</p></blockquote><p>为了鉴别有问题的批次，可以先将每个批次分别计算结果，然后比较它们的阈值，如果比同类批次超出太多，就要警觉。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ercc.thresholds &lt;- attr(discard.ercc, <span class="string">&quot;thresholds&quot;</span>)[<span class="string">&quot;higher&quot;</span>,]</span><br><span class="line">ercc.thresholds</span><br><span class="line"><span class="comment">##        D10        D17         D2         D3         D7 </span></span><br><span class="line"><span class="comment">##  73.610696   7.599947   6.010975 113.105828  15.216956</span></span><br><span class="line"></span><br><span class="line">names(ercc.thresholds)[isOutlier(ercc.thresholds, type=<span class="string">&quot;higher&quot;</span>)]</span><br><span class="line"><span class="comment">## [1] &quot;D10&quot; &quot;D3&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>可以看到D10、D3的阈值就超过其他批次很多</p></blockquote><p>但是这么做的前提都是：我们认为批次中的细胞质量整体还不错。如果我们保证不了细胞质量，那么这种计算相对阈值的方法就不成立，还是要使用绝对阈值，手动去除。</p><h3 id="其他方法">3. 其他方法</h3><p>另一个策略是根据每个细胞的QC指标来在高维空间中识别异常值。利用<code>robustbase</code> 包，将细胞放在高维空间，根据他们的QC指标（文库大小、表达基因数、spike-in比例、线粒体比例），然后使用<code>isOutlier()</code>来识别表现出异常高outlylier水平的低质量细胞</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">stats &lt;- cbind(log10(df$sum), log10(df$detected),</span><br><span class="line">    df$subsets_Mito_percent, df$altexps_ERCC_percent)</span><br><span class="line"></span><br><span class="line"><span class="keyword">library</span>(robustbase)</span><br><span class="line">outlying &lt;- adjOutlyingness(stats, only.outlyingness = <span class="literal">TRUE</span>)</span><br><span class="line">multi.outlier &lt;- isOutlier(outlying, type = <span class="string">&quot;higher&quot;</span>)</span><br><span class="line">summary(multi.outlier)</span><br><span class="line"><span class="comment">##    Mode   FALSE    TRUE </span></span><br><span class="line"><span class="comment">## logical     182      10</span></span><br></pre></td></tr></table></figure><p>除此以外，有时<strong>还可以根据基因表达量进行过滤</strong>，不过在bulk转录组中用的比较多，但是在scRNA中这样操作可能会损失一些本身数量就比较少的高质量细胞群体（比如一些罕见细胞，本身基因表达量就不是很高）</p><h2 id="画图检查">画图检查</h2><p>检查QC度量的分布以确定可能的问题是一个很好的实践。在最理想的情况下，我们会看到正态分布，可以证明在离群值检测中使用的<code>3 MAD</code>阈值是合理的。另一种模式下的大量细胞表明QC指标可能与某些生物状态相关，可能导致过滤过程中不同细胞类型的丢失;或者有不一致的库准备为一个子集的细胞，一个非罕见的现象在板的协议。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 把QC指标和原来的sce.416b细胞信息整合起来</span></span><br><span class="line">colData(sce.416b) &lt;- cbind(colData(sce.416b), df)</span><br><span class="line"><span class="comment"># 修改一下整合后的信息</span></span><br><span class="line">sce.416b$block &lt;- factor(sce.416b$block)</span><br><span class="line">sce.416b$phenotype &lt;- ifelse(grepl(<span class="string">&quot;induced&quot;</span>, sce.416b$phenotype),</span><br><span class="line">    <span class="string">&quot;induced&quot;</span>, <span class="string">&quot;wild type&quot;</span>)</span><br><span class="line">sce.416b$discard &lt;- reasons$discard</span><br><span class="line"><span class="comment"># 绘图</span></span><br><span class="line">gridExtra::grid.arrange(</span><br><span class="line">    plotColData(sce.416b, x=<span class="string">&quot;block&quot;</span>, y=<span class="string">&quot;sum&quot;</span>, colour_by=<span class="string">&quot;discard&quot;</span>,</span><br><span class="line">        other_fields=<span class="string">&quot;phenotype&quot;</span>) + facet_wrap(~phenotype) + </span><br><span class="line">        scale_y_log10() + ggtitle(<span class="string">&quot;Total count&quot;</span>),</span><br><span class="line">    plotColData(sce.416b, x=<span class="string">&quot;block&quot;</span>, y=<span class="string">&quot;detected&quot;</span>, colour_by=<span class="string">&quot;discard&quot;</span>, </span><br><span class="line">        other_fields=<span class="string">&quot;phenotype&quot;</span>) + facet_wrap(~phenotype) + </span><br><span class="line">        scale_y_log10() + ggtitle(<span class="string">&quot;Detected features&quot;</span>),</span><br><span class="line">    plotColData(sce.416b, x=<span class="string">&quot;block&quot;</span>, y=<span class="string">&quot;subsets_Mito_percent&quot;</span>, </span><br><span class="line">        colour_by=<span class="string">&quot;discard&quot;</span>, other_fields=<span class="string">&quot;phenotype&quot;</span>) + </span><br><span class="line">        facet_wrap(~phenotype) + ggtitle(<span class="string">&quot;Mito percent&quot;</span>),</span><br><span class="line">    plotColData(sce.416b, x=<span class="string">&quot;block&quot;</span>, y=<span class="string">&quot;altexps_ERCC_percent&quot;</span>, </span><br><span class="line">        colour_by=<span class="string">&quot;discard&quot;</span>, other_fields=<span class="string">&quot;phenotype&quot;</span>) + </span><br><span class="line">        facet_wrap(~phenotype) + ggtitle(<span class="string">&quot;ERCC percent&quot;</span>),</span><br><span class="line">    ncol=<span class="number">1</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><img src="/images/quality-control/qc-dist-416b-1.png" /></p><blockquote><p>展示的是不同批次的QC指标</p></blockquote><p>另一种有用的诊断方法是绘制相对于其他QC指标的线粒体计数比例图。</p><p>为了确保不存在这样的细胞：虽然细胞文库大，但它的线粒体占比也高。另外也是为了避免意外过滤掉本来是高质量但同时具有高代谢活性（即高线粒体占比）的细胞（如肝脏细胞）</p><p>======未完</p><h2 id="针对droplet数据的细胞判断">针对Droplet数据的细胞判断</h2><h3 id="背景">背景</h3><p>由于这种建库方法的独特性，我们没办法事先知道某一个细胞文库（比如一个cell barcode）是真正包含一个细胞还是只是一个空的液滴（droplet）。因此，<strong>第一步是需要根据得到的表达量信息，来推断液滴是不是空的</strong>。但仅仅根据表达量判断还是不太靠谱，因为还有可能在空的液滴中依然包含外源RNA，最后的细胞文库依旧不为0，但确实不包含细胞。</p><p>这里为了说明这个问题，<strong>使用了一个未过滤的10X PBMC数据</strong></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据下载</span></span><br><span class="line"><span class="keyword">library</span>(BiocFileCache)</span><br><span class="line">bfc &lt;- BiocFileCache(<span class="string">&quot;raw_data&quot;</span>, ask = <span class="literal">FALSE</span>)</span><br><span class="line">raw.path &lt;- bfcrpath(bfc, file.path(<span class="string">&quot;http://cf.10xgenomics.com/samples&quot;</span>,</span><br><span class="line">    <span class="string">&quot;cell-exp/2.1.0/pbmc4k/pbmc4k_raw_gene_bc_matrices.tar.gz&quot;</span>))</span><br><span class="line"><span class="comment"># 解压数据</span></span><br><span class="line">untar(raw.path, exdir=file.path(tempdir(), <span class="string">&quot;pbmc4k&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">library</span>(DropletUtils)</span><br><span class="line"><span class="keyword">library</span>(Matrix)</span><br><span class="line">fname &lt;- file.path(tempdir(), <span class="string">&quot;pbmc4k/raw_gene_bc_matrices/GRCh38&quot;</span>)</span><br><span class="line">sce.pbmc &lt;- read10xCounts(fname, col.names=<span class="literal">TRUE</span>)</span><br><span class="line">sce.pbmc</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## class: SingleCellExperiment </span></span><br><span class="line"><span class="comment">## dim: 33694 737280 </span></span><br><span class="line"><span class="comment">## metadata(1): Samples</span></span><br><span class="line"><span class="comment">## assays(1): counts</span></span><br><span class="line"><span class="comment">## rownames(33694): ENSG00000243485 ENSG00000237613 ... ENSG00000277475</span></span><br><span class="line"><span class="comment">##   ENSG00000268674</span></span><br><span class="line"><span class="comment">## rowData names(2): ID Symbol</span></span><br><span class="line"><span class="comment">## colnames(737280): AAACCTGAGAAACCAT-1 AAACCTGAGAAACCGC-1 ...</span></span><br><span class="line"><span class="comment">##   TTTGTCATCTTTAGTC-1 TTTGTCATCTTTCCTC-1</span></span><br><span class="line"><span class="comment">## colData names(2): Sample Barcode</span></span><br><span class="line"><span class="comment">## reducedDimNames(0):</span></span><br><span class="line"><span class="comment">## altExpNames(0):</span></span><br></pre></td></tr></table></figure><p><strong>整体观察不同的barcodes（不一定都是真的细胞）的文库大小分布：</strong></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">bcrank &lt;- barcodeRanks(counts(sce.pbmc))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Only showing unique points for plotting speed.</span></span><br><span class="line">uniq &lt;- !duplicated(bcrank$rank)</span><br><span class="line">plot(bcrank$rank[uniq], bcrank$total[uniq], log=<span class="string">&quot;xy&quot;</span>,</span><br><span class="line">    xlab=<span class="string">&quot;Rank&quot;</span>, ylab=<span class="string">&quot;Total UMI count&quot;</span>, cex.lab=<span class="number">1.2</span>)</span><br><span class="line"></span><br><span class="line">abline(h=metadata(bcrank)$inflection, col=<span class="string">&quot;darkgreen&quot;</span>, lty=<span class="number">2</span>)</span><br><span class="line">abline(h=metadata(bcrank)$knee, col=<span class="string">&quot;dodgerblue&quot;</span>, lty=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">legend(<span class="string">&quot;bottomleft&quot;</span>, legend=c(<span class="string">&quot;Inflection&quot;</span>, <span class="string">&quot;Knee&quot;</span>), </span><br><span class="line">        col=c(<span class="string">&quot;darkgreen&quot;</span>, <span class="string">&quot;dodgerblue&quot;</span>), lty=<span class="number">2</span>, cex=<span class="number">1.2</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/quality-control/rankplot-1.png" /></p><blockquote><p>看到各个barcodes的文库大小有高有低，并且相差较大，因此可能对应着真实存在的细胞和空液滴。当然最简单的办法还是”一刀切“，<strong>留下那些文库较大的细胞</strong>，不过还是有损失真实细胞类型的风险</p></blockquote><h3 id="检测空的液滴">检测空的液滴</h3><p>我们使用<code>emptyDrops()</code>函数，检查每个barcode的表达量是不是和外源RNA的表达量有显著差异(Lun et al. 2019)。如果存在显著差异，就说明barcode中更有可能是一个细胞。这种方法可<strong>以帮助区分：测序质量好的空液滴 和 包含细胞但RNA含量较少的液滴</strong>。尽管它们总体的表达量可能很相似，但本质不同，还是要区分的。</p><p><code>emptyDrops()</code> 使用Monte Carlo统计模拟计算p值，如果要重复结果，需要设置随机种子。另外设置 false discovery rate (FDR)为0.1%，意味着不超过0.1%的barcodes是空的。</p>]]></content>
      
      
      <categories>
          
          <category> SingleCell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SingleCell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>单尾还是双尾检验</title>
      <link href="2020/08/10/one-tail/"/>
      <url>2020/08/10/one-tail/</url>
      
        <content type="html"><![CDATA[<p>单侧检验 or 双侧检验？ <a id="more"></a></p><h2 id="单尾检验与双尾检验">单尾检验与双尾检验</h2><ul><li><strong>假设有一个新的肿瘤治疗方案，我们希望新治疗方案的疗效较传统治疗更好</strong><br /></li><li><strong>为了探究新的抗肿瘤治疗方案是否疗效更优，故进行含6个患者的小临床试验，其中3个患者接受传统治疗方案，另外3个患者接受新的治疗方案。</strong>将治疗疗效结果表示在坐标轴上，从左至右表示疗效从好至差。该数据提示新治疗方案的疗效似乎更好，但是有部分数据并未得出此结论（如下），故两种方案的疗效优劣并不明确。</li></ul><p><img src="/images/one-tail/onetail1.jpg" /></p><p><img src="/images/one-tail/onetail2.jpg" /></p><p>进行统计学检验：</p><ul><li><strong>在单尾检验时，得出p值=0.03，p值小于常见显著性水平的阈值0.05。</strong><br /></li><li><strong>在双尾检验时，得出p值=0.06，p值大于常见显著性水平阈值0.05。</strong></li></ul><p>那么在这种情况下应该选择哪个计算的阈值？</p><p>单尾检验得出的p值检验的假设是： <strong>主观认为新治疗方案的疗效更好</strong>，故假设是否新的治疗方案优于传统治疗方案；该检验假设并没有区分新治疗方案疗效劣于和等于传统治疗方案的情况。</p><p>双尾检验得出的p值检验的假设是： <strong>对两种方案的疗效无主观判定</strong>，故假设是否新的治疗方案优于或劣于或等于传统治疗方案。</p><p><strong>因为在实际试验中，大多数情况下我们并不能知道两种方案疗效的优劣，我们需要探究的是新治疗方案是否优于或劣于或等于传统治疗方案，故我们应该选用双尾检验</strong>。尽管在此次小样本临床试验中，新治疗方案似乎比传统方案更优，但是我们也必须考虑新方案劣于传统方案的情况。好的统计检验意味着，我们必须在试验实施前确定检验方案和显著性水平。否则就会发生p-hacking，它会增加我们报告虚假结果的机会（bogus results）。</p><p><strong>故，在以上这种情况下，我们应该考虑采用双尾t检验，得出新方案与传统方案疗效无显著差异的结论</strong>（p值=0.06）。</p><h2 id="总结">总结</h2><p>在大多数情况下，我们并不知道目标数据差异的方向和好坏， 因此<strong>我们既需要考虑一组数据高于另一组数据的情况，也需要考虑一组数据低于另一组数据的情况，故我们往往需要选取双尾检验以减少假阳性率。</strong></p><hr /><p><strong>Reference</strong></p><p>https://www.youtube.com/watch?v=bsZGt-caXO4&amp;list=PLblh5JKOoLUK0FLuzwntyYI10UQFUhsY9&amp;index=30</p>]]></content>
      
      
      <categories>
          
          <category> statistics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stats </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Orchestrating Single-Cell Analysis (一)</title>
      <link href="2020/08/10/single-cell-ii/"/>
      <url>2020/08/10/single-cell-ii/</url>
      
        <content type="html"><![CDATA[<p>单细胞数据结构</p><a id="more"></a><h2 id="背景">背景</h2><p>在单细胞分析当中，最为基础重要的是单细胞特有的数据结构，用户应该能够使用不同的封装R包来分析他们的数据，而不需要格式之间转换。<code>SingleCellExperiment</code>是最为重要的数据类型。</p><p><img src="/images/single-cell-ii/SingleCellExperiment.png" /></p><p>图中最核心的部分，是蓝色的data部分；另外还有绿色的基因注释信息<code>feature metadata</code>、橙色的细胞注释信息<code>cell metadata</code>。除了这三大件，还会包含一些下游分析结果，比如PCA、tSNE降维结果就会保存在紫色的<code>Dimension Reductions</code></p><p>这个<code>SingleCellExperiment</code>对象来自<code>SingleCellExperiment</code>R包，现在Bioconductor上的70多个单细胞相关的R包都使用了这个对象，<strong>可以说是单细胞领域的通用货币</strong>。</p><h2 id="原始实验数据存储">原始实验数据存储</h2><h3 id="filling-the-assays-slot">Filling the <code>assays</code> slot</h3><p><strong>创建一个<code>SingleCellExperiment</code>对象很容易，只需要一个<code>assays</code>就可以了</strong>。这是一个列表，其中包含了许多表达数据，例如原始数据count或者其他标准化处理过的数据，行是基因，列是样本</p><p>可以构建一个10个基因，3个细胞的矩阵</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">counts_matrix &lt;- data.frame(cell_1 = rpois(<span class="number">10</span>, <span class="number">10</span>), </span><br><span class="line">                    cell_2 = rpois(<span class="number">10</span>, <span class="number">10</span>), </span><br><span class="line">                    cell_3 = rpois(<span class="number">10</span>, <span class="number">30</span>))</span><br><span class="line">rownames(counts_matrix) &lt;- paste0(<span class="string">&quot;gene_&quot;</span>, <span class="number">1</span>:<span class="number">10</span>)</span><br><span class="line">counts_matrix &lt;- as.matrix(counts_matrix) <span class="comment"># must be a matrix object!</span></span><br></pre></td></tr></table></figure><p>有了这个，就可以用一个list构建出SingleCellExperiment对象。当然，这个<strong>list中可以包括任意个矩阵</strong></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sce &lt;- SingleCellExperiment(assays = list(counts = counts_matrix))</span><br><span class="line">sce</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">## class: SingleCellExperiment </span><br><span class="line">## dim: 10 3 </span><br><span class="line">## metadata(0):</span><br><span class="line">## assays(1): counts</span><br><span class="line">## rownames(10): gene_1 gene_2 ... gene_9 gene_10</span><br><span class="line">## rowData names(0):</span><br><span class="line">## colnames(3): cell_1 cell_2 cell_3</span><br><span class="line">## colData names(0):</span><br><span class="line">## reducedDimNames(0):</span><br><span class="line">## altExpNames(0):</span><br></pre></td></tr></table></figure><p>为了得到这个对象中的矩阵，可以用两种方式获得：</p><ul><li><code>assay(sce, "counts")</code>：这个方法是最通用的办法，而且其中的counts可以换成其他的名称，只要是出现在之前的list中都可以</li><li><code>counts(sce)</code>：它实现的东西和上面一样，只不过这个方法只适合提取<code>counts</code>这个名称的矩阵</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">counts(sce)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">##         cell_1 cell_2 cell_3</span><br><span class="line">## gene_1      10     10     27</span><br><span class="line">## gene_2       6      9     41</span><br><span class="line">## gene_3       9      9     22</span><br><span class="line">## gene_4       5     14     31</span><br><span class="line">## gene_5      13      9     32</span><br><span class="line">## gene_6       7     14     30</span><br><span class="line">## gene_7       8      5     35</span><br><span class="line">## gene_8       8      6     41</span><br><span class="line">## gene_9      12     10     27</span><br><span class="line">## gene_10      9     11     25</span><br></pre></td></tr></table></figure><h3 id="adding-more-assays">Adding more <code>assays</code></h3><blockquote><p>使用<code>assays</code>非常强大的是我们可以对他进行各种扩展，这对于存储原始的计数矩阵以及数据的标准化版本特别有用。</p></blockquote><p>之前<code>assays</code>中只有原始表达矩阵，其实还能根据它扩展到归一化矩阵，例如使用<code>scater</code>R包的函数对包装的矩阵进行操作：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sce &lt;- scran::computeSumFactors(sce)</span><br><span class="line">sce &lt;- scater::logNormCounts(sce)</span><br><span class="line">sce</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">## class: SingleCellExperiment </span><br><span class="line">## dim: 10 3 </span><br><span class="line">## metadata(0):</span><br><span class="line">## assays(2): counts logcounts</span><br><span class="line">## rownames(10): gene_1 gene_2 ... gene_9 gene_10</span><br><span class="line">## rowData names(0):</span><br><span class="line">## colnames(3): cell_1 cell_2 cell_3</span><br><span class="line">## colData names(1): sizeFactor</span><br><span class="line">## reducedDimNames(0):</span><br><span class="line">## altExpNames(0):</span><br></pre></td></tr></table></figure><p>这样，<code>assays</code> 就从一个存储原始矩阵的<code>counts</code> ，又扩增了归一化矩阵的<code>logcounts</code>。同理，这个<code>logcounts</code>也是能有两种提取方法：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logcounts(sce)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">##           cell_1   cell_2   cell_3</span><br><span class="line">## gene_1  4.319439 4.170751 3.937792</span><br><span class="line">## gene_2  3.629859 4.027621 4.507948</span><br><span class="line">## gene_3  4.175442 4.027621 3.663575</span><br><span class="line">## gene_4  3.389947 4.633108 4.124903</span><br><span class="line">## gene_5  4.681178 4.027621 4.168120</span><br><span class="line">## gene_6  3.835506 4.633108 4.080351</span><br><span class="line">## gene_7  4.015463 3.248710 4.290508</span><br><span class="line">## gene_8  4.015463 3.486223 4.507948</span><br><span class="line">## gene_9  4.570379 4.170751 3.937792</span><br><span class="line">## gene_10 4.175442 4.300954 3.834273</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># assay(sce, &quot;logcounts&quot;)</span></span><br></pre></td></tr></table></figure><p>除了使用R包进行扩展之外，同样可以根据自己的想法，去根据原始矩阵得到一个新的对象，并储存在<code>assay</code>里边</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">counts_100 &lt;- counts(sce) + <span class="number">100</span></span><br><span class="line">assay(sce, <span class="string">&quot;counts_100&quot;</span>) &lt;- counts_100 <span class="comment"># assign a new entry to assays slot</span></span><br><span class="line">assays(sce) <span class="comment"># new assay has now been added.</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## List of length 3</span><br><span class="line">## names(3): counts logcounts counts_100</span><br></pre></td></tr></table></figure><blockquote><p>新增用的是<code>assay</code>单数，查看结果用的是<code>assays</code>复数</p></blockquote><p><strong><code>assays</code>可以包含多个矩阵；构建sce对象可以一次一次加入新的矩阵，也可以用列表的形式，一次加入多个矩阵。</strong>这与最开始的图形表示内容是相同的</p><h2 id="handling-metadata">Handling metadata</h2><h3 id="on-the-columns">On the columns</h3><p>为了进一步注释我们的<code>SingleCellExperiment</code>对象，那么我们需要添加注释信息来描述我们的数据，这部分来介绍列的注释，针对的就是实验样本、细胞。这部分信息将会保存在<code>colData</code>中，它的主体是样本，于是将行名设定为样本，列名设为注释信息（如：批次、作者等等），对应上面图中的橙色部分。</p><p>先添加一个细胞的注释信息：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cell_metadata &lt;- data.frame(batch = c(<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line">rownames(cell_metadata) &lt;- paste0(<span class="string">&quot;cell_&quot;</span>, <span class="number">1</span>:<span class="number">3</span>)</span><br></pre></td></tr></table></figure><p>有两种方法可以添加到<code>SingleCellExperiment</code>对象中：一种是<strong>直接构建</strong>，一种是<strong>后续添加</strong></p><ul><li><p>直接构建：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sce &lt;- SingleCellExperiment(assays = list(counts = counts_matrix),</span><br><span class="line">    colData = cell_metadata)</span><br></pre></td></tr></table></figure></li><li><p>后续添加：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">colData(sce) &lt;- DataFrame(cell_metadata)</span><br></pre></td></tr></table></figure></li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sce</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">## class: SingleCellExperiment </span><br><span class="line">## dim: 10 3 </span><br><span class="line">## metadata(0):</span><br><span class="line">## assays(1): counts</span><br><span class="line">## rownames(10): gene_1 gene_2 ... gene_9 gene_10</span><br><span class="line">## rowData names(0):</span><br><span class="line">## colnames(3): cell_1 cell_2 cell_3</span><br><span class="line">## colData names(1): batch</span><br><span class="line">## reducedDimNames(0):</span><br><span class="line">## altExpNames(0):</span><br></pre></td></tr></table></figure><p>可以看到<code>colData</code>增加了之前设置的<code>batch</code>信息</p><p>同样有两种方式获取这个注释信息</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">colData(sce)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">## DataFrame with 3 rows and 1 column</span><br><span class="line">##            batch</span><br><span class="line">##        &lt;numeric&gt;</span><br><span class="line">## cell_1         1</span><br><span class="line">## cell_2         1</span><br><span class="line">## cell_3         2</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sce$batch</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## [1] 1 1 2</span><br></pre></td></tr></table></figure><p>有一些函数可以帮助我们自动计算这些注释信息并添加到元数据当中，例如<code>scater</code>包的<code>calculateQCMetrics()</code>就会帮你计算几十项细胞的质量信息，结果依然是使用<code>colData</code>调用注释结果信息</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sce &lt;- scater::addPerCellQC(sce)</span><br><span class="line">colData(sce)[, <span class="number">1</span>:<span class="number">5</span>]</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">## DataFrame with 3 rows and 5 columns</span><br><span class="line">##            batch       sum  detected percent_top_50 percent_top_100</span><br><span class="line">##        &lt;numeric&gt; &lt;integer&gt; &lt;integer&gt;      &lt;numeric&gt;       &lt;numeric&gt;</span><br><span class="line">## cell_1         1        87        10            100             100</span><br><span class="line">## cell_2         1        97        10            100             100</span><br><span class="line">## cell_3         2       311        10            100             100</span><br></pre></td></tr></table></figure><p>或者，我们可能想要手动添加更多的字段到元数据当中:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sce$more_stuff &lt;- runif(ncol(sce))</span><br><span class="line">colnames(colData(sce))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## [1] &quot;batch&quot;           &quot;sum&quot;             &quot;detected&quot;        &quot;percent_top_50&quot;  &quot;percent_top_100&quot;</span><br><span class="line">## [6] &quot;percent_top_200&quot; &quot;percent_top_500&quot; &quot;total&quot;           &quot;more_stuff&quot;</span><br></pre></td></tr></table></figure><p>既然<code>colData</code>可以包含这么多的注释信息，那么怎么从中选取一部分呢？</p><p>colData的一个常用操作就是取子集，看下面操作：</p><p>例如想从colData中选择批次信息，和数据框取子集是类似的</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sce$batch</span><br><span class="line"><span class="comment"># 或者colData(sce)$batch</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## [1] 1 1 2</span><br></pre></td></tr></table></figure><p>然后如果再想取批次中属于第一个批次的信息，就可以继续按照数据框的思路取子集</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sce[, sce$batch == <span class="number">1</span>]</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">## class: SingleCellExperiment </span><br><span class="line">## dim: 10 2 </span><br><span class="line">## metadata(0):</span><br><span class="line">## assays(1): counts</span><br><span class="line">## rownames(10): gene_1 gene_2 ... gene_9 gene_10</span><br><span class="line">## rowData names(0):</span><br><span class="line">## colnames(2): cell_1 cell_2</span><br><span class="line">## colData names(9): batch sum ... total more_stuff</span><br><span class="line">## reducedDimNames(0):</span><br><span class="line">## altExpNames(0):</span><br></pre></td></tr></table></figure><h3 id="on-the-rows">On the rows</h3><p>既然样本有注释信息，那么同样的，基因也有自己的注释，它就存放在<code>rowData</code>或者<code>rowRanges</code>中，这两个的区别就是：</p><ul><li><p><code>rowData</code>：是一个数据框的结构，它就存储了核心<code>assays</code>矩阵的基因相关信息</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sce &lt;- scater::addPerFeatureQC(sce)</span><br><span class="line">rowData(sce)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">## DataFrame with 10 rows and 2 columns</span><br><span class="line">##              mean  detected</span><br><span class="line">##         &lt;numeric&gt; &lt;numeric&gt;</span><br><span class="line">## gene_1    15.6667       100</span><br><span class="line">## gene_2    18.6667       100</span><br><span class="line">## gene_3    13.3333       100</span><br><span class="line">## gene_4    16.6667       100</span><br><span class="line">## gene_5    18.0000       100</span><br><span class="line">## gene_6    17.0000       100</span><br><span class="line">## gene_7    16.0000       100</span><br><span class="line">## gene_8    18.3333       100</span><br><span class="line">## gene_9    16.3333       100</span><br><span class="line">## gene_10   15.0000       100</span><br></pre></td></tr></table></figure></li><li><p><code>rowRanges</code>：也是基因相关，但是它是GRange对象，存储了基因坐标信息，例如染色体信息、起始终点坐标</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rowRanges(sce) <span class="comment"># empty</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">## GRangesList object of length 10:</span><br><span class="line">## $gene_1</span><br><span class="line">## GRanges object with 0 ranges and 0 metadata columns:</span><br><span class="line">##    seqnames    ranges strand</span><br><span class="line">##       &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt;</span><br><span class="line">##   -------</span><br><span class="line">##   seqinfo: no sequences</span><br><span class="line">## </span><br><span class="line">## $gene_2</span><br><span class="line">## GRanges object with 0 ranges and 0 metadata columns:</span><br><span class="line">##    seqnames    ranges strand</span><br><span class="line">##       &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt;</span><br><span class="line">##   -------</span><br><span class="line">##   seqinfo: no sequences</span><br><span class="line">## </span><br><span class="line">## $gene_3</span><br><span class="line">## GRanges object with 0 ranges and 0 metadata columns:</span><br><span class="line">##    seqnames    ranges strand</span><br><span class="line">##       &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt;</span><br><span class="line">##   -------</span><br><span class="line">##   seqinfo: no sequences</span><br><span class="line">## </span><br><span class="line">## ...</span><br><span class="line">## &lt;7 more elements&gt;</span><br></pre></td></tr></table></figure></li></ul><p>同样类似于数据框，可以按位置、名称取子集：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sce[c(<span class="string">&quot;gene_1&quot;</span>, <span class="string">&quot;gene_4&quot;</span>), ]</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">## class: SingleCellExperiment </span><br><span class="line">## dim: 2 3 </span><br><span class="line">## metadata(0):</span><br><span class="line">## assays(1): counts</span><br><span class="line">## rownames(2): gene_1 gene_4</span><br><span class="line">## rowData names(2): mean detected</span><br><span class="line">## colnames(3): cell_1 cell_2 cell_3</span><br><span class="line">## colData names(9): batch sum ... total more_stuff</span><br><span class="line">## reducedDimNames(0):</span><br><span class="line">## altExpNames(0):</span><br></pre></td></tr></table></figure><h3 id="other-metadata">Other metadata</h3><h4 id="metadata-信息"><code>metadata</code> 信息</h4><p>除了以上介绍的，还有一些重要的元数据信息需要储存，这些可以用<code>metadata</code>来表示</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">my_genes &lt;- c(<span class="string">&quot;gene_1&quot;</span>, <span class="string">&quot;gene_5&quot;</span>)</span><br><span class="line">metadata(sce) &lt;- list(favorite_genes = my_genes)</span><br><span class="line">metadata(sce)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## $favorite_genes</span><br><span class="line">## [1] &quot;gene_1&quot; &quot;gene_5&quot;</span><br></pre></td></tr></table></figure><p>我们可以用<code>$</code>对其进行扩展</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">your_genes &lt;- c(<span class="string">&quot;gene_4&quot;</span>, <span class="string">&quot;gene_8&quot;</span>)</span><br><span class="line">metadata(sce)$your_genes &lt;- your_genes</span><br><span class="line">metadata(sce)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">## $favorite_genes</span><br><span class="line">## [1] &quot;gene_1&quot; &quot;gene_5&quot;</span><br><span class="line">## </span><br><span class="line">## $your_genes</span><br><span class="line">## [1] &quot;gene_4&quot; &quot;gene_8&quot;</span><br></pre></td></tr></table></figure><h4 id="对样本进行归一化sizefactors">对样本进行归一化：<code>sizeFactors</code></h4><p>这里面装了根据样本文库计算的文库大小因子，是一个数值型向量，用于后面的归一化</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sce &lt;- scran::computeSumFactors(sce)</span><br><span class="line">sizeFactors(sce)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## [1] 0.5272727 0.5878788 1.8848485</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 手动添加</span></span><br><span class="line">sizeFactors(sce) &lt;- scater::librarySizeFactors(sce)</span><br><span class="line">sizeFactors(sce)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">##    cell_1    cell_2    cell_3 </span><br><span class="line">## 0.5272727 0.5878788 1.8848485</span><br></pre></td></tr></table></figure><p>前面提到的：<code>assays</code> (primary data), <code>colData</code> (sample metadata),<code>rowData</code>/<code>rowRanges</code> (feature metadata), and <code>sizeFactors</code> 。其实这其中前三个都来自于<code>SummarizedExperiment</code>这个对象。还有一些基于<code>SummarizedExperiment</code>计算得到的信息同样可以一起储存在<code>SummarizedExperiment</code>对象当中。</p><h4 id="降维结果reduceddims">降维结果：<code>reducedDims</code></h4><p>存储了原始矩阵的降维结果，可以通过PCA、tSNE、UMAP等得到，它是一个数值型矩阵的list，行名是原来矩阵的列名（就是细胞、样本），它的列就是各种维度信息</p><p>它和<code>assays</code>一样，也可以包含许多降维的结果，例如用<code>scater</code>包计算PCA：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sce &lt;- scater::logNormCounts(sce)</span><br><span class="line">sce &lt;- scater::runPCA(sce)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## Warning in check_numbers(k &#x3D; k, nu &#x3D; nu, nv &#x3D; nv, limit &#x3D; min(dim(x)) - : more singular</span><br><span class="line">## values&#x2F;vectors requested than available</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## Warning in (function (A, nv &#x3D; 5, nu &#x3D; nv, maxit &#x3D; 1000, work &#x3D; nv + 7, reorth &#x3D; TRUE, : You&#39;re</span><br><span class="line">## computing too large a percentage of total singular values, use a standard svd instead.</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reducedDim(sce, <span class="string">&quot;PCA&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">##              PC1        PC2</span><br><span class="line">## cell_1 -0.792842 -0.6994112</span><br><span class="line">## cell_2  1.113535 -0.2302468</span><br><span class="line">## cell_3 -0.320693  0.9296580</span><br><span class="line">## attr(,&quot;percentVar&quot;)</span><br><span class="line">## [1] 58.36254 41.63746</span><br><span class="line">## attr(,&quot;rotation&quot;)</span><br><span class="line">##                   PC1         PC2</span><br><span class="line">## gene_4   0.5826349629  0.28228727</span><br><span class="line">## gene_7  -0.4778380724  0.30732611</span><br><span class="line">## gene_8  -0.3790515744  0.41216988</span><br><span class="line">## gene_2   0.0818326382  0.51529505</span><br><span class="line">## gene_6   0.4106910258  0.03126769</span><br><span class="line">## gene_5  -0.2856972185 -0.23213641</span><br><span class="line">## gene_9  -0.1228230993 -0.35271423</span><br><span class="line">## gene_3  -0.0002291474 -0.31414168</span><br><span class="line">## gene_10  0.1263935133 -0.24605811</span><br><span class="line">## gene_1  -0.0219019212 -0.22792469</span><br></pre></td></tr></table></figure><p>除了PCA，tSNE的结果也是存储在这里：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sce &lt;- scater::runTSNE(sce, perplexity = <span class="number">0.1</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## Perplexity should be lower than K!</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reducedDim(sce, <span class="string">&quot;TSNE&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">##             [,1]       [,2]</span><br><span class="line">## cell_1  2121.516 -5285.0599</span><br><span class="line">## cell_2  3516.243  4479.8174</span><br><span class="line">## cell_3 -5637.759   805.2426</span><br></pre></td></tr></table></figure><p>查看下全部的结果都包含什么：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reducedDims(sce)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## List of length 2</span><br><span class="line">## names(2): PCA TSNE</span><br></pre></td></tr></table></figure><p><strong>调取方法也十分类似</strong>：<code>assay</code>，数据矩阵存储在<code>assays</code>，而调用是<code>assay</code>；这里的降维结果存储在<code>reducedDims</code>，调用是<code>reducedDim</code></p><p>同样的这些信息可以通过其他包计算后直接添加到对象中</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">u &lt;- uwot::umap(t(logcounts(sce)), n_neighbors = <span class="number">2</span>)</span><br><span class="line">reducedDim(sce, <span class="string">&quot;UMAP_uwot&quot;</span>) &lt;- u</span><br><span class="line">reducedDims(sce)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## List of length 3</span><br><span class="line">## names(3): PCA TSNE UMAP_uwot</span><br></pre></td></tr></table></figure><h4 id="对列添加label">对列添加label</h4><p>使用<code>colLabels()</code> ，尤其在非监督聚类过程中对细胞添加label，进行分组</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">colLabels(sce) &lt;- LETTERS[<span class="number">1</span>:<span class="number">3</span>]</span><br><span class="line">colLabels(sce)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## [1] &quot;A&quot; &quot;B&quot; &quot;C&quot;</span><br></pre></td></tr></table></figure><p>例如<code>scran::findMarkers</code>就是通过<code>colLabels()</code>来提取细胞信息的</p><hr /><h4 id="reference">Reference</h4><p><a href="https://osca.bioconductor.org/">Orchestrating Single-Cell Analysis with Bioconductor</a></p>]]></content>
      
      
      <categories>
          
          <category> SingleCell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SingleCell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>R 语言统计检验函数汇总</title>
      <link href="2020/07/31/r-stats/"/>
      <url>2020/07/31/r-stats/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="连续型数据">连续型数据</h2><h3 id="基于分布的检验">基于分布的检验</h3><h4 id="t检验">T检验</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t.test(<span class="number">1</span>:<span class="number">10</span>, <span class="number">10</span>:<span class="number">20</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">## </span><br><span class="line">## Welch Two Sample t-test</span><br><span class="line">## </span><br><span class="line">## data:  1:10 and 10:20</span><br><span class="line">## t &#x3D; -7, df &#x3D; 19, p-value &#x3D; 2e-06</span><br><span class="line">## alternative hypothesis: true difference in means is not equal to 0</span><br><span class="line">## 95 percent confidence interval:</span><br><span class="line">##  -12.4  -6.6</span><br><span class="line">## sample estimates:</span><br><span class="line">## mean of x mean of y </span><br><span class="line">##       5.5      15.0</span><br></pre></td></tr></table></figure><p>配对 t 检验：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t.test(rnorm(<span class="number">10</span>), rnorm(<span class="number">10</span>, mean = <span class="number">1</span>), paired = <span class="literal">TRUE</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">## </span><br><span class="line">## Paired t-test</span><br><span class="line">## </span><br><span class="line">## data:  rnorm(10) and rnorm(10, mean &#x3D; 1)</span><br><span class="line">## t &#x3D; -2, df &#x3D; 9, p-value &#x3D; 0.03</span><br><span class="line">## alternative hypothesis: true difference in means is not equal to 0</span><br><span class="line">## 95 percent confidence interval:</span><br><span class="line">##  -1.981 -0.096</span><br><span class="line">## sample estimates:</span><br><span class="line">## mean of the differences </span><br><span class="line">##                   -1.04</span><br></pre></td></tr></table></figure><p>使用公式表示：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">df &lt;- data.frame(</span><br><span class="line">  value = c(rnorm(<span class="number">10</span>), rnorm(<span class="number">10</span>, mean = <span class="number">1</span>)),</span><br><span class="line">  group = c(rep(<span class="string">&quot;case&quot;</span>, <span class="number">10</span>), rep(<span class="string">&quot;control&quot;</span>, <span class="number">10</span>))</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">t.test(value ~ group, data = df)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">## </span><br><span class="line">## Welch Two Sample t-test</span><br><span class="line">## </span><br><span class="line">## data:  value by group</span><br><span class="line">## t &#x3D; -0.7, df &#x3D; 18, p-value &#x3D; 0.5</span><br><span class="line">## alternative hypothesis: true difference in means is not equal to 0</span><br><span class="line">## 95 percent confidence interval:</span><br><span class="line">##  -0.933  0.447</span><br><span class="line">## sample estimates:</span><br><span class="line">##    mean in group case mean in group control </span><br><span class="line">##                 0.539                 0.782</span><br></pre></td></tr></table></figure><p>假设方差同质化：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t.test(value ~ group, data = df, var.equal = <span class="literal">TRUE</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">## </span><br><span class="line">## Two Sample t-test</span><br><span class="line">## </span><br><span class="line">## data:  value by group</span><br><span class="line">## t &#x3D; -0.7, df &#x3D; 18, p-value &#x3D; 0.5</span><br><span class="line">## alternative hypothesis: true difference in means is not equal to 0</span><br><span class="line">## 95 percent confidence interval:</span><br><span class="line">##  -0.933  0.447</span><br><span class="line">## sample estimates:</span><br><span class="line">##    mean in group case mean in group control </span><br><span class="line">##                 0.539                 0.782</span><br></pre></td></tr></table></figure><h4 id="总体方差比较">总体方差比较</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var.test(value ~ group, data = df)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">## </span><br><span class="line">## F test to compare two variances</span><br><span class="line">## </span><br><span class="line">## data:  value by group</span><br><span class="line">## F &#x3D; 0.8, num df &#x3D; 9, denom df &#x3D; 9, p-value &#x3D; 0.8</span><br><span class="line">## alternative hypothesis: true ratio of variances is not equal to 1</span><br><span class="line">## 95 percent confidence interval:</span><br><span class="line">##  0.202 3.269</span><br><span class="line">## sample estimates:</span><br><span class="line">## ratio of variances </span><br><span class="line">##              0.812</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bartlett.test(value ~ group, data = df)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">## </span><br><span class="line">## Bartlett test of homogeneity of variances</span><br><span class="line">## </span><br><span class="line">## data:  value by group</span><br><span class="line">## Bartlett&#39;s K-squared &#x3D; 0.09, df &#x3D; 1, p-value &#x3D; 0.8</span><br></pre></td></tr></table></figure><h4 id="多个组间均值的比较">多个组间均值的比较</h4><p>两组以上的比较要使用ANOVA</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aov(wt ~ factor(cyl), data = mtcars)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">## Call:</span><br><span class="line">##    aov(formula &#x3D; wt ~ factor(cyl), data &#x3D; mtcars)</span><br><span class="line">## </span><br><span class="line">## Terms:</span><br><span class="line">##                 factor(cyl) Residuals</span><br><span class="line">## Sum of Squares         18.2      11.5</span><br><span class="line">## Deg. of Freedom           2        29</span><br><span class="line">## </span><br><span class="line">## Residual standard error: 0.63</span><br><span class="line">## Estimated effects may be unbalanced</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 查看详细的信息</span></span><br><span class="line">model.tables(aov(wt ~ factor(cyl), data = mtcars))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">## Tables of effects</span><br><span class="line">## </span><br><span class="line">##  factor(cyl) </span><br><span class="line">##           4       6      8</span><br><span class="line">##     -0.9315 -0.1001  0.782</span><br><span class="line">## rep 11.0000  7.0000 14.000</span><br></pre></td></tr></table></figure><p>ANOVA 分析假设各组样本数据的方差是相等的，如果知道（或怀疑）不相等，可以使用 <code>oneway.test()</code> 函数。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oneway.test(wt ~ cyl, data = mtcars)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">## </span><br><span class="line">## One-way analysis of means (not assuming equal variances)</span><br><span class="line">## </span><br><span class="line">## data:  wt and cyl</span><br><span class="line">## F &#x3D; 20, num df &#x3D; 2, denom df &#x3D; 19, p-value &#x3D; 2e-05</span><br></pre></td></tr></table></figure><h4 id="多组样本的配对-t-检验">多组样本的配对 t 检验</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pairwise.t.test(mtcars$wt, mtcars$cyl)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">## </span><br><span class="line">## Pairwise comparisons using t tests with pooled SD </span><br><span class="line">## </span><br><span class="line">## data:  mtcars$wt and mtcars$cyl </span><br><span class="line">## </span><br><span class="line">##   4     6   </span><br><span class="line">## 6 0.01  -   </span><br><span class="line">## 8 6e-07 0.01</span><br><span class="line">## </span><br><span class="line">## P value adjustment method: holm</span><br></pre></td></tr></table></figure><h4 id="正态性检验">正态性检验</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shapiro.test(rnorm(<span class="number">30</span>))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">## </span><br><span class="line">## Shapiro-Wilk normality test</span><br><span class="line">## </span><br><span class="line">## data:  rnorm(30)</span><br><span class="line">## W &#x3D; 1, p-value &#x3D; 0.6</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qqnorm(rnorm(<span class="number">30</span>))</span><br></pre></td></tr></table></figure><p><img src="/images/r-stats/Rplot.png" /></p><h4 id="分布的对称性检验">分布的对称性检验</h4><p>用 Kolmogorov-Smirnov 检验查看一个向量是否来自一个对称的分布（不限于正态分布）。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ks.test(rnorm(<span class="number">10</span>), pnorm)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">## </span><br><span class="line">## One-sample Kolmogorov-Smirnov test</span><br><span class="line">## </span><br><span class="line">## data:  rnorm(10)</span><br><span class="line">## D &#x3D; 0.3, p-value &#x3D; 0.2</span><br><span class="line">## alternative hypothesis: two-sided</span><br></pre></td></tr></table></figure><blockquote><p>函数第 1 个参数指定待检验的数据，第 2个参数指定对称分布的类型，可以是数值型向量、指定概率分布函数的字符串或一个分布函数。</p></blockquote><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ks.test(rnorm(<span class="number">10</span>), <span class="string">&quot;pnorm&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">## </span><br><span class="line">## One-sample Kolmogorov-Smirnov test</span><br><span class="line">## </span><br><span class="line">## data:  rnorm(10)</span><br><span class="line">## D &#x3D; 0.3, p-value &#x3D; 0.3</span><br><span class="line">## alternative hypothesis: two-sided</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ks.test(rpois(<span class="number">10</span>, lambda = <span class="number">1</span>), <span class="string">&quot;pnorm&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## Warning in ks.test(rpois(10, lambda &#x3D; 1), &quot;pnorm&quot;): ties should not be present for the</span><br><span class="line">## Kolmogorov-Smirnov test</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">## </span><br><span class="line">## One-sample Kolmogorov-Smirnov test</span><br><span class="line">## </span><br><span class="line">## data:  rpois(10, lambda &#x3D; 1)</span><br><span class="line">## D &#x3D; 0.5, p-value &#x3D; 0.006</span><br><span class="line">## alternative hypothesis: two-sided</span><br></pre></td></tr></table></figure><h4 id="检验两个向量是否服从同一分布">检验两个向量是否服从同一分布</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ks.test(rnorm(<span class="number">20</span>), rnorm(<span class="number">30</span>))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">## </span><br><span class="line">## Two-sample Kolmogorov-Smirnov test</span><br><span class="line">## </span><br><span class="line">## data:  rnorm(20) and rnorm(30)</span><br><span class="line">## D &#x3D; 0.2, p-value &#x3D; 0.4</span><br><span class="line">## alternative hypothesis: two-sided</span><br></pre></td></tr></table></figure><h4 id="相关性分析">相关性分析</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cor.test(mtcars$mpg, mtcars$wt)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">## </span><br><span class="line">## Pearson&#39;s product-moment correlation</span><br><span class="line">## </span><br><span class="line">## data:  mtcars$mpg and mtcars$wt</span><br><span class="line">## t &#x3D; -10, df &#x3D; 30, p-value &#x3D; 1e-10</span><br><span class="line">## alternative hypothesis: true correlation is not equal to 0</span><br><span class="line">## 95 percent confidence interval:</span><br><span class="line">##  -0.934 -0.744</span><br><span class="line">## sample estimates:</span><br><span class="line">##    cor </span><br><span class="line">## -0.868</span><br></pre></td></tr></table></figure><h3 id="不依赖分布的检验">不依赖分布的检验</h3><h4 id="均值检验">均值检验</h4><p>Wilcoxon 检验是 t 检验的非参数版本</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 秩和检验</span></span><br><span class="line">wilcox.test(<span class="number">1</span>:<span class="number">10</span>, <span class="number">10</span>:<span class="number">20</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## Warning in wilcox.test.default(1:10, 10:20): cannot compute exact p-value with ties</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">## </span><br><span class="line">## Wilcoxon rank sum test with continuity correction</span><br><span class="line">## </span><br><span class="line">## data:  1:10 and 10:20</span><br><span class="line">## W &#x3D; 0.5, p-value &#x3D; 1e-04</span><br><span class="line">## alternative hypothesis: true location shift is not equal to 0</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 符号秩检验</span></span><br><span class="line">wilcox.test(<span class="number">1</span>:<span class="number">10</span>, <span class="number">10</span>:<span class="number">19</span>, paired = <span class="literal">TRUE</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## Warning in wilcox.test.default(1:10, 10:19, paired &#x3D; TRUE): cannot compute exact p-value with</span><br><span class="line">## ties</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">## </span><br><span class="line">## Wilcoxon signed rank test with continuity correction</span><br><span class="line">## </span><br><span class="line">## data:  1:10 and 10:19</span><br><span class="line">## V &#x3D; 0, p-value &#x3D; 0.002</span><br><span class="line">## alternative hypothesis: true location shift is not equal to 0</span><br></pre></td></tr></table></figure><h4 id="多均值比较">多均值比较</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Kruskal-Wallis 秩和检验</span></span><br><span class="line">kruskal.test(wt ~ factor(cyl), data = mtcars)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">## </span><br><span class="line">## Kruskal-Wallis rank sum test</span><br><span class="line">## </span><br><span class="line">## data:  wt by factor(cyl)</span><br><span class="line">## Kruskal-Wallis chi-squared &#x3D; 23, df &#x3D; 2, p-value &#x3D; 1e-05</span><br></pre></td></tr></table></figure><h4 id="方差检验">方差检验</h4><p>使用Fligner-Killeen（中位数）检验完成不同组别的方差比较</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fligner.test(wt ~ cyl, data = mtcars)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">## </span><br><span class="line">## Fligner-Killeen test of homogeneity of variances</span><br><span class="line">## </span><br><span class="line">## data:  wt by cyl</span><br><span class="line">## Fligner-Killeen:med chi-squared &#x3D; 0.5, df &#x3D; 2, p-value &#x3D; 0.8</span><br></pre></td></tr></table></figure><h2 id="离散数据">离散数据</h2><h3 id="比例检验">比例检验</h3><p>使用 <code>prop.test()</code> 比较两组观测值发生的概率是否有差异。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">heads &lt;- rbinom(<span class="number">1</span>, size = <span class="number">100</span>, prob = <span class="number">.5</span>)</span><br><span class="line">prop.test(heads, <span class="number">100</span>)  </span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">## </span><br><span class="line">## 1-sample proportions test with continuity correction</span><br><span class="line">## </span><br><span class="line">## data:  heads out of 100, null probability 0.5</span><br><span class="line">## X-squared &#x3D; 2, df &#x3D; 1, p-value &#x3D; 0.1</span><br><span class="line">## alternative hypothesis: true p is not equal to 0.5</span><br><span class="line">## 95 percent confidence interval:</span><br><span class="line">##  0.477 0.677</span><br><span class="line">## sample estimates:</span><br><span class="line">##    p </span><br><span class="line">## 0.58</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">prop.test(heads, <span class="number">100</span>, p = <span class="number">0.3</span>, correct = <span class="literal">FALSE</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">## </span><br><span class="line">## 1-sample proportions test without continuity correction</span><br><span class="line">## </span><br><span class="line">## data:  heads out of 100, null probability 0.3</span><br><span class="line">## X-squared &#x3D; 37, df &#x3D; 1, p-value &#x3D; 1e-09</span><br><span class="line">## alternative hypothesis: true p is not equal to 0.3</span><br><span class="line">## 95 percent confidence interval:</span><br><span class="line">##  0.482 0.672</span><br><span class="line">## sample estimates:</span><br><span class="line">##    p </span><br><span class="line">## 0.58</span><br></pre></td></tr></table></figure><h3 id="二项式检验">二项式检验</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">binom.test(c(<span class="number">682</span>, <span class="number">243</span>), p = <span class="number">3</span>/<span class="number">4</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">## </span><br><span class="line">## Exact binomial test</span><br><span class="line">## </span><br><span class="line">## data:  c(682, 243)</span><br><span class="line">## number of successes &#x3D; 682, number of trials &#x3D; 925, p-value &#x3D; 0.4</span><br><span class="line">## alternative hypothesis: true probability of success is not equal to 0.75</span><br><span class="line">## 95 percent confidence interval:</span><br><span class="line">##  0.708 0.765</span><br><span class="line">## sample estimates:</span><br><span class="line">## probability of success </span><br><span class="line">##                  0.737</span><br></pre></td></tr></table></figure><h3 id="列联表">列联表</h3><p>确定两个分类变量是否相关</p><h4 id="fisher精确检验">Fisher精确检验</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">TeaTasting &lt;-</span><br><span class="line">matrix(c(<span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>),</span><br><span class="line">       nrow = <span class="number">2</span>,</span><br><span class="line">       dimnames = list(Guess = c(<span class="string">&quot;Milk&quot;</span>, <span class="string">&quot;Tea&quot;</span>),</span><br><span class="line">                       Truth = c(<span class="string">&quot;Milk&quot;</span>, <span class="string">&quot;Tea&quot;</span>)))</span><br><span class="line">fisher.test(TeaTasting, alternative = <span class="string">&quot;greater&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">## </span><br><span class="line">## Fisher&#39;s Exact Test for Count Data</span><br><span class="line">## </span><br><span class="line">## data:  TeaTasting</span><br><span class="line">## p-value &#x3D; 0.2</span><br><span class="line">## alternative hypothesis: true odds ratio is greater than 1</span><br><span class="line">## 95 percent confidence interval:</span><br><span class="line">##  0.314   Inf</span><br><span class="line">## sample estimates:</span><br><span class="line">## odds ratio </span><br><span class="line">##       6.41</span><br></pre></td></tr></table></figure><p>当样本数比较多时，使用卡方检验代替</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chisq.test(TeaTasting)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## Warning in chisq.test(TeaTasting): Chi-squared approximation may be incorrect</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">## </span><br><span class="line">## Pearson&#39;s Chi-squared test with Yates&#39; continuity correction</span><br><span class="line">## </span><br><span class="line">## data:  TeaTasting</span><br><span class="line">## X-squared &#x3D; 0.5, df &#x3D; 1, p-value &#x3D; 0.5</span><br></pre></td></tr></table></figure><p>对于三变量的混合影响，使用 Cochran-Mantel-Haenszel 检验。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Rabbits &lt;-</span><br><span class="line">array(c(<span class="number">0</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">5</span>,</span><br><span class="line">        <span class="number">3</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">6</span>,</span><br><span class="line">        <span class="number">6</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">4</span>,</span><br><span class="line">        <span class="number">5</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line">        <span class="number">2</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">      dim = c(<span class="number">2</span>, <span class="number">2</span>, <span class="number">5</span>),</span><br><span class="line">      dimnames = list(</span><br><span class="line">          Delay = c(<span class="string">&quot;None&quot;</span>, <span class="string">&quot;1.5h&quot;</span>),</span><br><span class="line">          Response = c(<span class="string">&quot;Cured&quot;</span>, <span class="string">&quot;Died&quot;</span>),</span><br><span class="line">          Penicillin.Level = c(<span class="string">&quot;1/8&quot;</span>, <span class="string">&quot;1/4&quot;</span>, <span class="string">&quot;1/2&quot;</span>, <span class="string">&quot;1&quot;</span>, <span class="string">&quot;4&quot;</span>)))</span><br><span class="line">Rabbits</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">## , , Penicillin.Level &#x3D; 1&#x2F;8</span><br><span class="line">## </span><br><span class="line">##       Response</span><br><span class="line">## Delay  Cured Died</span><br><span class="line">##   None     0    6</span><br><span class="line">##   1.5h     0    5</span><br><span class="line">## </span><br><span class="line">## , , Penicillin.Level &#x3D; 1&#x2F;4</span><br><span class="line">## </span><br><span class="line">##       Response</span><br><span class="line">## Delay  Cured Died</span><br><span class="line">##   None     3    3</span><br><span class="line">##   1.5h     0    6</span><br><span class="line">## </span><br><span class="line">## , , Penicillin.Level &#x3D; 1&#x2F;2</span><br><span class="line">## </span><br><span class="line">##       Response</span><br><span class="line">## Delay  Cured Died</span><br><span class="line">##   None     6    0</span><br><span class="line">##   1.5h     2    4</span><br><span class="line">## </span><br><span class="line">## , , Penicillin.Level &#x3D; 1</span><br><span class="line">## </span><br><span class="line">##       Response</span><br><span class="line">## Delay  Cured Died</span><br><span class="line">##   None     5    1</span><br><span class="line">##   1.5h     6    0</span><br><span class="line">## </span><br><span class="line">## , , Penicillin.Level &#x3D; 4</span><br><span class="line">## </span><br><span class="line">##       Response</span><br><span class="line">## Delay  Cured Died</span><br><span class="line">##   None     2    0</span><br><span class="line">##   1.5h     5    0</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mantelhaen.test(Rabbits)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">## </span><br><span class="line">## Mantel-Haenszel chi-squared test with continuity correction</span><br><span class="line">## </span><br><span class="line">## data:  Rabbits</span><br><span class="line">## Mantel-Haenszel X-squared &#x3D; 4, df &#x3D; 1, p-value &#x3D; 0.05</span><br><span class="line">## alternative hypothesis: true common odds ratio is not equal to 1</span><br><span class="line">## 95 percent confidence interval:</span><br><span class="line">##   1.03 47.73</span><br><span class="line">## sample estimates:</span><br><span class="line">## common odds ratio </span><br><span class="line">##                 7</span><br></pre></td></tr></table></figure><h4 id="列联表非参数检验">列联表非参数检验</h4><p>Friedman 秩和检验是一个非参数版本的双边 ANOVA 检验。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Hollander &amp; Wolfe (1973), p. 140ff.</span></span><br><span class="line"><span class="comment">## Comparison of three methods (&quot;round out&quot;, &quot;narrow angle&quot;, and</span></span><br><span class="line"><span class="comment">##  &quot;wide angle&quot;) for rounding first base.  For each of 18 players</span></span><br><span class="line"><span class="comment">##  and the three method, the average time of two runs from a point on</span></span><br><span class="line"><span class="comment">##  the first base line 35ft from home plate to a point 15ft short of</span></span><br><span class="line"><span class="comment">##  second base is recorded.</span></span><br><span class="line">RoundingTimes &lt;-</span><br><span class="line">matrix(c(<span class="number">5.40</span>, <span class="number">5.50</span>, <span class="number">5.55</span>,</span><br><span class="line">         <span class="number">5.85</span>, <span class="number">5.70</span>, <span class="number">5.75</span>,</span><br><span class="line">         <span class="number">5.20</span>, <span class="number">5.60</span>, <span class="number">5.50</span>,</span><br><span class="line">         <span class="number">5.55</span>, <span class="number">5.50</span>, <span class="number">5.40</span>,</span><br><span class="line">         <span class="number">5.90</span>, <span class="number">5.85</span>, <span class="number">5.70</span>,</span><br><span class="line">         <span class="number">5.45</span>, <span class="number">5.55</span>, <span class="number">5.60</span>,</span><br><span class="line">         <span class="number">5.40</span>, <span class="number">5.40</span>, <span class="number">5.35</span>,</span><br><span class="line">         <span class="number">5.45</span>, <span class="number">5.50</span>, <span class="number">5.35</span>,</span><br><span class="line">         <span class="number">5.25</span>, <span class="number">5.15</span>, <span class="number">5.00</span>,</span><br><span class="line">         <span class="number">5.85</span>, <span class="number">5.80</span>, <span class="number">5.70</span>,</span><br><span class="line">         <span class="number">5.25</span>, <span class="number">5.20</span>, <span class="number">5.10</span>,</span><br><span class="line">         <span class="number">5.65</span>, <span class="number">5.55</span>, <span class="number">5.45</span>,</span><br><span class="line">         <span class="number">5.60</span>, <span class="number">5.35</span>, <span class="number">5.45</span>,</span><br><span class="line">         <span class="number">5.05</span>, <span class="number">5.00</span>, <span class="number">4.95</span>,</span><br><span class="line">         <span class="number">5.50</span>, <span class="number">5.50</span>, <span class="number">5.40</span>,</span><br><span class="line">         <span class="number">5.45</span>, <span class="number">5.55</span>, <span class="number">5.50</span>,</span><br><span class="line">         <span class="number">5.55</span>, <span class="number">5.55</span>, <span class="number">5.35</span>,</span><br><span class="line">         <span class="number">5.45</span>, <span class="number">5.50</span>, <span class="number">5.55</span>,</span><br><span class="line">         <span class="number">5.50</span>, <span class="number">5.45</span>, <span class="number">5.25</span>,</span><br><span class="line">         <span class="number">5.65</span>, <span class="number">5.60</span>, <span class="number">5.40</span>,</span><br><span class="line">         <span class="number">5.70</span>, <span class="number">5.65</span>, <span class="number">5.55</span>,</span><br><span class="line">         <span class="number">6.30</span>, <span class="number">6.30</span>, <span class="number">6.25</span>),</span><br><span class="line">       nrow = <span class="number">22</span>,</span><br><span class="line">       byrow = <span class="literal">TRUE</span>,</span><br><span class="line">       dimnames = list(<span class="number">1</span> : <span class="number">22</span>,</span><br><span class="line">                       c(<span class="string">&quot;Round Out&quot;</span>, <span class="string">&quot;Narrow Angle&quot;</span>, <span class="string">&quot;Wide Angle&quot;</span>)))</span><br><span class="line">friedman.test(RoundingTimes)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">## </span><br><span class="line">## Friedman rank sum test</span><br><span class="line">## </span><br><span class="line">## data:  RoundingTimes</span><br><span class="line">## Friedman chi-squared &#x3D; 11, df &#x3D; 2, p-value &#x3D; 0.004</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stats </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>R Docker tutorial</title>
      <link href="2020/07/31/r-docker-tutorial/"/>
      <url>2020/07/31/r-docker-tutorial/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><p>这是专门为具有 R 和 RStudio 知识的朋友设计的 Docker 教程。该介绍旨在帮助需要 Docker 进行项目的人们。我们首先解释 Docker 是什么以及为什么有用。然后，我们将详细介绍如何将其用于可复制的分析项目。</p><h2 id="开始之前">开始之前</h2><p>在开始之前，请根据下面的指南安装需要的Docker：</p><ul><li><a href="https://docs.docker.com/mac/step_one/">mac</a><br /></li><li><a href="https://docs.docker.com/linux/step_one/">linux</a><br /></li><li><a href="https://docs.docker.com/windows/step_one/">windows</a></li></ul><h2 id="什么是-docker为什么我要使用它">什么是 Docker？为什么我要使用它？</h2><h3 id="学习目标">学习目标</h3><ul><li>理解 Docker 的基本思想<br /></li><li>了解为什么 Docker 非常有用</li></ul><h3 id="为什么要使用docker">为什么要使用Docker</h3><p>想象一下，你正在 R 中进行分析，然后将代码发送给朋友。你的朋友在完全相同的数据集上运行此代码，但结果略有不同。这可能有多种原因，例如操作系统不同，R 软件包的版本不同等。Docker 可以解决这样的问题。</p><p><strong>可以将Docker容器视为你计算机内部的一台计算机</strong>。这个虚拟计算机的妙处在于你可以将其发送给你的朋友。当他们启动计算机并运行你的代码时，他们将获得与你完全相同的结果。</p><p><img src="/images/r-docker-tutorial/computerception.jfif" /></p><p>简单来说，你因为下面的一些原因使用 Docker：</p><ul><li>它允许你解决从操作系统到R或latex版本上的依赖<br /></li><li>它使你的分析可重复</li></ul><p>还有一些 Docker 可以发挥用处的地方：</p><ul><li>可移植性：由于 Docker 容器可以轻松地发送到另一台机器，因此你可以在自己的计算机上设置好所有内容，然后在更强大的机器上运行分析。<br /></li><li>可共享性：你可以将 Docker 容器发送给任何知道如何使用 Docker 的人。</li></ul><h3 id="基本词汇">基本词汇</h3><p>下面会经常出现<strong>镜像</strong>和<strong>容器</strong>这两个词。镜像的实例称为容器。镜像是虚拟计算机的设置。如果运行此镜像，将拥有它的一个实例，我们将其称为容器。可以有多个运行相同镜像的容器。</p><h2 id="在-docker-中启动-rstudio">在 Docker 中启动 RStudio</h2><h3 id="学习目标-1">学习目标</h3><ul><li>在 Docker 中启动 RStudio<br /></li><li>将磁盘与 Docker 镜像链接<br /></li><li>载入容器</li></ul><h3 id="安装">安装</h3><p>首先参考 <a href="https://docs.docker.com/get-started/">install Docker</a> 进行安装，没有必要完成链接中所有的教程，有需要再回看它们。</p><h3 id="在-docker-中启动-rstudio-1">在 Docker 中启动 RStudio</h3><p>要启动 Docker，我们需要做的第一件事是打开一个 <code>Unix Shell</code>。如果你在<code>Mac</code>或<code>Windows</code> 上，在最后一步，你安装了一个叫<em>Docker快速启动终端</em>;现在打开它——它看起来应该像一个普通的 shell 提示符(<code>~$</code>)，但实际上它指向的是一个 Docker 默认运行的 linux 虚拟机，而在本教程的其余部分，除非另有说明，你应该在这里完成所有操作。如果您在 linux 机器上，那么您可以使用旧的终端提示符。</p><p>在 <code>Mac</code>上，你也可以选择你的终端并配置 Docker使用。特别是如果你得到错误，不能连接到Docker守护进程。Docker 守护进程是否在此主机上运行?。在教程的某个时候，运行下面的命令可能会解决你的问题:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval &quot;$(docker-machine env default)&quot;</span><br></pre></td></tr></table></figure><p>接下来，我们将让Docker运行一个已经存在的映像，我们会使用来自<a href="https://github.com/rocker-org/rocker/wiki">Rocker</a>的<code>verse</code>Docker镜像。它将允许我们在容器内运行RStudio，并且已经安装了许多有用的R包。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm -p 8787:8787 rocker&#x2F;verse</span><br></pre></td></tr></table></figure><p><code>--rm</code>、<code>-p</code>是允许你自定义如何运行容器的标志。<code>-p</code>告诉 Docker 你将使用一个端口在你的浏览器中看到 RStudio(我们随后指定为端口<code>8787:8787</code>), <code>—rm</code> 确保当我们退出容器时，容器被删除。如果我们不这样做，每次我们运行一个容器，它的一个版本将被保存到我们的本地计算机。这最终会导致大量磁盘空间的浪费，直到我们手动删除这些容器。稍后，我们将向你展示如何保存容器(如果你想这样做的话)。</p><p>如果你尝试运行一个没有在本地安装的 Docker 容器，那么Docker会自动在Docker Hub(一个在线的Docker 镜像存储库)上搜索该容器，如果它存在，就下载它。</p><p>上面的命令将导致 RStudio-Server 不可见地启动。要连接到它，打开一个浏览器，输入<code>http://</code>，然后加上你的 <code>ip</code> 地址，再加上<code>:8787</code>。如果您运行的是 Mac 或 Windows 机器，您将在启动 Docker Quickstart终端时出现在终端中的第一行文本中找到 ip 地址。例如，你应该会看到:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">                        ##         .</span><br><span class="line">                  ## ## ##        &#x3D;&#x3D;</span><br><span class="line">               ## ## ## ## ##    &#x3D;&#x3D;&#x3D;</span><br><span class="line">           &#x2F;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;\___&#x2F; &#x3D;&#x3D;&#x3D;</span><br><span class="line">      ~~~ &#123;~~ ~~~~ ~~~ ~~~~ ~~~ ~ &#x2F;  &#x3D;&#x3D;&#x3D;- ~~~</span><br><span class="line">           \______ o           __&#x2F;</span><br><span class="line">             \    \         __&#x2F;</span><br><span class="line">              \____\_______&#x2F;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker is configured to use the default machine with IP 192.168.99.100</span><br><span class="line">For help getting started, check out the docs at https:&#x2F;&#x2F;docs.docker.com</span><br></pre></td></tr></table></figure><p>你应该在浏览器中键入 URL <code>http://192.168.99.100:8787</code></p><p>如果你在一台 Linux 机器上运行，你可以使用 localhost 作为 ip 地址，例如：<code>http://localhost:8787</code></p><p>这将会将你导向 RStudio 登录界面，使用下面的信息登录：</p><p>username: <code>rstudio</code> password: <code>rstudio</code></p><p>现在你就可以在浏览器中使用 RStudio 工作了，就像你使用 Rstudio 桌面版一样。</p><p>下面是一个截图示例：</p><p><img src="/images/r-docker-tutorial/Rstudio.png" /></p><p>现在尝试查看虚拟计算机的文件(docker容器)。点击<code>File -&gt; Open File</code>,你将看到当前没有文件。原因是这个镜像现在没有文件。然后打开一个新的R脚本，例如：<code>file -&gt; New file -&gt; R Script</code>，然后j键入以下脚本，并保存：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># make x the numbers from 1 to 5, and y the numbers from 6-10</span><br><span class="line">x &lt;- 1:5</span><br><span class="line">y &lt;- 6:10</span><br><span class="line"></span><br><span class="line"># plot x against y</span><br><span class="line">plot(x, y)</span><br></pre></td></tr></table></figure><p>如果您现在再次查看您的文件，您将看到建立的脚本文件。</p><p>因为我们刚才启动镜像时使用了 <code>--rm</code> 标记，所以在这个机器上创建的任何东西在关闭后都会消失。你可以试试将上面的代码保存为一个文件，然后关闭浏览器，在终端上用 <code>Ctrl+C</code> 关掉容器，然后重新启动容器，看是否创建的文件是否依然存在。</p><h3 id="将磁盘与-docker-镜像连接以便于访问和保存数据文件">将磁盘与 Docker 镜像连接以便于访问和保存数据文件</h3><p>这就引出了一个问题，如果在退出容器时删除了容器，我们如何保存我们的工作?一种解决方案是将卷(例如本地硬盘驱动器)链接到容器，这样您就可以访问那里的数据并在那里保存数据。</p><p>这一次当我们启动容器时使用 <code>-v</code> 标记指定我们项目的根目录，如下所示（你的目录可能有所不同），:左边是你本地计算机的路径，右边是容器里的路径，一般以 /home/rstudio/ 开始（这个镜像已经默认创建了用户名 RStudio 和进行了相关配置）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm -p 8787:8787 -v &#x2F;Users&#x2F;tiffanytimbers&#x2F;Documents&#x2F;DC&#x2F;r-docker-tutorial:&#x2F;home&#x2F;rstudio&#x2F;r-docker-tutorial rocker&#x2F;verse</span><br></pre></td></tr></table></figure><p>然后你就可以再一次的在浏览器中打开Rstudio</p><p>这一次你在 Docker 容器中启动 RStudio 后，你可以查看到下面映射的文件目录。然后就可以载入数据进行分析工作了：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># load gapminder data from a csv on your computer</span><br><span class="line">gap5yr &lt;- read.csv(file &#x3D; &#39;data&#x2F;gapminder-FiveYearData.csv&#39;)</span><br></pre></td></tr></table></figure><p>画一个分析图</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># load ggplot library</span><br><span class="line">library(ggplot2)</span><br><span class="line"></span><br><span class="line"># plot GDP against  life expectancy</span><br><span class="line">qplot(gap5yr$lifeExp, gap5yr$gdpPercap)</span><br><span class="line"></span><br><span class="line"># save the plot</span><br><span class="line">ggsave(filename &#x3D; &#39;data&#x2F;GDP_LifeExp.pdf&#39;)</span><br></pre></td></tr></table></figure><p>让我们将脚本保存为 <code>plot_GDP_LifeExp.R</code>，然后关闭容器，看在本地目录下是否能看到脚本和绘图文件。</p><h3 id="小结">小结</h3><p>在这节课中，我们学习了如何启动Docker容器来允许我们在浏览器中运行RStudio。我们知道在运行Docker时使用<code>-rm</code>标志会使容器短暂;这意味着它会在我们关闭容器后被自动删除。我们这样做是为了不在我们的机器上积累大量的容器和浪费空间。我们还了解到，如果我们想访问和保存数据、脚本和任何其他文件，我们可以将笔记本电脑的一个卷连接到Docker容器。</p><p>我们使用的容器已经安装了R、RStudio和几个有用的R包。在后面的课程中，我们将学习如何修改这个容器来安装新的包，以及在哪里可以找到对我们的工作可能有用的其他Docker容器。</p><h2 id="安装-r-包">安装 R 包</h2><h3 id="在-rstudio-内安装-r-包">在 RStudio 内安装 R 包</h3><p>您可以通过使用<code>install.packages()</code>在浏览器中使用RStudio安装R包，就像在桌面RStudio上一样。让我们像以前一样启动一个<code>verse</code> Docker容器来运行RStudio，并尝试安装<code>gapminder</code>包，加载它并查看数据。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># install package</span><br><span class="line">install.packages(&#39;gapminder&#39;)</span><br><span class="line"></span><br><span class="line"># load library</span><br><span class="line">library(gapminder)</span><br><span class="line"></span><br><span class="line"># peek at data</span><br><span class="line">head(gapminder)</span><br></pre></td></tr></table></figure><p>太好了！现在我们已经安装好包并可以进行工作。但是等等，如果我们退出了容器会发生什么？安装的包会被删除，因为我们没有保存这个版本的 Docker 镜像。我们需要创建一个镜像，这样当利用它创建一个新的容器时，<code>gapminder</code> 包也已经安装好了，可以直接使用。</p><p>为了做到这一点，我们需要运行 <code>docker commit</code>（类似 <code>git commit</code>）保存修改。记住，这个操作需要在关闭容器前运行，一般我们另外打开一个终端进行这个操作。</p><p>我们可以使用下面的命令进行查看（类似 linux <code>ps</code> 命令）：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure><p>输出应该类似下面展示，哈希值记录了容器 ID：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4a6a528b35da        rocker&#x2F;verse        &quot;&#x2F;init&quot;             2 minutes ago       Up 2 minutes        0.0.0.0:8787-&gt;8787&#x2F;tcp   silly_meninsky</span><br></pre></td></tr></table></figure><p>现在我们在新的终端中运行下面命令，并记录修改信息：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit -m &quot;verse + gapminder&quot; 4a6a528b35da verse_gapminder</span><br></pre></td></tr></table></figure><p>为了保存这个Docker映像，我们必须提供一个提交消息来描述我们对映像所做的更改。我们通过传递<code>-m</code>标志，后跟引号中的消息来实现这一点。我们还需要为这个版本的容器(这里是<code>4a6a528b35da</code>)提供特定的散列。最后，我们还为新映像提供一个新名称。我们将这个新图像命名为<code>verse_gapminder</code>。</p><p>我们可以看到，我们现在有两个Docker镜像保存在我们的电脑上</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images </span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">REPOSITORY                           TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">verse_gapminder                      latest              bb38976d03cf        57 seconds ago      1.955 GB</span><br><span class="line">rocker&#x2F;verse                         latest              0168d115f220        3 days ago          1.954 GB</span><br></pre></td></tr></table></figure><p>你可以通过从每个映像运行Docker容器来测试它是否工作。您将发现<code>Gapminder</code>包只安装在<code>verse_gapminder</code>映像上，而没有安装在<code>rocker/verse</code>映像上。</p><h3 id="安装-r-系统外部依赖">安装 R 系统外部依赖</h3><p>许多R包都有R外部的依赖关系，例如<code>GSL</code>、<code>GDAL</code>、<code>JAGS</code>等等。要在正在运行的rocker容器上安装这些文件，您需要进入docker命令行(在一个新的终端窗口中)并键入以下命令:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker ps # find the ID of the running container you want to add a package to</span><br><span class="line">docker exec -it &lt;container-id&gt; bash # a docker command to start a bash shell in your container</span><br><span class="line">apt-get install libgsl0-dev # install the package, in this case GSL</span><br></pre></td></tr></table></figure><p>如果您在运行<code>apt-get install libgsl0-dev</code>时报错，尝试先运行<code>apt-get update</code>。</p><p>为了保存安装的依赖，依旧需要进行修改的提交：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit -m &quot;verse + gapminder + GSL&quot; &lt;container id&gt;  verse_gapminder_gsl</span><br></pre></td></tr></table></figure><p>现在，您可以进入输入<code>docker exec</code>命令的终端窗口，并通过输入<code>exit</code>关闭docker容器</p><h2 id="对-docker-hub-推送或拉取镜像">对 Docker Hub 推送或拉取镜像</h2><h3 id="学习目标-2">学习目标</h3><ul><li>理解镜像来自哪里<br /></li><li>从 Docker Hub 拉取镜像<br /></li><li>推送镜像到 Docker Hub</li></ul><h3 id="从-docker-hub-获取镜像">从 Docker Hub 获取镜像</h3><p><a href="https://hub.docker.com/">Docker Hub</a> 是一个存储 Docker 镜像的地方，当我们运行下面的命令时，软件首选检查镜像是否存在于你的计算机上。如果不存在，它会自动去 Docker Hub 搜索和下载。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm -p 8787:8787 rocker&#x2F;verse</span><br></pre></td></tr></table></figure><p>如果你想要从 Docker Hub 上拉取镜像而不运行它，可以使用命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull rocker&#x2F;verse</span><br></pre></td></tr></table></figure><h3 id="将镜像放到-docker-hub">将镜像放到 Docker Hub</h3><p>想象一下如果你自己创建了一个镜像，然后想要与其他人分享，你可以在 https://hub.docker.com/ 创建一个账号。验证完邮箱之后，你就可以将你的镜像上传了：</p><ol type="1"><li>登录 https://hub.docker.com/<br /></li><li>点击创建仓库<br /></li><li>设置名字后点击创建<br /></li><li>使用命令行登录 Docker Hub</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker login --username&#x3D;yourhubusername --email&#x3D;youremail@company.com</span><br></pre></td></tr></table></figure><p>当提示输入你的密码。如果一切正常，您将得到一个类似的消息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WARNING: login credentials saved in &#x2F;home&#x2F;username&#x2F;.docker&#x2F;config.json</span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure><ol start="5" type="1"><li>检查镜像的 ID</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><p>然后你会看到类似下面的输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">REPOSITORY              TAG       IMAGE ID         CREATED           SIZE</span><br><span class="line">verse_gapminder_gsl     latest    023ab91c6291     3 minutes ago     1.975 GB</span><br><span class="line">verse_gapminder         latest    bb38976d03cf     13 minutes ago    1.955 GB</span><br><span class="line">rocker&#x2F;verse            latest    0168d115f220     3 days ago        1.954 GB</span><br></pre></td></tr></table></figure><p>然后标记你的镜像</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag bb38976d03cf yourhubusername&#x2F;verse_gapminder:firsttry</span><br></pre></td></tr></table></figure><p>这里镜像 ID 必须匹配，<code>fisttry</code> 是标签，一般选择一些容易识别的标签。</p><ol start="6" type="1"><li>推送你的镜像：</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push yourhubusername&#x2F;verse_gapminder</span><br></pre></td></tr></table></figure><p>现在所有人都可以使用你的镜像了！</p><h3 id="保存和加载镜像">保存和加载镜像</h3><p>将镜像推送到 Docker Hub 非常使用，但它有些缺点：</p><ol type="1"><li>受带宽限制<br /></li><li>推送意味着发布（私密需要额外付费）</li><li>当在一些计算节点上工作时，如果每一次你都拉取 Docker Hub 的镜像，速度会很慢</li></ol><p>解决方案的在本地对你的镜像进行存档，这样你可以在需要的时候轻松载入。</p><p>为了这一目的，你可以使用 <code>docker save</code> 命令。例如，让我们保存一个我们制作的<code>verse_gapminder</code> docker镜像的本地副本:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker save verse_gapminder &gt; verse_gapminder.tar</span><br></pre></td></tr></table></figure><p>如果我们想要从存档中载入镜像，使用下面的命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker load --input verse_gapminder.tar</span><br></pre></td></tr></table></figure><h2 id="dockerfile">Dockerfile</h2><p>前面我们学习了一个可以在 Docker 中运行 RStudio 的基础镜像，学习如何使用 <code>docker commit</code> 修改镜像的内容。这是一个非常棒的技术，它让我们可以进行重复，但如果我们想要更简单地修改镜像中的内容，并有一份清晰的记录，该怎么办呢？这在维护运行环境时非常有用，这些环境可能会随着项目的变化而发展，<code>Dockerfiles</code>可以帮助维护这些环境。</p><p><code>Dockerfiles</code>是一组关于如何向基本映像添加内容的指令。它们在一系列层中构建自定义图像。在一个名为<code>Dockerfile</code>的新文件中，放入以下内容:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FROM rocker&#x2F;verse:latest</span><br></pre></td></tr></table></figure><p>这告诉 Docker 以 <code>rocker/verse</code> 基础镜像作为开始。<code>FROM</code> 命令必须是第一条指令。</p><p>接下来，让我们基于该基础镜像添加一层，让 <code>gapminder</code> 提取安装好可以直接使用：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RUN R -e &quot;install.packages(&#39;gapminder&#39;, repos &#x3D; &#39;http:&#x2F;&#x2F;cran.us.r-project.org&#39;)&quot;</span><br></pre></td></tr></table></figure><p><code>RUN</code> 命令可以执行 Shell 命令，这个例子中，我们直接通过 Shell 调用包安装命令。保存你的 <code>Dockerfile</code>，返回终端，现在我们可以利用下面的命令构建一个自定义镜像：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t my-r-image .</span><br></pre></td></tr></table></figure><p><code>-t my-r-image</code> 指定镜像名字（要小写），. 指定构建镜像所需要的资源来源，这里指当前目录。查看镜像：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><p>你应该在列表中看到<code>my-r-image</code>。启动你的新镜像:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm -p 8787:8787 my-r-image</span><br></pre></td></tr></table></figure><p>在 RStudio 控制台中尝使用<code>gapminder</code>：</p><figure class="highlight plain"><figcaption><span>eval</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">library(&#39;gapminder&#39;)</span><br><span class="line">gapminder</span><br></pre></td></tr></table></figure><p>现在，<code>gapminder</code>已经被预装好了，可以进入你的新docker镜像了。</p><p>有时候我们想要添加一些静态文件到镜像中，这可以使用 <code>ADD</code> 命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ADD data&#x2F;gapminder-FiveYearData.csv &#x2F;home&#x2F;rstudio&#x2F;</span><br></pre></td></tr></table></figure><p>重新建立你的Docker镜像</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t my-r-image .</span><br></pre></td></tr></table></figure><p>然后再次启动它</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm -p 8787:8787 my-r-image</span><br></pre></td></tr></table></figure><p>在浏览器中返回到RStudio, <code>gapmin - fiveyeardata .csv</code>将出现在RStudio可见的文件中。通过这种方式，我们可以捕获文件作为Docker映像的一部分，因此它们始终与映像的其余部分处于完全相同的状态。</p><h3 id="高级技巧缓存层">高级技巧：缓存层</h3><p>在构建和重构建你的 Docker 镜像时，你可能注意到了类似下面的输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Step 2 : RUN R -e &quot;install.packages(&#39;gapminder&#39;, repos &#x3D; &#39;http:&#x2F;&#x2F;cran.us.r-project.org&#39;)&quot;</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; fa9be67b52d1</span><br></pre></td></tr></table></figure><p>注意到使用的是命令的缓存版本。当你重新构建映像时，Docker 会检查该映像的以前版本，以查看以前是否执行了相同的命令；每一个步骤都被保存为一个单独的层，Docker 非常聪明，可以重用那些层，如果它们没有改变，并且和前面一样的顺序。因此，一旦你弄清楚了你的安装过程的一部分(特别是如果它是一个缓慢的部分)，把它放在你的Dockerfile的顶部，不要在这些行上面或中间放任何东西，特别是那些经常变化的东西;这可以大大加快你的构建过程。</p><blockquote><p>简单的说，重构建只修改有变动的步骤，如果很多命令没有问题，尽量放到顶部。</p></blockquote><h2 id="共享你的所有分析">共享你的所有分析</h2><p>现在我们已经学习了如何使用dockerfile，我们可以将所有分析发送给协作者。我们将共享一个包含运行分析、数据和分析所需的所有依赖项的映像。</p><p>我们将通过dockerfile构建此镜像。我们以基础的<code>verse rocker</code>镜像开始。这一次我们希望拥有一个特定的R版本(3.3.2)。可以通过给镜像加上标签实现。这对于我们重现是非常有用的。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FROM rocker&#x2F;verse:3.3.2</span><br></pre></td></tr></table></figure><p>作为我们分析的一部分，我们将使用<code>gapminder</code>数据。我们需要将这个包安装到docker映像中。让我们通过修改dockerfile来安装这个包。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RUN R -e &quot;install.packages(&#39;gapminder&#39;, repos &#x3D; &#39;http:&#x2F;&#x2F;cran.us.r-project.org&#39;)&quot;</span><br></pre></td></tr></table></figure><p>现在我们只需要进行数据分析并将其添加到dockerfile中。</p><p>为了进行分析，我们将创建一个预期寿命与人均gdp的图表。</p><p>在一个新的R脚本上，让我们写以下分析内容:</p><figure class="highlight plain"><figcaption><span>eval</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">library(ggplot2)</span><br><span class="line">library(gapminder)</span><br><span class="line"></span><br><span class="line">life_expentancy_plot &lt;- ggplot(data &#x3D; gapminder) + </span><br><span class="line">    geom_point(aes(x &#x3D; lifeExp, y &#x3D; gdpPercap, colour &#x3D; continent)) </span><br></pre></td></tr></table></figure><p>我们将把这个脚本保存为<code>analysis.R</code>并将其添加到dockerfile中。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ADD analysis.R &#x2F;home&#x2F;rstudio&#x2F;</span><br></pre></td></tr></table></figure><p>现在，我们可以构建映像并检查是否有想要与协作者共享的所有内容。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t my-analysis .</span><br></pre></td></tr></table></figure><p>我们的镜像将出现在镜像列表当中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><p>启动你的新镜像，检查你所有想要的信息:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -dp 8787:8787 my-analysis</span><br></pre></td></tr></table></figure><p>所有的信息都包含在镜像里了。</p><p>现在我们可以把我们的分析推到dockerhub。</p><p>在DockerHub上点击创建仓库，选取一个仓库名字（例如：<code>gapminder_my_analysis</code>）和一个描述，点击创建</p><p>从命令行登录到Docker Hub</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker login --username&#x3D;yourhubusername --email&#x3D;youremail@company.com</span><br></pre></td></tr></table></figure><p>登录认证后检查本地的镜像ID：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><p>你将会看到类似的信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">REPOSITORY                         TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">my-analysis                      latest              dc63d4790eaa        2 minutes ago       3.164 GB</span><br></pre></td></tr></table></figure><p>标记你的镜像</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag dc63d4790eaa yourhubusername&#x2F;gapminder_my_analysis:firsttry</span><br></pre></td></tr></table></figure><p>将映像推到创建的存储库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push yourhubusername&#x2F;gapminder_my_analysis</span><br></pre></td></tr></table></figure><p>现在每个人都可以使用你的镜像。</p><p>其他人可以使用以下命令获取你的镜像</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull yourhubusername&#x2F;gapminder_my_analysis:firsttry</span><br></pre></td></tr></table></figure><p>现在他们就拥有了你所有的信息。</p><hr /><h2 id="reference">Reference</h2><p>http://ropenscilabs.github.io/r-docker-tutorial/</p>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker 学习笔记(一)</title>
      <link href="2020/06/08/docker-i/"/>
      <url>2020/06/08/docker-i/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="背景">背景</h2><p><strong>Docker</strong> 是一个开源的应用容器引擎，基于 <strong>Go 语言</strong> 并遵从 <code>Apache2.0</code> 协议开源。</p><p><strong>Docker</strong> 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。</p><h3 id="docker的应用场景">Docker的应用场景</h3><ul><li>Web 应用的自动化打包和发布。<br /></li><li>自动化测试和持续集成、发布。<br /></li><li>在服务型环境中部署和调整数据库或其他的后台应用。<br /></li><li>从头编译或者扩展现有的 OpenShift 或 Cloud Foundry 平台来搭建自己的 PaaS 环境。</li></ul><h2 id="docker-安装">docker 安装</h2><p><code>Docker</code> 的旧版本被称为 <code>docker</code>，<code>docker.io</code> 或 <code>docker-engine</code> 。如果已安装，请卸载它们：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get remove docker docker-engine docker.io containerd runc</span><br></pre></td></tr></table></figure><p>首先安装依赖:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install apt-transport-https ca-certificates curl gnupg2 software-properties-common</span><br></pre></td></tr></table></figure><p>添加信任 Docker 的 GPG 公钥:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span><br></pre></td></tr></table></figure><p>对于 amd64 架构的计算机，添加软件仓库:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository \</span><br><span class="line">   <span class="string">&quot;deb [arch=amd64] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/ubuntu \</span></span><br><span class="line"><span class="string">   <span class="subst">$(lsb_release -cs)</span> \</span></span><br><span class="line"><span class="string">   stable&quot;</span></span><br></pre></td></tr></table></figure><p>最后安装</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install docker-ce</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker --version</span><br><span class="line"><span class="comment">## Docker version 19.03.11, build 42e35e61f3</span></span><br></pre></td></tr></table></figure><h2 id="hello-world">Hello world</h2><p><code>Docker</code> 允许你在容器内运行应用程序， 使用 <code>docker run</code> 命令来在容器内运行一个应用程序。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run ubuntu:15.10 /bin/<span class="built_in">echo</span> <span class="string">&quot;Hello world&quot;</span></span><br><span class="line"><span class="comment">## hello world</span></span><br></pre></td></tr></table></figure><p>参数解析：<br />+ <strong>docker</strong> : Docker 的执行命令<br />+ <strong>run</strong> : 与<code>docker</code>命令组合运行一个特定的容器<br />+ <strong>ubuntu:15.10</strong> : 指定要运行的镜像，<code>Docker</code> 首先从本地主机上查找镜像是否存在，如果不存在，<code>Docker</code> 就会从镜像仓库 <code>Docker Hub</code> 下载公共镜像。<br />+ <strong>/bin/echo "Hello world"</strong> : 在启动的容器里执行的命令</p><p>连起来就是：<code>Docker 以 ubuntu15.10 镜像创建一个新容器，然后在容器里执行 bin/echo "Hello world"，然后输出结果。</code></p><h2 id="交互运行">交互运行</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@VM-0-11-ubuntu:~$ sudo docker run -i -t ubuntu:15.10 /bin/bash</span><br><span class="line">root@2401df9ef044:/<span class="comment"># </span></span><br></pre></td></tr></table></figure><ul><li><strong>-t</strong>: 在新容器内指定一个伪终端或终端。<br /></li><li><strong>-i</strong>: 允许你对容器内的标准输入进行交互。</li></ul><p>通过运行 <code>exit</code> 命令或者使用 <code>CTRL+D</code> 来退出容器。</p><h2 id="后台运行">后台运行</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@VM-0-11-ubuntu:~$ sudo docker run -d ubuntu:15.10 /bin/sh -c <span class="string">&quot;while true; do echo hello world; sleep 1; done&quot;</span></span><br><span class="line">9db349c972802d3a7627b27d3c9eb0c58888ad0c80a001b5d7e6f08813eed876</span><br></pre></td></tr></table></figure><p>输出的长字符串叫做容器 ID，对每个容器来说都是唯一的，我们可以通过容器 ID 来查看对应的容器发生了什么</p><p>可以通过 <code>docker ps</code> 来查看容器的运行情况</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@VM-0-11-ubuntu:~$ sudo docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">9db349c97280        ubuntu:15.10        <span class="string">&quot;/bin/sh -c &#x27;while t…&quot;</span>   11 seconds ago      Up 10 seconds                           tender_black</span><br></pre></td></tr></table></figure><p>输出详情介绍:</p><ul><li><strong>CONTAINER ID</strong>: 容器 ID。<br /></li><li><strong>IMAGE</strong>: 使用的镜像。<br /></li><li><strong>COMMAND</strong>: 启动容器时运行的命令。<br /></li><li><strong>CREATED</strong>: 容器的创建时间。<br /></li><li><strong>STATUS</strong>: 容器状态。<br /></li><li><strong>PORTS</strong>: 容器的端口信息和使用的连接类型（tcp）。<br /></li><li><strong>NAMES</strong>: 自动分配的容器名称。</li></ul><blockquote><p>docker 运行有七种状态<br />+ created（已创建）<br />+ restarting（重启中）<br />+ running（运行中）<br />+ removing（迁移中）<br />+ paused（暂停）<br />+ exited（停止）<br />+ dead（死亡）</p></blockquote><p>使用<code>docker logs</code>查看输出结果</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@VM-0-11-ubuntu:~$ sudo docker logs tender_black</span><br><span class="line">hello world</span><br></pre></td></tr></table></figure><p>使用<code>docker stop</code>停止容器</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@VM-0-11-ubuntu:~$ sudo docker stop tender_black</span><br><span class="line">tender_black</span><br></pre></td></tr></table></figure><h2 id="docker-用户">docker 用户</h2><p>docker进程使用Unix Socket而不是TCP端口。而默认情况下，Unix socket属于root用户，需要root权限才能访问。</p><p>解决方案：<br />1. 使用sudo获取管理员权限，运行docker命令<br />2. docker守护进程启动的时候，会默认赋予名字为docker的用户组读写Unix socket的权限，因此只要创建docker用户组，并将当前用户加入到docker用户组中，那么当前用户就有权限访问Unix socket了，进而也就可以执行docker相关命令<br /><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo groupadd docker     <span class="comment">#添加docker用户组</span></span><br><span class="line">sudo gpasswd -a <span class="variable">$USER</span> docker     <span class="comment">#将登陆用户加入到docker用户组中</span></span><br><span class="line">newgrp docker     <span class="comment">#更新用户组</span></span><br><span class="line">docker ps    <span class="comment">#测试docker命令是否可以使用sudo正常使用</span></span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>分类变量和连续变量的相关性计算</title>
      <link href="2020/06/01/classificated-continonus/"/>
      <url>2020/06/01/classificated-continonus/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="背景">背景</h2><p>在实际的应用过程中，我们往往需要计算两个变量之间的相关性。但是有一个问题————一般会有两类变量：连续型变量(continuous variable) 和 分类变量（categorical variable）。因此我们需要各自不同的统计度量来计算两两之间的相关性（continuous-continuous, categorical-categorical, continuous-categorical）</p><p>而相关性问题又可以分成两个不同的子问题，即：</p><ol type="1"><li>检验两个变量之间是否显著相关;<br /></li><li>定量两个变量之间的关联性</li></ol><h2 id="categorical-categorical">categorical-categorical</h2><p>当比较两个分类变量时，我们可以通过计算分类的频率从而构建出列联表。比如：我们想要知道性别（Gender）和获得基金资助（Grant）之间是否存在相关性。可能数据包含两列：(1) Gender（Male/Female）(2) Grant （Yes/No）。通过计算他们各自的频率可以得到列联表</p><table><tr><td></td><td></td><th colspan="2">Gender</th></tr><tr><td></td><td></td><td>Male</td><td>Female</td></tr><tr><th rowspan="2">Grant</th><td>Yes</td><td>100</td><td>40</td></tr><tr><td>No</td><td>600</td><td>500</td></tr></table><p>通常情况下，我们一般使用卡方检验去检验两者之间是否有显著的相关性，然而我们去衡量两者之间的关系强弱的时候可以使用以下统计量：</p><ol type="1"><li><a href="https://en.wikipedia.org/wiki/Goodman_and_Kruskal&#39;s_lambda">Goodman Kruskal’s lambda</a><br /></li><li><a href="https://en.wikipedia.org/wiki/Phi_coefficient">Phi co-efficient</a> (uses chi-squared statistic)<br /></li><li><a href="https://en.wikipedia.org/wiki/Cramér&#39;s_V">Cramer’s V</a> (uses chi-squared statistic)<br /></li><li><a href="https://en.wikipedia.org/wiki/Tschuprow&#39;s_T">Tschuprow’s <em>T</em></a> (uses chi-squared statistic)<br /></li><li><a href="http://www.statisticshowto.com/contingency-coefficient/">Contingency coefficient C</a> (uses chi-squared statistic)</li></ol><h2 id="continuous-categorical"><strong>continuous</strong>-<strong>categorical</strong></h2><p>对于此类事件，计算相关性的方法主要分为以下三种：</p><h3 id="point-biserial-correlation"><strong>Point biserial Correlation</strong></h3><p><code>point biserial</code>相关系数是皮尔森相关系数的特例。需要</p><h3 id="logistic-regression"><strong>Logistic Regression</strong></h3><h3 id="kruskal-wallis-h-test"><strong>Kruskal-Wallis H Test</strong></h3>]]></content>
      
      
      <categories>
          
          <category> statistics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> correlation </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>R语言基础设置</title>
      <link href="2020/06/01/r-base-set/"/>
      <url>2020/06/01/r-base-set/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><p>在R语言中，为了方便使用，可以对其进行个性化设置，优化使用体验。</p><p><a href="去掉控制台的加号">去掉控制台的加号</a><br /><a href="更改显示小数点位数">更改显示小数点位数</a></p><h2 id="去掉控制台的加号">去掉控制台的加号</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file.edit(<span class="string">&quot;~/.Rprofile&quot;</span>)</span><br><span class="line">options(continue = <span class="string">&quot;  &quot;</span>) <span class="comment">## 使用两个空格代替+</span></span><br></pre></td></tr></table></figure><p>使用效果：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a &lt;- <span class="number">1</span></span><br><span class="line">b &lt;- <span class="number">2</span></span><br><span class="line">a +</span><br><span class="line">  b</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## [1] 3</span><br></pre></td></tr></table></figure><h2 id="更改显示小数点位数">更改显示小数点位数</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options(digits = <span class="number">3</span>)</span><br></pre></td></tr></table></figure><p>使用效果：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a &lt;- <span class="number">3.1415926</span></span><br><span class="line">a</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## [1] 3.14</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Markdown语法说明</title>
      <link href="2020/05/30/markdown-synathx/"/>
      <url>2020/05/30/markdown-synathx/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h1 id="markdown-文件">Markdown 文件</h1><p><img src="http://markdown.tw/images/208x128.png" /></p><p><strong>NOTE:</strong> 本文是简体中文意译,英文原文见 <a href="http://daringfireball.net/projects/markdown/syntax">Markdown: Syntax</a>.</p><h1 id="markdown-语法syntax">Markdown: 语法(syntax)</h1><ul><li><a href="#overview">概述</a><ul><li><a href="#philosophy">宗旨</a></li><li><a href="#html">兼容 HTML</a></li><li><a href="#autoescape">特殊字符自动转换</a></li></ul></li><li><a href="#block">区块元素</a><ul><li><a href="#p">段落和换行</a></li><li><a href="#header">标题</a></li><li><a href="#blockquote">区块引用</a></li><li><a href="#list">列表</a></li><li><a href="#precode">代码区块</a></li><li><a href="#hr">分隔线</a></li></ul></li><li><a href="#span">区段元素</a><ul><li><a href="#link">链接</a></li><li><a href="#em">强调</a></li><li><a href="#code">代码</a></li><li><a href="#img">图片</a></li></ul></li><li><a href="#misc">其它</a><ul><li><a href="#autolink">自动链接</a></li><li><a href="#backslash">反斜杠</a></li></ul></li></ul><p><strong>注意</strong>:这份文件是用 Markdown 写的，你可以<a href="https://github.com/osokay/markdown-syntax-zh/edit/master/syntax_zh.md">看看它的原始档</a> 。</p><hr /><h2 id="overview">概述</h2><h3 id="philosophy">宗旨</h3><p>Markdown 的目标是实现「易读易写」。</p><p>可读性，无论如何，都是最重要的。一份使用 Markdown 格式撰写的文件应该可以直接以纯文本发布，并且看起来不会像是由许多标签或是格式指令所构成。Markdown 语法受到一些既有 text-to-HTML 格式的影响，包括 [Setext] <a href="http://docutils.sourceforge.net/mirror/setext.html">1</a>、[atx] <a href="http://www.aaronsw.com/2002/atx/">2</a>、[Textile] <a href="http://textism.com/tools/textile/">3</a>、[reStructuredText] <a href="http://docutils.sourceforge.net/rst.html">4</a>、[Grutatext] <a href="http://www.triptico.com/software/grutatxt.html">5</a> 和 [EtText] <a href="http://ettext.taint.org/doc/">6</a>，而最大灵感来源其实是纯文本电子邮件的格式。</p><p>总之， Markdown 的语法全由一些符号所组成，这些符号经过精挑细选，其作用一目了然。比如：在文字两旁加上星号，看起来就像<em>强调</em>。Markdown 的列表看起来，嗯，就是列表。Markdown 的区块引用看起来就真的像是引用一段文字，就像你曾在电子邮件中见过的那样。</p><h3 id="html">兼容 HTML</h3><p>Markdown 的格式语法只涵盖纯文本可以涵盖的范围，不在 Markdown 涵盖范围之内的标签，都可以直接在文件里面用 HTML 撰写。不需要额外标注这是 HTML 或是 Markdown；只要直接加标签就可以了。</p><p>只有区块元素──比如 <code>&lt;div&gt;</code>、<code>&lt;table&gt;</code>、<code>&lt;pre&gt;</code>、<code>&lt;p&gt;</code> 等标签，必须在前后加上空行与其它内容区隔开，而且这些（元素）的开始与结尾标签，不可以用制表符或空格来缩进。Markdown 的生成器足够智能，不会在 HTML 区块标签外加上不必要的 <code>&lt;p&gt;</code> 标签。</p><p>举例来说，在 Markdown 文件里加上一段 HTML 表格：</p><pre><code>This is a regular paragraph.&lt;table&gt;    &lt;tr&gt;        &lt;td&gt;Foo&lt;/td&gt;    &lt;/tr&gt;&lt;/table&gt;This is another regular paragraph.</code></pre><p>Markdown 语法在 HTML 区块标签中将不会被进行处理。比如，你在 HTML 区块内使用 Markdown 样式的<code>*强调*</code>会没有效果。</p><p>HTML 的区段（行内）标签如 <code>&lt;span&gt;</code>、<code>&lt;cite&gt;</code>、<code>&lt;del&gt;</code> 则不受限制，可以在 Markdown 的段落、列表或是标题里任意使用。依照个人习惯，甚至可以不用Markdown 格式，而直接采用 HTML 标签来格式化。举例说明：如果比较喜欢 HTML 的 <code>&lt;a&gt;</code> 或 <code>&lt;img&gt;</code> 标签，可以直接使用这些标签，而不用 Markdown 提供的链接或是图像标签语法。</p><p>请注意，Markdown 语法在 HTML 区段标签间是有效的。</p><h3 id="autoescape">特殊字符自动转换</h3><p>在 HTML 文件中，有两个字符需要特殊处理： <code>&lt;</code> 和 <code>&amp;</code> 。 <code>&lt;</code> 符号用于起始标签，<code>&amp;</code> 符号则用于标记 HTML 实体，如果你只是想要显示这些字符的原型，你必须要使用实体的形式，像是 <code>&amp;lt;</code> 和 <code>&amp;amp;</code>。</p><p><code>&amp;</code> 符号其实很容易让写作网络文件的人感到困扰，如果你要打「AT&amp;T」 ，你必须要写成「<code>AT&amp;amp;T</code>」 ，而且网址中的 <code>&amp;</code> 字符也要转换。如果你要链接到：</p><pre><code>http://images.google.com/images?num=30&amp;q=larry+bird</code></pre><p>你必须要把网址写成：</p><pre><code>http://images.google.com/images?num=30&amp;amp;q=larry+bird</code></pre><p>才能放到链接标签的 <code>href</code> 属性里。不用说也知道这很容易忽略，这也可能是 HTML 标准检查所检查到的错误中，数量最多的。</p><p>Markdown 可以自动处理这些符号，如果你使用的 <code>&amp;</code> 字符是 HTML 字符实体的一部分，它会保留原状，否则它会被转换成 <code>&amp;amp</code>;。<br />所以你如果要在文件中插入一个著作权的符号，你可以这样写：</p><pre><code>&amp;copy;</code></pre><p>Markdown 将不会对这段文字做修改，但是如果你这样写：</p><pre><code>AT&amp;T</code></pre><p>Markdown 就会将它转为：</p><pre><code>AT&amp;amp;T</code></pre><p>类似的状况也会发生在 <code>&lt;</code> 符号上，因为 Markdown 支持 <a href="#html">兼容 HTML</a> ，如果你是使用 <code>&lt;</code> 符号作为 HTML 标签使用，那 Markdown 也不会对它做任何转换，但是如果你是写：</p><pre><code>4 &lt; 5</code></pre><p>Markdown 将会把它转换为：</p><pre><code>4 &amp;lt; 5</code></pre><p>不过需要注意的是，code 范围内，不论是行内还是区块， <code>&lt;</code> 和 <code>&amp;</code> 两个符号都<strong>一定</strong>会被转换成 HTML 实体，这项特性让你可以很容易地用 Markdown 写 HTML code （和 HTML 相对而言， HTML 语法中，你要把所有的 <code>&lt;</code> 和 <code>&amp;</code> 都转换为 HTML 实体，才能在 HTML 文件里面写出 HTML code。）</p><hr /><h2 id="block">区块元素</h2><h3 id="p">段落和换行</h3><p>一个 Markdown 段落是由一个或多个连续的文本行组成，它的前后要有一个以上的空行（空行的定义是显示上看起来像是空的，便会被视为空行。比方说，若某一行只包含空格和制表符，则该行也会被视为空行）。普通段落不该用空格或制表符来缩进。</p><p>「由一个或多个连续的文本行组成」这句话其实暗示了 Markdown 允许段落内的强迫换行（插入换行符），这个特性和其他大部分的 text-to-HTML 格式不一样（包括 Movable Type 的「Convert Line Breaks」选项），其它的格式会把每个换行符都转成 <code>&lt;br /&gt;</code> 标签。</p><p>如果你<strong>真的</strong>想要插入 <code>&lt;br /&gt;</code> 标签的话，在行尾加上两个以上的格然后回车。</p><p>是的，这确实需要花比较多功夫来插入 <code>&lt;br /&gt;</code> ，但是「每个换行都转换为 <code>&lt;br /&gt;</code>」的方法在 Markdown 中并不适合， Markdown 中 email 式的 <a href="#blockquote">区块引用</a> 和多段落的 <a href="#list">列表</a> 在使用换行来排版的时候，不但更好用，还更好阅读。</p><h3 id="header">标题</h3><p>Markdown 支持两种标题的语法，类 [Setext] <a href="http://docutils.sourceforge.net/mirror/setext.html">1</a> 和类 [atx] <a href="http://www.aaronsw.com/2002/atx/">2</a> 形式。</p><p>类 Setext 形式是用底线的形式，利用 <code>=</code> （最高阶标题）和 <code>-</code> （第二阶标题），例如：</p><pre><code>This is an H1=============This is an H2-------------</code></pre><p>任何数量的 <code>=</code> 和 <code>-</code> 都可以有效果。</p><p>类 Atx 形式则是在行首插入 1 到 6 个 <code>#</code> ，对应到标题 1 到 6 阶，例如：</p><pre><code># This is an H1## This is an H2###### This is an H6</code></pre><p>你可以选择性地「闭合」类 atx 样式的标题，这纯粹只是美观用的，若是觉得这样看起来比较舒适，你就可以在行尾加上 <code>#</code>，而行尾的 <code>#</code> 数量也不用和开头一样（行首的井字数量决定标题的阶数）：</p><pre><code># This is an H1 ### This is an H2 ##### This is an H3 ######</code></pre><h3 id="blockquote">Blockquotes</h3><p>Markdown 标记区块引用是使用类似 email 中用 <code>&gt;</code> 的引用方式。如果你还熟悉在 email 信件中的引言部分，你就知道怎么在 Markdown 文件中建立一个区块引用，那会看起来像是你自己先断好行，然后在每行的最前面加上 <code>&gt;</code> ：</p><pre><code>&gt; This is a blockquote with two paragraphs. Lorem ipsum dolor sit amet,&gt; consectetuer adipiscing elit. Aliquam hendrerit mi posuere lectus.&gt; Vestibulum enim wisi, viverra nec, fringilla in, laoreet vitae, risus.&gt; &gt; Donec sit amet nisl. Aliquam semper ipsum sit amet velit. Suspendisse&gt; id sem consectetuer libero luctus adipiscing.</code></pre><p>Markdown 也允许你只在整个段落的第一行最前面加上 <code>&gt;</code> ：</p><pre><code>&gt; This is a blockquote with two paragraphs. Lorem ipsum dolor sit amet,consectetuer adipiscing elit. Aliquam hendrerit mi posuere lectus.Vestibulum enim wisi, viverra nec, fringilla in, laoreet vitae, risus.&gt; Donec sit amet nisl. Aliquam semper ipsum sit amet velit. Suspendisseid sem consectetuer libero luctus adipiscing.</code></pre><p>区块引用可以有嵌套（例如：引用内的引用），只要根据层数加上不同数量的 <code>&gt;</code> ：</p><pre><code>&gt; This is the first level of quoting.&gt;&gt; &gt; This is nested blockquote.&gt;&gt; Back to the first level.</code></pre><p>引用的区块内也可以使用其他的 Markdown 语法，包括标题、列表、代码区块等：</p><pre><code>&gt; ## This is a header.&gt; &gt; 1.   This is the first list item.&gt; 2.   This is the second list item.&gt; &gt; Here&#39;s some example code:&gt; &gt;     return shell_exec(&quot;echo $input | $markdown_script&quot;);</code></pre><p>任何标准的文本编辑器都能简单地建立 email 样式的引用，例如 BBEdit ，你可以选取文字后然后从选单中选择<em>增加引用阶层</em>。</p><h3 id="list">列表</h3><p>Markdown 支持有序列表和无序列表。</p><p>无序清单使用星号、加号或是减号作为列表标记：</p><pre><code>*   Red*   Green*   Blue</code></pre><p>等同于：</p><pre><code>+   Red+   Green+   Blue</code></pre><p>也等同于：</p><pre><code>-   Red-   Green-   Blue</code></pre><p>有序列表则使用数字接着一个英文句点：</p><pre><code>1.  Bird2.  McHale3.  Parish</code></pre><p>很重要的一点是，你在列表标记上使用的数字并不会影响输出的 HTML 结果，上面的列表所产生的 HTML 标记为：</p><pre><code>&lt;ol&gt;&lt;li&gt;Bird&lt;/li&gt;&lt;li&gt;McHale&lt;/li&gt;&lt;li&gt;Parish&lt;/li&gt;&lt;/ol&gt;</code></pre><p>如果你的列表标记写成：</p><pre><code>1.  Bird1.  McHale1.  Parish</code></pre><p>或甚至是：</p><pre><code>3. Bird1. McHale8. Parish</code></pre><p>你都会得到完全相同的 HTML 输出。重点在于，你可以让 Markdown 文件的列表数字和输出的结果相同，或是你懒一点，你可以完全不用在意数字的正确性。</p><p>如果你使用懒惰的写法，建议第一个项目最好还是从 1. 开始，因为 Markdown 未来可能会支持有序列表的 start 属性。</p><p>列表项目标记通常是放在最左边，但是其实也可以缩进，最多 3 个空格，项目标记后面则一定要接着至少一个空格或制表符。</p><p>要让列表看起来更漂亮，你可以把内容用固定的缩进整理好：</p><pre><code>*   Lorem ipsum dolor sit amet, consectetuer adipiscing elit.    Aliquam hendrerit mi posuere lectus. Vestibulum enim wisi,    viverra nec, fringilla in, laoreet vitae, risus.*   Donec sit amet nisl. Aliquam semper ipsum sit amet velit.    Suspendisse id sem consectetuer libero luctus adipiscing.</code></pre><p>但是如果你很懒，那也行：</p><pre><code>*   Lorem ipsum dolor sit amet, consectetuer adipiscing elit.Aliquam hendrerit mi posuere lectus. Vestibulum enim wisi,viverra nec, fringilla in, laoreet vitae, risus.*   Donec sit amet nisl. Aliquam semper ipsum sit amet velit.Suspendisse id sem consectetuer libero luctus adipiscing.</code></pre><p>如果列表项目间用空行分开， 在输出 HTML 时 Markdown 会把项目的内容在输出时用 <code>&lt;p&gt;</code> 标签包起来，举例来说：</p><pre><code>*   Bird*   Magic</code></pre><p>会被转换为：</p><pre><code>&lt;ul&gt;&lt;li&gt;Bird&lt;/li&gt;&lt;li&gt;Magic&lt;/li&gt;&lt;/ul&gt;</code></pre><p>但是这个：</p><pre><code>*   Bird*   Magic</code></pre><p>会被转换为：</p><pre><code>&lt;ul&gt;&lt;li&gt;&lt;p&gt;Bird&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Magic&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;</code></pre><p>列表项目可以包含多个段落，每个项目下的段落都必须缩进 4 个空格或是 1 个制表符：</p><pre><code>1.  This is a list item with two paragraphs. Lorem ipsum dolor    sit amet, consectetuer adipiscing elit. Aliquam hendrerit    mi posuere lectus.    Vestibulum enim wisi, viverra nec, fringilla in, laoreet    vitae, risus. Donec sit amet nisl. Aliquam semper ipsum    sit amet velit.2.  Suspendisse id sem consectetuer libero luctus adipiscing.</code></pre><p>如果你每行都有缩进，看起来会看好很多，当然，Markdown 也允许：</p><pre><code>*   This is a list item with two paragraphs.    This is the second paragraph in the list item. You&#39;reonly required to indent the first line. Lorem ipsum dolorsit amet, consectetuer adipiscing elit.*   Another item in the same list.</code></pre><p>如果要在列表项目内放进引用，那 <code>&gt;</code> 就需要缩进：</p><pre><code>*   A list item with a blockquote:    &gt; This is a blockquote    &gt; inside a list item.</code></pre><p>如果要放代码区块的话，该区块就需要缩排<strong>两次</strong>，也就是 8 个空格或是 2 个制表符：</p><pre><code>*   A list item with a code block:        &lt;code goes here&gt;</code></pre><p>当然，项目列表很可能会不小心产生，像是下面这样的写法：</p><pre><code>1986. What a great season.</code></pre><p>换句话说，也就是在行首出现<strong>数字-句点-空白</strong>，要避免这样的状况，你可以在句点前面加上反斜杠。</p><pre><code>1986\. What a great season.</code></pre><h3 id="precode">程序代码区块</h3><p>和程序相关的写作或是标签语言原始码通常会有已经排版好的代码区块，通常这些区块我们并不希望它以一般段落文件的方式去排版，而是照原来的样子显示，Markdown 会用 <code>&lt;pre&gt;</code> 和 <code>&lt;code&gt;</code> 标签来把代码区块包起来。</p><p>要在 Markdown 中建立代码区块很简单，只要简单地缩进 4 个空格或是 1 个制表符就可以，例如，下面的输入：</p><pre><code>This is a normal paragraph:    This is a code block.</code></pre><p>Markdown 会转换成：</p><pre><code>&lt;p&gt;This is a normal paragraph:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;This is a code block.&lt;/code&gt;&lt;/pre&gt;</code></pre><p>这个每行一阶的缩进（4 个空格或是 1 个制表符），都会被移除，例如：</p><pre><code>Here is an example of AppleScript:    tell application &quot;Foo&quot;        beep    end tell</code></pre><p>会被转换为：</p><pre><code>&lt;p&gt;Here is an example of AppleScript:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;tell application &quot;Foo&quot;    beepend tell&lt;/code&gt;&lt;/pre&gt;</code></pre><p>一个代码区块会一直持续到没有缩进的那一行（或是文件结尾）。</p><p>在代码区块里面， <code>&amp;</code> 、 <code>&lt;</code> 和 <code>&gt;</code> 会自动转成 HTML 实体，这样的方式让你非常容易使用 Markdown 插入范例用的 HTML 原始码，只需要复制贴上，再加上缩进就可以了，剩下的 Markdown 都会帮你处理，例如：</p><pre><code>    &lt;div class=&quot;footer&quot;&gt;        &amp;copy; 2004 Foo Corporation    &lt;/div&gt;</code></pre><p>会被转换为：</p><pre><code>&lt;pre&gt;&lt;code&gt;&amp;lt;div class=&quot;footer&quot;&amp;gt;    &amp;amp;copy; 2004 Foo Corporation&amp;lt;/div&amp;gt;&lt;/code&gt;&lt;/pre&gt;</code></pre><p>代码区块中，一般的 Markdown 语法不会被转换，像是星号便只是星号，这表示你可以很容易地以 Markdown 语法撰写 Markdown 语法相关的文件。</p><h3 id="hr">分隔线</h3><p>你可以在一行中用三个或以上的星号、减号来建立一个分隔线，行内不能有其他东西。你也可以在星号中间插入空格。下面每种写法都可以建立分隔线：</p><pre><code>* * *********- - ----------------------------------------</code></pre><hr /><h2 id="span">区段元素</h2><h3 id="link">链接</h3><p>Markdown 支持两种形式的链接语法： <strong>行内式</strong>和<strong>参考式</strong>两种形式。</p><p>不管是哪一种，链接的文字都是用 [方括号] 来标记。</p><p>要建立一个<strong>行内式</strong>的链接，只要在方括号后面马上接着圆括号并插入网址链接即可，如果你还想要加上链接的 title 文字，只要在网址后面，用双引号把 title 文字包起来即可，例如：</p><pre><code>This is [an example](http://example.com/ &quot;Title&quot;) inline link.[This link](http://example.net/) has no title attribute.</code></pre><p>会产生：</p><pre><code>&lt;p&gt;This is &lt;a href=&quot;http://example.com/&quot; title=&quot;Title&quot;&gt;an example&lt;/a&gt; inline link.&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;http://example.net/&quot;&gt;This link&lt;/a&gt; has notitle attribute.&lt;/p&gt;</code></pre><p>如果你是要链接到同样主机的资源，你可以使用相对路径：</p><pre><code>See my [About](/about/) page for details.   </code></pre><p><strong>参考式</strong>的链接是在链接文字的括号后面再接上另一个方括号，而在第二个方括号里面要填入用以辨识链接的标记：</p><pre><code>This is [an example][id] reference-style link.</code></pre><p>你也可以选择性地在两个方括号中间加上空格：</p><pre><code>This is [an example] [id] reference-style link.</code></pre><p>接着，在文件的任意处，你可以把这个标签的链接内容定义出来：</p><pre><code>[id]: http://example.com/  &quot;Optional Title Here&quot;</code></pre><p>链接内容定义的形式为：</p><ul><li>方括号（前面可以选择性地加上至多三个空格来缩进），里面输入链接文字</li><li>接着一个冒号</li><li>接着一个以上的空格或制表符</li><li>接着链接的网址</li><li>选择性地接着 title 内容，可以用单引号、双引号或是圆括号包着</li></ul><p>下面这三种连结的定义都是相同：</p><pre><code>[foo]: http://example.com/  &quot;Optional Title Here&quot;[foo]: http://example.com/  &#39;Optional Title Here&#39;[foo]: http://example.com/  (Optional Title Here)</code></pre><p><strong>请注意：</strong>有一个已知的问题是 Markdown.pl 1.0.1 会忽略单引号包起来的链接 title。</p><p>链接网址也可以用方括号包起来：</p><pre><code>[id]: &lt;http://example.com/&gt;  &quot;Optional Title Here&quot;</code></pre><p>你也可以把 title 属性放到下一行，也可以加一些缩进，网址太长的话，这样会比较好看：</p><pre><code>[id]: http://example.com/longish/path/to/resource/here    &quot;Optional Title Here&quot;</code></pre><p>网址定义只有在产生链接的时候用到，并不会直接出现在文件之中。</p><p>链接辨识标记可以有字母、数字、空白和标点符号，但是并<strong>不区分</strong>大小写，因此下面两个链接是一样的：</p><pre><code>[link text][a][link text][A]</code></pre><p><strong>隐式链接标记</strong>功能让你可以省略指定链接标记，这种情形下，链接标记和链接文字会视为相同，要用隐式链接标记只要在链接文字后面加上一个空的方括号，如果你要让 "Google" 链接到 google.com，你可以简化成：</p><pre><code>[Google][]</code></pre><p>然后定义链接内容：</p><pre><code>[Google]: http://google.com/</code></pre><p>由于链接文字可能包含空白，所以这种简化的标记内也可以包含多个单词：</p><pre><code>Visit [Daring Fireball][] for more information.</code></pre><p>然后接着定义链接：</p><pre><code>[Daring Fireball]: http://daringfireball.net/</code></pre><p>链接的定义可以放在文件中的任何一个地方，我比较偏好直接放在链接出现段落的后面，你也可以把它放在文件最后面，就像是注解一样。</p><p>下面是一个参考式链接的范例：</p><pre><code>I get 10 times more traffic from [Google] [1] than from[Yahoo] [2] or [MSN] [3].  [1]: http://google.com/        &quot;Google&quot;  [2]: http://search.yahoo.com/  &quot;Yahoo Search&quot;  [3]: http://search.msn.com/    &quot;MSN Search&quot;</code></pre><p>如果改成用链接名称的方式写：</p><pre><code>I get 10 times more traffic from [Google][] than from[Yahoo][] or [MSN][].  [google]: http://google.com/        &quot;Google&quot;  [yahoo]:  http://search.yahoo.com/  &quot;Yahoo Search&quot;  [msn]:    http://search.msn.com/    &quot;MSN Search&quot;</code></pre><p>上面两种写法都会产生下面的 HTML。</p><pre><code>&lt;p&gt;I get 10 times more traffic from &lt;a href=&quot;http://google.com/&quot;title=&quot;Google&quot;&gt;Google&lt;/a&gt; than from&lt;a href=&quot;http://search.yahoo.com/&quot; title=&quot;Yahoo Search&quot;&gt;Yahoo&lt;/a&gt;or &lt;a href=&quot;http://search.msn.com/&quot; title=&quot;MSN Search&quot;&gt;MSN&lt;/a&gt;.&lt;/p&gt;</code></pre><p>下面是用行内形式写的同样一段内容的 Markdown 文件，提供作为比较之用：</p><pre><code>I get 10 times more traffic from [Google](http://google.com/ &quot;Google&quot;)than from [Yahoo](http://search.yahoo.com/ &quot;Yahoo Search&quot;) or[MSN](http://search.msn.com/ &quot;MSN Search&quot;).</code></pre><p>参考式的链接其实重点不在于它比较好写，而是它比较好读，比较一下上面的范例，使用参考式的文章本身只有 81 个字符，但是用行内形式的连结却会增加到 176 个字符，如果是用纯 HTML 格式来写，会有 234 个字符，在 HTML 格式中，标签比文字还要多。</p><p>使用 Markdown 的参考式链接，可以让文件更像是浏览器最后产生的结果，让你可以把一些标记相关的信息移到段落文字之外，你就可以增加连结而不让文章的阅读感觉被打断。</p><h3 id="em">强调</h3><p>Markdown 使用星号（<code>*</code>）和底线（<code>_</code>）作为标记强调字词的符号，被 <code>*</code> 或 <code>_</code> 包围的字词会被转成用 <code>&lt;em&gt;</code> 标签包围，用两个 <code>*</code> 或 <code>_</code> 包起来的话，则会被转成 <code>&lt;strong&gt;</code>，例如：</p><pre><code>*single asterisks*_single underscores_**double asterisks**__double underscores__</code></pre><p>会转成：</p><pre><code>&lt;em&gt;single asterisks&lt;/em&gt;&lt;em&gt;single underscores&lt;/em&gt;&lt;strong&gt;double asterisks&lt;/strong&gt;&lt;strong&gt;double underscores&lt;/strong&gt;</code></pre><p>你可以随便用你喜欢的样式，唯一的限制是，你用什么符号开启标签，就要用什么符号结束。</p><p>强调也可以直接插在文字中间：</p><pre><code>un*frigging*believable</code></pre><p>但是<strong>如果你的 <code>*</code> 和 <code>_</code> 两边都有空白的话，它们就只会被当成普通的符号</strong>。</p><p>如果要在文字前后直接插入普通的星号或底线，你可以用反斜杠：</p><pre><code>\*this text is surrounded by literal asterisks\*</code></pre><h3 id="code">代码</h3><p>如果要标记一小段行内代码，你可以用反引号把它包起来（<code>`</code>），例如：</p><pre><code>Use the `printf()` function.</code></pre><p>会产生：</p><pre><code>&lt;p&gt;Use the &lt;code&gt;printf()&lt;/code&gt; function.&lt;/p&gt;</code></pre><p>如果要在代码区段内插入反引号，你可以用多个反引号来开启和结束代码区段：</p><pre><code>``There is a literal backtick (`) here.``</code></pre><p>这段语法会产生：</p><pre><code>&lt;p&gt;&lt;code&gt;There is a literal backtick (`) here.&lt;/code&gt;&lt;/p&gt;</code></pre><p>代码区段的起始和结束端都可以放入一个空白，起始端后面一个，结束端前面一个，这样你就可以在区段的一开始就插入反引号：</p><pre><code>A single backtick in a code span: `` ` ``A backtick-delimited string in a code span: `` `foo` ``</code></pre><p>会产生：</p><pre><code>&lt;p&gt;A single backtick in a code span: &lt;code&gt;`&lt;/code&gt;&lt;/p&gt;&lt;p&gt;A backtick-delimited string in a code span: &lt;code&gt;`foo`&lt;/code&gt;&lt;/p&gt;</code></pre><p>在代码区段内，<code>&amp;</code> 和方括号都会被转成 HTML 实体，这样会比较容易插入 HTML 原始码，Markdown 会把下面这段：</p><pre><code>Please don&#39;t use any `&lt;blink&gt;` tags.</code></pre><p>转为：</p><pre><code>&lt;p&gt;Please don&#39;t use any &lt;code&gt;&amp;lt;blink&amp;gt;&lt;/code&gt; tags.&lt;/p&gt;</code></pre><p>你也可以这样写：</p><pre><code>`&amp;#8212;` is the decimal-encoded equivalent of `&amp;mdash;`.</code></pre><p>以产生：</p><pre><code>&lt;p&gt;&lt;code&gt;&amp;amp;#8212;&lt;/code&gt; is the decimal-encodedequivalent of &lt;code&gt;&amp;amp;mdash;&lt;/code&gt;.&lt;/p&gt;</code></pre><h3 id="img">图片</h3><p>很明显地，要在纯文本应用中设计一个 「自然」的语法来插入图片是有一定难度的。</p><p>Markdown 使用一种和链接很相似的语法来标记图片，同样也允许两种样式： <strong>行内式</strong>和<strong>参考式</strong>。</p><p>行内式图片的语法看起来像是：</p><pre><code>![Alt text](/path/to/img.jpg)![Alt text](/path/to/img.jpg &quot;Optional title&quot;)</code></pre><p>详细叙述如下：</p><ul><li>一个惊叹号 <code>!</code></li><li>接着一对方括号，里面放上图片的替代文字</li><li>接着一对普通括号，里面放上图片的网址，最后还可以用引号包住并加上选择性的 'title' 文字。</li></ul><p>参考式的图片语法则长得像这样：</p><pre><code>![Alt text][id]</code></pre><p>「id」是图片参考的名称，图片参考的定义方式则和链接参考一样：</p><pre><code>[id]: url/to/image  &quot;Optional title attribute&quot;</code></pre><p>到目前为止， Markdown 还没有办法指定图片的宽高，如果你需要的话，你可以使用普通的 <code>&lt;img&gt;</code> 标签。</p><hr /><h2 id="misc">其它</h2><h3 id="autolink">自动链接</h3><p>Markdown 支持比较简短的自动连结形式来处理网址和电子邮件信箱，只要是用方括号包起来， Markdown 就会自动把它转成链接，链接的文字就和链接位置一样，例如：</p><pre><code>&lt;http://example.com/&gt;</code></pre><p>Markdown 会转为：</p><pre><code>&lt;a href=&quot;http://example.com/&quot;&gt;http://example.com/&lt;/a&gt;</code></pre><p>邮址的自动链接也很类似，只是 Markdown 会先做一个编码转换的过程，把文字字符转成 16 进位码的 HTML 实体，这样的格式可以糊弄一些不好的邮址收集机器人，例如：</p><pre><code>&lt;address@example.com&gt;</code></pre><p>Markdown 会转成：</p><pre><code>&lt;a href=&quot;&amp;#x6D;&amp;#x61;i&amp;#x6C;&amp;#x74;&amp;#x6F;:&amp;#x61;&amp;#x64;&amp;#x64;&amp;#x72;&amp;#x65;&amp;#115;&amp;#115;&amp;#64;&amp;#101;&amp;#120;&amp;#x61;&amp;#109;&amp;#x70;&amp;#x6C;e&amp;#x2E;&amp;#99;&amp;#111;&amp;#109;&quot;&gt;&amp;#x61;&amp;#x64;&amp;#x64;&amp;#x72;&amp;#x65;&amp;#115;&amp;#115;&amp;#64;&amp;#101;&amp;#120;&amp;#x61;&amp;#109;&amp;#x70;&amp;#x6C;e&amp;#x2E;&amp;#99;&amp;#111;&amp;#109;&lt;/a&gt;</code></pre><p>在浏览器里面，这段字符串（其实是 <code>&lt;a href="mailto:address@example.com"&gt;address@example.com&lt;/a&gt;</code>）会变成一个可以点击的「address@example.com」链接。</p><p>（这种作法虽然可以糊弄不少的机器人，但并无法全部挡下来，不过这样也比什么都不做好些。无论如何，公开你的信箱终究会引来广告信件的。）</p><h3 id="backslash">反斜杠</h3><p>Markdown 可以利用反斜杠来插入一些在语法中有其它意义的符号，例如：如果你想要用星号加在文字旁边的方式来做出强调效果（但不用 <code>&lt;em&gt;</code> 标签），你可以在星号的前面加上反斜杠：</p><pre><code>\*literal asterisks\*</code></pre><p>Markdown 支持在下面这些符号前面加上反斜杠来帮助插入普通的符号：</p><pre><code>\   反斜杠`   反引号*   星号_   底线&#123;&#125;  大括号[]  方括号()  括号#   井字号+    加号-    减号.   英文句点!   惊叹号</code></pre>]]></content>
      
      
      <categories>
          
          <category> Markdown </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Markdown </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基因ID转换相关知识</title>
      <link href="2020/05/29/id-convert/"/>
      <url>2020/05/29/id-convert/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="ensembl-id-辨识">Ensembl ID 辨识</h2><blockquote><ul><li>例如ENSG00000279928.1中，<strong>ENS</strong>是<strong>固定字符</strong>，表示它是属于Ensembl数据库的。默认物种是人，如果是小鼠就要用<strong>ENSMUS</strong>开头，关于物种代码：http://www.ensembl.org/info/genome/stable_ids/index.html<br /></li><li><strong>G</strong>表示：这个ID指向一个基因；<strong>E</strong>指向Exon；<strong>FM</strong>指向 protein family；<strong>GT</strong>指向gene tree；<strong>P</strong>指向protein；R指向regulary feature；T指向transcript<br /></li><li>后面11位数字部分如00000279928 表示基因真正的编号<br /></li><li>小数点后不一定每个都有，<strong>表示这个ID在数据库中做了几次变更</strong>，比如.1做了1次变更，在分析时需要去除</li></ul></blockquote><h2 id="ensembl-id-与-symbol对应关系">Ensembl ID 与 Symbol对应关系</h2><h3 id="一对多">一对多</h3><p>在转换时会存在一个<code>Ensembl ID</code>对应多个<code>Symbol</code>的现象。此时，为了保证ID转换的准确性，需要对这些ID进行专门的转换，可以更换注释资源进行操作</p><blockquote><p>不同的注释资源之间会有差别，有时并不可靠</p></blockquote><h3 id="多对一">多对一</h3><p>同样，会存在一些<code>Ensembl ID</code>对应同一个<code>Symbol</code>，此时，除了其中一个真正对应的外，其他的可以叫做<code>haplotypic regions</code>。像这样的ID需要检查ENSG对应的染色体位置进行辨别</p><blockquote><p><strong>Haplotyptic regions</strong> are defined by the Genome Reference Consortium (GRC) and are visible on all their genome assemblies for human, mouse, and zebrafish. They can also be called ‘<strong>alternate locus</strong>’, ‘<strong>partial chromosomes</strong>’, and ‘<strong>alternate alleles</strong>’ or ‘<strong>assembly exceptions</strong>’.<br />These regions can have small sequence differences, contain <strong>different gene structures or different genes entirely</strong>, or contain <strong>genes in a different order compared to the reference genome assembly</strong>.</p></blockquote><h2 id="注释途径">注释途径</h2><ul class="task-list"><li><input type="checkbox" disabled="" checked="" />bitr<br /></li><li><input type="checkbox" disabled="" checked="" />biomart</li></ul>]]></content>
      
      
      <categories>
          
          <category> IDconvert </category>
          
      </categories>
      
      
        <tags>
            
            <tag> gene </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dplyr学习笔记(三)</title>
      <link href="2020/05/28/dplyr-iii/"/>
      <url>2020/05/28/dplyr-iii/</url>
      
        <content type="html"><![CDATA[<p>对于数据进行操作时，往往不限于单个数据的操作，多数情况需要对数据进行整合，过滤，标准化。在<code>dplyr</code>包中，提供了一系列的快捷操作，用于两个数据之间的操作处理</p><h2 id="合并join操作">合并(join)操作</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(<span class="string">&quot;nycflights13&quot;</span>)</span><br><span class="line"><span class="comment"># Drop unimportant variables so it&#x27;s easier to understand the join results.</span></span><br><span class="line">flights2 &lt;- flights %&gt;% select(year:day, hour, origin, dest, tailnum, carrier)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 向前边的数据添加变量</span></span><br><span class="line">flights2 %&gt;% </span><br><span class="line">  left_join(airlines)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## Joining, by &#x3D; &quot;carrier&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 336,776 x 9</span><br><span class="line">##     year month   day  hour origin dest  tailnum carrier name </span><br><span class="line">##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;</span><br><span class="line">##  1  2013     1     1     5 EWR    IAH   N14228  UA      Unit~</span><br><span class="line">##  2  2013     1     1     5 LGA    IAH   N24211  UA      Unit~</span><br><span class="line">##  3  2013     1     1     5 JFK    MIA   N619AA  AA      Amer~</span><br><span class="line">##  4  2013     1     1     5 JFK    BQN   N804JB  B6      JetB~</span><br><span class="line">##  5  2013     1     1     6 LGA    ATL   N668DN  DL      Delt~</span><br><span class="line">##  6  2013     1     1     5 EWR    ORD   N39463  UA      Unit~</span><br><span class="line">##  7  2013     1     1     6 EWR    FLL   N516JB  B6      JetB~</span><br><span class="line">##  8  2013     1     1     6 LGA    IAD   N829AS  EV      Expr~</span><br><span class="line">##  9  2013     1     1     6 JFK    MCO   N593JB  B6      JetB~</span><br><span class="line">## 10  2013     1     1     6 LGA    ORD   N3ALAA  AA      Amer~</span><br><span class="line">## # ... with 336,766 more rows</span><br></pre></td></tr></table></figure><h3 id="join变量参照">join变量参照</h3><p>在进行join操作时，选取变量作为参照，对数据进行合并，在默认情况下时<code>NULL</code>，意思为根据所有变量进行合并</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flights2 %&gt;% left_join(weather)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## Joining, by &#x3D; c(&quot;year&quot;, &quot;month&quot;, &quot;day&quot;, &quot;hour&quot;, &quot;origin&quot;)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 336,776 x 18</span><br><span class="line">##     year month   day  hour origin dest  tailnum carrier  temp</span><br><span class="line">##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;</span><br><span class="line">##  1  2013     1     1     5 EWR    IAH   N14228  UA       39.0</span><br><span class="line">##  2  2013     1     1     5 LGA    IAH   N24211  UA       39.9</span><br><span class="line">##  3  2013     1     1     5 JFK    MIA   N619AA  AA       39.0</span><br><span class="line">##  4  2013     1     1     5 JFK    BQN   N804JB  B6       39.0</span><br><span class="line">##  5  2013     1     1     6 LGA    ATL   N668DN  DL       39.9</span><br><span class="line">##  6  2013     1     1     5 EWR    ORD   N39463  UA       39.0</span><br><span class="line">##  7  2013     1     1     6 EWR    FLL   N516JB  B6       37.9</span><br><span class="line">##  8  2013     1     1     6 LGA    IAD   N829AS  EV       39.9</span><br><span class="line">##  9  2013     1     1     6 JFK    MCO   N593JB  B6       37.9</span><br><span class="line">## 10  2013     1     1     6 LGA    ORD   N3ALAA  AA       39.9</span><br><span class="line">## # ... with 336,766 more rows, and 9 more variables:</span><br><span class="line">## #   dewp &lt;dbl&gt;, humid &lt;dbl&gt;, wind_dir &lt;dbl&gt;,</span><br><span class="line">## #   wind_speed &lt;dbl&gt;, wind_gust &lt;dbl&gt;, precip &lt;dbl&gt;,</span><br><span class="line">## #   pressure &lt;dbl&gt;, visib &lt;dbl&gt;, time_hour &lt;dttm&gt;</span><br></pre></td></tr></table></figure><p>同样，也可以设定特殊的列作为参考进行数据合并</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flights2 %&gt;% left_join(planes, by = <span class="string">&quot;tailnum&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 336,776 x 16</span><br><span class="line">##    year.x month   day  hour origin dest  tailnum carrier</span><br><span class="line">##     &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;  </span><br><span class="line">##  1   2013     1     1     5 EWR    IAH   N14228  UA     </span><br><span class="line">##  2   2013     1     1     5 LGA    IAH   N24211  UA     </span><br><span class="line">##  3   2013     1     1     5 JFK    MIA   N619AA  AA     </span><br><span class="line">##  4   2013     1     1     5 JFK    BQN   N804JB  B6     </span><br><span class="line">##  5   2013     1     1     6 LGA    ATL   N668DN  DL     </span><br><span class="line">##  6   2013     1     1     5 EWR    ORD   N39463  UA     </span><br><span class="line">##  7   2013     1     1     6 EWR    FLL   N516JB  B6     </span><br><span class="line">##  8   2013     1     1     6 LGA    IAD   N829AS  EV     </span><br><span class="line">##  9   2013     1     1     6 JFK    MCO   N593JB  B6     </span><br><span class="line">## 10   2013     1     1     6 LGA    ORD   N3ALAA  AA     </span><br><span class="line">## # ... with 336,766 more rows, and 8 more variables:</span><br><span class="line">## #   year.y &lt;int&gt;, type &lt;chr&gt;, manufacturer &lt;chr&gt;,</span><br><span class="line">## #   model &lt;chr&gt;, engines &lt;int&gt;, seats &lt;int&gt;, speed &lt;int&gt;,</span><br><span class="line">## #   engine &lt;chr&gt;</span><br></pre></td></tr></table></figure><p>当在两个数据中，需要参考的变量的名称不一样怎么办？使用<code>by = c("x" = "a")</code>进行操作</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flights2 %&gt;% left_join(airports, c(<span class="string">&quot;dest&quot;</span> = <span class="string">&quot;faa&quot;</span>))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 336,776 x 15</span><br><span class="line">##     year month   day  hour origin dest  tailnum carrier name </span><br><span class="line">##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;</span><br><span class="line">##  1  2013     1     1     5 EWR    IAH   N14228  UA      Geor~</span><br><span class="line">##  2  2013     1     1     5 LGA    IAH   N24211  UA      Geor~</span><br><span class="line">##  3  2013     1     1     5 JFK    MIA   N619AA  AA      Miam~</span><br><span class="line">##  4  2013     1     1     5 JFK    BQN   N804JB  B6      &lt;NA&gt; </span><br><span class="line">##  5  2013     1     1     6 LGA    ATL   N668DN  DL      Hart~</span><br><span class="line">##  6  2013     1     1     5 EWR    ORD   N39463  UA      Chic~</span><br><span class="line">##  7  2013     1     1     6 EWR    FLL   N516JB  B6      Fort~</span><br><span class="line">##  8  2013     1     1     6 LGA    IAD   N829AS  EV      Wash~</span><br><span class="line">##  9  2013     1     1     6 JFK    MCO   N593JB  B6      Orla~</span><br><span class="line">## 10  2013     1     1     6 LGA    ORD   N3ALAA  AA      Chic~</span><br><span class="line">## # ... with 336,766 more rows, and 6 more variables:</span><br><span class="line">## #   lat &lt;dbl&gt;, lon &lt;dbl&gt;, alt &lt;dbl&gt;, tz &lt;dbl&gt;, dst &lt;chr&gt;,</span><br><span class="line">## #   tzone &lt;chr&gt;</span><br></pre></td></tr></table></figure><h3 id="join的类型">join的类型</h3><h4 id="inner_join">inner_join()</h4><p>合并后保留两个数据公有的观测值，保留所有unique的变量</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df1 &lt;- tibble(x = c(<span class="number">1</span>, <span class="number">2</span>), y = <span class="number">2</span>:<span class="number">1</span>)</span><br><span class="line">df2 &lt;- tibble(x = c(<span class="number">1</span>, <span class="number">3</span>), a = <span class="number">10</span>, b = <span class="string">&quot;a&quot;</span>)</span><br><span class="line">df1 %&gt;% inner_join(df2)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## Joining, by &#x3D; &quot;x&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 1 x 4</span><br><span class="line">##       x     y     a b    </span><br><span class="line">##   &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;</span><br><span class="line">## 1     1     2    10 a</span><br></pre></td></tr></table></figure><h4 id="left_join">left_join()</h4><p>合并后包含第一个数据所有的观测值，第二个数据中没有的值用<code>NA</code>表示</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1 %&gt;% left_join(df2)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## Joining, by &#x3D; &quot;x&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 2 x 4</span><br><span class="line">##       x     y     a b    </span><br><span class="line">##   &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;</span><br><span class="line">## 1     1     2    10 a    </span><br><span class="line">## 2     2     1    NA &lt;NA&gt;</span><br></pre></td></tr></table></figure><h4 id="right_join">right_join()</h4><p>合并后保留第二个数据所有的观测值，等同于<code>left_join(y,x)</code>，不过变量顺序发生了改变</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1 %&gt;% right_join(df2)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## Joining, by &#x3D; &quot;x&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 2 x 4</span><br><span class="line">##       x     y     a b    </span><br><span class="line">##   &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;</span><br><span class="line">## 1     1     2    10 a    </span><br><span class="line">## 2     3    NA    10 a</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df2 %&gt;% left_join(df1)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## Joining, by &#x3D; &quot;x&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 2 x 4</span><br><span class="line">##       x     a b         y</span><br><span class="line">##   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;int&gt;</span><br><span class="line">## 1     1    10 a         2</span><br><span class="line">## 2     3    10 a        NA</span><br></pre></td></tr></table></figure><h4 id="full_join">full_join()</h4><p>合并后包含两个数据所有的观测值，没有的值用<code>NA</code>补足</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1 %&gt;% full_join(df2)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## Joining, by &#x3D; &quot;x&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 3 x 4</span><br><span class="line">##       x     y     a b    </span><br><span class="line">##   &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;</span><br><span class="line">## 1     1     2    10 a    </span><br><span class="line">## 2     2     1    NA &lt;NA&gt; </span><br><span class="line">## 3     3    NA    10 a</span><br></pre></td></tr></table></figure><h4 id="semi_join">semi_join()</h4><p>合并后保留第一个数据中所有在第二个数据中匹配到的观测值</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df1 &lt;- tibble(x = c(<span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>), y = <span class="number">1</span>:<span class="number">4</span>)</span><br><span class="line">df2 &lt;- tibble(x = c(<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>), z = c(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;a&quot;</span>))</span><br><span class="line">df1 %&gt;% semi_join(df2, by = <span class="string">&quot;x&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 2 x 2</span><br><span class="line">##       x     y</span><br><span class="line">##   &lt;dbl&gt; &lt;int&gt;</span><br><span class="line">## 1     1     1</span><br><span class="line">## 2     1     2</span><br></pre></td></tr></table></figure><h4 id="anti_join">anti_join()</h4><p>合并后保留第一个数据中所有在第二个数据中未匹配到的观测值</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1 %&gt;% anti_join(df2, by = <span class="string">&quot;x&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 2 x 2</span><br><span class="line">##       x     y</span><br><span class="line">##   &lt;dbl&gt; &lt;int&gt;</span><br><span class="line">## 1     3     3</span><br><span class="line">## 2     4     4</span><br></pre></td></tr></table></figure><h2 id="集合操作">集合操作</h2><p>在基础R函数中的向量取集操作运用到data.frame水平</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df1 &lt;- tibble(x = <span class="number">1</span>:<span class="number">2</span>, y = c(<span class="number">1L</span>, <span class="number">1L</span>))</span><br><span class="line">df2 &lt;- tibble(x = <span class="number">1</span>:<span class="number">2</span>, y = <span class="number">1</span>:<span class="number">2</span>)</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">intersect(df1, df2)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 1 x 2</span><br><span class="line">##       x     y</span><br><span class="line">##   &lt;int&gt; &lt;int&gt;</span><br><span class="line">## 1     1     1</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union(df1, df2)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 3 x 2</span><br><span class="line">##       x     y</span><br><span class="line">##   &lt;int&gt; &lt;int&gt;</span><br><span class="line">## 1     1     1</span><br><span class="line">## 2     2     1</span><br><span class="line">## 3     2     2</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setdiff(df1, df2)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 1 x 2</span><br><span class="line">##       x     y</span><br><span class="line">##   &lt;int&gt; &lt;int&gt;</span><br><span class="line">## 1     2     1</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setdiff(df2, df1)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 1 x 2</span><br><span class="line">##       x     y</span><br><span class="line">##   &lt;int&gt; &lt;int&gt;</span><br><span class="line">## 1     2     2</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tidyverse </tag>
            
            <tag> dplyr </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ggpubr使用指南(一)</title>
      <link href="2020/05/28/ggpubr-i/"/>
      <url>2020/05/28/ggpubr-i/</url>
      
        <content type="html"><![CDATA[<p><code>ggpubr</code> 是由 <strong>Alboukadel Kassambara</strong> 开发的一款非常优秀的基于<code>ggplot2</code>作图的可视化R包，一行命令即可简单方便的绘制出符合出版物要求的图形。<a id="more"></a></p><blockquote><p>ggplot2 by Hadley Wickham is an excellent and flexible package for elegant data visualization in R. However the default generated plots requires some formatting before we can send them for publication. Furthermore, to customize a ggplot, the syntax is opaque and this raises the level of difficulty for researchers with no advanced R programming skills. The 'ggpubr' package provides some easy-to-use functions for creating and customizing 'ggplot2'- based publication ready plots.</p></blockquote><h3 id="r包安装">R包安装</h3><figure class="highlight plain"><figcaption><span>echo</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">install.packages(&quot;ggpubr&quot;)</span><br><span class="line">library(ggpubr)</span><br><span class="line"></span><br><span class="line"># github安装</span><br><span class="line">if(!require(devtools)) install.packages(&quot;devtools&quot;)</span><br><span class="line">devtools::install_github(&quot;kassambara&#x2F;ggpubr&quot;)</span><br><span class="line">library(ggpubr)</span><br></pre></td></tr></table></figure><h3 id="常用图形绘制">常用图形绘制</h3><h4 id="分布图绘制distribution">分布图绘制(Distribution)</h4><ol type="1"><li><strong>带有均值线和地毯线的密度图</strong></li></ol><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#构建数据集set.seed(1234)</span></span><br><span class="line">df &lt;- data.frame( sex=factor(rep(c(<span class="string">&quot;f&quot;</span>, <span class="string">&quot;M&quot;</span>), each=<span class="number">200</span>)),</span><br><span class="line">                 weight=c(rnorm(<span class="number">200</span>, <span class="number">55</span>), rnorm(<span class="number">200</span>, <span class="number">58</span>)))</span><br><span class="line"><span class="comment"># 预览数据格式</span></span><br><span class="line">head(df)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">##   sex   weight</span><br><span class="line">## 1   f 58.29504</span><br><span class="line">## 2   f 53.92389</span><br><span class="line">## 3   f 55.38073</span><br><span class="line">## 4   f 53.90834</span><br><span class="line">## 5   f 54.95872</span><br><span class="line">## 6   f 55.28395</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 绘制密度图</span></span><br><span class="line"><span class="comment"># rug参数添加地毯线，add参数可以添加均值mean和中位数median，按性别”sex“分组标记边框线颜色和填充色，使用palette参数自定义颜色</span></span><br><span class="line">p1 &lt;- ggdensity(df, x=<span class="string">&quot;weight&quot;</span>, add = <span class="string">&quot;mean&quot;</span>, rug = <span class="literal">TRUE</span>, color = <span class="string">&quot;sex&quot;</span>, </span><br><span class="line">                fill = <span class="string">&quot;sex&quot;</span>,palette = c(<span class="string">&quot;#00AFBB&quot;</span>, <span class="string">&quot;#E7B800&quot;</span>)) </span><br><span class="line">p1</span><br></pre></td></tr></table></figure><figure><img src="/images/ggpubr-i/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-3</figcaption></figure><ol start="2" type="1"><li><strong>带有均值线和边际地毯线的直方图</strong></li></ol><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p2 &lt;- gghistogram(df, x=<span class="string">&quot;weight&quot;</span>, add = <span class="string">&quot;mean&quot;</span>, rug = <span class="literal">TRUE</span>, color = <span class="string">&quot;sex&quot;</span>, </span><br><span class="line">                  fill = <span class="string">&quot;sex&quot;</span>,palette = c(<span class="string">&quot;#00AFBB&quot;</span>, <span class="string">&quot;#E7B800&quot;</span>))</span><br><span class="line">p2</span><br></pre></td></tr></table></figure><figure><img src="/images/ggpubr-i/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-4</figcaption></figure><h4 id="箱线小提琴图绘制barplotviolinplot">箱线/小提琴图绘制(barplot/violinplot)</h4><ol type="1"><li><strong>箱线图+分组形状+统计</strong></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">data(&quot;mtcars&quot;)</span><br><span class="line">#jitter参数添加扰动点，点的形状shape由dose变量映射</span><br><span class="line">p3 &lt;- ggboxplot(mtcars, x&#x3D;&quot;cyl&quot;, y&#x3D;&quot;drat&quot;, color &#x3D; &quot;cyl&quot;,</span><br><span class="line">                palette &#x3D; c(&quot;#00AFBB&quot;, &quot;#E7B800&quot;, &quot;#FC4E07&quot;),</span><br><span class="line">                add &#x3D; &quot;jitter&quot;, shape&#x3D;&quot;cyl&quot;) </span><br><span class="line">p3</span><br></pre></td></tr></table></figure><figure><img src="/images/ggpubr-i/unnamed-chunk-5-1.png" alt="plot of chunk unnamed-chunk-5" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-5</figcaption></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># stat_compare_means参数比较不同组之间的均值，并增加不同组间比较的p-value值，可以自定义需要标注的组间比较</span></span><br><span class="line">my_comparisons &lt;- list(c(<span class="string">&quot;4&quot;</span>, <span class="string">&quot;6&quot;</span>), c(<span class="string">&quot;6&quot;</span>, <span class="string">&quot;8&quot;</span>), c(<span class="string">&quot;4&quot;</span>, <span class="string">&quot;8&quot;</span>))</span><br><span class="line">p4 &lt;- p3 + stat_compare_means(comparisons = my_comparisons)+</span><br><span class="line">  stat_compare_means(label.y = <span class="number">6</span>)</span><br><span class="line">p4</span><br></pre></td></tr></table></figure><figure><img src="/images/ggpubr-i/unnamed-chunk-6-1.png" alt="plot of chunk unnamed-chunk-6" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-6</figcaption></figure><ol start="2" type="1"><li><strong>内有箱线图的小提琴图+星标记</strong></li></ol><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add = “boxplot”添加箱线图，stat_compare_means中设置lable=”p.signif”，即可添加星添加组间比较连线和统计P值按星分类add添加箱线图，label标注选择显著性标记（星号）</span></span><br><span class="line">p5 &lt;- ggviolin(mtcars, x=<span class="string">&quot;cyl&quot;</span>, y=<span class="string">&quot;drat&quot;</span>, fill = <span class="string">&quot;cyl&quot;</span>,</span><br><span class="line">               palette = c(<span class="string">&quot;#00AFBB&quot;</span>, <span class="string">&quot;#E7B800&quot;</span>, <span class="string">&quot;#FC4E07&quot;</span>),</span><br><span class="line">               add = <span class="string">&quot;boxplot&quot;</span>, add.params = list(fill=<span class="string">&quot;white&quot;</span>))+        </span><br><span class="line">  stat_compare_means(comparisons = my_comparisons, label = <span class="string">&quot;p.signif&quot;</span>) +         </span><br><span class="line">  stat_compare_means(label.y = <span class="number">6</span>)</span><br><span class="line">p5</span><br></pre></td></tr></table></figure><figure><img src="/images/ggpubr-i/unnamed-chunk-7-1.png" alt="plot of chunk unnamed-chunk-7" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-7</figcaption></figure><h4 id="条形柱状图绘制barplot">条形/柱状图绘制(barplot)</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">df2 &lt;- mtcars</span><br><span class="line"><span class="comment"># 设置因子变量</span></span><br><span class="line">df2$cyl &lt;- factor(df2$cyl)</span><br><span class="line">df2$name &lt;- rownames(df2) <span class="comment">#添加一新列name</span></span><br><span class="line">head(df2[, c(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;wt&quot;</span>, <span class="string">&quot;mpg&quot;</span>, <span class="string">&quot;cyl&quot;</span>)])</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">##                                name    wt  mpg cyl</span><br><span class="line">## Mazda RX4                 Mazda RX4 2.620 21.0   6</span><br><span class="line">## Mazda RX4 Wag         Mazda RX4 Wag 2.875 21.0   6</span><br><span class="line">## Datsun 710               Datsun 710 2.320 22.8   4</span><br><span class="line">## Hornet 4 Drive       Hornet 4 Drive 3.215 21.4   6</span><br><span class="line">## Hornet Sportabout Hornet Sportabout 3.440 18.7   8</span><br><span class="line">## Valiant                     Valiant 3.460 18.1   6</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 颜色按nature配色方法(支持 ggsci包中的本色方案 ，如: “npg”, “aaas”, “lancet”, “jco”, “ucscgb”, “uchicago”, “simpsons” and “rickandmorty”)</span></span><br><span class="line">p6 &lt;- ggbarplot(df2, x=<span class="string">&quot;name&quot;</span>, y=<span class="string">&quot;mpg&quot;</span>, fill = <span class="string">&quot;cyl&quot;</span>, color = <span class="string">&quot;white&quot;</span>,</span><br><span class="line">         palette = <span class="string">&quot;npg&quot;</span>, <span class="comment">#杂志nature的配色         </span></span><br><span class="line">         sort.val = <span class="string">&quot;desc&quot;</span>, <span class="comment">#降序排序         </span></span><br><span class="line">         sort.by.groups=<span class="literal">FALSE</span>, <span class="comment">#不按组排序         </span></span><br><span class="line">         x.text.angle=<span class="number">60</span>)</span><br><span class="line">p6</span><br></pre></td></tr></table></figure><figure><img src="/images/ggpubr-i/unnamed-chunk-8-1.png" alt="plot of chunk unnamed-chunk-8" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-8</figcaption></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 按组进行排序</span></span><br><span class="line">p7 &lt;- ggbarplot(df2, x=<span class="string">&quot;name&quot;</span>, y=<span class="string">&quot;mpg&quot;</span>, fill = <span class="string">&quot;cyl&quot;</span>, color = <span class="string">&quot;white&quot;</span>,</span><br><span class="line">         palette = <span class="string">&quot;aaas&quot;</span>, <span class="comment">#杂志Science的配色</span></span><br><span class="line">         sort.val = <span class="string">&quot;asc&quot;</span>, <span class="comment">#升序排序,区别于desc         </span></span><br><span class="line">         sort.by.groups=<span class="literal">TRUE</span>,x.text.angle=<span class="number">60</span>) <span class="comment">#按组排序 x.text.angl设置x轴标签旋转角度</span></span><br><span class="line">p7</span><br></pre></td></tr></table></figure><figure><img src="/images/ggpubr-i/unnamed-chunk-9-1.png" alt="plot of chunk unnamed-chunk-9" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-9</figcaption></figure><h4 id="ƫͼdeviation-graphs">ƫ��ͼ����(Deviation graphs)</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">df2$mpg_z &lt;- (df2$mpg-mean(df2$mpg))/sd(df2$mpg)    </span><br><span class="line"><span class="comment"># 相当于Zscore标准化，减均值，除标准差</span></span><br><span class="line">df2$mpg_grp &lt;- factor(ifelse(df2$mpg_z&lt;<span class="number">0</span>, <span class="string">&quot;low&quot;</span>, <span class="string">&quot;high&quot;</span>), levels = c(<span class="string">&quot;low&quot;</span>, <span class="string">&quot;high&quot;</span>))   </span><br><span class="line"><span class="comment">#设置分组因子</span></span><br><span class="line">head(df2[, c(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;wt&quot;</span>, <span class="string">&quot;mpg&quot;</span>, <span class="string">&quot;mpg_grp&quot;</span>, <span class="string">&quot;cyl&quot;</span>)])</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">##                                name    wt  mpg mpg_grp cyl</span><br><span class="line">## Mazda RX4                 Mazda RX4 2.620 21.0    high   6</span><br><span class="line">## Mazda RX4 Wag         Mazda RX4 Wag 2.875 21.0    high   6</span><br><span class="line">## Datsun 710               Datsun 710 2.320 22.8    high   4</span><br><span class="line">## Hornet 4 Drive       Hornet 4 Drive 3.215 21.4    high   6</span><br><span class="line">## Hornet Sportabout Hornet Sportabout 3.440 18.7     low   8</span><br><span class="line">## Valiant                     Valiant 3.460 18.1     low   6</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">p8 &lt;- ggbarplot(df2, x=<span class="string">&quot;name&quot;</span>, y=<span class="string">&quot;mpg_z&quot;</span>, fill = <span class="string">&quot;mpg_grp&quot;</span>, color = <span class="string">&quot;white&quot;</span>,</span><br><span class="line">      palette = <span class="string">&quot;jco&quot;</span>, sort.val = <span class="string">&quot;asc&quot;</span>, sort.by.groups = <span class="literal">FALSE</span>,                   </span><br><span class="line">      x.text.angle=<span class="number">60</span>, ylab = <span class="string">&quot;MPG z-score&quot;</span>, xlab = <span class="literal">FALSE</span>)</span><br><span class="line">p8</span><br></pre></td></tr></table></figure><figure><img src="/images/ggpubr-i/unnamed-chunk-11-1.png" alt="plot of chunk unnamed-chunk-11" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-11</figcaption></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rotate设置x/y轴对换</span></span><br><span class="line">p9 &lt;- ggbarplot(df2, x=<span class="string">&quot;name&quot;</span>, y=<span class="string">&quot;mpg_z&quot;</span>, fill = <span class="string">&quot;mpg_grp&quot;</span>, color = <span class="string">&quot;white&quot;</span>,</span><br><span class="line">         palette = <span class="string">&quot;jco&quot;</span>, sort.val = <span class="string">&quot;desc&quot;</span>, sort.by.groups = <span class="literal">FALSE</span>,</span><br><span class="line">         x.text.angle=<span class="number">90</span>, ylab = <span class="string">&quot;MPG z-score&quot;</span>, xlab = <span class="literal">FALSE</span>,</span><br><span class="line">        rotate=<span class="literal">TRUE</span>, ggtheme = theme_minimal())   </span><br><span class="line">p9</span><br></pre></td></tr></table></figure><figure><img src="/images/ggpubr-i/unnamed-chunk-12-1.png" alt="plot of chunk unnamed-chunk-12" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-12</figcaption></figure><h4 id="棒棒糖图绘制lollipop-chart">棒棒糖图绘制(Lollipop chart)</h4><p>棒棒图代替条形图展示数据</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">p10 &lt;- ggdotchart(df2, x=<span class="string">&quot;name&quot;</span>, y=<span class="string">&quot;mpg&quot;</span>, color = <span class="string">&quot;cyl&quot;</span>,</span><br><span class="line">          palette = c(<span class="string">&quot;#00AFBB&quot;</span>, <span class="string">&quot;#E7B800&quot;</span>, <span class="string">&quot;#FC4E07&quot;</span>),          </span><br><span class="line">          sorting = <span class="string">&quot;ascending&quot;</span>,          </span><br><span class="line">          add = <span class="string">&quot;segments&quot;</span>, ggtheme = theme_pubr())</span><br><span class="line">p10</span><br></pre></td></tr></table></figure><figure><img src="/images/ggpubr-i/unnamed-chunk-13-1.png" alt="plot of chunk unnamed-chunk-13" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-13</figcaption></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置其他参数, dot.size = 6调整糖的大小，添加label标签，设置字体样式和方向</span></span><br><span class="line">p11 &lt;- ggdotchart(df2, x=<span class="string">&quot;name&quot;</span>, y=<span class="string">&quot;mpg&quot;</span>, color = <span class="string">&quot;cyl&quot;</span>, </span><br><span class="line">         palette = c(<span class="string">&quot;#00AFBB&quot;</span>, <span class="string">&quot;#E7B800&quot;</span>, <span class="string">&quot;#FC4E07&quot;</span>),          </span><br><span class="line">         sorting = <span class="string">&quot;descending&quot;</span>, add = <span class="string">&quot;segments&quot;</span>, rotate = <span class="literal">TRUE</span>,</span><br><span class="line">         group = <span class="string">&quot;cyl&quot;</span>, dot.size = <span class="number">6</span>,          </span><br><span class="line">         label = round(df2$mpg), font.label = list(color=<span class="string">&quot;white&quot;</span>,</span><br><span class="line">         size=<span class="number">9</span>, vjust=<span class="number">0.5</span>), ggtheme = theme_pubr())</span><br><span class="line">p11</span><br></pre></td></tr></table></figure><figure><img src="/images/ggpubr-i/unnamed-chunk-14-1.png" alt="plot of chunk unnamed-chunk-14" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-14</figcaption></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#棒棒糖偏差图</span></span><br><span class="line">p12 &lt;- ggdotchart(df2, x = <span class="string">&quot;name&quot;</span>, y = <span class="string">&quot;mpg_z&quot;</span>,</span><br><span class="line">                  color = <span class="string">&quot;cyl&quot;</span>, <span class="comment"># Color by groups                    </span></span><br><span class="line">                  palette = c(<span class="string">&quot;#00AFBB&quot;</span>, <span class="string">&quot;#E7B800&quot;</span>, <span class="string">&quot;#FC4E07&quot;</span>), <span class="comment"># Custom color palette                    </span></span><br><span class="line">                  sorting = <span class="string">&quot;descending&quot;</span>, <span class="comment"># Sort value in descending order                    </span></span><br><span class="line">                  add = <span class="string">&quot;segments&quot;</span>, <span class="comment"># Add segments from y = 0 to dots                    </span></span><br><span class="line">                  add.params = list(color = <span class="string">&quot;lightgray&quot;</span>, size = <span class="number">2</span>), <span class="comment"># Change segment color and size                    </span></span><br><span class="line">                  group = <span class="string">&quot;cyl&quot;</span>, <span class="comment"># Order by groups                   </span></span><br><span class="line">                  dot.size = <span class="number">6</span>, <span class="comment"># Large dot size                    </span></span><br><span class="line">                  label = round(df2$mpg_z,<span class="number">1</span>), <span class="comment"># Add mpg values as dot labels，设置一位小数                    </span></span><br><span class="line">                  font.label = list(color = <span class="string">&quot;white&quot;</span>, size = <span class="number">9</span>, vjust = <span class="number">0.5</span>), <span class="comment"># Adjust label parameters                    </span></span><br><span class="line">                  ggtheme = theme_pubr()) + </span><br><span class="line">                  geom_hline(yintercept = <span class="number">0</span>, linetype = <span class="number">2</span>, color = <span class="string">&quot;lightgray&quot;</span>)</span><br><span class="line">p12</span><br></pre></td></tr></table></figure><figure><img src="/images/ggpubr-i/unnamed-chunk-15-1.png" alt="plot of chunk unnamed-chunk-15" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-15</figcaption></figure><h4 id="clevelandͼ">Cleveland��ͼ����</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># theme_cleveland()主题可设置为Cleveland点图样式</span></span><br><span class="line">p13 &lt;- ggdotchart(df2, x = <span class="string">&quot;name&quot;</span>, y = <span class="string">&quot;mpg&quot;</span>,</span><br><span class="line">                  color = <span class="string">&quot;cyl&quot;</span>, <span class="comment"># Color by groups                    </span></span><br><span class="line">                  palette = c(<span class="string">&quot;#00AFBB&quot;</span>, <span class="string">&quot;#E7B800&quot;</span>, <span class="string">&quot;#FC4E07&quot;</span>), <span class="comment"># Custom color palette                    </span></span><br><span class="line">                  sorting = <span class="string">&quot;descending&quot;</span>, <span class="comment"># Sort value in descending order                    </span></span><br><span class="line">                  rotate = <span class="literal">TRUE</span>, <span class="comment"># Rotate vertically                    </span></span><br><span class="line">                  dot.size = <span class="number">2</span>, <span class="comment"># Large dot size                    </span></span><br><span class="line">                  y.text.col = <span class="literal">TRUE</span>, <span class="comment"># Color y text by groups                    </span></span><br><span class="line">                  ggtheme = theme_pubr()) + </span><br><span class="line">       theme_cleveland() <span class="comment"># Add dashed grids</span></span><br><span class="line">p13</span><br></pre></td></tr></table></figure><figure><img src="/images/ggpubr-i/unnamed-chunk-16-1.png" alt="plot of chunk unnamed-chunk-16" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-16</figcaption></figure><h3 id="常用基本绘图函数及参数">常用基本绘图函数及参数</h3><h4 id="基本绘图函数">基本绘图函数</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">gghistogram        Histogram plot <span class="comment">#绘制直方图</span></span><br><span class="line">ggdensity        Density plot <span class="comment">#绘制密度图</span></span><br><span class="line">ggdotplot        Dot plot <span class="comment">#绘制点图</span></span><br><span class="line">ggdotchart        Cleveland<span class="string">&#x27;s Dot Plots #绘制Cleveland点图</span></span><br><span class="line"><span class="string">ggline        Line plot #绘制线图</span></span><br><span class="line"><span class="string">ggbarplot        Bar plot #绘制条形/柱状图</span></span><br><span class="line"><span class="string">ggerrorplot        Visualizing Error #绘制误差棒图</span></span><br><span class="line"><span class="string">ggstripchart        Stripcharts #绘制线带图</span></span><br><span class="line"><span class="string">ggboxplot        Box plot #绘制箱线图</span></span><br><span class="line"><span class="string">ggviolin        Violin plot #绘制小提琴图</span></span><br><span class="line"><span class="string">ggpie        Pie chart #绘制饼图</span></span><br><span class="line"><span class="string">ggqqplot        QQ Plots #绘制QQ图</span></span><br><span class="line"><span class="string">ggscatter        Scatter plot #绘制散点图</span></span><br><span class="line"><span class="string">ggmaplot        MA-plot from means and log fold changes #绘制M-A图</span></span><br><span class="line"><span class="string">ggpaired        Plot Paired Data #绘制配对数据</span></span><br><span class="line"><span class="string">ggecdf          Empirical cumulative density function  #绘制经验累积密度分布图</span></span><br></pre></td></tr></table></figure><h4 id="基本参数">基本参数</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">ggtext        Text <span class="comment">#添加文本</span></span><br><span class="line">border        Set ggplot Panel Border Line <span class="comment">#设置画布边框线</span></span><br><span class="line">grids        Add Grids to a ggplot <span class="comment">#添加网格线</span></span><br><span class="line">font        Change the Appearance of Titles and Axis Labels <span class="comment">#设置字体类型</span></span><br><span class="line">bgcolor        Change ggplot Panel Background Color <span class="comment">#更改画布背景颜色</span></span><br><span class="line">background_image        Add Background Image to ggplot2 <span class="comment">#添加背景图片</span></span><br><span class="line">facet        Facet a ggplot into Multiple Panels <span class="comment">#设置分面</span></span><br><span class="line">ggpar        Graphical parameters <span class="comment">#添加画图参数</span></span><br><span class="line">ggparagraph        Draw a Paragraph of Text <span class="comment">#添加文本段落</span></span><br><span class="line">ggtexttable        Draw a Textual Table <span class="comment">#添加文本表格</span></span><br><span class="line">ggadd        Add Summary Statistics or a Geom onto a ggplot <span class="comment">#添加基本统计结果或其他几何图形</span></span><br><span class="line">ggarrange        Arrange Multiple ggplots <span class="comment">#排版多个图形</span></span><br><span class="line">annotate_figure          Annotate Arranged Figure <span class="comment">#添加注释信息</span></span><br><span class="line">gradient_color        Set Gradient Color <span class="comment">#设置连续型颜色</span></span><br><span class="line">xscale        Change Axis Scale: log2, log10 and more <span class="comment">#更改坐标轴的标度</span></span><br><span class="line">add_summary        Add Summary Statistics onto a ggplot <span class="comment">#添加基本统计结果</span></span><br><span class="line">set_palette        Set Color Palette <span class="comment">#设置画板颜色</span></span><br><span class="line">rotate        Rotate a ggplot Horizontally <span class="comment">#设置图形旋转</span></span><br><span class="line">rotate_axis_text        Rotate Axes Text <span class="comment">#旋转坐标轴文本</span></span><br><span class="line">stat_stars        Add Stars to a Scatter Plot <span class="comment">#添加散点图星标</span></span><br><span class="line">stat_cor        Add Correlation Coefficients with P-values to a Scatter Plot <span class="comment">#添加相关系数</span></span><br><span class="line">stat_compare_means        Add Mean Comparison P-values to a ggplot <span class="comment">#添加平均值比较的P值</span></span><br><span class="line">diff_express      Differential gene expression analysis results <span class="comment">#内置差异分析结果数据集</span></span><br><span class="line">ggexport    Export ggplots <span class="comment"># 导出图片</span></span><br><span class="line">theme_transparent        Create a ggplot with Transparent Background <span class="comment">#设置透明背景</span></span><br><span class="line">theme_pubr        Publication ready theme <span class="comment">#设置出版物主题</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> plot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ggpubr使用指南(二)</title>
      <link href="2020/05/28/ggpubr-ii/"/>
      <url>2020/05/28/ggpubr-ii/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="使用ggmaplot函数绘制火山图">使用ggmaplot函数绘制火山图</h2><h3 id="加载所需r包">加载所需R包</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(ggpubr)</span><br></pre></td></tr></table></figure><h3 id="基本用法">基本用法:</h3><p><strong>Usage</strong></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggmaplot(data, fdr = <span class="number">0.05</span>, fc = <span class="number">1.5</span>, genenames = <span class="literal">NULL</span>, detection_call = <span class="literal">NULL</span>, size = <span class="literal">NULL</span>,</span><br><span class="line">  font.label = c(<span class="number">12</span>, <span class="string">&quot;plain&quot;</span>, <span class="string">&quot;black&quot;</span>), label.rectangle = <span class="literal">FALSE</span>, palette = c(<span class="string">&quot;#B31B21&quot;</span>, <span class="string">&quot;#1465AC&quot;</span>, <span class="string">&quot;darkgray&quot;</span>), top = <span class="number">15</span>, select.top.method = c(<span class="string">&quot;padj&quot;</span>, <span class="string">&quot;fc&quot;</span>), main = <span class="literal">NULL</span>, xlab = <span class="string">&quot;Log2 mean expression&quot;</span>,</span><br><span class="line">  ylab = <span class="string">&quot;Log2 fold change&quot;</span>, ggtheme = theme_classic(), <span class="keyword">...</span>)</span><br></pre></td></tr></table></figure><h3 id="常用参数">常用参数：</h3><p><strong>Arguments</strong></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">data    <span class="comment">#差异基因分析结果 an object of class DESeqResults, get_diff, DE_Results, matrix or data frame containing the columns baseMean, log2FoldChange, and padj. Rows are genes.</span></span><br><span class="line">        <span class="comment">#baseMean: the mean expression of genes in the two groups.</span></span><br><span class="line">        <span class="comment">#log2FoldChange: the log2 fold changes of group 2 compared to group 1</span></span><br><span class="line">        <span class="comment">#padj: the adjusted p-value of the used statiscal test.</span></span><br><span class="line">fdr     <span class="comment">#设定fdr阈值 Accepted false discovery rate for considering genes as differentially expressed.</span></span><br><span class="line">fc      <span class="comment">#设定fc阈值 the fold change threshold. Only genes with a fold change &gt;= fc and padj &lt;= fdr are considered as significantly differentially expressed.</span></span><br><span class="line">genenames    <span class="comment">#基因名 a character vector of length nrow(data) specifying gene names corresponding to each row. Used for point labels.</span></span><br><span class="line">detection_call    <span class="comment">#选出特定表达模式的基因进行展示 a numeric vector with length = nrow(data), specifying if the genes is expressed (value = 1) or not (value = 0). For example detection_call = c(1, 1, 0, 1, 0, 1). Default is NULL. If detection_call column is available in data, it will be used.</span></span><br><span class="line">size    <span class="comment">#points size.</span></span><br><span class="line">font.label    <span class="comment">#a vector of length 3 indicating respectively the size (e.g.: 14), the style (e.g.: &quot;plain&quot;, &quot;bold&quot;, &quot;italic&quot;, &quot;bold.italic&quot;) and the color (e.g.: &quot;red&quot;) of point labels. For example font.label = c(14, &quot;bold&quot;, &quot;red&quot;).</span></span><br><span class="line">label.rectangle    <span class="comment">#logical value. If TRUE, add rectangle underneath the text, making it easier to read.</span></span><br><span class="line">palette    <span class="comment">#the color palette to be used for coloring or filling by groups. Allowed values include &quot;grey&quot; for grey color palettes; brewer palettes e.g. &quot;RdBu&quot;, &quot;Blues&quot;, ...; or custom color palette e.g. c(&quot;blue&quot;, &quot;red&quot;); and scientific journal palettes from ggsci R package, e.g.: &quot;npg&quot;, &quot;aaas&quot;, &quot;lancet&quot;, &quot;jco&quot;, &quot;ucscgb&quot;, &quot;uchicago&quot;, &quot;simpsons&quot; and &quot;rickandmorty&quot;.</span></span><br><span class="line">top    <span class="comment">#选定top基因进行展示 the number of top genes to be shown on the plot. Use top = 0 to hide to gene labels.</span></span><br><span class="line">select.top.method    <span class="comment">#methods to be used for selecting top genes. Allowed values include &quot;padj&quot; and &quot;fc&quot; for selecting by adjusted p values or fold changes, respectively.</span></span><br><span class="line">main    <span class="comment">#plot main title.</span></span><br><span class="line">xlab    <span class="comment">#character vector specifying x axis labels. Use xlab = FALSE to hide xlab.</span></span><br><span class="line">ylab    <span class="comment">#character vector specifying y axis labels. Use ylab = FALSE to hide ylab.</span></span><br><span class="line">ggtheme    <span class="comment">#function, ggplot2 theme name. Default value is theme_pubr(). Allowed values include ggplot2 official themes: theme_gray(), theme_bw(), theme_minimal(), theme_classic(), theme_void()</span></span><br><span class="line"><span class="keyword">...</span>     <span class="comment">#other arguments to be passed to ggpar.</span></span><br></pre></td></tr></table></figure><h3 id="使用示例">使用示例</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加载数据集</span></span><br><span class="line">data(diff_express)</span><br><span class="line">head(diff_express)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">##                     name     baseMean log2FoldChange         padj detection_call</span><br><span class="line">## ENSG00000000003   TSPAN6    0.1184475      0.0000000           NA              0</span><br><span class="line">## ENSG00000000419     DPM1 1654.4618144      0.6789538 5.280802e-02              1</span><br><span class="line">## ENSG00000000457    SCYL3  681.0463277      1.5263838 3.915112e-07              1</span><br><span class="line">## ENSG00000000460 C1orf112  389.7226640      3.8933573 1.180333e-14              1</span><br><span class="line">## ENSG00000000938      FGR  364.7810090     -2.3554014 1.559228e-04              1</span><br><span class="line">## ENSG00000000971      CFH    1.1346239      1.2932740 4.491812e-01              0</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p1 &lt;- ggmaplot(diff_express, fdr = <span class="number">0.05</span>, fc = <span class="number">2</span>, size = <span class="number">0.4</span>,</span><br><span class="line">               palette = c(<span class="string">&quot;red&quot;</span>, <span class="string">&quot;green&quot;</span>, <span class="string">&quot;gray&quot;</span>))</span><br><span class="line">p1</span><br></pre></td></tr></table></figure><figure><img src="/images/ggpubr-ii/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-4</figcaption></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">p2 &lt;- ggmaplot(diff_express, main = expression(<span class="string">&quot;Group 1&quot;</span> %-&gt;% <span class="string">&quot;Group 2&quot;</span>),</span><br><span class="line">               fdr = <span class="number">0.05</span>, fc = <span class="number">2</span>, size = <span class="number">0.4</span>,</span><br><span class="line">               palette = c(<span class="string">&quot;#B31B21&quot;</span>, <span class="string">&quot;#1465AC&quot;</span>, <span class="string">&quot;darkgray&quot;</span>),</span><br><span class="line">               genenames = as.vector(diff_express$name),</span><br><span class="line">               xlab = <span class="string">&quot;M&quot;</span>, ylab = <span class="string">&quot;A&quot;</span>,</span><br><span class="line">               legend = <span class="string">&quot;top&quot;</span>, top = <span class="number">20</span>,</span><br><span class="line">               font.label = c(<span class="number">11</span>, <span class="string">&quot;blue&quot;</span>, <span class="string">&quot;red&quot;</span>),</span><br><span class="line">               font.legend = <span class="string">&quot;bold&quot;</span>, font.main = <span class="string">&quot;bold&quot;</span>,</span><br><span class="line">               ggtheme = ggplot2::theme_minimal())</span><br><span class="line">p2</span><br></pre></td></tr></table></figure><figure><img src="/images/ggpubr-ii/unnamed-chunk-5-1.png" alt="plot of chunk unnamed-chunk-5" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-5</figcaption></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Add rectangle around labels</span></span><br><span class="line">p3 &lt;- ggmaplot(diff_express, main = expression(<span class="string">&quot;Group 1&quot;</span> %-&gt;% <span class="string">&quot;Group 2&quot;</span>),</span><br><span class="line">               fdr = <span class="number">0.05</span>, fc = <span class="number">2</span>, size = <span class="number">0.4</span>,</span><br><span class="line">               palette = c(<span class="string">&quot;#B31B21&quot;</span>, <span class="string">&quot;#1465AC&quot;</span>, <span class="string">&quot;darkgray&quot;</span>),</span><br><span class="line">               genenames = as.vector(diff_express$name),</span><br><span class="line">               legend = <span class="string">&quot;top&quot;</span>, top = <span class="number">20</span>, font.label = c(<span class="string">&quot;bold&quot;</span>, <span class="number">11</span>),</span><br><span class="line">               label.rectangle = <span class="literal">TRUE</span>, font.legend = <span class="string">&quot;bold&quot;</span>, </span><br><span class="line">               select.top.method = <span class="string">&quot;padj&quot;</span>, font.main = <span class="string">&quot;bold&quot;</span>,</span><br><span class="line">               ggtheme = ggplot2::theme_minimal())</span><br><span class="line">p3</span><br></pre></td></tr></table></figure><figure><img src="/images/ggpubr-ii/unnamed-chunk-6-1.png" alt="plot of chunk unnamed-chunk-6" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-6</figcaption></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">p4 &lt;- ggmaplot(diff_express, main = expression(<span class="string">&quot;Group 1&quot;</span> %-&gt;% <span class="string">&quot;Group 2&quot;</span>),</span><br><span class="line">               fdr = <span class="number">0.05</span>, fc = <span class="number">2</span>, size = <span class="number">0.5</span>,</span><br><span class="line">               palette = c(<span class="string">&quot;#B31B21&quot;</span>, <span class="string">&quot;#1465AC&quot;</span>, <span class="string">&quot;darkgray&quot;</span>),</span><br><span class="line">               genenames = as.vector(diff_express$name),</span><br><span class="line">               legend = <span class="string">&quot;top&quot;</span>, top = <span class="number">20</span>, font.label = c(<span class="string">&quot;bold&quot;</span>, <span class="number">11</span>),</span><br><span class="line">               label.rectangle = <span class="literal">TRUE</span>, font.legend = <span class="string">&quot;bold&quot;</span>, </span><br><span class="line">               select.top.method = <span class="string">&quot;fc&quot;</span>, font.main = <span class="string">&quot;bold&quot;</span>,</span><br><span class="line">               ggtheme = ggplot2::theme_minimal())</span><br><span class="line">p4</span><br></pre></td></tr></table></figure><figure><img src="/images/ggpubr-ii/unnamed-chunk-7-1.png" alt="plot of chunk unnamed-chunk-7" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-7</figcaption></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sessionInfo()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">## R version 4.0.2 (2020-06-22)</span><br><span class="line">## Platform: x86_64-w64-mingw32&#x2F;x64 (64-bit)</span><br><span class="line">## Running under: Windows 10 x64 (build 17763)</span><br><span class="line">## </span><br><span class="line">## Matrix products: default</span><br><span class="line">## </span><br><span class="line">## locale:</span><br><span class="line">## [1] LC_COLLATE&#x3D;Chinese (Simplified)_China.936  LC_CTYPE&#x3D;Chinese (Simplified)_China.936   </span><br><span class="line">## [3] LC_MONETARY&#x3D;Chinese (Simplified)_China.936 LC_NUMERIC&#x3D;C                              </span><br><span class="line">## [5] LC_TIME&#x3D;Chinese (Simplified)_China.936    </span><br><span class="line">## system code page: 65001</span><br><span class="line">## </span><br><span class="line">## attached base packages:</span><br><span class="line">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span><br><span class="line">## </span><br><span class="line">## other attached packages:</span><br><span class="line">##  [1] ggpubr_0.4.0       nycflights13_1.0.1 forcats_0.5.0      stringr_1.4.0     </span><br><span class="line">##  [5] dplyr_1.0.2        purrr_0.3.4        readr_1.3.1        tidyr_1.1.2       </span><br><span class="line">##  [9] tibble_3.0.3       ggplot2_3.3.2      tidyverse_1.3.0   </span><br><span class="line">## </span><br><span class="line">## loaded via a namespace (and not attached):</span><br><span class="line">##  [1] ggrepel_0.8.2     Rcpp_1.0.5        lubridate_1.7.9   assertthat_0.2.1  digest_0.6.25    </span><br><span class="line">##  [6] utf8_1.1.4        R6_2.4.1          cellranger_1.1.0  backports_1.1.9   reprex_0.3.0     </span><br><span class="line">## [11] evaluate_0.14     httr_1.4.2        highr_0.8         pillar_1.4.6      rlang_0.4.7      </span><br><span class="line">## [16] curl_4.3          readxl_1.3.1      rstudioapi_0.11   data.table_1.13.0 car_3.0-9        </span><br><span class="line">## [21] blob_1.2.1        labeling_0.3      foreign_0.8-80    munsell_0.5.0     broom_0.7.0      </span><br><span class="line">## [26] compiler_4.0.2    modelr_0.1.8      xfun_0.17         pkgconfig_2.0.3   tidyselect_1.1.0 </span><br><span class="line">## [31] rio_0.5.16        fansi_0.4.1       crayon_1.3.4      dbplyr_1.4.4      withr_2.2.0      </span><br><span class="line">## [36] grid_4.0.2        jsonlite_1.7.1    gtable_0.3.0      lifecycle_0.2.0   DBI_1.1.0        </span><br><span class="line">## [41] magrittr_1.5      scales_1.1.1      zip_2.1.1         cli_2.0.2         stringi_1.5.3    </span><br><span class="line">## [46] carData_3.0-4     farver_2.0.3      ggsignif_0.6.0    fs_1.5.0          xml2_1.3.2       </span><br><span class="line">## [51] ellipsis_0.3.1    generics_0.0.2    vctrs_0.3.4       openxlsx_4.1.5    ggsci_2.9        </span><br><span class="line">## [56] tools_4.0.2       glue_1.4.2        hms_0.5.3         abind_1.4-5       colorspace_1.4-1 </span><br><span class="line">## [61] rstatix_0.6.0     rvest_0.3.6       knitr_1.29        haven_2.3.1</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> plot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dplyr学习笔记(一)</title>
      <link href="2020/05/27/dplyr-i/"/>
      <url>2020/05/27/dplyr-i/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h1 id="dplyr">dplyr</h1><p><code>dplyr</code>是<code>tidyverse</code>数据科学包中的重要成员，提供了许多数据操控(data manipulation)的语法，用于快速处理数据。</p><h2 id="verbs-语法">Verbs 语法</h2><p>在<code>dplyr</code>包中，提供了一致的动词语法，帮助解决最常见的数据操作:</p><ul><li><code>filter()</code>: 根据值筛选数据<br /></li><li><code>arrange()</code>: 数据排序<br /></li><li><code>select()</code> 和 <code>rename()</code>: 根据名字选择变量<br /></li><li><code>mutate()</code> 和 <code>transmute()</code>: 修改数据<br /></li><li><code>summarise()</code>: 数据摘要<br /></li><li><code>sample_n()</code>和<code>sample_frac()</code>: 随机选择样本</li></ul><h3 id="filter">filter()</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(nycflights13)</span><br><span class="line">dim(flights)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## [1] 336776     19</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flights</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 336,776 x 19</span><br><span class="line">##     year month   day dep_time sched_dep_time dep_delay</span><br><span class="line">##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;</span><br><span class="line">##  1  2013     1     1      517            515         2</span><br><span class="line">##  2  2013     1     1      533            529         4</span><br><span class="line">##  3  2013     1     1      542            540         2</span><br><span class="line">##  4  2013     1     1      544            545        -1</span><br><span class="line">##  5  2013     1     1      554            600        -6</span><br><span class="line">##  6  2013     1     1      554            558        -4</span><br><span class="line">##  7  2013     1     1      555            600        -5</span><br><span class="line">##  8  2013     1     1      557            600        -3</span><br><span class="line">##  9  2013     1     1      557            600        -3</span><br><span class="line">## 10  2013     1     1      558            600        -2</span><br><span class="line">## # ... with 336,766 more rows, and 13 more variables:</span><br><span class="line">## #   arr_time &lt;int&gt;, sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,</span><br><span class="line">## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,</span><br><span class="line">## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span><br><span class="line">## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,</span><br><span class="line">## #   time_hour &lt;dttm&gt;</span><br></pre></td></tr></table></figure><p>根据条件筛选行：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filter(flights, month == <span class="number">1</span>, day == <span class="number">1</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 842 x 19</span><br><span class="line">##     year month   day dep_time sched_dep_time dep_delay</span><br><span class="line">##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;</span><br><span class="line">##  1  2013     1     1      517            515         2</span><br><span class="line">##  2  2013     1     1      533            529         4</span><br><span class="line">##  3  2013     1     1      542            540         2</span><br><span class="line">##  4  2013     1     1      544            545        -1</span><br><span class="line">##  5  2013     1     1      554            600        -6</span><br><span class="line">##  6  2013     1     1      554            558        -4</span><br><span class="line">##  7  2013     1     1      555            600        -5</span><br><span class="line">##  8  2013     1     1      557            600        -3</span><br><span class="line">##  9  2013     1     1      557            600        -3</span><br><span class="line">## 10  2013     1     1      558            600        -2</span><br><span class="line">## # ... with 832 more rows, and 13 more variables:</span><br><span class="line">## #   arr_time &lt;int&gt;, sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,</span><br><span class="line">## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,</span><br><span class="line">## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span><br><span class="line">## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,</span><br><span class="line">## #   time_hour &lt;dttm&gt;</span><br></pre></td></tr></table></figure><p>这等价于<code>flights[flights$month == 1 &amp; flights$day == 1, ]</code></p><h3 id="arrange">arrange()</h3><p>数据排序</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arrange(flights, year, month, day)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 336,776 x 19</span><br><span class="line">##     year month   day dep_time sched_dep_time dep_delay</span><br><span class="line">##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;</span><br><span class="line">##  1  2013     1     1      517            515         2</span><br><span class="line">##  2  2013     1     1      533            529         4</span><br><span class="line">##  3  2013     1     1      542            540         2</span><br><span class="line">##  4  2013     1     1      544            545        -1</span><br><span class="line">##  5  2013     1     1      554            600        -6</span><br><span class="line">##  6  2013     1     1      554            558        -4</span><br><span class="line">##  7  2013     1     1      555            600        -5</span><br><span class="line">##  8  2013     1     1      557            600        -3</span><br><span class="line">##  9  2013     1     1      557            600        -3</span><br><span class="line">## 10  2013     1     1      558            600        -2</span><br><span class="line">## # ... with 336,766 more rows, and 13 more variables:</span><br><span class="line">## #   arr_time &lt;int&gt;, sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,</span><br><span class="line">## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,</span><br><span class="line">## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span><br><span class="line">## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,</span><br><span class="line">## #   time_hour &lt;dttm&gt;</span><br></pre></td></tr></table></figure><p>降序排列</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arrange(flights, desc(arr_delay))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 336,776 x 19</span><br><span class="line">##     year month   day dep_time sched_dep_time dep_delay</span><br><span class="line">##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;</span><br><span class="line">##  1  2013     1     9      641            900      1301</span><br><span class="line">##  2  2013     6    15     1432           1935      1137</span><br><span class="line">##  3  2013     1    10     1121           1635      1126</span><br><span class="line">##  4  2013     9    20     1139           1845      1014</span><br><span class="line">##  5  2013     7    22      845           1600      1005</span><br><span class="line">##  6  2013     4    10     1100           1900       960</span><br><span class="line">##  7  2013     3    17     2321            810       911</span><br><span class="line">##  8  2013     7    22     2257            759       898</span><br><span class="line">##  9  2013    12     5      756           1700       896</span><br><span class="line">## 10  2013     5     3     1133           2055       878</span><br><span class="line">## # ... with 336,766 more rows, and 13 more variables:</span><br><span class="line">## #   arr_time &lt;int&gt;, sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,</span><br><span class="line">## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,</span><br><span class="line">## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span><br><span class="line">## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,</span><br><span class="line">## #   time_hour &lt;dttm&gt;</span><br></pre></td></tr></table></figure><h4 id="select">select()</h4><p>变量筛选</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Select columns by name</span></span><br><span class="line">select(flights, year, month, day)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 336,776 x 3</span><br><span class="line">##     year month   day</span><br><span class="line">##    &lt;int&gt; &lt;int&gt; &lt;int&gt;</span><br><span class="line">##  1  2013     1     1</span><br><span class="line">##  2  2013     1     1</span><br><span class="line">##  3  2013     1     1</span><br><span class="line">##  4  2013     1     1</span><br><span class="line">##  5  2013     1     1</span><br><span class="line">##  6  2013     1     1</span><br><span class="line">##  7  2013     1     1</span><br><span class="line">##  8  2013     1     1</span><br><span class="line">##  9  2013     1     1</span><br><span class="line">## 10  2013     1     1</span><br><span class="line">## # ... with 336,766 more rows</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Select all columns between year and day (inclusive)</span></span><br><span class="line">select(flights, year:day)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 336,776 x 3</span><br><span class="line">##     year month   day</span><br><span class="line">##    &lt;int&gt; &lt;int&gt; &lt;int&gt;</span><br><span class="line">##  1  2013     1     1</span><br><span class="line">##  2  2013     1     1</span><br><span class="line">##  3  2013     1     1</span><br><span class="line">##  4  2013     1     1</span><br><span class="line">##  5  2013     1     1</span><br><span class="line">##  6  2013     1     1</span><br><span class="line">##  7  2013     1     1</span><br><span class="line">##  8  2013     1     1</span><br><span class="line">##  9  2013     1     1</span><br><span class="line">## 10  2013     1     1</span><br><span class="line">## # ... with 336,766 more rows</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Select all columns except those from year to day (inclusive)</span></span><br><span class="line">select(flights, -(year:day))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 336,776 x 16</span><br><span class="line">##    dep_time sched_dep_time dep_delay arr_time sched_arr_time</span><br><span class="line">##       &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;</span><br><span class="line">##  1      517            515         2      830            819</span><br><span class="line">##  2      533            529         4      850            830</span><br><span class="line">##  3      542            540         2      923            850</span><br><span class="line">##  4      544            545        -1     1004           1022</span><br><span class="line">##  5      554            600        -6      812            837</span><br><span class="line">##  6      554            558        -4      740            728</span><br><span class="line">##  7      555            600        -5      913            854</span><br><span class="line">##  8      557            600        -3      709            723</span><br><span class="line">##  9      557            600        -3      838            846</span><br><span class="line">## 10      558            600        -2      753            745</span><br><span class="line">## # ... with 336,766 more rows, and 11 more variables:</span><br><span class="line">## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,</span><br><span class="line">## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span><br><span class="line">## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,</span><br><span class="line">## #   time_hour &lt;dttm&gt;</span><br></pre></td></tr></table></figure><p>利用<code>select</code>和其他辅助函数进行组合，进行更多类型的操作</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 提取变量并重命名</span></span><br><span class="line">select(flights, tail_num = tailnum)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 336,776 x 1</span><br><span class="line">##    tail_num</span><br><span class="line">##    &lt;chr&gt;   </span><br><span class="line">##  1 N14228  </span><br><span class="line">##  2 N24211  </span><br><span class="line">##  3 N619AA  </span><br><span class="line">##  4 N804JB  </span><br><span class="line">##  5 N668DN  </span><br><span class="line">##  6 N39463  </span><br><span class="line">##  7 N516JB  </span><br><span class="line">##  8 N829AS  </span><br><span class="line">##  9 N593JB  </span><br><span class="line">## 10 N3ALAA  </span><br><span class="line">## # ... with 336,766 more rows</span><br></pre></td></tr></table></figure><h3 id="mutate">mutate()</h3><p>基于已有变量，添加新变量</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mutate(flights,</span><br><span class="line">  gain = arr_delay - dep_delay,</span><br><span class="line">  speed = distance / air_time * <span class="number">60</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 336,776 x 21</span><br><span class="line">##     year month   day dep_time sched_dep_time dep_delay</span><br><span class="line">##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;</span><br><span class="line">##  1  2013     1     1      517            515         2</span><br><span class="line">##  2  2013     1     1      533            529         4</span><br><span class="line">##  3  2013     1     1      542            540         2</span><br><span class="line">##  4  2013     1     1      544            545        -1</span><br><span class="line">##  5  2013     1     1      554            600        -6</span><br><span class="line">##  6  2013     1     1      554            558        -4</span><br><span class="line">##  7  2013     1     1      555            600        -5</span><br><span class="line">##  8  2013     1     1      557            600        -3</span><br><span class="line">##  9  2013     1     1      557            600        -3</span><br><span class="line">## 10  2013     1     1      558            600        -2</span><br><span class="line">## # ... with 336,766 more rows, and 15 more variables:</span><br><span class="line">## #   arr_time &lt;int&gt;, sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,</span><br><span class="line">## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,</span><br><span class="line">## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span><br><span class="line">## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,</span><br><span class="line">## #   time_hour &lt;dttm&gt;, gain &lt;dbl&gt;, speed &lt;dbl&gt;</span><br></pre></td></tr></table></figure><p>并且，可以依据刚建立的新列进行操作</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mutate(flights,</span><br><span class="line">  gain = arr_delay - dep_delay,</span><br><span class="line">  gain_per_hour = gain / (air_time / <span class="number">60</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 336,776 x 21</span><br><span class="line">##     year month   day dep_time sched_dep_time dep_delay</span><br><span class="line">##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;</span><br><span class="line">##  1  2013     1     1      517            515         2</span><br><span class="line">##  2  2013     1     1      533            529         4</span><br><span class="line">##  3  2013     1     1      542            540         2</span><br><span class="line">##  4  2013     1     1      544            545        -1</span><br><span class="line">##  5  2013     1     1      554            600        -6</span><br><span class="line">##  6  2013     1     1      554            558        -4</span><br><span class="line">##  7  2013     1     1      555            600        -5</span><br><span class="line">##  8  2013     1     1      557            600        -3</span><br><span class="line">##  9  2013     1     1      557            600        -3</span><br><span class="line">## 10  2013     1     1      558            600        -2</span><br><span class="line">## # ... with 336,766 more rows, and 15 more variables:</span><br><span class="line">## #   arr_time &lt;int&gt;, sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,</span><br><span class="line">## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,</span><br><span class="line">## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span><br><span class="line">## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,</span><br><span class="line">## #   time_hour &lt;dttm&gt;, gain &lt;dbl&gt;, gain_per_hour &lt;dbl&gt;</span><br></pre></td></tr></table></figure><p>若只想保留新列，可以使用<code>transmute()</code></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">transmute(flights,</span><br><span class="line">  gain = arr_delay - dep_delay,</span><br><span class="line">  gain_per_hour = gain / (air_time / <span class="number">60</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 336,776 x 2</span><br><span class="line">##     gain gain_per_hour</span><br><span class="line">##    &lt;dbl&gt;         &lt;dbl&gt;</span><br><span class="line">##  1     9          2.38</span><br><span class="line">##  2    16          4.23</span><br><span class="line">##  3    31         11.6 </span><br><span class="line">##  4   -17         -5.57</span><br><span class="line">##  5   -19         -9.83</span><br><span class="line">##  6    16          6.4 </span><br><span class="line">##  7    24          9.11</span><br><span class="line">##  8   -11        -12.5 </span><br><span class="line">##  9    -5         -2.14</span><br><span class="line">## 10    10          4.35</span><br><span class="line">## # ... with 336,766 more rows</span><br></pre></td></tr></table></figure><h3 id="summarise">summarise()</h3><p>根据要求提供数据概要</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">summarise(flights,</span><br><span class="line">  delay = mean(dep_delay, na.rm = <span class="literal">TRUE</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 1 x 1</span><br><span class="line">##   delay</span><br><span class="line">##   &lt;dbl&gt;</span><br><span class="line">## 1  12.6</span><br></pre></td></tr></table></figure><h2 id="sample_n-和-sample_frac">sample_n() 和 sample_frac()</h2><p>随机选择变量</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 提取变量并重命名</span></span><br><span class="line">sample_n(flights, <span class="number">10</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 10 x 19</span><br><span class="line">##     year month   day dep_time sched_dep_time dep_delay</span><br><span class="line">##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;</span><br><span class="line">##  1  2013     4    19     1948           1930        18</span><br><span class="line">##  2  2013     5    17     1328           1329        -1</span><br><span class="line">##  3  2013     6    27      732            600        92</span><br><span class="line">##  4  2013     7    17     1010           1014        -4</span><br><span class="line">##  5  2013     8    17     1241           1229        12</span><br><span class="line">##  6  2013     7    14      700            700         0</span><br><span class="line">##  7  2013     9    24     1015           1020        -5</span><br><span class="line">##  8  2013    11    14     1451           1455        -4</span><br><span class="line">##  9  2013     3    17      847            850        -3</span><br><span class="line">## 10  2013    11     9     1629           1630        -1</span><br><span class="line">## # ... with 13 more variables: arr_time &lt;int&gt;,</span><br><span class="line">## #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,</span><br><span class="line">## #   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,</span><br><span class="line">## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,</span><br><span class="line">## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 按比例选择</span></span><br><span class="line">sample_frac(flights, <span class="number">0.01</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 3,368 x 19</span><br><span class="line">##     year month   day dep_time sched_dep_time dep_delay</span><br><span class="line">##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;</span><br><span class="line">##  1  2013     4     2      812            815        -3</span><br><span class="line">##  2  2013     8     6      542            545        -3</span><br><span class="line">##  3  2013     2     6      608            610        -2</span><br><span class="line">##  4  2013    10     5     1138           1145        -7</span><br><span class="line">##  5  2013     6    14     1515           1455        20</span><br><span class="line">##  6  2013     7    17      608            609        -1</span><br><span class="line">##  7  2013    10     2     1214           1223        -9</span><br><span class="line">##  8  2013     6     9     1739           1629        70</span><br><span class="line">##  9  2013     6    13      651            700        -9</span><br><span class="line">## 10  2013    10     1     2026           2029        -3</span><br><span class="line">## # ... with 3,358 more rows, and 13 more variables:</span><br><span class="line">## #   arr_time &lt;int&gt;, sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,</span><br><span class="line">## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,</span><br><span class="line">## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span><br><span class="line">## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,</span><br><span class="line">## #   time_hour &lt;dttm&gt;</span><br></pre></td></tr></table></figure><h2 id="总结">总结</h2><p><code>dplyr</code>动词语法的操作规律：</p><ol type="1"><li>第一个参数是data.frame<br /></li><li>第二个参数是要进行的操作<br /></li><li>最后返回一个data.frame</li></ol>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tidyverse </tag>
            
            <tag> dplyr </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dplyr学习笔记(二)</title>
      <link href="2020/05/27/dplyr-ii/"/>
      <url>2020/05/27/dplyr-ii/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><p>在<code>dplyr</code>中提供的动词语法与其他操作进行连接，可以实现更加复杂的数据操作</p><h2 id="group操作">group操作</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># group操作</span></span><br><span class="line">by_tailnum &lt;- group_by(flights, tailnum)</span><br><span class="line"></span><br><span class="line"><span class="comment"># group操作</span></span><br><span class="line">delay &lt;- summarise(by_tailnum,</span><br><span class="line">  count = n(),</span><br><span class="line">  dist = mean(distance, na.rm = <span class="literal">TRUE</span>),</span><br><span class="line">  delay = mean(arr_delay, na.rm = <span class="literal">TRUE</span>))</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delay</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 4,044 x 4</span><br><span class="line">##    tailnum count  dist  delay</span><br><span class="line">##    &lt;chr&gt;   &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;</span><br><span class="line">##  1 D942DN      4  854. 31.5  </span><br><span class="line">##  2 N0EGMQ    371  676.  9.98 </span><br><span class="line">##  3 N10156    153  758. 12.7  </span><br><span class="line">##  4 N102UW     48  536.  2.94 </span><br><span class="line">##  5 N103US     46  535. -6.93 </span><br><span class="line">##  6 N104UW     47  535.  1.80 </span><br><span class="line">##  7 N10575    289  520. 20.7  </span><br><span class="line">##  8 N105UW     45  525. -0.267</span><br><span class="line">##  9 N107US     41  529. -5.73 </span><br><span class="line">## 10 N108UW     60  534. -1.25 </span><br><span class="line">## # ... with 4,034 more rows</span><br></pre></td></tr></table></figure><blockquote><p>在<code>summarise()</code>函数中可以与基础的R函数(如：<code>min()</code>)进行联合操作，同时<code>dplyr</code>同样提供了一系列的快捷操作：<br />+ <code>n()</code>: 观测值的个数<br />+ <code>n_distinct(x)</code>: unique的观测值数目<br />+ <code>first(x)</code>,<code>last(x)</code>, <code>nth(x, n)</code>: 第一个、最后一个、第n个观测值</p></blockquote><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">destinations &lt;- group_by(flights, dest)</span><br><span class="line">summarise(destinations,</span><br><span class="line">  planes = n_distinct(tailnum),</span><br><span class="line">  flights = n()</span><br><span class="line">)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 105 x 3</span><br><span class="line">##    dest  planes flights</span><br><span class="line">##    &lt;chr&gt;  &lt;int&gt;   &lt;int&gt;</span><br><span class="line">##  1 ABQ      108     254</span><br><span class="line">##  2 ACK       58     265</span><br><span class="line">##  3 ALB      172     439</span><br><span class="line">##  4 ANC        6       8</span><br><span class="line">##  5 ATL     1180   17215</span><br><span class="line">##  6 AUS      993    2439</span><br><span class="line">##  7 AVL      159     275</span><br><span class="line">##  8 BDL      186     443</span><br><span class="line">##  9 BGR       46     375</span><br><span class="line">## 10 BHM       45     297</span><br><span class="line">## # ... with 95 more rows</span><br></pre></td></tr></table></figure><p>当依据多个变量进行分组时，可以根据<code>summarise()</code>层层递进，得出结果</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">daily &lt;- group_by(flights, year, month, day)</span><br><span class="line"></span><br><span class="line">per_day   &lt;- summarise(daily, flights = n())</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">per_month &lt;- summarise(per_day, flights = sum(flights))</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">per_year  &lt;- summarise(per_month, flights = sum(flights))</span><br></pre></td></tr></table></figure><h2 id="select-操作">select 操作</h2><p><code>select</code>函数可以接受数字和具体的列名，但需要注意的是，当有与列名相同的其他赋值时，不能进行操作</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select(flights, year)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 336,776 x 1</span><br><span class="line">##     year</span><br><span class="line">##    &lt;int&gt;</span><br><span class="line">##  1  2013</span><br><span class="line">##  2  2013</span><br><span class="line">##  3  2013</span><br><span class="line">##  4  2013</span><br><span class="line">##  5  2013</span><br><span class="line">##  6  2013</span><br><span class="line">##  7  2013</span><br><span class="line">##  8  2013</span><br><span class="line">##  9  2013</span><br><span class="line">## 10  2013</span><br><span class="line">## # ... with 336,766 more rows</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select(flights, <span class="number">1</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 336,776 x 1</span><br><span class="line">##     year</span><br><span class="line">##    &lt;int&gt;</span><br><span class="line">##  1  2013</span><br><span class="line">##  2  2013</span><br><span class="line">##  3  2013</span><br><span class="line">##  4  2013</span><br><span class="line">##  5  2013</span><br><span class="line">##  6  2013</span><br><span class="line">##  7  2013</span><br><span class="line">##  8  2013</span><br><span class="line">##  9  2013</span><br><span class="line">## 10  2013</span><br><span class="line">## # ... with 336,766 more rows</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">year &lt;- <span class="number">5</span></span><br><span class="line">select(flights, year)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 336,776 x 1</span><br><span class="line">##     year</span><br><span class="line">##    &lt;int&gt;</span><br><span class="line">##  1  2013</span><br><span class="line">##  2  2013</span><br><span class="line">##  3  2013</span><br><span class="line">##  4  2013</span><br><span class="line">##  5  2013</span><br><span class="line">##  6  2013</span><br><span class="line">##  7  2013</span><br><span class="line">##  8  2013</span><br><span class="line">##  9  2013</span><br><span class="line">## 10  2013</span><br><span class="line">## # ... with 336,766 more rows</span><br></pre></td></tr></table></figure><h2 id="mutating-操作">Mutating 操作</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df &lt;- select(flights, year:dep_time)</span><br><span class="line"></span><br><span class="line">mutate(df, <span class="string">&quot;year&quot;</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 336,776 x 6</span><br><span class="line">##     year month   day dep_time &#96;&quot;year&quot;&#96;   &#96;2&#96;</span><br><span class="line">##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt;</span><br><span class="line">##  1  2013     1     1      517 year         2</span><br><span class="line">##  2  2013     1     1      533 year         2</span><br><span class="line">##  3  2013     1     1      542 year         2</span><br><span class="line">##  4  2013     1     1      544 year         2</span><br><span class="line">##  5  2013     1     1      554 year         2</span><br><span class="line">##  6  2013     1     1      554 year         2</span><br><span class="line">##  7  2013     1     1      555 year         2</span><br><span class="line">##  8  2013     1     1      557 year         2</span><br><span class="line">##  9  2013     1     1      557 year         2</span><br><span class="line">## 10  2013     1     1      558 year         2</span><br><span class="line">## # ... with 336,766 more rows</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mutate(df, year + <span class="number">10</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 336,776 x 5</span><br><span class="line">##     year month   day dep_time &#96;year + 10&#96;</span><br><span class="line">##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;       &lt;dbl&gt;</span><br><span class="line">##  1  2013     1     1      517        2023</span><br><span class="line">##  2  2013     1     1      533        2023</span><br><span class="line">##  3  2013     1     1      542        2023</span><br><span class="line">##  4  2013     1     1      544        2023</span><br><span class="line">##  5  2013     1     1      554        2023</span><br><span class="line">##  6  2013     1     1      554        2023</span><br><span class="line">##  7  2013     1     1      555        2023</span><br><span class="line">##  8  2013     1     1      557        2023</span><br><span class="line">##  9  2013     1     1      557        2023</span><br><span class="line">## 10  2013     1     1      558        2023</span><br><span class="line">## # ... with 336,766 more rows</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var &lt;- seq(<span class="number">1</span>, nrow(df))</span><br><span class="line">mutate(df, new = var)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 336,776 x 5</span><br><span class="line">##     year month   day dep_time   new</span><br><span class="line">##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt; &lt;int&gt;</span><br><span class="line">##  1  2013     1     1      517     1</span><br><span class="line">##  2  2013     1     1      533     2</span><br><span class="line">##  3  2013     1     1      542     3</span><br><span class="line">##  4  2013     1     1      544     4</span><br><span class="line">##  5  2013     1     1      554     5</span><br><span class="line">##  6  2013     1     1      554     6</span><br><span class="line">##  7  2013     1     1      555     7</span><br><span class="line">##  8  2013     1     1      557     8</span><br><span class="line">##  9  2013     1     1      557     9</span><br><span class="line">## 10  2013     1     1      558    10</span><br><span class="line">## # ... with 336,766 more rows</span><br></pre></td></tr></table></figure><p><code>group_by()</code>的操作同样可以修改和创建变量，不同的时该变量是group之后的</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">group_by(df, month)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 336,776 x 4</span><br><span class="line">## # Groups:   month [12]</span><br><span class="line">##     year month   day dep_time</span><br><span class="line">##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;</span><br><span class="line">##  1  2013     1     1      517</span><br><span class="line">##  2  2013     1     1      533</span><br><span class="line">##  3  2013     1     1      542</span><br><span class="line">##  4  2013     1     1      544</span><br><span class="line">##  5  2013     1     1      554</span><br><span class="line">##  6  2013     1     1      554</span><br><span class="line">##  7  2013     1     1      555</span><br><span class="line">##  8  2013     1     1      557</span><br><span class="line">##  9  2013     1     1      557</span><br><span class="line">## 10  2013     1     1      558</span><br><span class="line">## # ... with 336,766 more rows</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">group_by(df, month = as.factor(month))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 336,776 x 4</span><br><span class="line">## # Groups:   month [12]</span><br><span class="line">##     year month   day dep_time</span><br><span class="line">##    &lt;int&gt; &lt;fct&gt; &lt;int&gt;    &lt;int&gt;</span><br><span class="line">##  1  2013 1         1      517</span><br><span class="line">##  2  2013 1         1      533</span><br><span class="line">##  3  2013 1         1      542</span><br><span class="line">##  4  2013 1         1      544</span><br><span class="line">##  5  2013 1         1      554</span><br><span class="line">##  6  2013 1         1      554</span><br><span class="line">##  7  2013 1         1      555</span><br><span class="line">##  8  2013 1         1      557</span><br><span class="line">##  9  2013 1         1      557</span><br><span class="line">## 10  2013 1         1      558</span><br><span class="line">## # ... with 336,766 more rows</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">group_by(df, day_binned = cut(day, <span class="number">3</span>))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 336,776 x 5</span><br><span class="line">## # Groups:   day_binned [3]</span><br><span class="line">##     year month   day dep_time day_binned</span><br><span class="line">##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt; &lt;fct&gt;     </span><br><span class="line">##  1  2013     1     1      517 (0.97,11] </span><br><span class="line">##  2  2013     1     1      533 (0.97,11] </span><br><span class="line">##  3  2013     1     1      542 (0.97,11] </span><br><span class="line">##  4  2013     1     1      544 (0.97,11] </span><br><span class="line">##  5  2013     1     1      554 (0.97,11] </span><br><span class="line">##  6  2013     1     1      554 (0.97,11] </span><br><span class="line">##  7  2013     1     1      555 (0.97,11] </span><br><span class="line">##  8  2013     1     1      557 (0.97,11] </span><br><span class="line">##  9  2013     1     1      557 (0.97,11] </span><br><span class="line">## 10  2013     1     1      558 (0.97,11] </span><br><span class="line">## # ... with 336,766 more rows</span><br></pre></td></tr></table></figure><h2 id="pipe-操作">pipe 操作</h2><p>当进行多重的动词语法操作时，可以把一系列的操作进行融合，不过因此会损害代码的可读性</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 鎸笺父鏄笺工鎴笺父鏄笺付鎸笺功鏀笺赴同鎴笺傅牟鎼笺腹鎼笺阜鏄笺阜 </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># method 1</span></span><br><span class="line">a1 &lt;- group_by(flights, year, month, day)</span><br><span class="line">a2 &lt;- select(a1, arr_delay, dep_delay)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## Adding missing grouping variables: &#96;year&#96;, &#96;month&#96;, &#96;day&#96;</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a3 &lt;- summarise(a2,</span><br><span class="line">  arr = mean(arr_delay, na.rm = <span class="literal">TRUE</span>),</span><br><span class="line">  dep = mean(dep_delay, na.rm = <span class="literal">TRUE</span>))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## &#96;summarise()&#96; regrouping output by &#39;year&#39;, &#39;month&#39; (override with &#96;.groups&#96; argument)</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a4 &lt;- filter(a3, arr &gt; <span class="number">30</span> | dep &gt; <span class="number">30</span>)</span><br><span class="line">a4</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 49 x 5</span><br><span class="line">## # Groups:   year, month [11]</span><br><span class="line">##     year month   day   arr   dep</span><br><span class="line">##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;</span><br><span class="line">##  1  2013     1    16  34.2  24.6</span><br><span class="line">##  2  2013     1    31  32.6  28.7</span><br><span class="line">##  3  2013     2    11  36.3  39.1</span><br><span class="line">##  4  2013     2    27  31.3  37.8</span><br><span class="line">##  5  2013     3     8  85.9  83.5</span><br><span class="line">##  6  2013     3    18  41.3  30.1</span><br><span class="line">##  7  2013     4    10  38.4  33.0</span><br><span class="line">##  8  2013     4    12  36.0  34.8</span><br><span class="line">##  9  2013     4    18  36.0  34.9</span><br><span class="line">## 10  2013     4    19  47.9  46.1</span><br><span class="line">## # ... with 39 more rows</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># method 2</span></span><br><span class="line">filter(</span><br><span class="line">  summarise(</span><br><span class="line">    select(</span><br><span class="line">      group_by(flights, year, month, day),</span><br><span class="line">      arr_delay, dep_delay</span><br><span class="line">    ),</span><br><span class="line">    arr = mean(arr_delay, na.rm = <span class="literal">TRUE</span>),</span><br><span class="line">    dep = mean(dep_delay, na.rm = <span class="literal">TRUE</span>)</span><br><span class="line">  ),</span><br><span class="line">  arr &gt; <span class="number">30</span> | dep &gt; <span class="number">30</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## Adding missing grouping variables: &#96;year&#96;, &#96;month&#96;, &#96;day&#96;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## &#96;summarise()&#96; regrouping output by &#39;year&#39;, &#39;month&#39; (override with &#96;.groups&#96; argument)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 49 x 5</span><br><span class="line">## # Groups:   year, month [11]</span><br><span class="line">##     year month   day   arr   dep</span><br><span class="line">##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;</span><br><span class="line">##  1  2013     1    16  34.2  24.6</span><br><span class="line">##  2  2013     1    31  32.6  28.7</span><br><span class="line">##  3  2013     2    11  36.3  39.1</span><br><span class="line">##  4  2013     2    27  31.3  37.8</span><br><span class="line">##  5  2013     3     8  85.9  83.5</span><br><span class="line">##  6  2013     3    18  41.3  30.1</span><br><span class="line">##  7  2013     4    10  38.4  33.0</span><br><span class="line">##  8  2013     4    12  36.0  34.8</span><br><span class="line">##  9  2013     4    18  36.0  34.9</span><br><span class="line">## 10  2013     4    19  47.9  46.1</span><br><span class="line">## # ... with 39 more rows</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># method 3</span></span><br><span class="line"></span><br><span class="line">flights %&gt;%</span><br><span class="line">  group_by(year, month, day) %&gt;%</span><br><span class="line">  select(arr_delay, dep_delay) %&gt;%</span><br><span class="line">  summarise(</span><br><span class="line">    arr = mean(arr_delay, na.rm = <span class="literal">TRUE</span>),</span><br><span class="line">    dep = mean(dep_delay, na.rm = <span class="literal">TRUE</span>)</span><br><span class="line">  ) %&gt;%</span><br><span class="line">  filter(arr &gt; <span class="number">30</span> | dep &gt; <span class="number">30</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## Adding missing grouping variables: &#96;year&#96;, &#96;month&#96;, &#96;day&#96;</span><br><span class="line">## &#96;summarise()&#96; regrouping output by &#39;year&#39;, &#39;month&#39; (override with &#96;.groups&#96; argument)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 49 x 5</span><br><span class="line">## # Groups:   year, month [11]</span><br><span class="line">##     year month   day   arr   dep</span><br><span class="line">##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;</span><br><span class="line">##  1  2013     1    16  34.2  24.6</span><br><span class="line">##  2  2013     1    31  32.6  28.7</span><br><span class="line">##  3  2013     2    11  36.3  39.1</span><br><span class="line">##  4  2013     2    27  31.3  37.8</span><br><span class="line">##  5  2013     3     8  85.9  83.5</span><br><span class="line">##  6  2013     3    18  41.3  30.1</span><br><span class="line">##  7  2013     4    10  38.4  33.0</span><br><span class="line">##  8  2013     4    12  36.0  34.8</span><br><span class="line">##  9  2013     4    18  36.0  34.9</span><br><span class="line">## 10  2013     4    19  47.9  46.1</span><br><span class="line">## # ... with 39 more rows</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tidyverse </tag>
            
            <tag> dplyr </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>inferCNV 推断拷贝数</title>
      <link href="2020/01/09/inferCNV/"/>
      <url>2020/01/09/inferCNV/</url>
      
        <content type="html"><![CDATA[<h2 id="infercnv使用流程">inferCNV使用流程</h2><h3 id="infercnv简介">inferCNV简介</h3><p><strong>inferCNV</strong>可以被用于单细胞RNA-seq数据识别大规模的染色体拷贝数变异，如：整个染色体或是大染色体片段的获得和缺失。主要是通过与一组参考“正常”细胞相比，探索肿瘤基因组不同位置基因表达强度来实现。生成的热图可以显示每条染色体的相对表达强度。通过与正常细胞相比，很容易看出肿瘤基因组哪些区域表达过于丰富或者不够丰富。</p><h3 id="infercnv安装">inferCNV安装</h3><p>安装inferCNV需要同时安装<a href="https://sourceforge.net/projects/mcmc-jags/files/JAGS/4.x/">JAGS</a> package.</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!requireNamespace(<span class="string">&quot;BiocManager&quot;</span>, quietly = <span class="literal">TRUE</span>))</span><br><span class="line">     install.packages(<span class="string">&quot;BiocManager&quot;</span>)</span><br><span class="line">BiocManager::install(<span class="string">&quot;infercnv&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="infercnv运行">inferCNV运行</h3><p>inferCNV可以通过两步进行运行：</p><p><strong>首先需要创建一个inferCNV对象</strong>。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">infercnv_obj = CreateInfercnvObject(raw_counts_matrix=system.file(<span class="string">&quot;extdata&quot;</span>, <span class="string">&quot;oligodendroglioma_expression_downsampled.counts.matrix.gz&quot;</span>, package = <span class="string">&quot;infercnv&quot;</span>),</span><br><span class="line">                                    annotations_file=system.file(<span class="string">&quot;extdata&quot;</span>,            <span class="string">&quot;oligodendroglioma_annotations_downsampled.txt&quot;</span>, package = <span class="string">&quot;infercnv&quot;</span>),</span><br><span class="line">                                    delim=<span class="string">&quot;\t&quot;</span>,</span><br><span class="line">                                    gene_order_file=system.file(<span class="string">&quot;extdata&quot;</span>, <span class="string">&quot;gencode_downsampled.EXAMPLE_ONLY_DONT_REUSE.txt&quot;</span>, package = <span class="string">&quot;infercnv&quot;</span>), ref_group_names=c(<span class="string">&quot;Microglia/Macrophage&quot;</span>,<span class="string">&quot;Oligodendrocytes (non-malignant)&quot;</span>)) </span><br></pre></td></tr></table></figure><p>需要的输入文件有三个：</p><ul><li><p><strong>Raw Counts Matrix for Genes x Cells</strong></p><p><strong>inferCNV</strong>可以兼容来自<code>smart-seq2</code>和<code>10x genmoic</code>等单细胞测序平台的数据，count矩阵必须行是基因，列是细胞的矩阵，格式如下：</p><table><thead><tr class="header"><th></th><th>MGH54_P16_F12</th><th>MGH54_P12_C10</th><th>MGH54_P11_C11</th><th>MGH54_P15_D06</th><th>...</th></tr></thead><tbody><tr class="odd"><td>A2M</td><td>0</td><td>0</td><td>0</td><td>0</td><td>...</td></tr><tr class="even"><td>AAAS</td><td>0</td><td>37</td><td>30</td><td>21</td><td>...</td></tr><tr class="odd"><td>AACS</td><td>0</td><td>0</td><td>0</td><td>0</td><td>...</td></tr><tr class="even"><td>AADAT</td><td>0</td><td>0</td><td>0</td><td>0</td><td>...</td></tr><tr class="odd"><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr></tbody></table></li><li><p><strong>Sample annotation file</strong></p><p>样本注释文件包括两列：第一列是细胞名字，第二列是细胞的类型，以<code>tab</code>分割。如果已知正常细胞的类型，可以给出具体的细胞类型，并且，在进行计算时，每一种细胞类型都将作为单独的正常细胞存在，而不是整合成一个正常的类型。同样，如果并不能详细的获得正常细胞的类型，可以将其统称为normal，作为统一的正常细胞类型。对于恶性细胞需要标记为<code>malignant_&#123;patient&#125;</code>的形式。使它们在聚类时可以聚在一起。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MGH54_P2_C12    Microglia&#x2F;Macrophage</span><br><span class="line">MGH36_P6_F03    Microglia&#x2F;Macrophage</span><br><span class="line">MGH54_P16_F12   Oligodendrocytes (non-malignant)</span><br><span class="line">MGH54_P12_C10   Oligodendrocytes (non-malignant)</span><br><span class="line">MGH36_P1_B02    malignant_MGH36</span><br><span class="line">MGH36_P1_H10    malignant_MGH36</span><br></pre></td></tr></table></figure></li><li><p><strong>Gene ordering file</strong></p><p>Gene ordering文件提供每个基因的染色体位置信息，使用<code>tab</code>分割。要分析的count矩阵中的每个基因都应该在这个基因排序文件中提供相应的基因名称和位置信息。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">WASH7P  chr1    14363   29806</span><br><span class="line">LINC00115       chr1    761586  762902</span><br><span class="line">NOC2L   chr1    879584  894689</span><br><span class="line">MIR200A chr1    1103243 1103332</span><br><span class="line">SDF4    chr1    1152288 1167411</span><br><span class="line">UBE2J2  chr1    1189289 1209265</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>注意，如果没有参考的正常细胞，可以设置<code>ref_group_names=NULL</code>，使用所有细胞的平均表达作为参考基线。</p><p>此外，inferCNV默认已经去除低质量的细胞，如果要进一步进行最大或最小count值的过滤，可以设置<code>min_max_counts_per_cell=c(1e5,1e6)</code></p></blockquote><p><strong>在创建<code>infercnv_obj</code>对象之后，使用内置的<code>infercnv::run()</code>方法运行标准的infercnv过程：</strong></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">infercnv_obj = infercnv::run(infercnv_obj,</span><br><span class="line">                             cutoff=<span class="number">1</span>, <span class="comment"># cutoff=1 works well for Smart-seq2, and cutoff=0.1 works well for 10x Genomics</span></span><br><span class="line">                             out_dir=tempfile(), </span><br><span class="line">                             cluster_by_groups=<span class="literal">TRUE</span>, </span><br><span class="line">                             denoise=<span class="literal">TRUE</span>,</span><br><span class="line">                             HMM=<span class="literal">TRUE</span>)</span><br></pre></td></tr></table></figure><p><code>cutoff</code>决定了哪个基因可以被用于infercnv分析</p><p><code>cluster_by_groups</code>可以根据细胞注释文件对细胞进行聚类</p><h3 id="infercnv降噪处理">inferCNV降噪处理</h3><p>降噪处理可以降低噪声对与表达的影响，同时保留在肿瘤细胞中的表达</p><ol type="1"><li><p>使用固定阈值过滤</p><p>可以使用<code>noise_filter</code>参数设定一个特定的偏离均值的阈值</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">infercnv_obj = infercnv::run(infercnv_obj,</span><br><span class="line">                             cutoff=<span class="number">1</span>, <span class="comment"># cutoff=1 works well for Smart-seq2, and cutoff=0.1 works well for 10x Genomics</span></span><br><span class="line">                             out_dir=out_dir, </span><br><span class="line">                             cluster_by_groups=<span class="literal">T</span>, </span><br><span class="line">                             plot_steps=<span class="literal">F</span>,</span><br><span class="line">                             denoise=<span class="literal">T</span>, <span class="comment">## de noise</span></span><br><span class="line">                             noise_filter=<span class="number">0.1</span>   <span class="comment">## hard thresholds</span></span><br><span class="line">                             )</span><br></pre></td></tr></table></figure><p><img src="/images/inferCNV/denoise_hard_filter.png" /></p></li><li><p>使用动态阈值过滤</p><p>默认情况下，用于去噪的硬边界是基于剩余的正常表达值的标准差来计算的。这个阈值可以使用<code>sd_amplifier</code>参数进行调整。例如，我们可以使用1.5 *标准差的过滤如下:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">infercnv_obj = infercnv::run(infercnv_obj,</span><br><span class="line">                             cutoff=<span class="number">1</span>, <span class="comment"># cutoff=1 works well for Smart-seq2, and cutoff=0.1 works well for 10x Genomics</span></span><br><span class="line">                             out_dir=out_dir, </span><br><span class="line">                             cluster_by_groups=<span class="literal">T</span>, </span><br><span class="line">                             plot_steps=<span class="literal">F</span>,</span><br><span class="line">                             denoise=<span class="literal">T</span>,</span><br><span class="line">                             sd_amplifier=<span class="number">1.5</span>  <span class="comment">## set dynamic thresholding based on the standard deviation value.</span></span><br><span class="line">                             )</span><br></pre></td></tr></table></figure><p><img src="/images/inferCNV/denoise_dynamic_sd.png" /></p></li></ol><h3 id="基于hmm的cnv预测方法">基于HMM的CNV预测方法</h3><p>inferCNV当前支持两种基于HMM的CNV预测方法（i3和i6）。两种方法可以通过<code>infercnv::run()</code>函数中的<code>HMM_type</code>参数进行设定，默认为<code>HMM_type='i6</code></p><p>两种方法的操作对象都是对<code>CreateInfercnvObject()</code>函数计算出来的<code>infercnv</code>对象进行处理。</p><blockquote><p><a href="https://github.com/broadinstitute/infercnv/wiki/infercnv-i3-HMM-type">i3 HMM</a>: 包括CNV的三种状态： 拷贝数缺失（deletion）、拷贝数中立（neutral）、拷贝数扩增（amplification ）</p><p><a href="https://github.com/broadinstitute/infercnv/wiki/infercnv-i6-HMM-type">i6 HMM</a>: 包括更加精细定义六种CNV改变状态：</p><ul><li>0x: complete loss</li><li>0.5x: loss of one copy<br /></li><li>1x: neutral<br /></li><li>1.5x: addition of one copy<br /></li><li>2x: addition of two copies<br /></li><li>3x: essentially a placeholder for &gt;2x copies but modeled as 3x</li></ul></blockquote><h3 id="cnv-region预测报告">CNV region预测报告</h3><p>CNV的推断预测结果包含在以下文件夹中：</p><ul><li><p><code>HMM_CNV_predictions.*.pred_cnv_regions.dat</code> ：包含CNV区域坐标、状态分配和细胞分组的摘要信息。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cell_group_name                         cnv_name        state   chr     start   end</span><br><span class="line">malignant_MGH36.malignant_MGH36_s1      chr1-region_2   0.5     chr1    3696784 144612683</span><br><span class="line">malignant_MGH36.malignant_MGH36_s1      chr1-region_4   1.5     chr1    151336778       156213123</span><br><span class="line">malignant_MGH36.malignant_MGH36_s1      chr3-region_7   1.5     chr3    3168600 10285427</span><br><span class="line">malignant_MGH36.malignant_MGH36_s1      chr3-region_9   1.5     chr3    45429998        49460186</span><br><span class="line">malignant_MGH36.malignant_MGH36_s1      chr4-region_11  0.5     chr4    53179   187134610</span><br><span class="line">malignant_MGH36.malignant_MGH36_s1      chr5-region_13  1.5     chr5    134181370       177037348</span><br></pre></td></tr></table></figure></li><li><p><code>HMM_CNV_predictions.*.cell_groupings</code>: 提供肿瘤subcluster和细胞成员的对应关系</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cell_group_name                         cell</span><br><span class="line">malignant_MGH36.malignant_MGH36_s1      MGH36_P3_E06</span><br><span class="line">malignant_MGH36.malignant_MGH36_s1      MGH36_P10_E07</span><br><span class="line">malignant_MGH36.malignant_MGH36_s1      MGH36_P3_C04</span><br><span class="line">malignant_MGH36.malignant_MGH36_s1      MGH36_P3_A09</span><br><span class="line">malignant_MGH36.malignant_MGH36_s1      MGH36_P2_A08</span><br><span class="line">malignant_MGH36.malignant_MGH36_s1      MGH36_P10_B08</span><br><span class="line">malignant_MGH36.malignant_MGH36_s1      MGH36_P8_H09</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li><li><p><code>HMM_CNV_predictions.*.pred_cnv_genes.dat</code>: 包含每个细胞、每个基因的CNV状态分级情况</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cell_group_name                         gene_region_name state   gene    chr     start   end</span><br><span class="line">malignant_MGH36.malignant_MGH36_s1      chr1-region_2   0.5     DFFB    chr1    3696784 3713068</span><br><span class="line">malignant_MGH36.malignant_MGH36_s1      chr1-region_2   0.5     C1orf174        chr1    3773845 3801993</span><br><span class="line">malignant_MGH36.malignant_MGH36_s1      chr1-region_2   0.5     RPL22   chr1    3805689 3816857</span><br><span class="line">malignant_MGH36.malignant_MGH36_s1      chr1-region_2   0.5     ICMT    chr1    6241329 6269449</span><br><span class="line">malignant_MGH36.malignant_MGH36_s1      chr1-region_2   0.5     ACOT7   chr1    6281253 6296032</span><br><span class="line">malignant_MGH36.malignant_MGH36_s1      chr1-region_2   0.5     NOL9    chr1    6324329 6454451</span><br><span class="line">malignant_MGH36.malignant_MGH36_s1      chr1-region_2   0.5     KLHL21  chr1    6581407 6614595</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li><li><p><code>HMM_CNV_predictions.*.genes_used.dat</code>: 提供在分析中使用的基因列表</p></li></ul><h3 id="推断肿瘤subclusters">推断肿瘤subclusters</h3><p>通过设置 <code>infercnv::run(analysis_mode='subclusters')</code>, inferCNV会试着根据CNV改变的模式对细胞进行聚类。</p><p>在inferCNV中，使用的聚类方式为层次聚类（hierarchical clustering），根据层次聚类树划分不同的subcluster。有三个参数可以影响层次聚类划分的结果：</p><ul><li><code>infercnv::run(hclust_method='ward.D2')</code>：层次聚类使用的方法，支持所有的<code>hclust</code>方法。目前作者认为<code>ward.D2</code>的效果最好<br /></li><li><code>infercnv::run(tumor_subcluster_partition_method='random_trees')</code>：划分层次聚类树的方法。可选的方法为：<code>random_trees</code>, <code>qnorm</code><br /></li><li><code>infercnv::run(tumor_subcluster_pval=0.05)</code>:用于确定分层树中的切割点的设置</li></ul><h3 id="infercnv的输出">inferCNV的输出</h3><p>通过inferCNV的<code>run</code>函数运行后，会产生一些输出文件：</p><ul><li><code>infercnv.preliminary.png</code>:初步的inferCNV图像<br /></li><li><code>infercnv.png</code>：采用去噪方法，生成最终的热图<br /></li><li><code>infercnv.references.txt</code>：“正常”细胞矩阵数据值<br /></li><li><code>infercnv.observations.txt</code>：肿瘤细胞数据值<br /></li><li><code>infercnv.observation_groupings.txt</code>：聚类后的肿瘤细胞关系<br /></li><li><code>infercnv.observations_dendrogram.txt</code>：肿瘤细胞聚类树状结构图</li></ul><h3 id="解读infercnv图像">解读inferCNV图像</h3><p>通过inferCNV会得到类似于下面的聚类图：</p><p><img src="/images/inferCNV/infercnv.png" /></p><p>正常细胞的表达值绘制在顶部的热图中，肿瘤细胞绘制在底部的热图中，基因从左到右排列在染色体上。将正常的细胞表达数据从肿瘤细胞表达数据中减去，产生差异，其中染色体区域扩增为红色块，染色体区域缺失为蓝色块。</p><hr /><h3 id="参考">参考</h3><p>https://github.com/broadinstitute/infercnv/wiki</p>]]></content>
      
      
      <categories>
          
          <category> SingleCell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
            <tag> inferCNV </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>复合饼图</title>
      <link href="2020/01/07/pie/"/>
      <url>2020/01/07/pie/</url>
      
        <content type="html"><![CDATA[<p>复合图形可以给出更多的信息，并且更能够观察数据之间的联系。一般所说的复合饼图包括以下两种：</p><p><strong>散点复合饼图</strong>（compound scatter and pie chart）可以展示三个数据变量的信息：(x, y, P)，其中x和y决定气泡在直角坐标系中的位置，P表示饼图的数据信息，决定饼图中各个类别的占比情况，如图1(a)所示。</p><p><strong>气泡复合饼图</strong>（compound bubble and pie chart）可以展示四个数据变量的信息：(x, y, z, P)，其中x和y决定气泡在直角坐标系中的位置，z决定气泡的大小，P表示饼图的数据信息，决定饼图中各个类别的占比情况，如图1(b)所示。</p><div data-align="center"><p><img src="/images/pie/P1.png" height="500" width = "600"> <img src="/images/pie/P2.png" height="500" width = "600" ></p></div><p>具体操作如下：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(ggforce)</span><br><span class="line"><span class="keyword">library</span>(dplyr)</span><br><span class="line">data_graph &lt;- read.table(text = <span class="string">&quot;x     y group    nb</span></span><br><span class="line"><span class="string">1     0     0     1  1060</span></span><br><span class="line"><span class="string">2     0     0     2   361</span></span><br><span class="line"><span class="string">3     0     0     3   267</span></span><br><span class="line"><span class="string">4     0     1     1   788</span></span><br><span class="line"><span class="string">5     0     1     2   215</span></span><br><span class="line"><span class="string">6     0     1     3    80</span></span><br><span class="line"><span class="string">7     1     0     1   485</span></span><br><span class="line"><span class="string">8     1     0     2   168</span></span><br><span class="line"><span class="string">9     1     0     3   101</span></span><br><span class="line"><span class="string">10     1     1     1  6306</span></span><br><span class="line"><span class="string">11     1     1     2  1501</span></span><br><span class="line"><span class="string">12     1     1     3   379&quot;</span>, header = <span class="literal">TRUE</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># make group a factor</span></span><br><span class="line">data_graph$group &lt;- factor(data_graph$group)</span><br><span class="line"></span><br><span class="line"><span class="comment"># add case variable that separates the four pies</span></span><br><span class="line">data_graph &lt;- cbind(data_graph, case = rep(c(<span class="string">&quot;Aaaa&quot;</span>, <span class="string">&quot;Bbbb&quot;</span>, <span class="string">&quot;Cccc&quot;</span>, <span class="string">&quot;Dddd&quot;</span>), each = <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># calculate the start and end angles for each pie</span></span><br><span class="line">data_graph &lt;- left_join(data_graph,</span><br><span class="line">                        data_graph %&gt;% </span><br><span class="line">                          group_by(case) %&gt;%</span><br><span class="line">                          summarize(nb_total = sum(nb))) %&gt;%</span><br><span class="line">  group_by(case) %&gt;%</span><br><span class="line">  mutate(nb_frac = <span class="number">2</span>*pi*cumsum(nb)/nb_total,</span><br><span class="line">         start = lag(nb_frac, default = <span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># position of the labels</span></span><br><span class="line">data_labels &lt;- data_graph %&gt;% </span><br><span class="line">  group_by(case) %&gt;%</span><br><span class="line">  summarize(x = x[<span class="number">1</span>], y = y[<span class="number">1</span>], nb_total = nb_total[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># overall scaling for pie size</span></span><br><span class="line">scale = <span class="number">.5</span>/sqrt(max(data_graph$nb_total))</span><br><span class="line"></span><br><span class="line"><span class="comment"># draw the pies</span></span><br><span class="line">ggplot(data_graph) + </span><br><span class="line">  geom_arc_bar(aes(x0 = x, y0 = y, r0 = <span class="number">0</span>, r = sqrt(nb_total)*scale,</span><br><span class="line">                   start = start, end = nb_frac, fill = group)) +</span><br><span class="line">  geom_text(data = data_labels,</span><br><span class="line">            aes(label = case, x = x, y = y + scale*sqrt(nb_total) + <span class="number">.05</span>),</span><br><span class="line">            size =<span class="number">11</span>/.pt, vjust = <span class="number">0</span>) +</span><br><span class="line">  coord_fixed() +</span><br><span class="line">  scale_x_continuous(breaks = c(<span class="number">0</span>, <span class="number">1</span>), labels = c(<span class="string">&quot;X0&quot;</span>, <span class="string">&quot;X1&quot;</span>), name = <span class="string">&quot;x axis&quot;</span>) +</span><br><span class="line">  scale_y_continuous(breaks = c(<span class="number">0</span>, <span class="number">1</span>), labels = c(<span class="string">&quot;Y0&quot;</span>, <span class="string">&quot;Y1&quot;</span>), name = <span class="string">&quot;y axis&quot;</span>) +</span><br><span class="line">  theme_minimal() +</span><br><span class="line">  theme(panel.grid.minor = element_blank())</span><br></pre></td></tr></table></figure><p>最终得到的图形如下所示：</p><div data-align="center"><p><img src="/images/pie/P3.png" height="500" width = "700"></p></div>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
            <tag> ggplot2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>R graphics cookbook</title>
      <link href="2019/12/28/cookbook/"/>
      <url>2019/12/28/cookbook/</url>
      
        <content type="html"><![CDATA[<h2 id="R语言绘制基础图形">R语言绘制基础图形</h2><p>R语言绘制图像主要有三种方式：（1）由<code>graphics</code>包提供的基础绘图方式；（2）基于<code>ggplot2</code>的<code>qplot()</code>快捷绘图函数；（3）<code>ggplot2</code>图层绘图风格</p><h3 id="散点图">散点图</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 方法一</span></span><br><span class="line">plot(mtcars$wt, mtcars$mpg)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 方法二</span></span><br><span class="line">qplot(mtcars$wt, mtcars$mpg)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 方法三</span></span><br><span class="line">ggplot(mtcars, aes(x=wt, y=mpg)) + geom_point()</span><br></pre></td></tr></table></figure><div align="left">  <img src="/images/cookbook/P1.jpg" height="400" width = "400">  <img src="/images/cookbook/P2.jpg" height="400" width = "400" >    </div><h3 id="线图">线图</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 方法一</span></span><br><span class="line">plot(pressure$temperature, pressure$pressure, type=<span class="string">&quot;l&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 方法二</span></span><br><span class="line">qplot(pressure$temperature, pressure$pressure, geom=<span class="string">&quot;line&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 方法三</span></span><br><span class="line">ggplot(pressure, aes(x=temperature, y=pressure)) + geom_line()</span><br></pre></td></tr></table></figure><div align="left">  <img src="/images/cookbook/P4.jpg" height="400" width = "400">  <img src="/images/cookbook/P3.jpg" height="400" width = "400" >    </div><p>同时绘制点和线</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 方法一</span></span><br><span class="line">lines(pressure$temperature, pressure$pressure, col=<span class="string">&quot;red&quot;</span>)</span><br><span class="line">points(pressure$temperature, pressure$pressure, col=<span class="string">&quot;red&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 方法二</span></span><br><span class="line">qplot(temperature, pressure, data=pressure, geom=c(<span class="string">&quot;line&quot;</span>, <span class="string">&quot;point&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">## 方法三</span></span><br><span class="line">ggplot(pressure, aes(x=temperature, y=pressure)) + geom_line() + geom_point()</span><br></pre></td></tr></table></figure><div align="left">  <img src="/images/cookbook/P5.jpg" height="400" width = "400"></div><h3 id="条形图">条形图</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 方法一</span></span><br><span class="line">barplot(table(mtcars$cyl))</span><br><span class="line"></span><br><span class="line"><span class="comment">## 方法二</span></span><br><span class="line">qplot(BOD$Time, BOD$demand, geom=<span class="string">&quot;bar&quot;</span>, stat=<span class="string">&quot;identity&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 方法三</span></span><br><span class="line">ggplot(BOD, aes(x=Time, y=demand)) + geom_bar(stat=<span class="string">&quot;identity&quot;</span>)</span><br></pre></td></tr></table></figure><div align="left">  <img src="/images/cookbook/P6.jpg" height="400" width = "400">  <img src="/images/cookbook/P7.jpg" height="400" width = "400"></div><h3 id="直方图">直方图</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 方法一</span></span><br><span class="line">hist(mtcars$mpg)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 方法二</span></span><br><span class="line">qplot(mpg, data=mtcars, binwidth=<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 方法三</span></span><br><span class="line">ggplot(mtcars, aes(x=mpg)) + geom_histogram(binwidth=<span class="number">4</span>)</span><br></pre></td></tr></table></figure><div align="left">  <img src="/images/cookbook/P8.jpg" height="400" width = "400">  <img src="/images/cookbook/P9.jpg" height="400" width = "400"></div><h3 id="箱式图">箱式图</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 方法一</span></span><br><span class="line">boxplot(len ~ supp, data = ToothGrowth)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 方法二</span></span><br><span class="line">qplot(ToothGrowth$supp, ToothGrowth$len, geom=<span class="string">&quot;boxplot&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 方法三</span></span><br><span class="line">ggplot(ToothGrowth, aes(x=supp, y=len)) + geom_boxplot()</span><br></pre></td></tr></table></figure><div align="left">  <img src="/images/cookbook/P10.jpg" height="400" width = "400">  <img src="/images/cookbook/P11.jpg" height="400" width = "400"></div><p>同时使用多个分组变量</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 方法一</span></span><br><span class="line">boxplot(len ~ supp + dose, data = ToothGrowth)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 方法二</span></span><br><span class="line">qplot(interaction(supp, dose), len, data=ToothGrowth, geom=<span class="string">&quot;boxplot&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 方法三</span></span><br><span class="line">ggplot(ToothGrowth, aes(x=interaction(supp, dose), y=len)) + geom_boxplot()</span><br></pre></td></tr></table></figure><div align="left">  <img src="/images/cookbook/P12.jpg" height="400" width = "400">  <img src="/images/cookbook/P13.jpg" height="400" width = "400"></div><h2 id="总结">总结</h2><p>基于图层的<code>ggplot2</code>绘图风格是将图形中的每一个对象拆分开，然后根据不同的需求映射到图形中</p><p><code>ggplot()</code>函数控制图像的整体格式，x、y轴的对象<br><code>geom_point</code>函数描述的是点图层的属性<br><code>geom_line</code>函数描述的是线图层的属性<br><code>geom_bar</code>函数是条形图的属性<br><code>geom_boxplot</code>函数控制的是箱线图图层的属性<br><code>geom_histogram</code>函数控制直方图图层的属性</p><h2 id="ggplot2图形语法">ggplot2图形语法</h2><p>必须的图表输入信息包括以下两部分：</p><p>（1）ggplot()：底层绘图函数。DATA为数据集，主要是数据框（data.frame）格式的数据集；MAPPINGS变量的视觉通道映射，用来表示变量x和y，还可以用来控制颜色（color）、大小（size）或形状（shape）等视觉通道；STAT表示统计变换，与stat_×××()相对应，默认为&quot;identity&quot;（无数据变换）；POSITION表示绘图数据系列的位置调整，默认为&quot;identity&quot;（无位置调整）</p><p>（2）geom_×××() | stat_×××()：几何图层或统计变换，比如常见的geom_point()（散点图）、geom_bar()（柱形图）、geom_histogram()（统计直方图）、geom_ boxplot()（箱形图）、geom_line()（折线图）等。我们通常使用geom_×××()函数就可以绘制大部分图表，有时候通过设定stat参数可以先实现统计变换。</p><p>可选的图表输入信息包括如下5个部分，主要是实现图表的美化与变换等。</p><p>(1) scale_×××()：度量调整，调整具体的度量，包括颜色（color）、大小（size）或形状（shape）等，跟MAPPINGS的映射变量相对应；<br>(2) coord_×××()：坐标变换，默认笛卡儿坐标系，还包括极坐标系、地理空间坐标系等；<br>(3) facet_×××()：分面系统，将某个变量进行分面变换，包括按行、列和网格等形式分面绘图，这部分内容具体可见第9章9.4节。<br>(4) guides()：图例调整，主要包括连续型和离散型两种类型的图例。<br>(5) theme()：主题设定，主要用于调整图表的细节，包括图表背景颜色、网格线的间隔与颜色等。</p>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
            <tag> ggplot2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基础R操作</title>
      <link href="2019/12/28/baseR/"/>
      <url>2019/12/28/baseR/</url>
      
        <content type="html"><![CDATA[<h2 id="r-package信息查看">R package信息查看</h2><table><thead><tr class="header"><th><strong>命令</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr class="odd"><td><code>installed.packages()</code></td><td>返回一个矩阵，包含所有已安装的包信息</td></tr><tr class="even"><td><code>available.packages()</code></td><td>返回一个矩阵，包含远端库上所有可用的R包</td></tr><tr class="odd"><td><code>old.packages()</code></td><td>返回一个矩阵，显示所有已安装的包中具有新版本的包</td></tr><tr class="even"><td><code>new.packages()</code></td><td>返回一个矩阵，包含所有已安装的包信息</td></tr><tr class="odd"><td><code>download.packages()</code></td><td>下载一系列R包到本地目录</td></tr><tr class="even"><td><code>install.packages()</code></td><td>从远端库下载安装一系列R包</td></tr><tr class="odd"><td><code>remove.packages()</code></td><td>移除一系列已安装的R包</td></tr></tbody></table><h2 id="公式的创建与使用">公式的创建与使用</h2><p>最基础实用的方法就是调用函数 <code>as.formula()</code> :</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">as.formula(<span class="string">&quot;y ~ x1 + x2&quot;</span>)</span><br><span class="line"><span class="comment">#&gt; y ~ x1 + x2</span></span><br></pre></td></tr></table></figure><p>从公式中提取部分字符串</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">f &lt;- y ~ x1 + x2</span><br><span class="line">f[[<span class="number">1</span>]]</span><br><span class="line"><span class="comment">#&gt; `~`</span></span><br><span class="line">as.list(f)</span><br><span class="line"><span class="comment">#&gt; [[1]]</span></span><br><span class="line"><span class="comment">#&gt; `~`</span></span><br><span class="line"><span class="comment">#&gt; </span></span><br><span class="line"><span class="comment">#&gt; [[2]]</span></span><br><span class="line"><span class="comment">#&gt; y</span></span><br><span class="line"><span class="comment">#&gt; </span></span><br><span class="line"><span class="comment">#&gt; [[3]]</span></span><br><span class="line"><span class="comment">#&gt; x1 + x2</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo 博客搭建</title>
      <link href="2019/12/27/hexo/"/>
      <url>2019/12/27/hexo/</url>
      
        <content type="html"><![CDATA[<h1 id="前言">前言</h1><p>使用hexo + github pages 搭建博客的好处:</p><ol type="1"><li>全是静态文件，访问速度快；<br /></li><li>免费方便，不用花一分钱就可以搭建一个自由的个人博客，不需要服务器不需要后台；<br /></li><li>可以随意绑定自己的域名，不仔细看的话根本看不出来你的网站是基于github的<br /></li><li>数据绝对安全，基于github的版本管理，想恢复到哪个历史版本都行；<br /></li><li>博客内容可以轻松打包、转移、发布到其它平台</li></ol><h1 id="准备工作">准备工作</h1><p>有一个github账号，没有的话去注册一个；<br />安装了<code>node.js</code>、<code>npm</code><br />安装了git</p><p>本文环境：<br />&gt; Windows 10 &gt; hexo: 4.1.1 &gt; node: 12.13.1 &gt; git: 2.24.0</p><h1 id="创建github仓库">创建github仓库</h1><h2 id="创建仓库">创建仓库</h2><p>新建一个名为你的用户名<code>.github.io</code>的仓库，比如说，如果你的github用户名是<code>test</code>，那么你就新建<code>test.github.io</code>的仓库（必须是你的用户名，其它名称无效），将来你的网站访问地址就是 http://test.github.io 了</p><p>由此可见，每一个github账户最多只能创建一个这样可以直接使用域名访问的仓库。</p><p>几个注意的地方：</p><blockquote><ol type="1"><li>注册的邮箱一定要验证，否则不会成功；<br /></li><li>仓库名字必须是：<code>username.github.io</code>，其中<code>username</code>是你的用户名；</li></ol></blockquote><p>创建成功后，以后博客所有代码都是放在这个仓库里了</p><h2 id="配置ssh-key">配置SSH key</h2><p>配置ssh密钥是为了能够将本地仓库连接到github，详情请见：<a href="https://mooner.netlify.app/2018/09/25/more-github/">同一电脑配置多个Github账户</a></p><h2 id="测试是否连接成功">测试是否连接成功</h2><p>使用命令行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com # 注意邮箱地址不用改</span><br></pre></td></tr></table></figure><p>如果提示<code>Are you sure you want to continue connecting (yes/no)?</code>，输入<code>yes</code>，然后会看到：</p><blockquote><p>Hi xxx! You’ve successfully authenticated, but GitHub does not provide shell access.</p></blockquote><h1 id="搭建hexo博客">搭建hexo博客</h1><h2 id="hexo简介">hexo简介</h2><p>Hexo是一个简单、快速、强大的博客发布工具，支持Markdown格式，有众多优秀插件和主题。</p><p>官网： http://hexo.io</p><p>github: https://github.com/hexojs/hexo</p><h2 id="原理">原理</h2><p>由于github pages存放的都是静态文件，博客存放的不只是文章内容，还有文章列表、分类、标签、翻页等动态内容，假如每次写完一篇文章都要手动更新博文目录和相关链接信息，相信谁都会疯掉，所以hexo所做的就是将这些md文件都放在本地，每次写完文章后调用写好的命令来批量完成相关页面的生成，然后再将有改动的页面提交到github。</p><h2 id="安装">安装</h2><h3 id="注意事项">注意事项</h3><blockquote><ol type="1"><li>很多命令既可以用Windows的cmd来完成，也可以使用git bash来完成，但是部分命令会有一些问题，为避免不必要的问题，建议全部使用git bash来执行<br /></li><li>hexo有2种<code>_config.yml</code>文件，一个是根目录下的全局的<code>_config.yml</code>，一个是各个theme下的<code>_config.yml</code>。为了描述方便，在以下说明中，将前者称为 <strong>站点配置文件</strong>， 后者称为 <strong>主题配置文件</strong></li></ol></blockquote><h3 id="安装hexo">安装hexo</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g hexo</span><br></pre></td></tr></table></figure><h3 id="初始化">初始化</h3><p>在电脑的某个地方新建一个名为<code>hexo</code>的文件夹（名字可以随便取），比如我的是<code>F:\Workspaces\hexo</code>，由于这个文件夹将来就作为你存放代码的地方，所以最好不要随便放。</p><p>hexo会自动下载一些文件到这个目录，包括node_modules，目录结构如下图:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── _config.yml</span><br><span class="line">├── package.json</span><br><span class="line">├── scaffolds</span><br><span class="line">├── source</span><br><span class="line">|   ├── _drafts</span><br><span class="line">|   └── _posts</span><br><span class="line">└── themes</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo g # 生成</span><br><span class="line">hexo s # 启动服务</span><br></pre></td></tr></table></figure><p>执行以上命令之后，hexo就会在public文件夹生成相关html文件，这些文件将来都是要提交到github去的：</p><p><code>hexo s</code>是开启本地预览服务，打开浏览器访问 http://localhost:4000 即可看到内容</p><h2 id="主题">主题</h2><h3 id="更改主题">更改主题</h3><p>默认主题很丑，那我们别的不做，首先来替换一个好看点的主题</p><p><a href="https://hexo.io/themes/">官方主题</a></p><p>首先下载主题</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /f/Workspaces/hexo/</span><br><span class="line">git clone https://github.com/litten/hexo-theme-yilia.git themes/yilia</span><br></pre></td></tr></table></figure><p>下载以后的主题全在<code>theme</code>文件夹下边</p><p>打开根目录下站点配置文件<code>_config.yml</code>， 找到 <code>theme</code> 字段，并将其值更改为 <code>next</code>, 然后重新执行<code>hexo g</code>来重新生成。</p><p>如果出现一些莫名其妙的问题，可以先执行<code>hexo clean</code>来清理一下<code>public</code>的内容，然后再来重新生成和发布。</p><h2 id="github上传">github上传</h2><p>如果你一切都配置好了，发布上传很容易，一句<code>hexo d</code>就搞定，当然关键还是你要把所有东西配置好。</p><p>首先，<code>ssh key</code>肯定要配置好。其次，配置站点配置文件<code>_config.yml</code>中有关<code>deploy</code>的部分:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: https://github.com/Jeason-Zhao/Jeason-Zhao.github.io.git</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure><blockquote><p>注意：最新版本一定要是这种格式</p></blockquote><p>最后需要安装一个插件:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure><p>打开<code>git bash</code>，输入<code>hexo d</code>就会将本次有改动的代码全部提交，没有改动的不会</p><h2 id="保留cnamereadme.md等文件">保留CNAME、README.md等文件</h2><p>hexo默认会把所有md文件都转换成html，包括README.md，所以在上传之前配置站点配置文件<code>_config.yml</code>的<code>skip_render</code>部分：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">skip_render: README.md</span><br></pre></td></tr></table></figure><p>这样就会跳过该文件。</p><h2 id="常用hexo命令">常用hexo命令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hexo new &quot;postName&quot; #新建文章</span><br><span class="line">hexo new page &quot;pageName&quot; #新建页面</span><br><span class="line">hexo generate #生成静态页面至public目录</span><br><span class="line">hexo server #开启预览访问端口（默认端口4000，&#x27;ctrl + c&#x27;关闭server）</span><br><span class="line">hexo deploy #部署到GitHub</span><br><span class="line">hexo help  # 查看帮助</span><br><span class="line">hexo version  #查看Hexo的版本</span><br></pre></td></tr></table></figure><p>缩写：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hexo n == hexo new</span><br><span class="line">hexo g == hexo generate</span><br><span class="line">hexo s == hexo server</span><br><span class="line">hexo d == hexo deploy</span><br></pre></td></tr></table></figure><p>组合命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo s -g #生成并本地预览</span><br><span class="line">hexo d -g #生成并上传</span><br></pre></td></tr></table></figure><h1 id="写博客">写博客</h1><h2 id="写博客-1">写博客</h2><p>定位到我们的hexo根目录，执行命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new &#x27;my-first-blog&#x27;</span><br></pre></td></tr></table></figure><p>hexo会帮我们在<code>_posts</code>下生成相关md文件：</p><p>我们只需要打开这个文件就可以开始写博客了，</p><p>当然你也可以直接自己新建md文件，用这个命令的好处是帮我们自动生成了时间。一般完整格式如下：</p><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: postName #文章页面上的显示名称，一般是中文</span><br><span class="line">date: 2013-12-02 15:30:16 #文章生成时间，一般不改，当然也可以任意修改</span><br><span class="line">categories: 默认分类 #分类</span><br><span class="line">tags: [tag1,tag2,tag3] #文章标签，可空，多标签请用格式，注意:后面有个空格</span><br><span class="line">description: 附加一段文章摘要，字数最好在140字以内，会出现在meta的description里面</span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">以下是正文</span><br></pre></td></tr></table></figure><h2 id="新建页面">新建页面</h2><p>假如我新建一个名字为<code>about</code>的页面：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new page &quot;about&quot;</span><br></pre></td></tr></table></figure><p>在<code>source</code>文件夹下，将生成<code>about</code>文件夹</p><p>部署后将在<code>public</code>文件夹生成一个新的<code>html</code>页面：hexo.html，通过访问https://用户名.github.io/about/访问这个页面：</p>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pheatmap使用指南</title>
      <link href="2019/12/23/pheatmap/"/>
      <url>2019/12/23/pheatmap/</url>
      
        <content type="html"><![CDATA[<h2 id="pheatmap包">pheatmap包</h2><h3 id="简介">简介</h3><p>官方介绍：<br />A function to draw clustered heatmaps where one has better control over some graphical parameters such as cell size, etc</p><p>实际上，pheatmap是 Pretty Heatmaps 的缩写，是我认为目前最好用的绘制聚类热图的R包（尽管有很多其他的函数。。。）</p><h3 id="使用方法">使用方法</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">pheatmap(mat, color = colorRampPalette(rev(brewer.pal(n = <span class="number">7</span>, name =</span><br><span class="line">  <span class="string">&quot;RdYlBu&quot;</span>)))(<span class="number">100</span>), kmeans_k = <span class="literal">NA</span>, breaks = <span class="literal">NA</span>, border_color = <span class="string">&quot;grey60&quot;</span>,</span><br><span class="line">  cellwidth = <span class="literal">NA</span>, cellheight = <span class="literal">NA</span>, scale = <span class="string">&quot;none&quot;</span>, cluster_rows = <span class="literal">TRUE</span>,</span><br><span class="line">  cluster_cols = <span class="literal">TRUE</span>, clustering_distance_rows = <span class="string">&quot;euclidean&quot;</span>,</span><br><span class="line">  clustering_distance_cols = <span class="string">&quot;euclidean&quot;</span>, clustering_method = <span class="string">&quot;complete&quot;</span>,</span><br><span class="line">  clustering_callback = identity2, cutree_rows = <span class="literal">NA</span>, cutree_cols = <span class="literal">NA</span>,</span><br><span class="line">  treeheight_row = ifelse((class(cluster_rows) == <span class="string">&quot;hclust&quot;</span>) || cluster_rows,</span><br><span class="line">  <span class="number">50</span>, <span class="number">0</span>), treeheight_col = ifelse((class(cluster_cols) == <span class="string">&quot;hclust&quot;</span>) ||</span><br><span class="line">  cluster_cols, <span class="number">50</span>, <span class="number">0</span>), legend = <span class="literal">TRUE</span>, legend_breaks = <span class="literal">NA</span>,</span><br><span class="line">  legend_labels = <span class="literal">NA</span>, annotation_row = <span class="literal">NA</span>, annotation_col = <span class="literal">NA</span>,</span><br><span class="line">  annotation = <span class="literal">NA</span>, annotation_colors = <span class="literal">NA</span>, annotation_legend = <span class="literal">TRUE</span>,</span><br><span class="line">  annotation_names_row = <span class="literal">TRUE</span>, annotation_names_col = <span class="literal">TRUE</span>,</span><br><span class="line">  drop_levels = <span class="literal">TRUE</span>, show_rownames = <span class="literal">T</span>, show_colnames = <span class="literal">T</span>, main = <span class="literal">NA</span>,</span><br><span class="line">  fontsize = <span class="number">10</span>, fontsize_row = fontsize, fontsize_col = fontsize,</span><br><span class="line">  angle_col = c(<span class="string">&quot;270&quot;</span>, <span class="string">&quot;0&quot;</span>, <span class="string">&quot;45&quot;</span>, <span class="string">&quot;90&quot;</span>, <span class="string">&quot;315&quot;</span>), display_numbers = <span class="literal">F</span>,</span><br><span class="line">  number_format = <span class="string">&quot;%.2f&quot;</span>, number_color = <span class="string">&quot;grey30&quot;</span>, fontsize_number = <span class="number">0.8</span></span><br><span class="line">  * fontsize, gaps_row = <span class="literal">NULL</span>, gaps_col = <span class="literal">NULL</span>, labels_row = <span class="literal">NULL</span>,</span><br><span class="line">  labels_col = <span class="literal">NULL</span>, filename = <span class="literal">NA</span>, width = <span class="literal">NA</span>, height = <span class="literal">NA</span>,</span><br><span class="line">  silent = <span class="literal">FALSE</span>, na_col = <span class="string">&quot;#DDDDDD&quot;</span>, <span class="keyword">...</span>)</span><br></pre></td></tr></table></figure><h3 id="常用参数介绍">常用参数介绍</h3><h4 id="图形参数设置">图形参数设置</h4><p><font color = 'blue'><strong>main</strong></font>: 图的标题<br /><font color = 'blue'><strong>color</strong></font>: 表示颜色，赋值渐变颜色调色板<code>colorRampPalette</code>属性，选择“绿，黑，红”渐变，分为100个等级,，例：<code>color = colorRampPalette(c(“navy”, “white”, “firebrick3”))(100)</code><br /><font color = 'blue'><strong>sclae</strong></font>: 表示值均一化的方向，或者按照行或列，或者没有，值可以是"row", “column” 或者"none"<br /><font color = 'blue'><strong>margins</strong></font>: 表示页边空白的大小<br /><font color = 'blue'><strong>fontsize</strong></font>: 表示图中的字体大小<br /><font color = 'blue'><strong>fontsize_row</strong></font>: 行名的字体大小<br /><font color = 'blue'><strong>fontsize_col</strong></font>: 列名的字体大小<br /><font color = 'blue'><strong>breaks</strong></font>: 一个数字序列向量，涵盖数据中值的范围，用来定义图例中color_bar的范围<br /><font color = 'blue'><strong>angle_col</strong></font>: 列标签旋转的角度 (0, 45, 90, 270 and 315)<br /><font color = 'blue'><strong>labels_row</strong></font>: 向量，用来替代原来的行名<br /><font color = 'blue'><strong>labels_col</strong></font>: 向量，用来替代原来的列名</p><h4 id="聚类参数设置">聚类参数设置</h4><p><font color = 'blue'><strong>kmeans_k</strong></font>: 对行进行kmean聚类的个数，如果不设置，则不对行进行聚类<br /><font color = 'blue'><strong>cluster_cols</strong></font>: 表示进行列的聚类，值可以是FALSE或TRUE<br /><font color = 'blue'><strong>cluster_rows</strong></font>: 是否进行行的聚类，值可以是FALSE或TRUE<br /><font color = 'blue'><strong>treeheight_row</strong></font>: 设置row方向的聚类树高<br /><font color = 'blue'><strong>treeheight_col</strong></font>: 设置col方向的聚类树高<br /><font color = 'blue'><strong>clustering_distance_rows</strong></font>: 表示行距离度量的方法<br /><font color = 'blue'><strong>clustering_distance_cols</strong></font>: 表示列距离度量的方法<br /><font color = 'blue'><strong>clustering_method</strong></font>: 表示聚类方法，值可以是hclust的任何一种，如"ward.D",“single”, “complete”, “average”, “mcquitty”, “median”, “centroid”, “ward.D2”<br /><font color = 'blue'><strong>cutree_rows</strong></font>: 一致性聚类中行聚类的数量，如果没有进行聚类就忽略<br /><font color = 'blue'><strong>cutree_cols</strong></font>: 一致性聚类中列聚类的数量，如果没有进行聚类就忽略</p><h4 id="图例参数设置">图例参数设置</h4><p><font color = 'blue'><strong>legend</strong></font>: TRUE或者FALSE，表示是否显示图例<br /><font color = 'blue'><strong>legend_breaks</strong></font>: 设置图例的断点，格式：vector<br /><font color = 'blue'><strong>legend_labels</strong></font>: legend_breaks对应的标签，例：legend_breaks = -1:4, legend_labels = c(“0”,“1e-4”, “1e-3”, “1e-2”, “1e-1”, “1”)</p><h4 id="单元格参数设置">单元格参数设置</h4><p><font color = 'blue'><strong>border_color</strong></font>: 单元格边框的颜色，如果不需要则设为NA<br /><font color = 'blue'><strong>cellwidth</strong></font>: 单元格的宽度，默认NA，为适应画布大小<br /><font color = 'blue'><strong>cellheight</strong></font>: 单元格的高度，默认NA，为适应画布大小<br /><font color = 'blue'><strong>na_col</strong></font>: 指定矩阵中NA值的单元格的颜色</p><h4 id="单元格内字的设置">单元格内字的设置</h4><p><font color = 'blue'><strong>display_numbers</strong></font>: 单元格中是否标注数值，如果是matrix，则用matrix中的值代替原始值<br /><font color = 'blue'><strong>number_color</strong></font>: 字的颜色<br /><font color = 'blue'><strong>number_format</strong></font>: 单元格中标注数值的格式<br /><font color = 'blue'><strong>fontsize_number</strong></font>: 单元格中显示的数字的字体大小</p><h4 id="热图分割参数设置">热图分割参数设置</h4><p><font color = 'blue'><strong>cutree_rows</strong></font>: 基于层次聚类（使用cutree）划分行的簇数（如果未聚集行，则忽略参数）<br /><font color = 'blue'><strong>cutree_cols</strong></font>: 基于层次聚类（使用cutree）划分列的簇数<br /><font color = 'blue'><strong>gaps_row</strong></font>: 向量，指出在未进行行聚类时，在哪里对热图进行分割<br /><font color = 'blue'><strong>gaps_col</strong></font>: 向量，指出在未进行列聚类时，在哪里对热图进行分割</p><h4 id="行列注释参数设置">行列注释参数设置</h4><p><font color = 'blue'><strong>annotation_row</strong></font>: 行的分组信息，需要使用相应的行名称来匹配数据和注释中的行，注意之后颜色设置会考虑离散值还是连续值，格式要求为数据框<br /><font color = 'blue'><strong>annotation_col</strong></font>: 同上，列的分组信息<br /><font color = 'blue'><strong>annotation_colors</strong></font>: 用于手动指定annotation_row和annotation_col track颜色的列表。<br /><font color = 'blue'><strong>annotation_names_row</strong></font>: boolean值，显示是否应绘制行注释track的名称。<br /><font color = 'blue'><strong>anotation_names_col</strong></font>:  同上，显示是否应绘制列注释track的名称。</p><h4 id="输出图形设置">输出图形设置</h4><p><font color = 'blue'><strong>filename</strong></font>: 要保存图的名字<br /><font color = 'blue'><strong>width</strong></font>: 输出图片的宽度（单位英寸）<br /><font color = 'blue'><strong>height</strong></font>: 输出图片的高度（单位英寸）<br /><font color = 'blue'><strong>silent</strong></font>: 不绘制图形，只输出<code>gtable</code>对象</p><h3 id="实例介绍">实例介绍</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create test matrix</span></span><br><span class="line">&gt; test = matrix(rnorm(<span class="number">200</span>), <span class="number">20</span>, <span class="number">10</span>)</span><br><span class="line">&gt; test[<span class="number">1</span>:<span class="number">10</span>, seq(<span class="number">1</span>, <span class="number">10</span>, <span class="number">2</span>)] = test[<span class="number">1</span>:<span class="number">10</span>, seq(<span class="number">1</span>, <span class="number">10</span>, <span class="number">2</span>)] + <span class="number">3</span></span><br><span class="line">&gt; test[<span class="number">11</span>:<span class="number">20</span>, seq(<span class="number">2</span>, <span class="number">10</span>, <span class="number">2</span>)] = test[<span class="number">11</span>:<span class="number">20</span>, seq(<span class="number">2</span>, <span class="number">10</span>, <span class="number">2</span>)] + <span class="number">2</span></span><br><span class="line">&gt; test[<span class="number">15</span>:<span class="number">20</span>, seq(<span class="number">2</span>, <span class="number">10</span>, <span class="number">2</span>)] = test[<span class="number">15</span>:<span class="number">20</span>, seq(<span class="number">2</span>, <span class="number">10</span>, <span class="number">2</span>)] + <span class="number">4</span></span><br><span class="line">&gt; colnames(test) = paste(<span class="string">&quot;Test&quot;</span>, <span class="number">1</span>:<span class="number">10</span>, sep = <span class="string">&quot;&quot;</span>)</span><br><span class="line">&gt; rownames(test) = paste(<span class="string">&quot;Gene&quot;</span>, <span class="number">1</span>:<span class="number">20</span>, sep = <span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">library</span>(pheatmap)</span><br><span class="line">&gt; pheatmap(test)</span><br></pre></td></tr></table></figure><p><img src="/images/pheatmap/heatmap1.png" /></p><blockquote><p>默认参数是对行列均进行聚类（可设置cluster_row = F, cluster_col = F不进行聚类；如果聚类了，还可以通过设置treeheight_row=0, treeheight_col=0不显示聚类树），矩阵没有进行标准化（标准化参数为scale），热图的每个小块之间以灰色隔开（参数border_color），legend显示在右上方；热图的颜色可利用参数color调整</p></blockquote><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; pheatmap(test,kmeans_k = <span class="number">2</span>) <span class="comment"># 对行进行kmeans聚类 </span></span><br></pre></td></tr></table></figure><p><img src="/images/pheatmap/heatmap2.png" /></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; pheatmap(test, display_numbers = <span class="literal">TRUE</span>)</span><br><span class="line">&gt; pheatmap(test, display_numbers = <span class="literal">TRUE</span>, number_format = <span class="string">&quot;\%.1e&quot;</span>)</span><br><span class="line">&gt; pheatmap(test, display_numbers = matrix(ifelse(test &gt; <span class="number">5</span>, <span class="string">&quot;*&quot;</span>, <span class="string">&quot;&quot;</span>), nrow(test))) <span class="comment"># 可以设置显示的内容</span></span><br></pre></td></tr></table></figure><p><img src="/images/pheatmap/heatmap3.png" /></p><blockquote><p>display_numbers将数值显示在热图的格子中，可通过number_format设置数值的格式，较常用的有"%.2f"（保留小数点后两位），"%.1e"（科学计数法显示，保留小数点后一位），number_color设置显示内容的颜色，fontsize_number设置字体的大小。</p></blockquote><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; pheatmap(test, cluster_row = <span class="literal">FALSE</span>, legend_breaks = -<span class="number">1</span>:<span class="number">4</span>, legend_labels = c(<span class="string">&quot;0&quot;</span>, <span class="string">&quot;1e-4&quot;</span>, <span class="string">&quot;1e-3&quot;</span>, <span class="string">&quot;1e-2&quot;</span>, <span class="string">&quot;1e-1&quot;</span>, <span class="string">&quot;1&quot;</span>)) <span class="comment"># 自己设置图例</span></span><br></pre></td></tr></table></figure><p><img src="/images/pheatmap/heatmap4.png" /></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; pheatmap(test, cellwidth = <span class="number">15</span>, cellheight = <span class="number">12</span>, fontsize = <span class="number">8</span>, main = <span class="string">&quot;Example heatmap&quot;</span>, filename = <span class="string">&quot;test.pdf&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/pheatmap/heatmap5.png" /></p><blockquote><p>main可设置热图的标题，fontsize设置字体大小，filename可直接将热图存出，支持格式png, pdf, tiff, bmp, jpeg，并且可以通过width, height设置图片的大小</p></blockquote><p>对行、列添加注释分组信息</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; annotation_col = data.frame(CellType = factor(rep(c(<span class="string">&quot;CT1&quot;</span>, <span class="string">&quot;CT2&quot;</span>), <span class="number">5</span>)), Time = <span class="number">1</span>:<span class="number">5</span>)</span><br><span class="line">&gt; rownames(annotation_col) = paste(<span class="string">&quot;Test&quot;</span>, <span class="number">1</span>:<span class="number">10</span>, sep = <span class="string">&quot;&quot;</span>)</span><br><span class="line">&gt; annotation_row = data.frame(GeneClass = factor(rep(c(<span class="string">&quot;Path1&quot;</span>, <span class="string">&quot;Path2&quot;</span>, <span class="string">&quot;Path3&quot;</span>), c(<span class="number">10</span>, <span class="number">4</span>, <span class="number">6</span>))))</span><br><span class="line">&gt; rownames(annotation_row) = paste(<span class="string">&quot;Gene&quot;</span>, <span class="number">1</span>:<span class="number">20</span>, sep = <span class="string">&quot;&quot;</span>)</span><br><span class="line">&gt; pheatmap(test, annotation_col = annotation_col, annotation_row = annotation_row)</span><br></pre></td></tr></table></figure><p><img src="/images/pheatmap/heatmap6.png" /></p><p>同样可以自己设置各个分组注释信息的颜色</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; ann_colors = list(Time = c(<span class="string">&quot;white&quot;</span>, <span class="string">&quot;firebrick&quot;</span>),</span><br><span class="line">    CellType = c(CT1 = <span class="string">&quot;#1B9E77&quot;</span>, CT2 = <span class="string">&quot;#D95F02&quot;</span>),</span><br><span class="line">    GeneClass = c(Path1 = <span class="string">&quot;#7570B3&quot;</span>, Path2 = <span class="string">&quot;#E7298A&quot;</span>, Path3 = <span class="string">&quot;#66A61E&quot;</span>)) <span class="comment"># 如果是连续型变量会形成渐变色，如：Time</span></span><br><span class="line">&gt; pheatmap(test, annotation_col = annotation_col, annotation_row = annotation_row, annotation_colors = ann_colors)</span><br></pre></td></tr></table></figure><p><img src="/images/pheatmap/heatmap7.png" /></p><p>对于聚类图，可以使用<code>cutree_rows</code>, <code>cutree_cols</code>设置热图分割<br /><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; pheatmap(test,cutree_rows=<span class="number">3</span>,cutree_cols=<span class="number">2</span>)</span><br></pre></td></tr></table></figure> <img src="/images/pheatmap/heatmap8.png" /></p><p>对于未进行聚类的图，可以使用<code>gaps_row</code>, <code>gaps_col</code>自己设定要分隔开的位置<br /><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; pheatmap(test, annotation_col = annotation_col, cluster_rows = <span class="literal">FALSE</span>, gaps_row = c(<span class="number">10</span>, <span class="number">14</span>), cutree_col = <span class="number">2</span>)</span><br></pre></td></tr></table></figure> <img src="/images/pheatmap/heatmap9.png" /></p><h3 id="pheatmap函数返回结果">pheatmap()函数返回结果</h3><p>返回一个<code>pheatmap</code>对象，但是该对象中包含以下内容：</p><p><font color = 'blue'><strong>tree_row</strong></font> : 行聚类得到的<code>hclust</code>对象<br /><font color = 'blue'><strong>tree_row</strong></font> : 列聚类得到的<code>hclust</code>对象<br /><font color = 'blue'><strong>kmeans</strong></font>   : kmeans聚类的k值<br /><font color = 'blue'><strong>gtable</strong></font>     : 热图的<code>gtable</code>对象，可以用来与其他<code>ggplot2</code>对象进行组合绘图</p>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
            <tag> heatmap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shell编程规范</title>
      <link href="2019/10/14/shell-format/"/>
      <url>2019/10/14/shell-format/</url>
      
        <content type="html"><![CDATA[<p>规范的编程格式既可以使代码更加整洁，又能帮助别人理解使用代码，下面是在使用shell脚本的过程中涉及到的一些代码编程规范</p><h2 id="命名">命名</h2><ol type="1"><li>命名只能使用字母,数字和下划线,首个字符不能以数字开头。<br /></li><li>中间不能有空格,不能使用标点符号,不能使用汉字,可以使用下划线 _ ,所以我们往往使用 _ 作为分词的标识 例如 user_name、city_id 等<br /></li><li>不能使用bash里的关键字(可用help命令查看保留关键字)<br /></li><li>脚本中的所有变量风格统一使用下划线命名风格</li></ol><blockquote><p>目前关于命名使用较多的两种方式是<code>驼峰式</code> 和 <code>下划线式</code>，两种命名规则见仁见智</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">local</span> userName=<span class="string">&quot;Jeason&quot;</span></span><br><span class="line"><span class="built_in">local</span> user_name=<span class="string">&quot;Jeason&quot;</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">log_info</span></span>()&#123;</span><br><span class="line">  <span class="comment"># todo</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">logInfo</span></span>()&#123;</span><br><span class="line">  <span class="comment"># todo</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">get_user_info</span></span>()&#123;</span><br><span class="line">  <span class="comment"># todo</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">getUserInfo</span></span>()&#123;</span><br><span class="line">  <span class="comment"># todo</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="首行">首行</h2><p>推荐使用<code>#!/usr/bin/env bash</code>，自动检测shell环境</p><h2 id="注释">注释</h2><ol type="1"><li>除脚本首行外,所有以 <code>#</code> 开头的语句都将成为注释。<br /></li><li>函数必须有注释标识该函数的用途、入参变量、函数的返回值类型,且必须简单在一行内写完。<br /></li><li>函数的注释 <code>#</code> 顶格写, 井号后面紧跟一个空格 ,对于该格式的要求是为了最后生成函数的帮助文档是用的(markdown语法),然后是注释的内容,注释尽量简短且在一行,最后跟的是函数的类型。<br /></li><li>函数内注释 <code>#</code> 与缩进格式对整齐。<br /></li><li>变量的注释紧跟在变量的后面</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 主函数 []&lt;-()                  &lt;-------函数注释这样写</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">main</span></span>()&#123;</span><br><span class="line">  <span class="built_in">local</span> var=<span class="string">&quot;Hello World!!!&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$&#123;var&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># info级别的日志 []&lt;-(msg:String)  &lt;-------带入参的函数注释</span></span><br><span class="line"><span class="function"><span class="title">log_info</span></span>()&#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;[<span class="subst">$(date +&#x27;%Y-%m-%dT%H:%M:%S%z&#x27;)</span>][$$]: [info] $*&quot;</span> &gt;&amp;2</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># error级别的日志 []&lt;-(msg:String) &lt;-------带入参的函数注释</span></span><br><span class="line"><span class="function"><span class="title">log_error</span></span>()&#123;</span><br><span class="line">  <span class="comment"># todo [error]用红色显示         &lt;------函数内注释</span></span><br><span class="line">  <span class="built_in">local</span> msg=<span class="variable">$1</span> <span class="comment"># 将要输出的日志内容  &lt;------变量的注释紧跟在变量的后面</span></span><br><span class="line">  <span class="keyword">if</span> [[ x<span class="string">&quot;<span class="variable">$&#123;msg&#125;</span>&quot;</span> != x<span class="string">&quot;&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">    <span class="comment"># 注释                        &lt;-------函数内注释 `#` 与缩进格式对整齐</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;[<span class="subst">$(date +&#x27;%Y-%m-%dT%H:%M:%S%z&#x27;)</span>][$$]:[error] $*&quot;</span> &gt;&amp;2</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="缩进">缩进</h2><ol type="1"><li>使用两个空格进行缩进,不适用tab缩进<br /></li><li>不在一行的时候使用 <code>\</code>进行换行,使用 <code>\</code> 换行的原则是整齐美观</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"><span class="comment"># 脚本使用帮助文档 []&lt;-()</span></span><br><span class="line"><span class="function"><span class="title">manual</span></span>()&#123;</span><br><span class="line">  cat <span class="string">&quot;<span class="variable">$0</span>&quot;</span>|grep -v <span class="string">&quot;less \&quot;\$0\&quot;&quot;</span> \</span><br><span class="line">          |grep -B1 <span class="string">&quot;function &quot;</span>   \</span><br><span class="line">          |grep -v <span class="string">&quot;\\--&quot;</span>         \</span><br><span class="line">          |sed <span class="string">&quot;s/function //g&quot;</span>   \</span><br><span class="line">          |sed <span class="string">&quot;s/()&#123;//g&quot;</span>         \</span><br><span class="line">          |sed <span class="string">&quot;s/#//g&quot;</span>           \</span><br><span class="line">          |sed <span class="string">&#x27;N;s/\n/ /&#x27;</span>        \</span><br><span class="line">          |column -t              \</span><br><span class="line">          |awk <span class="string">&#x27;&#123;print $1,$3,$2&#125;&#x27;</span> \</span><br><span class="line">          |column -t</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">search_user_info</span></span>()&#123;</span><br><span class="line">  <span class="built_in">local</span> result=$(httpclient_get --cookie <span class="string">&quot;<span class="variable">$&#123;cookie&#125;</span>&quot;</span> \</span><br><span class="line">                                         <span class="string">&quot;<span class="variable">$&#123;url&#125;</span>/userName=<span class="variable">$&#123;user_name&#125;</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="变量">变量</h2><ol type="1"><li>变量赋值使用 <code>=</code> 等号,左右不能留有空格<br /></li><li>使用变量的值用 <code>$</code> 取值符号<br /></li><li>使用变量的时候,变量名一定要用 <code>&#123;&#125;</code> 包裹<br /></li><li>使用变量的时候一定要用 双引号 <code>"$&#123;&#125;"</code> 包裹</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var1=<span class="string">&quot;Hello World&quot;</span>   <span class="comment">#正确,推荐使用双引号</span></span><br><span class="line">var2=<span class="string">&#x27;Hello World&#x27;</span>   <span class="comment">#正确,不推荐使用单引号</span></span><br><span class="line">var3=<span class="string">&quot;<span class="variable">$&#123;var1&#125;</span>&quot;</span>       <span class="comment">#应用前面定义的变量的时候也要使用双引号包裹</span></span><br><span class="line">var4=6            </span><br><span class="line">var5=6.70            <span class="comment">#小数</span></span><br><span class="line">var3=<span class="variable">$&#123;var1&#125;</span>         <span class="comment">#正确,不推荐</span></span><br></pre></td></tr></table></figure><ol start="5" type="1"><li>常量一定要定义成<code>readonly</code>,这种变量不能使用<code>source</code>跨shell使用<br /></li><li>函数中的变量要用<code>local</code>修饰,定义成局部变量,这样在外部遇到重名的变量也不会影响<br /></li><li>变量一经定义,不允许删除</li></ol><h2 id="变量类型">变量类型</h2><ol type="1"><li>定义在函数中的我们称之为函数局部变量;定义在函数外部，shell脚本中变量我们称之为脚本全局变量<br /></li><li>环境变量 所有的程序，包括shell启动的程序，都能访问环境变量，有些程序需要环境变量来保证其正常运行。必要的时候shell脚本也可以定义环境变量。</li></ol><h2 id="函数">函数</h2><p>函数定义形式：<br /><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">main</span></span>()&#123;</span><br><span class="line">  <span class="comment">#函数执行的操作</span></span><br><span class="line">  <span class="comment">#函数的返回结果</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> 或<br /><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">main</span></span>()&#123;</span><br><span class="line">  <span class="comment">#函数执行的操作</span></span><br><span class="line">  <span class="comment">#函数的返回结果</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ol type="1"><li>使用关键字 <code>function</code> 显示定义的函数为 <code>public</code> 的函数,可以供 外部脚本以 <code>sh 脚本 函数 函数入参</code> 的形式调用<br /></li><li>未使用关键字 <code>function</code> 显示定义的函数为 <code>privat</code> 的函数, 仅供本脚本内部调用,注意这种<code>privat</code>是人为规定的,并不是shell的语法,不推荐以 <code>sh 脚本 函数 函数入参</code> 的形式调用,注意是不推荐而不是不能。<br /></li><li>在函数内部首先使用有意义的变量名接受参数,然后在使用这些变量进行操作,禁止直接操作<code>$1</code>,<code>$2</code> 等，除非这些变量只用一次<br /></li><li>函数的注释</li></ol><p>函数类型的概念是从函数编程语言中的概念偷过来的,shell函数的函数类型指的是函数的输入到函数的输入的映射关系<br /><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 主函数 []&lt;-()                  &lt;-------函数注释这样写</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">main</span></span>()&#123;</span><br><span class="line">  <span class="built_in">local</span> var=<span class="string">&quot;Hello World!!!&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$&#123;var&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># info级别的日志 []&lt;-(msg:String)  &lt;-------带入参的函数注释</span></span><br><span class="line"><span class="function"><span class="title">log_info</span></span>()&#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;[<span class="subst">$(date +&#x27;%Y-%m-%dT%H:%M:%S%z&#x27;)</span>][$$]: [info] $*&quot;</span> &gt;&amp;2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <code>main</code>函数的函数类型是 <code>[]&lt;-()</code> , <code>&lt;-</code> 左侧表的是函数的返回值类型 用<code>[]</code>包裹, 右侧是函数的参数类型 用<code>()</code>包裹,多个参数用 <code>,</code> 分隔,参数的描述是从 Scala 语言中偷过来, 先是参数名称 然后是参数类型 中间用<code>:</code>分隔</p><p>对于<code>main</code>函数的注释来说, <code>#</code> 顶格写,后面紧跟一个空格,其实这样写是遵循的markdown的语法, 后面再跟一个空格,然后是 <code>[]&lt;-()</code>,代表这个函数没有入参也没有返回值,这个函数的目的就是执行这个这个函数中的命令,但我不关心这个函数的返回值。也就是利用函数的副作用来完成我们想要的操作</p><p>对于<code>log_info</code> 也是一样 不过 最后的函数类型是 <code>[]&lt;-(msg:String)</code> 代表入参是一个<code>string</code>类型的信息,然后也没有返回值。关于函数的返回值,我理解的函数的返回值有两种形式,一种是显示的<code>return</code>一种是隐式的<code>echo</code></p><h2 id="返回值">返回值</h2><h3 id="显式return">显式return</h3><ol type="1"><li>明确返回结果是在<code>[0-255]</code>之间的数值类型的时候使用显示 <code>reuturn</code> 返回结果<br /></li><li>返回结果类型是<code>Boolean</code>类型,也就是说函数的功能是起判断作用,返回结果是真或者假的时候使用显示 <code>return</code> 返回结果</li></ol><h3 id="隐式echo">隐式echo</h3><p>其他形式的输出使用<code>echo</code></p><h2 id="循环分支">循环分支</h2><h3 id="if">if</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [[ condition ]]; <span class="keyword">then</span></span><br><span class="line">  <span class="comment"># statements</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ condition ]]; <span class="keyword">then</span></span><br><span class="line">  <span class="comment"># statements</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="comment"># statements</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ condition ]]; <span class="keyword">then</span></span><br><span class="line">  <span class="comment"># statements</span></span><br><span class="line"><span class="keyword">elif</span> [[ condition ]]; <span class="keyword">then</span></span><br><span class="line">  <span class="comment"># statements</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="comment"># statements</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><ul><li><code>if</code> 后面的判断 使用 双中括号<code>[[]]</code><br /></li><li><code>if [[ condition ]]; then</code> 写在一行</li></ul><h3 id="while">while</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> [[ condition ]]; <span class="keyword">do</span></span><br><span class="line">  <span class="comment"># statements</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> -r item ;<span class="keyword">do</span></span><br><span class="line">  <span class="comment"># statements</span></span><br><span class="line"><span class="keyword">done</span> &lt; <span class="string">&#x27;file_name&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="until">until</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">until [[ condition ]]; <span class="keyword">do</span></span><br><span class="line">  <span class="comment"># statements</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h3 id="for">for</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (( i = 0; i &lt; 10; i++ )); <span class="keyword">do</span></span><br><span class="line">  <span class="comment"># statements</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> <span class="variable">$&#123;array&#125;</span>; <span class="keyword">do</span></span><br><span class="line">  <span class="comment"># statements</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h3 id="case">case</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> word <span class="keyword">in</span></span><br><span class="line">  pattern )</span><br><span class="line">    <span class="comment">#statements</span></span><br><span class="line">    ;;</span><br><span class="line">    *)</span><br><span class="line">    <span class="comment">#statements</span></span><br><span class="line">    ;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure><hr /><h3 id="reference">Reference</h3><p><a href="https://www.jianshu.com/p/161618366866">Shell编程规范--简书</a></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>高通量测序常用概念</title>
      <link href="2019/10/09/NGS/"/>
      <url>2019/10/09/NGS/</url>
      
        <content type="html"><![CDATA[<p>高通量测序技术（High-throughput sequencing，HTS）是对传统Sanger测序（称为一代测序技术）革命性的改变,一次对几十万到几百万条核酸分子进行序列测定, 因此在有些文献中称其为下一代测序技术(next generation sequencing，NGS )足见其划时代的改变, 同时高通量测序使得对一个物种的转录组和基因组进行细致全貌的分析成为可能, 所以又被称为深度测序(Deep sequencing)。</p><h2 id="什么是sanger法测序一代测序"><strong>什么是Sanger法测序（一代测序）</strong></h2><p>Sanger法测序利用一种DNA聚合酶来延伸结合在待定序列模板上的引物。直到掺入一种链终止核苷酸为止。每一次序列测定由一套四个单独的反应构成，每个反应含有所有四种脱氧核苷酸三磷酸(dNTP)，并混入限量的一种不同的双脱氧核苷三磷酸(ddNTP)。由于ddNTP缺乏延伸所需要的3-OH基团，使延长的寡聚核苷酸选择性地在G、A、T或C处终止。终止点由反应中相应的双脱氧而定。每一种dNTPs和ddNTPs的相对浓度可以调整，使反应得到一组长几百至几千碱基的链终止产物。它们具有共同的起始点，但终止在不同的的核苷酸上，可通过高分辨率变性凝胶电泳分离大小不同的片段，凝胶处理后可用X-光胶片放射自显影或非同位素标记进行检测。</p><h2 id="什么是基因组重测序genome-re-sequencing"><strong>什么是基因组重测序（Genome Re-sequencing）</strong></h2><p>全基因组重测序是对基因组序列已知的个体进行基因组测序，并在个体或群体水平上进行差异性分析的方法。随着基因组测序成本的不断降低，人类疾病的致病突变研究由外显子区域扩大到全基因组范围。通过构建不同长度的插入片段文库和短序列、双末端测序相结合的策略进行高通量测序，实现在全基因组水平上检测疾病关联的常见、低频、甚至是罕见的突变位点，以及结构变异等，具有重大的科研和产业价值。</p><h2 id="什么是de-novo测序"><strong>什么是de novo测序</strong></h2><p>de novo测序也称为从头测序：其不需要任何现有的序列资料就可以对某个物 种进行测序，利用生物信息学分析手段对序列进行拼接，组装，从而获得该物种的基因组图谱。获得一个物种的全基因组序列是加快对此物种了解的重要捷径。随着新一代测序技术的飞速发展，基因组测序所需的成本和时间较传统技术都大大降低，大规模基因组测序渐入佳境，基因组学研究也迎来新的发展契机和革命性突破。利用新一代高通量、高效率测序技术以及强大的生物信息分析能力，可以高效、低成本地测定并分析所有生物的基因组序列。</p><h2 id="什么是外显子测序whole-exon-sequencing"><strong>什么是外显子测序（whole exon sequencing）</strong></h2><p>外显子组测序是指利用序列捕获技术将全基因组外显子区域DNA捕捉并富集后进行高通量测序的基因组分析方法。外显子测序相对于基因组重测序成本较低，对研究已知基因的SNP、Indel等具有较大的优势，但无法研究基因组结构变异如染色体断裂重组等。</p><h2 id="什么是mrna测序-rna-seq"><strong>什么是mRNA测序 （RNA-seq）</strong></h2><p>转录组学（transcriptomics）是在基因组学后新兴的一门学科，即研究特定细胞在某一功能状态下所能转录出来的所有RNA（包括mRNA和非编码RNA）的类型与拷贝数。Illumina提供的mRNA测序技术可在整个mRNA领域进行各种相关研究和新的发现。mRNA测序不对引物或探针进行设计，可自由提供关于转录的客观和权威信息。研究人员仅需要一次试验即可快速生成完整的poly-A尾的RNA完整序列信息，并分析基因表达、cSNP、全新的转录、全新异构体、剪接位点、等位基因特异性表达和罕见转录等最全面的转录组信息。简单的样品制备和数据分析软件支持在所有物种中的mRNA测序研究。</p><h2 id="什么是chip-seq"><strong>什么是Chip-seq</strong></h2><p>染色质免疫共沉淀技术（ChromatinImmunoprecipitation，ChIP）也称结合位点分析法，是研究体内蛋白质与DNA相互作用的有力工具，通常用于转录因子结合位点或组蛋白特异性修饰位点的研究。将ChIP与第二代测序技术相结合的ChIP-Seq技术，能够高效地在全基因组范围内检测与组蛋白、转录因子等互作的DNA区段。 ChIP-Seq的原理是：首先通过染色质免疫共沉淀技术（ChIP）特异性地富集目的蛋白结合的DNA片段，并对其进行纯化与文库构建；然后对富集得到的DNA片段进行高通量测序。研究人员通过将获得的数百万条序列标签精确定位到基因组上，从而获得全基因组范围内与组蛋白、转录因子等互作的DNA区段信息。</p><h2 id="单核苷酸多态性"><strong>单核苷酸多态性</strong></h2><p>个体间基因组DNA序列同一位置单个核苷酸变异(替代、插入或缺失)所引起的多态性。不同物种、个体基因组DNA序列同一位置上的单个核苷酸存在差别的现象。有这种差别的基因座、DNA序列等可作为基因组作图的标志。人基因组上平均约每1000个核苷酸即可能出现1个单核苷酸多态性的变化，其中有些单核苷酸多态性可能与疾病有关，但可能大多数与疾病无关。单核苷酸多态性是研究人类家族和动植物品系遗传变异的重要依据。在研究癌症基因组变异时，相对于正常组织，癌症中特异的单核苷酸变异是一种体细胞突变（somatic mutation），称做SNV。</p><h2 id="什么是copy-number-variation-cnv"><strong>什么是copy number variation （CNV）</strong></h2><p>基因组拷贝数变异是基因组变异的一种形式，通常使基因组中大片段的DNA形成非正常的拷贝数量。例如人类正常染色体拷贝数是2，有些染色体区域拷贝数变成1或3，这样，该区域发生拷贝数缺失或增加，位于该区域内的基因表达量也会受到影响。如果把一条染色体分成A-B-C-D四个区域，则A-B-C-C-D/A-C-B-C-D/A-C-C-B-C-D/A-B-D分别发生了C区域的扩增及缺失，扩增的位置可以是连续扩增如A-B-C-C-D也可以是在其他位置的扩增，如A-C-B-C-D。</p><h2 id="什么是structure-variation-sv"><strong>什么是structure variation （SV）</strong></h2><p>染色体结构变异是指在染色体上发生了大片段的变异。主要包括染色体大片段的插入和缺失（引起CNV的变化），染色体内部的某块区域发生翻转颠换，两条染色体之间发生重组（inter-chromosome trans-location）等。一般SV的展示利用Circos 软件。</p><h2 id="什么是rpkmfpkm"><strong>什么是RPKM、FPKM</strong></h2><p><strong>RPKM,Reads Per Kilobase of exon model per Million mapped reads, is defined in this way</strong> [Mortazavi etal., 2008]: 每1百万个map上的reads中map到外显子的每1K个碱基上的reads个数。</p><p><strong>FPKM</strong>(<strong>fragments per kilobase of exon per million fragments mapped</strong>). FPKM与RPKM计算方法基本一致。不同点就是FPKM计算的是fragments，而RPKM计算的是reads。Fragment比read的含义更广，因此FPKM包含的意义也更广，可以是pair-end的一个fragment，也可以是一个read。</p>]]></content>
      
      
      <categories>
          
          <category> bioinformatics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> high throughput </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hemberg-lab单细胞转录组数据分析（一）</title>
      <link href="2019/10/09/Hemberg-lab1/"/>
      <url>2019/10/09/Hemberg-lab1/</url>
      
        <content type="html"><![CDATA[<h1 id="单细胞rna-seq简介">单细胞RNA-seq简介</h1><h2 id="bulk-rna-seq">Bulk RNA-seq</h2><ul><li>2000年末的重大技术突破，取代微阵列表达芯片被广泛使用<br /></li><li>通过混合大量细胞获取足够RNA用于建库测序，来定量每个基因的<strong>平均表达水平</strong><br /></li><li>用于比较转录组，例如来自不同样本的同一组织<br /></li><li>用于定量整体的基因表达特征<br /></li><li>对于异质性的研究仍然是不够充足的</li></ul><h2 id="scrna-seq">scRNA-seq</h2><ul><li>是一项由汤富酬等人在2009年首次发表的新技术。文章发表于Nature Method，测序了7个单细胞，两个卵裂球，两个野生型卵子，两个Dicer敲除的卵 子，一个Ago2敲除的卵子。<br /></li><li>这项技术在2013年被Nature评为年度技术,更简便的操作流程和较低的测序成本促成单细胞技术的广泛流行。2018年底，单细胞技术应用于胚胎发育追踪评为Science年度突破。<br /></li><li>检测每个基因在大量细胞中的表达水平分布。<br /></li><li>可以用于研究细胞类型特异性转录调控的新型生物问题<br /></li><li>研究中细胞数目范围从<strong>100</strong>个变到<strong>10^6</strong>个，且每年递增。<br /></li><li>目前有许多不同的单细胞Protocol，例如 <code>SMART-seq2</code> , <code>CELL-seq</code> 和 <code>Drop-seq</code><br /></li><li>还有商业平台，包括 <code>Fluidigm C1</code>, <code>Wafergen ICELL8</code> 和 <code>10X Genomics Chromium</code><br /></li><li>Bulk RNA-seq技术中一些计算分析方法可应用于单细胞分析<br /></li><li>多数情况下单细胞计算分析需要调整现有方法或者开发新方法</li></ul><h2 id="workflow">Workflow</h2><p><img src="/images/lab1/RNA-Seq_workflow-5.pdf.jpg" /></p><h2 id="计算分析">计算分析</h2><p><img src="/images/lab1/flowchart.png" /></p><h2 id="单细胞测序方法">单细胞测序方法</h2><p><img src="/images/lab1/moores-law.png" /></p><p>开发scRNA-seq的新实验方法和操作手册是目前很火的研究领域，而且最近这些年已经发表了一些改进方法。上图可以看出检测的细胞数目以指数形式增加，以下是一份不完全的统计：<br />+ STRT-seq<br />+ Smart-seq<br />+ CEL-seq<br />+ MARS-seq<br />+ SCRB-seq<br />+ Smart-seq2<br />+ Drop-seq<br />+ InDrop-seq<br />+ CEL-seq2<br />+ Seq-well<br />+ SMARTer<br />+ Microwell-seq 【2018，郭国冀团队】</p><p>这些方法可以用不同的方式分类，但两个最主要的优化是：<strong>定量</strong>和<strong>捕获</strong></p><p>定量有两种类型—-全长型 (<strong>full-length</strong>)和标签型 (<strong>tag-based</strong>)。全长型力图捕获并均匀测序整条转录本，标签型只捕获转录本的<code>5'</code>或<code>3'</code>端。不同定量方式需要自己对应的计算分析方法。全长方案理论上可以对整个转录本进行均匀测序，但实际上总会有测序覆盖偏好性的存在。标签型的主要优点是可以与唯一的分子标识符(<strong>UMIs</strong>)结合进行更精确定量。其缺点是，测序限制在转录本的<code>5'</code>或<code>3'</code>端，可能会降低比对率，并且难以区分不同剪接体的表达。</p><p>捕获的策略决定了实验通量、细胞如何被选择和除测序外的哪些额外信息可获得。最常用的三种捕获方式是基于微孔- (<strong>microwell-</strong>)，微流- (<strong>microfluidic-</strong>)，液滴- (<strong>droplet-</strong>)</p><p>对于基于微孔的捕获平台，先用移液管或者激光切割的方式分离细胞并放到微流孔中。它的一个优点是可以结合流式细胞荧光分选（FACS, fluorescent activated cell sorting）根据表面Marker分选细胞。因此特别适合分选细胞子集用于测序。另一个优点是可以获得细胞形态全览图，提供多一个维度的信息，可用于鉴定微孔中是否有损伤的细胞或双份细胞，主要缺点是通量低且每个细胞所需的工作量相当大。</p><p>微流型平台，比如Fluidigm’s C1，提供了一个更加整合的系统，同时可以捕获细胞和完成文库构建的准备过程。因此它们比微孔型平台通量更高。但是微流型平台大约只能捕获10%的细胞，不适合处理稀有细胞或者细胞量很少的情况。此外，微流控芯片相对昂贵，不过更小的反应体积可以节省试剂的费用。</p><p>液滴型方法是将单独的细胞和一个包含建库所学酶的珠粒 (<strong>bead</strong>)包裹在一个纳米级液滴里面。特殊地，每个珠粒(<strong>bead</strong>)包含一段独特的条形码序列 (<strong>barcode</strong>)，会加到所有来自于液滴里面这个细胞的序列上，用于区分不同细胞的转录本。因此所有的液滴可以混合在一起测序，然后再根据<code>barcode</code>序列确定其是否归属于同一细胞。液滴型平台通常有最高的通量，因为文库的准备成本很低，约为0.05美元/每个细胞。随之而来的，测序成本往往是其限制因素，通常测序深度比较低，只检测几千个转录本的表达。</p><hr /><h2 id="ref">Ref</h2><p>https://scrnaseq-course.cog.sanger.ac.uk/website/index.html</p>]]></content>
      
      
      <categories>
          
          <category> SingleCell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SingleCell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SRAtoolkit 安装与使用</title>
      <link href="2019/10/03/sratool/"/>
      <url>2019/10/03/sratool/</url>
      
        <content type="html"><![CDATA[<p>SRAtoolkit是NCBI开发的一个用于SRA文件处理的软件包，包含许多有用的工具。</p><h3 id="下载sratoolkit软件包"><strong>下载SRAtoolkit软件包</strong></h3><p>软件包下载地址在NCBI网站：https://trace.ncbi.nlm.nih.gov/Traces/sra/sra.cgi?view=software</p><p>目前最新版是2.10.8；有多个操作系统版本，我们选Ubuntu 64bit版；</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -P ~/download https://ftp-trace.ncbi.nlm.nih.gov/sra/sdk/2.10.8/sratoolkit.2.10.8-ubuntu64.tar.gz</span><br></pre></td></tr></table></figure><h3 id="解压压缩包"><strong>解压压缩包</strong></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar zvxf ~/download/sratoolkit.2.10.8-ubuntu64.tar.gz -C ~/software</span><br><span class="line">mv ~/software/sratoolkit.2.10.8-ubuntu64 ~/software/sratoolkit</span><br></pre></td></tr></table></figure><h3 id="将sratoolkit安装文件路径加入环境变量"><strong>将sratoolkit安装文件路径加入环境变量</strong></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;export PATH=<span class="variable">$PATH</span>:/home/ubuntu/software/sratoolkit/bin&quot;</span> &gt;&gt; ~/.zshrc</span><br><span class="line"><span class="built_in">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure><p>使用<code>fastq-dump</code>和<code>prefetch</code>进行测试</p><p>更详细步骤和说明，参见官网Documentation： https://trace.ncbi.nlm.nih.gov/Traces/sra/sra.cgi?view=toolkit_doc&amp;f=std</p><h3 id="下载sra文件">下载SRA文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">prefetch SRR10107270</span><br><span class="line">2020-10-03T06:03:13 prefetch.2.9.6: 1) Downloading <span class="string">&#x27;SRR10107270&#x27;</span>...</span><br><span class="line">2020-10-03T06:03:13 prefetch.2.9.6:  Downloading via https...</span><br><span class="line">2020-10-03T06:09:01 prefetch.2.9.6:  https download succeed</span><br><span class="line">2020-10-03T06:09:01 prefetch.2.9.6: 1) <span class="string">&#x27;SRR10107270&#x27;</span> was downloaded successfully</span><br><span class="line">2020-10-03T06:09:01 prefetch.2.9.6: <span class="string">&#x27;SRR10107270&#x27;</span> has 0 unresolved dependencies</span><br></pre></td></tr></table></figure><h3 id="解压sra文件">解压SRA文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> *sra</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line">fastq-dump --split-3 <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h3 id="查看文件">查看文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls</span><br><span class="line">SRR10107270_1.fastq  SRR10107270_2.fastq  SRR10107270.sra</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">head SRR10107270_1.fastq</span><br><span class="line">@SRR10107270.1 1 length=72</span><br><span class="line">TCGGGNAGTGCTAGCTCGCGATTCCAGGATGTAGTTAACCTTGAGCACAATTTCATTGACGNNAGCAGCNNN</span><br><span class="line">+SRR10107270.1 1 length=72</span><br><span class="line">AAAAA<span class="comment">#EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE##EEEEEE###</span></span><br><span class="line">@SRR10107270.2 2 length=76</span><br><span class="line">CATGTNATTGTTGTAGGAATCAAAGTCAAACACATTTCGAACTACACTGGAGAGACCTTCANNCGGAAANTNNNGT</span><br><span class="line">+SRR10107270.2 2 length=76</span><br><span class="line">AAAAA<span class="comment">#EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEAEEEEEEEEEEEEE/EEEEEE##EEEEEA#E###EE</span></span><br><span class="line">@SRR10107270.3 3 length=76</span><br><span class="line">AGACGNTGGAGGATGAAGGGCTGGCTGTTGGGTCTGTTCTTGCTCTAAGGCCACATCCTAGNAAAGCAGGGNNNGT   </span><br></pre></td></tr></table></figure><p>可以看到测序read的读长是七十多bp</p><h3 id="section"></h3>]]></content>
      
      
      
        <tags>
            
            <tag> software </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux下百度云快速下载</title>
      <link href="2019/09/19/baiduyun-ubuntu/"/>
      <url>2019/09/19/baiduyun-ubuntu/</url>
      
        <content type="html"><![CDATA[<p>记录一下找到的linux可用的百度云下载工具，项目地址：https://github.com/iikira/BaiduPCS-Go</p><p>直接下载文件解压，进入文件夹，命令行下运行：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./BaiduPCS-Go</span><br></pre></td></tr></table></figure><p>即可进入BaiduPCS-Go的加护界面，使用<code>help</code>命令查看相关命令。</p><h2 id="初级使用教程">初级使用教程</h2><p>新手建议: <strong>双击运行程序</strong>, 进入仿 Linux shell 的 cli 交互模式;</p><p>cli交互模式下, 光标所在行的前缀应为 <code>BaiduPCS-Go &gt;</code>, 如果登录了百度帐号则格式为 <code>BaiduPCS-Go:&lt;工作目录&gt; &lt;百度ID&gt;$</code></p><p>以下例子的命令, 均为 cli交互模式下的命令</p><p>运行命令的正确操作: <strong>输入命令, 按一下回车键 (键盘上的 Enter 键)</strong>, 程序会接收到命令并输出结果</p><h2 id="查看程序使用说明">1. 查看程序使用说明</h2><p>cli交互模式下, 运行命令 <code>help</code></p><h2 id="登录百度帐号-必做">2. 登录百度帐号 (必做)</h2><p>cli交互模式下, 运行命令 <code>login -h</code> (注意空格) 查看帮助</p><p>cli交互模式下, 运行命令 <code>login</code> 程序将会提示你输入百度用户名(手机号/邮箱/用户名)和密码, 必要时还可以在线验证绑定的手机号或邮箱</p><h2 id="切换网盘工作目录">3. 切换网盘工作目录</h2><p>cli交互模式下, 运行命令 <code>cd /我的资源</code> 将工作目录切换为 <code>/我的资源</code> (前提: 该目录存在于网盘)</p><p>目录支持通配符匹配, 所以你也可以这样: 运行命令 <code>cd /我的*</code> 或 <code>cd /我的??</code> 将工作目录切换为 <code>/我的资源</code>, 简化输入.</p><p>将工作目录切换为 <code>/我的资源</code> 成功后, 运行命令 <code>cd ..</code> 切换上级目录, 即将工作目录切换为 <code>/</code></p><p>为什么要这样设计呢, 举个例子,</p><p>假设 你要下载 <code>/我的资源</code> 内名为 <code>1.mp4</code> 和 <code>2.mp4</code> 两个文件, 而未切换工作目录, 你需要依次运行以下命令:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d &#x2F;我的资源&#x2F;1.mp4</span><br><span class="line">d &#x2F;我的资源&#x2F;2.mp4</span><br></pre></td></tr></table></figure><p>而切换网盘工作目录之后, 依次运行以下命令:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;我的资源</span><br><span class="line">d 1.mp4</span><br><span class="line">d 2.mp4</span><br></pre></td></tr></table></figure><p>这样就达到了简化输入的目的</p><h2 id="网盘内列出文件和目录">4. 网盘内列出文件和目录</h2><p>cli交互模式下, 运行命令 <code>ls -h</code> (注意空格) 查看帮助</p><p>cli交互模式下, 运行命令 <code>ls</code> 来列出当前所在目录的文件和目录</p><p>cli交互模式下, 运行命令 <code>ls /我的资源</code> 来列出 <code>/我的资源</code> 内的文件和目录</p><p>cli交互模式下, 运行命令 <code>ls ..</code> 来列出当前所在目录的上级目录的文件和目录</p><h2 id="下载文件">5. 下载文件</h2><p>说明: 下载的文件默认保存到 download/ 目录 (文件夹)</p><p>cli交互模式下, 运行命令 <code>d -h</code> (注意空格) 查看帮助</p><p>cli交互模式下, 运行命令 <code>d /我的资源/1.mp4</code> 来下载位于 <code>/我的资源/1.mp4</code> 的文件 <code>1.mp4</code> , 该操作等效于运行以下命令:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;我的资源</span><br><span class="line">d 1.mp4</span><br></pre></td></tr></table></figure><p>现在已经支持目录 (文件夹) 下载, 所以, 运行以下命令, 会下载 <code>/我的资源</code> 内的所有文件 (违规文件除外):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d &#x2F;我的资源</span><br></pre></td></tr></table></figure><p>参见 例6 设置下载最大并发量</p><h2 id="设置下载最大并发量">6. 设置下载最大并发量</h2><p>cli交互模式下, 运行命令 <code>config set -h</code> (注意空格) 查看设置帮助以及可供设置的值</p><p>cli交互模式下, 运行命令 <code>config set -max_parallel 250</code> 将下载最大并发量设置为 250</p><p>下载最大并发量建议值: 50~500, 太低下载速度提升不明显甚至速度会变为0, 太高可能会导致程序出错被操作系统结束掉.</p><h2 id="退出程序">7. 退出程序</h2><p>运行命令 <code>quit</code> 或 <code>exit</code> 或 组合键 <code>Ctrl+C</code> 或 组合键 <code>Ctrl+D</code></p>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> 软件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TCGA barcode（样本ID）</title>
      <link href="2019/09/19/tcga-barcode/"/>
      <url>2019/09/19/tcga-barcode/</url>
      
        <content type="html"><![CDATA[<p>接触和分析过TCGA数据的朋友肯定会经常处理TCGA barcode的7个编码信息，每个编码信息用横杠-隔开，如下所示：</p><p><img src="/images/tcga-barcode/barcode.jpg" /></p><p>接触和分析过TCGA数据的朋友肯定会经常处理TCGA barcode的前15位（有时12位），实际从上图可以看出TCGA的barcode设计总共有28位之多。</p><p>每一个短横杠衔接的都是含不同意义的序列，如下图</p><p><img src="/images/tcga-barcode/flow.jpg" /></p><p>图中总结了TCGA中从样品到数据处理流程：</p><p>BCR从TSS收到参与者的样本和他们相关的元数据。然后BCRs分配人可读的IDs（barcode），也就是TCGA barcode给参与者的元数据和样本。TCGA barcode用来把扩展到整个TCGA网络中的数据联系在一起，因为IDs可以唯一识别一个特定样本的一组结果。</p><p>具体的解释如下表：</p><table><colgroup><col style="width: 8%" /><col style="width: 45%" /><col style="width: 45%" /></colgroup><thead><tr class="header"><th>Label</th><th>Identifier for</th><th>解释</th></tr></thead><tbody><tr class="odd"><td>Project</td><td>Project name</td><td>来自哪个项目: 如TCGA、TARGET等等</td></tr><tr class="even"><td>TSS</td><td>Tissue source site</td><td>样品来自哪个组织机构：01 代表International Genomics Consortium, 更多见：<a href="https://www.omicsclass.com/article/1079">TSS</a></td></tr><tr class="odd"><td>Participant</td><td>Study participant</td><td>样品唯一编号(可以理解为一个病人唯一编号）</td></tr><tr class="even"><td>Sample</td><td>Sample type</td><td>样品来自人体组织类型，01-09表示肿瘤样本，10-19表示normal type，20-29表示control samples,如：01代表Primary Solid Tumor， 更多见：<a href="https://www.omicsclass.com/article/1080">SampleType</a></td></tr><tr class="odd"><td>Vial</td><td>Order of sample in a sequence of samples</td><td>一份样品被分割成好几份，表示第几份，通常是A-Z编号</td></tr><tr class="even"><td>Portion</td><td>Order of portion in a sequence of 100-120 mg sample portions</td><td>每份样品再分割成不同的小样品：01-99等等编号，代表第几份</td></tr><tr class="odd"><td>Analyte</td><td>Molecular type of analyte for analysis</td><td>实验数据来源分子类型，如R代表 RNA，D代表DNA等等，更多见：<a href="https://gdc.cancer.gov/resources-tcga-users/tcga-code-tables/portion-analyte-codes">Portion / Analyte Codes</a></td></tr><tr class="even"><td>Plate</td><td>Order of plate in a sequence of 96-well plates</td><td>96孔序列中板的顺序，4个数字组成</td></tr><tr class="odd"><td>Center</td><td>Sequencing or characterization center that will receive the aliquot for analysis</td><td>数据由哪个机构分析：如 01代表The Broad Institute GCC,更多见：<a href="https://www.omicsclass.com/article/1081">Center</a></td></tr></tbody></table><p>其中比较重要的，用于区分样本类型的是 sample。</p><p>此外除了上述的barcode还有表示其他信息的barcode，整体的组织形式如下：</p><p><img src="/images/tcga-barcode/barcode1.jpg" /></p><p>下表显示了不同barcode，所代表的不同意义：层次结构级别：</p><p><img src="/images/tcga-barcode/table.jpg" /></p>]]></content>
      
      
      
        <tags>
            
            <tag> TCGA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu18.04 安装 xmind8</title>
      <link href="2019/09/16/xmind-ubuntu/"/>
      <url>2019/09/16/xmind-ubuntu/</url>
      
        <content type="html"><![CDATA[<h2 id="相关下载">相关下载</h2><p>XMind 官网下载程序：https://www.xmind.cn/download/xmind8/<br />XMind 破解补丁：<a href="https://pan.baidu.com/s/1pijGyVHFfO1BlDx-ZhtI5g">网盘地址</a> 提取码：tnkb</p><h2 id="程序安装">程序安装</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建安装目录</span></span><br><span class="line">sudo mkdir -p /usr/<span class="built_in">local</span>/xmind-8</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压XMind下载文件</span></span><br><span class="line">sudo unzip -d /usr/<span class="built_in">local</span>/xmind-8 xmind-8-update8-linux.zip</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝破解补丁文件到XMind_amd64目录</span></span><br><span class="line">sudo mv XMind_amd64.tar.gz /usr/<span class="built_in">local</span>/xmind-8/XMind_amd64</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压破解补丁文件</span></span><br><span class="line"><span class="built_in">cd</span> /usr/develop/xmind-8/XMind_amd64</span><br><span class="line">tar -xvf XMind_amd64.tar.gz</span><br><span class="line">rm -f XMind_amd64.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果系统环境是Centos，则需要修改依赖库安装脚本，将安装依赖的命令注释掉，默认的脚本只适合Debian/Ubuntu系统</span></span><br><span class="line">sudo vim /usr/develop/xmind-8/setup.sh</span><br><span class="line"><span class="comment"># 注释掉： apt-get install openjdk-8-jre libgtk2.0-0 libwebkitgtk-1.0-0 lame libc6 libglib2.0-0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行依赖库安装脚本</span></span><br><span class="line"><span class="built_in">cd</span> /usr/develop/xmind-8</span><br><span class="line">sudo ./setup.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改Hosts</span></span><br><span class="line">sudo vim /etc/hosts</span><br><span class="line"><span class="comment"># 另起一行，添加　127.0.0.1 www.xmind.net</span></span><br></pre></td></tr></table></figure><h2 id="激活ximd">激活ximd</h2><p>进入XMind_amd64目录，执行命令 “./XMind” 运行软件，然后在XMind主界面导航到: Help -&gt; License，复制以下License Key即可, 邮箱可以随便填。</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XAka34A2rVRYJ4XBIU35UZMUEEF64CMMIYZCK2FZZUQNODEKUHGJLFMSLIQMQUCUBXRENLK6NZL37JXP4PZXQFILMQ2RG5R7G4QNDO3PSOEUBOCDRYSSXZGRARV6MGA33TN2AMUBHEL4FXMWYTTJDEINJXUAV4BAYKBDCZQWVF3LWYXSDCXY546U3NBGOI3ZPAP2SO3CSQFNB7VVIY123456789012345</span><br></pre></td></tr></table></figure><h2 id="报错解决办法">报错解决办法</h2><p><strong>警告1</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Gtk-Message: Failed to load module <span class="string">&quot;canberra-gtk-module&quot;</span></span><br></pre></td></tr></table></figure><p>解决办法：安装libcanberra-gtk-module</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libcanberra-gtk-module</span><br></pre></td></tr></table></figure><p><strong>警告2</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Gtk-WARNING **: 20:23:58.735: Theme directory status/scalable of theme macOS11 has no size field</span><br></pre></td></tr></table></figure><p>解决办法：安装jdk8，切换优先级</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 jdk</span></span><br><span class="line">sudo apt-get install openjdk-8-jdk</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换优先级，选jdk8</span></span><br><span class="line">sudo update-alternatives --config java</span><br></pre></td></tr></table></figure><hr /><p>参考： <a href="https://www.techgrow.cn/posts/d32cbc24.html">Linux破解安装XMind</a><br /><a href="https://blog.csdn.net/weixin_36049506/article/details/88092444">ubuntu18.04安装XMind8</a></p>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> 软件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu 系统下Rstudio不能输入中文的解决办法</title>
      <link href="2019/09/05/Rstudio-ubuntu/"/>
      <url>2019/09/05/Rstudio-ubuntu/</url>
      
        <content type="html"><![CDATA[<h2 id="背景">背景</h2><p>Rstudio作为一个R编程的神器竟然在Ubuntu中不能输入中文，经过搜索发现RStudio软件不能使用系统自带的QT5，因此需要我们自己编译安装qt5相关的库，但是由于Rstudio版本的不断更新，每个版本的解决方案都并不能完全兼容，下边记录集中看到的解决方案：</p><h3 id="方案一">方案一：</h3><p>在shell中输入如下命令，将相关插件软连接到RStudio的插件中。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -s /usr/lib/$(dpkg-architecture -qDEB_BUILD_MULTIARCH)/qt5/plugins/platforminputcontexts/libfcitxplatforminputcontextplugin.so /usr/lib/rstudio/bin/plugins/platforminputcontexts/</span><br></pre></td></tr></table></figure><h3 id="方案二">方案二：</h3><p>同样在shell中输入如下命令，下载相关插件并安装。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget [url=http://ikuya.info/tmp/fcitx-qt5-rstudio-qt542+2.tar.gz]http://ikuya.info/tmp/fcitx-qt5-rstudio-qt542+2.tar.gz[/url]</span><br><span class="line">tar xf fcitx-qt5-rstudio-qt542+2.tar.gz</span><br><span class="line">sudo apt install ./fcitx-frontend-qt5-rstudio_1.0.5-1ubuntu1~qt542+2_amd64.deb ./libfcitx-qt5-1-rstudio_1.0.5-1ubuntu1~qt542+2_amd64.deb</span><br></pre></td></tr></table></figure><h3 id="方案三">方案三：</h3><p>方法来自Github上，https://github.com/JackieMium/my_blog/issues/12 。作者将编译好的<code>libfcitxplatforminputcontextplugin.so</code> 复制到<code>usr/lib/rstudio/plugins/platforminputcontexts</code>路径下。然后删除<code>libQt5*</code>，<code>qt.conf</code>文件。</p><h3 id="方案四">方案四：</h3><blockquote><p>该方案适用于Rstudio（Version 1.2.1335）</p></blockquote><p>执行方案一的命令，将相关插件连接到<code>/usr/lib/rstudio/plugins/platforminputcontexts/</code>文件夹内，这里需要注意文件的权限</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -s /usr/lib/$(dpkg-architecture -qDEB_BUILD_MULTIARCH)/qt5/plugins/platforminputcontexts/libfcitxplatforminputcontextplugin.so  /usr/lib/rstudio/plugins/platforminputcontexts</span><br></pre></td></tr></table></figure><p>在/usr/lib/rstudio/bin的路径下找到qt.conf文件（注意：不同版本路径可能会有所差别），修改qt.conf的内容，添加刚才链接使用的路径：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[Paths]</span><br><span class="line">Prefix = /usr/lib/rstudio/</span><br><span class="line">Prefix = ../</span><br></pre></td></tr></table></figure><p>随着版本的更新，可能之前版本的解决方案会不适用，因此。。。<br />持续更新ing</p><hr /><h3 id="参考">参考</h3><p>https://support.rstudio.com/hc/en-us/articles/205605748-Using-RStudio-0-99-with-Fctix-on-Linux</p><p>https://blog.csdn.net/wukong1981/article/details/89484408</p><p>https://github.com/JackieMium/my_blog/issues/12</p>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>从源码安装R3.6(Ubuntu 18.04LTS)</title>
      <link href="2019/08/28/R-ubuntu/"/>
      <url>2019/08/28/R-ubuntu/</url>
      
        <content type="html"><![CDATA[<p>根据R官方提供的安装方法，感觉在Ubuntu18.04上毫无作用，因此尝试从源码手动编译安装R</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装依赖</span></span><br><span class="line">sudo apt-get install xorg-dev libreadline-dev</span><br><span class="line">sudo apt-get install libcurl4-openssl-dev</span><br><span class="line">sudo apt-get install libbz2-dev</span><br><span class="line">sudo apt-get install libcairo2-dev libgtk2.0-dev</span><br><span class="line">sudo apt-get install texinfo texlive</span><br><span class="line">wget http://mirrors.ctan.org/fonts/inconsolata.zip</span><br><span class="line">sudo cp -Rfp inconsolata/* /usr/share/texmf/</span><br><span class="line"><span class="comment"># 或者 sudo cp -r inconsolata/ /usr/share/texlive/texmf-dist/tex/latex/</span></span><br><span class="line">sudo mktexlsr <span class="comment"># 刷新一下</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果没有java解释器，安装下</span></span><br><span class="line">sudo apt-get install default-jdk</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载与安装R</span></span><br><span class="line">curl -O https://cran.r-project.org/src/base/R-3/R-3.6.1.tar.gz</span><br><span class="line">tar -zxvf R-3.6.1.tar.gz</span><br><span class="line"><span class="built_in">cd</span> R-3.6.1/</span><br><span class="line">./configure --prefix=<span class="variable">$HOME</span>/<span class="built_in">local</span>/R --enable-R-shlib --with-cairo=yes</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line"><span class="comment"># ./configure --with-cairo --with-libpng --with-libtiff --with-jpeglib --enable-R-shlib --prefix=$HOME/local/R</span></span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建符号链接</span></span><br><span class="line"><span class="built_in">cd</span> /usr/bin/</span><br><span class="line">sudo ln -s <span class="variable">$HOME</span>/<span class="built_in">local</span>/R/bin/Rscript Rscript</span><br><span class="line">sudo ln -s <span class="variable">$HOME</span>/<span class="built_in">local</span>/R/bin/R R</span><br></pre></td></tr></table></figure><p>在编译过程中需要使用<code>./configure</code>命令检测环境及其依赖包，检测过程中可能遇到的报错：</p><p>报错一：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configure: error: No F77 compiler found</span><br></pre></td></tr></table></figure><p>解决办法：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install gfortran build-essential</span><br></pre></td></tr></table></figure><p>报错二：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configure: error: <span class="string">&quot;liblzma library and headers are required&quot;</span></span><br></pre></td></tr></table></figure><p>解决办法：安装xz</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo wget http://tukaani.org/xz/xz-5.2.4.tar.gz</span><br><span class="line">sudo tar xzvf xz-5.2.4.tar.gz</span><br><span class="line">sudo <span class="built_in">cd</span> xz-5.2.4</span><br><span class="line">sudo ./configure</span><br><span class="line">sudo make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu 18.04 安装有道词典</title>
      <link href="2019/08/22/youdao-ubuntu/"/>
      <url>2019/08/22/youdao-ubuntu/</url>
      
        <content type="html"><![CDATA[<h2 id="下载编译过的安装包">下载编译过的安装包</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/yomun/youdaodict_5.5/raw/master/youdao-dict_1.1.1-0~ubuntu_amd64.deb</span><br></pre></td></tr></table></figure><h2 id="查询并卸载qt5">查询并卸载QT5</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如有显示 PyQt5 (5.10.1), 卸载</span></span><br><span class="line">pip3 list | grep PyQt5</span><br><span class="line">pip3 uninstall pyqt5</span><br><span class="line"></span><br><span class="line"><span class="comment"># root 用户</span></span><br><span class="line">sudo sudo pip3 list | grep PyQt5</span><br><span class="line">sudo sudo pip3 uninstall pyqt5</span><br></pre></td></tr></table></figure><h2 id="安装依赖包">安装依赖包</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install python3</span><br><span class="line"></span><br><span class="line">sudo apt install python3-dbus python3-lxml python3-pil python3-requests python3-xdg python3-xlib</span><br><span class="line">sudo apt install python3-pyqt5 python3-pyqt5.qtmultimedia python3-pyqt5.qtquick python3-pyqt5.qtwebkit</span><br><span class="line"></span><br><span class="line">sudo apt install gir1.2-appindicator3-0.1 qml-module-qtgraphicaleffects qml-module-qtquick-controls</span><br><span class="line">sudo apt install libqt5multimedia5-plugins ttf-wqy-microhei</span><br><span class="line">sudo apt install tesseract-ocr tesseract-ocr-eng tesseract-ocr-chi-sim tesseract-ocr-chi-tra</span><br><span class="line"></span><br><span class="line">sudo apt install ubuntu-restricted-extras</span><br><span class="line"></span><br><span class="line"><span class="comment"># Ubuntu 18.04 用 fonts-wqy-microhei 取代了 ttf-wqy-microhei</span></span><br></pre></td></tr></table></figure><h2 id="安装有道词典">安装有道词典</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">su</span><br><span class="line"></span><br><span class="line">如果是 dpkg 安装的话 (基于 Ubuntu / Debian / Linux Mint / Zorin OS)</span><br><span class="line">dpkg -i youdao-dict_1.1.1-0?ubuntu_amd64.deb</span><br><span class="line">apt install -f  (如果上面的 dpkg 命令运行显示缺依赖软件包)</span><br><span class="line"></span><br><span class="line">如果是 tar 安装的话 (其实就是将 deb 解压, 把文件放到系统各处)</span><br><span class="line">ar vx youdao-dict_1.1.1-0?ubuntu_amd64.deb</span><br><span class="line">tar -Jxvf data.tar.xz -C /</span><br><span class="line">rm -rf control.tar.gz &amp;&amp; rm -rf data.tar.xz &amp;&amp; rm -rf debian-binary</span><br></pre></td></tr></table></figure><p>安装之后可以直接运行有道词典</p><h2 id="卸载">卸载</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">rm -rf ~/.config/youdao-dict</span><br><span class="line">rm -rf ~/.cache/youdao-dict</span><br><span class="line"></span><br><span class="line">su</span><br><span class="line"></span><br><span class="line">如果是 dpkg 安装的话</span><br><span class="line">dpkg -r youdao-dict</span><br><span class="line"></span><br><span class="line">如果是 tar 安装的话</span><br><span class="line">wget https://raw.githubusercontent.com/yomun/youdaodict_5.5/master/youdaodict-uninstall.sh</span><br><span class="line">bash youdaodict-uninstall.sh</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> 软件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>stringr处理字符串</title>
      <link href="2019/08/18/stringr/"/>
      <url>2019/08/18/stringr/</url>
      
        <content type="html"><![CDATA[<p>用R语言处理字符串，总觉得很麻烦，即不能用向量的方法进行分割，也不能用循环遍历索引。grep()家族函数常常记不住，paste()函数默认以空格分割，各种不顺手啊！随着使用R语言的场景越来越多，字符串处理是必不可少的。stringr 包被定义为一致的、简单易用的字符串工具集。所有的函数和参数定义都具有一致性，更容易方便记忆和使用。</p><h2 id="字符串计算函数">字符串计算函数</h2><blockquote><p>str_length: 字符串长度<br />str_count: 字符串计数<br />str_order: 字符串排序</p></blockquote><h3 id="str_length字符串长度">str_length,字符串长度</h3><ul><li>函数定义：</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str_length(string)</span><br></pre></td></tr></table></figure><ul><li><p>参数列表：<br />string: 字符串，字符串向量。</p></li><li><p>使用示例：</p></li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; str_length(c(<span class="string">&quot;I&quot;</span>, <span class="string">&quot;am&quot;</span>, <span class="literal">NA</span>))</span><br><span class="line">[<span class="number">1</span>]  <span class="number">1</span>  <span class="number">2</span>  <span class="number">2</span> <span class="literal">NA</span></span><br></pre></td></tr></table></figure><h3 id="str_count-字符串计数">str_count, 字符串计数</h3><ul><li>函数定义：</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str_count(string, pattern = <span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure><ul><li><p>参数列表：<br />string: 字符串，字符串向量。<br />pattern: 匹配的字符。</p></li><li><p>使用示例：</p></li></ul><p>对字符串中匹配的字符计数</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; str_count(<span class="string">&#x27;aaa444sssddd&#x27;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="number">3</span></span><br></pre></td></tr></table></figure><p>对字符串向量中匹配的字符计数</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; fruit &lt;- c(<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;pear&quot;</span>, <span class="string">&quot;pineapple&quot;</span>)</span><br><span class="line">&gt; str_count(fruit, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">3</span> <span class="number">1</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><blockquote><p>对于一些特殊字符如："."，需要进行正则匹配</p></blockquote><h3 id="str_order-字符串索引排序">str_order, 字符串索引排序</h3><ul><li>函数定义：</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">str_order(x, decreasing = <span class="literal">FALSE</span>, na_last = <span class="literal">TRUE</span>, locale = <span class="string">&quot;en&quot;</span>, numeric = <span class="literal">FALSE</span>, <span class="keyword">...</span>)  </span><br><span class="line"></span><br><span class="line">str_sort(x, decreasing = <span class="literal">FALSE</span>, na_last = <span class="literal">TRUE</span>, locale = <span class="string">&quot;en&quot;</span>, numeric = <span class="literal">FALSE</span>, <span class="keyword">...</span>)</span><br></pre></td></tr></table></figure><ul><li><p>参数列表：<br />x: 字符串，字符串向量。<br />decreasing: 排序方向。<br />na_last:NA值的存放位置，一共3个值，TRUE放到最后，FALSE放到最前，NA过滤处理<br />locale:按哪种语言习惯排序<br />numeric: 是否只按照数字大小进行排序</p></li><li><p>使用示例：</p></li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; str_sort(letters[<span class="number">1</span>:<span class="number">5</span>])</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;a&quot;</span> <span class="string">&quot;b&quot;</span> <span class="string">&quot;c&quot;</span> <span class="string">&quot;d&quot;</span> <span class="string">&quot;e&quot;</span></span><br><span class="line">&gt; str_order(letters[<span class="number">1</span>:<span class="number">5</span>])</span><br><span class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 按照数字进行排序</span></span><br><span class="line">&gt; x &lt;- c(<span class="string">&quot;100a10&quot;</span>, <span class="string">&quot;100a5&quot;</span>, <span class="string">&quot;2b&quot;</span>, <span class="string">&quot;2a&quot;</span>)</span><br><span class="line">&gt; str_sort(x)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;100a10&quot;</span> <span class="string">&quot;100a5&quot;</span>  <span class="string">&quot;2a&quot;</span>     <span class="string">&quot;2b&quot;</span>    </span><br><span class="line">&gt; str_sort(x, numeric = <span class="literal">TRUE</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;2a&quot;</span>     <span class="string">&quot;2b&quot;</span>     <span class="string">&quot;100a5&quot;</span>  <span class="string">&quot;100a10&quot;</span></span><br></pre></td></tr></table></figure><h2 id="字符串拼接函数">字符串拼接函数</h2><blockquote><p>str_c: 字符串拼接<br />str_trim: 去掉字符串的空格和TAB(<br />str_pad: 补充字符串的长度<br />str_dup: 复制字符串<br />str_wrap: 控制字符串输出格式<br />str_sub: 截取字符串</p></blockquote><h3 id="str_c字符串拼接">str_c，字符串拼接</h3><ul><li>函数定义：</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str_c(<span class="keyword">...</span>, sep = <span class="string">&quot;&quot;</span>, collapse = <span class="literal">NULL</span>)</span><br></pre></td></tr></table></figure><ul><li><p>参数列表：<br />…: 多参数的输入<br />sep: 把多个字符串拼接为一个大的字符串，用于字符串的分割符<br />collapse: 把多个向量参数拼接为一个大的字符串，用于字符串的分割符</p></li><li><p>使用示例：</p></li></ul><p>把多个字符串拼接为一个大的字符串。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; str_c(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;ab&quot;</span></span><br><span class="line">&gt; str_c(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,sep=<span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;a-b&quot;</span></span><br><span class="line">&gt; str_c(c(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;a1&#x27;</span>),c(<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;b1&#x27;</span>),sep=<span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;a-b&quot;</span>   <span class="string">&quot;a1-b1&quot;</span></span><br></pre></td></tr></table></figure><p>把多个向量参数拼接为一个大的字符串。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; str_c(head(letters), collapse = <span class="string">&quot;&quot;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;abcdef&quot;</span></span><br><span class="line"><span class="comment"># collapse参数，对多个字符串无效</span></span><br><span class="line">&gt; str_c(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,collapse = <span class="string">&quot;-&quot;</span>)   </span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;ab&quot;</span></span><br><span class="line">&gt; str_c(c(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;a1&#x27;</span>),c(<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;b1&#x27;</span>),collapse=<span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;ab-a1b1&quot;</span></span><br></pre></td></tr></table></figure><p>拼接有NA值的字符串向量时，NA还是NA</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; str_c(c(<span class="string">&quot;a&quot;</span>, <span class="literal">NA</span>, <span class="string">&quot;b&quot;</span>), <span class="string">&quot;-d&quot;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;a-d&quot;</span> <span class="literal">NA</span>    <span class="string">&quot;b-d&quot;</span></span><br><span class="line"><span class="comment"># Use str_replace_NA to display literal NAs:</span></span><br><span class="line">&gt; str_c(str_replace_na(c(<span class="string">&quot;a&quot;</span>, <span class="literal">NA</span>, <span class="string">&quot;b&quot;</span>)), <span class="string">&quot;-d&quot;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;a-d&quot;</span>  <span class="string">&quot;NA-d&quot;</span> <span class="string">&quot;b-d&quot;</span> </span><br></pre></td></tr></table></figure><h3 id="str_flatten-字符串快速拼接函数">str_flatten: 字符串快速拼接函数</h3><ul><li>函数定义：</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str_flatten(string, collapse = <span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure><ul><li><p>参数列表：<br />string: 字符串，字符串向量<br />collapse: 拼接字符串之间插入的字符</p></li><li><p>使用示例：</p></li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; str_flatten(letters)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span></span><br><span class="line">&gt; str_flatten(letters, <span class="string">&quot;-&quot;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;a-b-c-d-e-f-g-h-i-j-k-l-m-n-o-p-q-r-s-t-u-v-w-x-y-z&quot;</span></span><br></pre></td></tr></table></figure><h3 id="str_trim去掉字符串的空格和tab">str_trim:去掉字符串的空格和TAB(</h3><blockquote><p>str_trim() 从字符串的开头和结尾删除空格; str_squish() 同时还可以删除字符串内部的空格</p></blockquote><ul><li>函数定义：</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">str_trim(string, side = c(<span class="string">&quot;both&quot;</span>, <span class="string">&quot;left&quot;</span>, <span class="string">&quot;right&quot;</span>))</span><br><span class="line">str_squish(string)</span><br></pre></td></tr></table></figure><ul><li><p>参数列表：<br />string: 字符串，字符串向量<br />side: 过滤方式，both两边都过滤，left左边过滤，right右边过滤</p></li><li><p>使用示例：</p></li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; str_trim(<span class="string">&quot;\n\nString with trailing and leading white space\n\n&quot;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;String with trailing, middle, and leading white space&quot;</span></span><br><span class="line">&gt; str_squish(<span class="string">&quot;\n\nString with excess, trailing and leading white space\n\n&quot;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;String with trailing, middle, and leading white space&quot;</span></span><br></pre></td></tr></table></figure><h3 id="str_pad补充字符串的长度">str_pad:补充字符串的长度</h3><ul><li>函数定义：</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str_pad(string, width, side = c(<span class="string">&quot;left&quot;</span>, <span class="string">&quot;right&quot;</span>, <span class="string">&quot;both&quot;</span>), pad = <span class="string">&quot; &quot;</span>)</span><br></pre></td></tr></table></figure><ul><li><p>参数列表：<br />string: 字符串，字符串向量<br />width: 字符串填充后的长度<br />side: 填充方向，both两边都填充，left左边填充，right右边填充<br />pad: 用于填充的字符</p></li><li><p>使用示例：</p></li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从左边补充空格，直到字符串长度为20</span></span><br><span class="line">&gt; str_pad(<span class="string">&quot;conan&quot;</span>, <span class="number">20</span>, <span class="string">&quot;left&quot;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;               conan&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从右边补充空格，直到字符串长度为20</span></span><br><span class="line">&gt; str_pad(<span class="string">&quot;conan&quot;</span>, <span class="number">20</span>, <span class="string">&quot;right&quot;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;conan               &quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从左右两边各补充空格，直到字符串长度为20</span></span><br><span class="line">&gt; str_pad(<span class="string">&quot;conan&quot;</span>, <span class="number">20</span>, <span class="string">&quot;both&quot;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;       conan        &quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从左右两边各补充x字符，直到字符串长度为20</span></span><br><span class="line">&gt; str_pad(<span class="string">&quot;conan&quot;</span>, <span class="number">20</span>, <span class="string">&quot;both&quot;</span>,<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;xxxxxxxconanxxxxxxxx&quot;</span></span><br></pre></td></tr></table></figure><h3 id="str_dup-复制字符串">str_dup: 复制字符串</h3><ul><li>函数定义：</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str_dup(string, times)</span><br></pre></td></tr></table></figure><ul><li><p>参数列表：<br />string: 字符串，字符串向量<br />times: 复制数量</p></li><li><p>使用示例：</p></li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; fruit &lt;- c(<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;pear&quot;</span>, <span class="string">&quot;banana&quot;</span>)</span><br><span class="line">&gt; str_dup(fruit, <span class="number">2</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;appleapple&quot;</span>   <span class="string">&quot;pearpear&quot;</span>     <span class="string">&quot;bananabanana&quot;</span></span><br></pre></td></tr></table></figure><h3 id="str_wrap控制字符串输出格式">str_wrap，控制字符串输出格式</h3><ul><li>函数定义：</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str_wrap(string, width = <span class="number">80</span>, indent = <span class="number">0</span>, exdent = <span class="number">0</span>)</span><br></pre></td></tr></table></figure><ul><li>参数列表：<br />string: 字符串，字符串向量<br />width: 设置一行所占的宽度<br />indent: 段落首行的缩进值<br />exdent: 段落非首行的缩进值</li></ul><h3 id="str_sub截取字符串">str_sub,截取字符串</h3><ul><li>函数定义：</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">str_sub(string, start = <span class="number">1L</span>, end = -<span class="number">1L</span>)</span><br><span class="line">str_sub(string, start = <span class="number">1L</span>, end = -<span class="number">1L</span>, omit_na = <span class="literal">FALSE</span>) &lt;- value</span><br></pre></td></tr></table></figure><ul><li><p>参数列表：<br />string: 字符串，字符串向量<br />start : 开始位置<br />end : 结束位置</p></li><li><p>使用示例：</p></li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt; hw &lt;- <span class="string">&quot;Hadley Wickham&quot;</span></span><br><span class="line">&gt; str_sub(hw, <span class="number">1</span>, <span class="number">6</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;Hadley&quot;</span></span><br><span class="line">&gt; str_sub(hw, end = <span class="number">6</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;Hadley&quot;</span></span><br><span class="line">&gt; str_sub(hw, c(<span class="number">1</span>, <span class="number">8</span>), c(<span class="number">6</span>, <span class="number">14</span>))</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;Hadley&quot;</span>  <span class="string">&quot;Wickham&quot;</span></span><br><span class="line"></span><br><span class="line">&gt; str_sub(hw, -<span class="number">1</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;m&quot;</span></span><br><span class="line">&gt; str_sub(hw, -<span class="number">7</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;Wickham&quot;</span></span><br><span class="line">&gt; str_sub(hw, end = -<span class="number">7</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;Hadley W&quot;</span></span><br></pre></td></tr></table></figure><h2 id="字符串匹配函数">字符串匹配函数</h2><blockquote><p>str_split: 字符串分割<br />str_subset: 返回匹配的字符串<br />word: 从文本中提取单词<br />str_detect: 检查匹配字符串的字符<br />str_match: 从字符串中提取匹配组<br />str_replace: 字符串替换<br />str_replace_na:把NA替换为NA字符串<br />str_locate: 找到匹配的字符串的位置<br />str_extract: 从字符串中提取匹配字符</p></blockquote><h3 id="str_split字符串分割">str_split,字符串分割</h3><ul><li>函数定义：</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">str_split(string, pattern, n = <span class="literal">Inf</span>, simplify = <span class="literal">FALSE</span>)</span><br><span class="line">str_split_fixed(string, pattern, n)</span><br></pre></td></tr></table></figure><ul><li><p>参数列表：<br />string: 字符串，字符串向量<br />pattern: 匹配的字符<br />n: 分割个数<br />simplify: FALSE以list返回结果，TRUE以matrix返回结果</p></li><li><p>使用示例：</p></li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&gt; fruits &lt;- c(<span class="string">&quot;apples and oranges and pears and bananas&quot;</span>, <span class="string">&quot;pineapples and mangos and guavas&quot;</span>)</span><br><span class="line">&gt; str_split(fruits, <span class="string">&quot; and &quot;</span>)</span><br><span class="line">[[<span class="number">1</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;apples&quot;</span>  <span class="string">&quot;oranges&quot;</span> <span class="string">&quot;pears&quot;</span>   <span class="string">&quot;bananas&quot;</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;pineapples&quot;</span> <span class="string">&quot;mangos&quot;</span>     <span class="string">&quot;guavas&quot;</span>    </span><br><span class="line"></span><br><span class="line">&gt; str_split(fruits, <span class="string">&quot; and &quot;</span>, simplify = <span class="literal">TRUE</span>)</span><br><span class="line">     [,<span class="number">1</span>]         [,<span class="number">2</span>]      [,<span class="number">3</span>]     [,<span class="number">4</span>]     </span><br><span class="line">[<span class="number">1</span>,] <span class="string">&quot;apples&quot;</span>     <span class="string">&quot;oranges&quot;</span> <span class="string">&quot;pears&quot;</span>  <span class="string">&quot;bananas&quot;</span></span><br><span class="line">[<span class="number">2</span>,] <span class="string">&quot;pineapples&quot;</span> <span class="string">&quot;mangos&quot;</span>  <span class="string">&quot;guavas&quot;</span> <span class="string">&quot;&quot;</span> </span><br><span class="line"></span><br><span class="line">&gt; str_split(fruits, <span class="string">&quot; and &quot;</span>, n = <span class="number">3</span>)</span><br><span class="line">[[<span class="number">1</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;apples&quot;</span>            <span class="string">&quot;oranges&quot;</span>           <span class="string">&quot;pears and bananas&quot;</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;pineapples&quot;</span> <span class="string">&quot;mangos&quot;</span>     <span class="string">&quot;guavas&quot;</span> </span><br><span class="line"></span><br><span class="line">&gt; str_split_fixed(fruits, <span class="string">&quot; and &quot;</span>, <span class="number">3</span>)</span><br><span class="line">     [,<span class="number">1</span>]         [,<span class="number">2</span>]      [,<span class="number">3</span>]               </span><br><span class="line">[<span class="number">1</span>,] <span class="string">&quot;apples&quot;</span>     <span class="string">&quot;oranges&quot;</span> <span class="string">&quot;pears and bananas&quot;</span></span><br><span class="line">[<span class="number">2</span>,] <span class="string">&quot;pineapples&quot;</span> <span class="string">&quot;mangos&quot;</span>  <span class="string">&quot;guavas&quot;</span>           </span><br><span class="line">&gt; str_split_fixed(fruits, <span class="string">&quot; and &quot;</span>, <span class="number">4</span>)</span><br><span class="line">     [,<span class="number">1</span>]         [,<span class="number">2</span>]      [,<span class="number">3</span>]     [,<span class="number">4</span>]     </span><br><span class="line">[<span class="number">1</span>,] <span class="string">&quot;apples&quot;</span>     <span class="string">&quot;oranges&quot;</span> <span class="string">&quot;pears&quot;</span>  <span class="string">&quot;bananas&quot;</span></span><br><span class="line">[<span class="number">2</span>,] <span class="string">&quot;pineapples&quot;</span> <span class="string">&quot;mangos&quot;</span>  <span class="string">&quot;guavas&quot;</span> <span class="string">&quot;&quot;</span> </span><br></pre></td></tr></table></figure><h3 id="str_subset返回的匹配字符串">str_subset:返回的匹配字符串</h3><ul><li>函数定义：</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">str_subset(string, pattern, negate = <span class="literal">FALSE</span>)</span><br><span class="line">str_which(string, pattern, negate = <span class="literal">FALSE</span>)</span><br></pre></td></tr></table></figure><ul><li><p>参数列表:<br />string: 字符串，字符串向量<br />pattern: 匹配的字符<br />negate: 如果为TRUE，返回未匹配的元素</p></li><li><p>使用示例：</p></li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; fruit &lt;- c(<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;pear&quot;</span>, <span class="string">&quot;pinapple&quot;</span>)</span><br><span class="line">&gt; str_subset(fruit, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;apple&quot;</span>    <span class="string">&quot;banana&quot;</span>   <span class="string">&quot;pear&quot;</span>     <span class="string">&quot;pinapple&quot;</span></span><br><span class="line">&gt; str_which(fruit, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span></span><br><span class="line"><span class="comment"># 支持正则表达式</span></span><br><span class="line">&gt; str_subset(fruit, <span class="string">&quot;^a&quot;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;apple&quot;</span></span><br><span class="line">&gt; str_subset(fruit, <span class="string">&quot;a$&quot;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;banana&quot;</span></span><br></pre></td></tr></table></figure><h3 id="word-从文本中提取单词">word, 从文本中提取单词</h3><ul><li>函数定义</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">word(string, start = <span class="number">1L</span>, end = start, sep = fixed(<span class="string">&quot; &quot;</span>))</span><br></pre></td></tr></table></figure><ul><li><p>参数列表：<br />string: 字符串，字符串向量<br />start: 开始位置<br />end: 结束位置<br />sep: 匹配字符</p></li><li><p>使用示例：</p></li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; sentences &lt;- c(<span class="string">&quot;Jane saw a cat&quot;</span>, <span class="string">&quot;Jane sat down&quot;</span>)</span><br><span class="line">&gt; word(sentences, <span class="number">1</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;Jane&quot;</span> <span class="string">&quot;Jane&quot;</span></span><br><span class="line">&gt; word(sentences, <span class="number">2</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;saw&quot;</span> <span class="string">&quot;sat&quot;</span></span><br><span class="line">&gt; word(sentences, -<span class="number">1</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;cat&quot;</span>  <span class="string">&quot;down&quot;</span></span><br><span class="line">&gt; word(sentences, <span class="number">2</span>, -<span class="number">1</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;saw a cat&quot;</span> <span class="string">&quot;sat down&quot;</span> </span><br><span class="line"><span class="comment"># 匹配以..分割开的word</span></span><br><span class="line">&gt; str &lt;- <span class="string">&#x27;abc.def..123.4568.999&#x27;</span></span><br><span class="line">&gt; word(str, <span class="number">1</span>, sep = fixed(<span class="string">&#x27;..&#x27;</span>))</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;abc.def&quot;</span></span><br></pre></td></tr></table></figure><h3 id="str_detect检查字符串是否出现">str_detect，检查字符串是否出现</h3><ul><li>函数定义：</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str_detect(string, pattern, negate = <span class="literal">FALSE</span>)</span><br></pre></td></tr></table></figure><ul><li><p>参数列表：<br />string: 字符串，字符串向量<br />pattern: 匹配字符<br />negate: 如果为TRUE，返回未匹配的元素</p></li><li><p>使用示例：</p></li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; fruit &lt;- c(<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;pear&quot;</span>, <span class="string">&quot;pinapple&quot;</span>)</span><br><span class="line">&gt; str_detect(fruit, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="literal">TRUE</span> <span class="literal">TRUE</span> <span class="literal">TRUE</span> <span class="literal">TRUE</span></span><br><span class="line">&gt; str_detect(fruit, <span class="string">&quot;^a&quot;</span>)</span><br><span class="line">[<span class="number">1</span>]  <span class="literal">TRUE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span></span><br><span class="line">&gt; str_detect(fruit, <span class="string">&quot;^p&quot;</span>, negate = <span class="literal">TRUE</span>)</span><br><span class="line">[<span class="number">1</span>]  <span class="literal">TRUE</span>  <span class="literal">TRUE</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span></span><br></pre></td></tr></table></figure><h3 id="str_match从字符串中提取匹配组">str_match,从字符串中提取匹配组</h3><ul><li>函数定义：</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">str_match(string, pattern)</span><br><span class="line">str_match_all(string, pattern)</span><br></pre></td></tr></table></figure><ul><li><p>参数列表：<br />string: 字符串，字符串向量<br />pattern: 匹配字符</p></li><li><p>使用示例：</p></li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&gt; val &lt;- c(<span class="string">&quot;abc&quot;</span>, <span class="number">123</span>, <span class="string">&quot;cba&quot;</span>)</span><br><span class="line">&gt; str_match(val, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">     [,<span class="number">1</span>]</span><br><span class="line">[<span class="number">1</span>,] <span class="string">&quot;a&quot;</span> </span><br><span class="line">[<span class="number">2</span>,] <span class="literal">NA</span>  </span><br><span class="line">[<span class="number">3</span>,] <span class="string">&quot;a&quot;</span> </span><br><span class="line">&gt; str_match(val, <span class="string">&quot;[0-9]&quot;</span>)</span><br><span class="line">     [,<span class="number">1</span>]</span><br><span class="line">[<span class="number">1</span>,] <span class="literal">NA</span>  </span><br><span class="line">[<span class="number">2</span>,] <span class="string">&quot;1&quot;</span> </span><br><span class="line">[<span class="number">3</span>,] <span class="literal">NA</span>  </span><br><span class="line">&gt; str_match_all(val, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">[[<span class="number">1</span>]]</span><br><span class="line">     [,<span class="number">1</span>]</span><br><span class="line">[<span class="number">1</span>,] <span class="string">&quot;a&quot;</span> </span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span>]]</span><br><span class="line">     [,<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">[[<span class="number">3</span>]]</span><br><span class="line">     [,<span class="number">1</span>]</span><br><span class="line">[<span class="number">1</span>,] <span class="string">&quot;a&quot;</span> </span><br></pre></td></tr></table></figure><h3 id="str_replace字符串替换">str_replace，字符串替换</h3><ul><li>函数定义：</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">str_replace(string, pattern, replacement)</span><br><span class="line">str_replace_all(string, pattern, replacement)</span><br></pre></td></tr></table></figure><ul><li><p>参数列表：<br />string: 字符串，字符串向量<br />pattern: 匹配字符<br />replacement: 用于替换的字符</p></li><li><p>使用示例：</p></li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; fruits &lt;- c(<span class="string">&quot;one apple&quot;</span>, <span class="string">&quot;two pears&quot;</span>, <span class="string">&quot;three bananas&quot;</span>)</span><br><span class="line">&gt; str_replace(fruits, <span class="string">&quot;[aeiou]&quot;</span>, <span class="string">&quot;-&quot;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;-ne apple&quot;</span>     <span class="string">&quot;tw- pears&quot;</span>     <span class="string">&quot;thr-e bananas&quot;</span></span><br><span class="line">&gt; str_replace_all(fruits, <span class="string">&quot;[aeiou]&quot;</span>, <span class="string">&quot;-&quot;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;-n- -ppl-&quot;</span>     <span class="string">&quot;tw- p--rs&quot;</span>     <span class="string">&quot;thr-- b-n-n-s&quot;</span></span><br></pre></td></tr></table></figure><h3 id="str_replace_na把na替换为na字符串">str_replace_na把NA替换为NA字符串</h3><ul><li>函数定义：</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str_replace_na(string, replacement = <span class="string">&quot;NA&quot;</span>)</span><br></pre></td></tr></table></figure><ul><li><p>参数列表：<br />string: 字符串，字符串向量<br />replacement : 用于替换的字符</p></li><li><p>使用示例：</p></li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; str_replace_na(c(<span class="literal">NA</span>, <span class="string">&quot;abc&quot;</span>, <span class="string">&quot;def&quot;</span>))</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;NA&quot;</span>  <span class="string">&quot;abc&quot;</span> <span class="string">&quot;def&quot;</span></span><br></pre></td></tr></table></figure><h3 id="str_locate找到的模式在字符串中的位置">str_locate，找到的模式在字符串中的位置</h3><ul><li>函数定义：</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">str_locate(string, pattern)</span><br><span class="line">str_locate_all(string, pattern)</span><br></pre></td></tr></table></figure><ul><li><p>参数列表：<br />string: 字符串，字符串向量<br />pattern: 匹配字符</p></li><li><p>使用示例：</p></li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&gt; fruit &lt;- c(<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;pear&quot;</span>, <span class="string">&quot;pineapple&quot;</span>)</span><br><span class="line">&gt; str_locate(fruit, <span class="string">&quot;a&quot;</span>) <span class="comment"># 在每个字符串中a的位置</span></span><br><span class="line">     start end</span><br><span class="line">[<span class="number">1</span>,]     <span class="number">1</span>   <span class="number">1</span></span><br><span class="line">[<span class="number">2</span>,]     <span class="number">2</span>   <span class="number">2</span></span><br><span class="line">[<span class="number">3</span>,]     <span class="number">3</span>   <span class="number">3</span></span><br><span class="line">[<span class="number">4</span>,]     <span class="number">5</span>   <span class="number">5</span></span><br><span class="line">&gt; str_locate_all(fruit, <span class="string">&quot;a&quot;</span>) <span class="comment"># 在每个字符串中所有a的位置</span></span><br><span class="line">[[<span class="number">1</span>]]</span><br><span class="line">     start end</span><br><span class="line">[<span class="number">1</span>,]     <span class="number">1</span>   <span class="number">1</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span>]]</span><br><span class="line">     start end</span><br><span class="line">[<span class="number">1</span>,]     <span class="number">2</span>   <span class="number">2</span></span><br><span class="line">[<span class="number">2</span>,]     <span class="number">4</span>   <span class="number">4</span></span><br><span class="line">[<span class="number">3</span>,]     <span class="number">6</span>   <span class="number">6</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">3</span>]]</span><br><span class="line">     start end</span><br><span class="line">[<span class="number">1</span>,]     <span class="number">3</span>   <span class="number">3</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">4</span>]]</span><br><span class="line">     start end</span><br><span class="line">[<span class="number">1</span>,]     <span class="number">5</span>   <span class="number">5</span></span><br></pre></td></tr></table></figure><h3 id="str_extract从字符串中提取匹配模式">str_extract从字符串中提取匹配模式</h3><ul><li>函数定义：</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">str_extract(string, pattern)</span><br><span class="line">str_extract_all(string, pattern, simplify = <span class="literal">FALSE</span>)</span><br></pre></td></tr></table></figure><ul><li><p>参数列表：<br />string: 字符串，字符串向量<br />pattern: 匹配字符<br />simplify: 返回值，TRUE返回matrix，FALSE返回字符串向量</p></li><li><p>使用示例：</p></li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&gt; shopping_list &lt;- c(<span class="string">&quot;apples x4&quot;</span>, <span class="string">&quot;bag of flour&quot;</span>, <span class="string">&quot;bag of sugar&quot;</span>, <span class="string">&quot;milk x2&quot;</span>)</span><br><span class="line">&gt; str_extract(shopping_list, <span class="string">&quot;\\d&quot;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;4&quot;</span> <span class="literal">NA</span>  <span class="literal">NA</span>  <span class="string">&quot;2&quot;</span></span><br><span class="line">&gt; str_extract_all(shopping_list, <span class="string">&quot;\\d&quot;</span>)</span><br><span class="line">[[<span class="number">1</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;4&quot;</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span>]]</span><br><span class="line">character(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">[[<span class="number">3</span>]]</span><br><span class="line">character(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">[[<span class="number">4</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;2&quot;</span></span><br><span class="line"></span><br><span class="line">&gt; str_extract_all(shopping_list, <span class="string">&quot;\\d&quot;</span>, simplify = <span class="literal">TRUE</span>)</span><br><span class="line">     [,<span class="number">1</span>]</span><br><span class="line">[<span class="number">1</span>,] <span class="string">&quot;4&quot;</span> </span><br><span class="line">[<span class="number">2</span>,] <span class="string">&quot;&quot;</span>  </span><br><span class="line">[<span class="number">3</span>,] <span class="string">&quot;&quot;</span>  </span><br><span class="line">[<span class="number">4</span>,] <span class="string">&quot;2&quot;</span> </span><br></pre></td></tr></table></figure><h2 id="字符串变换函数">字符串变换函数</h2><blockquote><p>str_conv: 字符编码转换<br />str_to_upper: 字符串转成大写<br />str_to_lower: 字符串转成小写,规则同str_to_upper<br />str_to_title: 字符串转成首字母大写,规则同str_to_upper</p></blockquote><h3 id="str_conv字符编码转换">str_conv:字符编码转换</h3><ul><li>函数定义：</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str_conv(string, encoding)</span><br></pre></td></tr></table></figure><ul><li><p>参数列表：<br />string: 字符串，字符串向量<br />encoding: 编码名</p></li><li><p>使用示例：</p></li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; x &lt;- charToRaw(<span class="string">&#x27;你好&#x27;</span>)</span><br><span class="line">&gt; x</span><br><span class="line">[<span class="number">1</span>] e4 bd a0 e5 a5 bd</span><br><span class="line">&gt; str_conv(x, <span class="string">&quot;GBK&quot;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;你好&quot;</span></span><br><span class="line">&gt; str_conv(x, <span class="string">&quot;GB2312&quot;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;你好&quot;</span></span><br></pre></td></tr></table></figure><h3 id="str_to_upper字符串大写转换">str_to_upper,字符串大写转换</h3><ul><li>函数定义：</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">str_to_upper(string, locale = <span class="string">&quot;en&quot;</span>)</span><br><span class="line">str_to_lower(string, locale = <span class="string">&quot;en&quot;</span>)</span><br><span class="line">str_to_title(string, locale = <span class="string">&quot;en&quot;</span>)</span><br><span class="line">str_to_sentence(string, locale = <span class="string">&quot;en&quot;</span>)</span><br></pre></td></tr></table></figure><ul><li><p>参数列表：<br />string: 字符串<br />locale:按哪种语言习惯排序</p></li><li><p>使用示例：</p></li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; dog &lt;- <span class="string">&quot;The quick brown dog&quot;</span></span><br><span class="line">&gt; str_to_upper(dog)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;THE QUICK BROWN DOG&quot;</span></span><br><span class="line">&gt; str_to_lower(dog)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;the quick brown dog&quot;</span></span><br><span class="line">&gt; str_to_title(dog)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;The Quick Brown Dog&quot;</span></span><br><span class="line">&gt; str_to_sentence(<span class="string">&quot;the quick brown dog&quot;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;The quick brown dog&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jekyll + NexT + GitHub Pages 主题优化</title>
      <link href="2019/07/20/Next/"/>
      <url>2019/07/20/Next/</url>
      
        <content type="html"><![CDATA[<h2 id="设置主题风格">设置主题风格</h2><p>打开 <font color = "red"><code>_config.yml</code></font> 文件，找到 <code>scheme</code> 相关配置内容，去掉启用主题前的 <code>#</code> 注释即可</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Scheme Settings 设置主题</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Schemes</span></span><br><span class="line"><span class="comment">#scheme: Muse   # 默认 Scheme，这是 NexT 最初的版本，黑白主调，大量留白</span></span><br><span class="line"><span class="comment">#scheme: Mist   # Muse 的紧凑版本，整洁有序的单栏外观</span></span><br><span class="line"><span class="attr">scheme:</span> <span class="string">Pisces</span>  <span class="comment"># 双栏 Scheme</span></span><br></pre></td></tr></table></figure><h2 id="设置菜单项的显示文本和图标">设置菜单项的显示文本和图标</h2><p>NexT 使用的是 <a href="http://fontawesome.dashgame.com/">Font Awesome</a> 提供的图标， <a href="http://fontawesome.dashgame.com/">Font Awesome</a> 提供了 600+ 的图标，可以满足绝大的多数的场景，同时无须担心在 Retina 屏幕下图标模糊的问题。</p><h3 id="设置菜单项的显示中文文本">设置菜单项的显示中文文本</h3><p>打开 <code>/_data/languages/zh-Hans.yml</code> 文件，找到 <code>menu</code> 菜单，新增或者修改菜单项</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="attr">home:</span> <span class="string">首页</span></span><br><span class="line">  <span class="attr">archives:</span> <span class="string">归档</span></span><br><span class="line">  <span class="attr">categories:</span> <span class="string">分类</span></span><br><span class="line">  <span class="attr">tags:</span> <span class="string">标签</span></span><br><span class="line">  <span class="attr">about:</span> <span class="string">关于</span></span><br><span class="line">  <span class="attr">search:</span> <span class="string">搜索</span></span><br><span class="line">  <span class="attr">schedule:</span> <span class="string">日程表</span></span><br><span class="line">  <span class="attr">sitemap:</span> <span class="string">站点地图</span></span><br><span class="line">  <span class="attr">commonweal:</span> <span class="string">公益404</span></span><br><span class="line">  <span class="comment"># 新增menu</span></span><br><span class="line">  <span class="attr">book:</span> <span class="string">书单</span></span><br></pre></td></tr></table></figure><h3 id="设定菜单项的文件目录和对应图标">设定菜单项的文件目录和对应图标</h3><p>打开 <code>_config.yml</code> 文件，搜索 <code>menu</code> 关键字，修改对应图标名称或者新增对应 menu 的图标。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Menu Settings</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># When running the site in a subdirectory (e.g. domain.tld/blog), remove the leading slash (/archives -&gt; archives)</span></span><br><span class="line"><span class="comment">## 这里添加或修改menu目录</span></span><br><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="attr">home:</span> <span class="string">/</span></span><br><span class="line">  <span class="attr">categories:</span> <span class="string">/categories/</span></span><br><span class="line">  <span class="attr">about:</span> <span class="string">/about/</span></span><br><span class="line">  <span class="attr">archives:</span> <span class="string">/archives/</span></span><br><span class="line">  <span class="attr">tags:</span> <span class="string">/tags/</span></span><br><span class="line">  <span class="comment">#sitemap: /sitemap.xml</span></span><br><span class="line">  <span class="comment">#commonweal: /404.html</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable/Disable menu icons.</span></span><br><span class="line"><span class="comment"># Icon Mapping:</span></span><br><span class="line"><span class="comment">#   Map a menu item to a specific FontAwesome icon name.</span></span><br><span class="line"><span class="comment">#   Key is the name of menu item and value is the name of FontAwesome icon. Key is case-senstive.</span></span><br><span class="line"><span class="comment">#   When an question mask icon presenting up means that the item has no mapping icon.</span></span><br><span class="line"><span class="comment"># 这里启用相应的FontAwesome图标</span></span><br><span class="line"><span class="attr">menu_icons:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment">#KeyMapsToMenuItemKey: NameOfTheIconFromFontAwesome</span></span><br><span class="line">  <span class="attr">home:</span> <span class="string">home</span></span><br><span class="line">  <span class="attr">about:</span> <span class="string">user</span></span><br><span class="line"><span class="comment">#  book: book</span></span><br><span class="line"><span class="comment">#  <span class="doctag">note:</span> pencil</span></span><br><span class="line">  <span class="attr">categories:</span> <span class="string">th</span></span><br><span class="line">  <span class="attr">schedule:</span> <span class="string">calendar</span></span><br><span class="line">  <span class="attr">tags:</span> <span class="string">tags</span></span><br><span class="line">  <span class="attr">archives:</span> <span class="string">archive</span></span><br><span class="line">  <span class="attr">sitemap:</span> <span class="string">sitemap</span></span><br><span class="line">  <span class="attr">commonweal:</span> <span class="string">heartbeat</span></span><br><span class="line"><span class="comment">#  myseo: internet-explorer</span></span><br><span class="line"><span class="comment">#  top: signal</span></span><br><span class="line"><span class="comment">#  resume: handshake-o</span></span><br><span class="line"><span class="comment">#  message: commenting</span></span><br><span class="line"><span class="comment">#  friends: link</span></span><br><span class="line"><span class="comment">#  file: file-archive-o</span></span><br><span class="line"><span class="comment">#  ariang: cloud-download</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>注意</strong>：除了 <code>home</code>， <code>archives</code> ,<code>/</code>后面都需要手动创建这个页面对应的文件夹及文件，且文件需要以 <code>index.md</code> 命名</p></blockquote><h2 id="头像设置">头像设置</h2><h3 id="添加头像">添加头像</h3><p>打开 <code>/_config.yml</code> 文件，搜索 <code>Sidebar Avatar</code> 关键字，去掉 <code>avatar</code> 前面的<code>#</code>，并添加相应的图片链接或者文件路径：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sidebar Avatar（侧栏头像）</span></span><br><span class="line"><span class="comment"># in directory: /assets/images/avatar.gif</span></span><br><span class="line"><span class="attr">avatar:</span> <span class="string">/assets/images/avatar.jpg</span></span><br></pre></td></tr></table></figure><h3 id="设置头像边框为圆形框">设置头像边框为圆形框</h3><p>打开 <code>/_sass/_common/components/sidebar/sidebar-author.scss</code> 文件,修改如下:</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.site-author-image</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="variable">$site-author-image-padding</span>;</span><br><span class="line">  <span class="attribute">max-width</span>: <span class="variable">$site-author-image-width</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="variable">$site-author-image-height</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="variable">$site-author-image-border-width</span> solid <span class="variable">$site-author-image-border-color</span>;</span><br><span class="line"> <span class="comment">// 修改头像边框</span></span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">  -webkit-<span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">  -moz-<span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="特效鼠标放置头像上旋转">特效：鼠标放置头像上旋转</h3><p>打开 <code>/_sass/_common/components/sidebar/sidebar-author.scss</code> 文件,修改如下:</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.site-author-image</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="variable">$site-author-image-padding</span>;</span><br><span class="line">  <span class="attribute">max-width</span>: <span class="variable">$site-author-image-width</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="variable">$site-author-image-height</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="variable">$site-author-image-border-width</span> solid <span class="variable">$site-author-image-border-color</span>;</span><br><span class="line"> <span class="comment">// 修改头像边框</span></span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">  -webkit-<span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">  -moz-<span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="comment">// 设置旋转</span></span><br><span class="line">  <span class="attribute">transition</span>: <span class="number">1.4s</span> all;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 可旋转的圆形头像,`hover`动作</span></span><br><span class="line"><span class="selector-class">.site-author-image</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    -webkit-<span class="attribute">transform</span>: rotate(<span class="number">360deg</span>);</span><br><span class="line">    -moz-<span class="attribute">transform</span>: rotate(<span class="number">360deg</span>);</span><br><span class="line">    -ms-<span class="attribute">transform</span>: rotate(<span class="number">360deg</span>);</span><br><span class="line">    -<span class="attribute">transform</span>: rotate(<span class="number">360deg</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="浏览页面的时候显示当前浏览进度">浏览页面的时候显示当前浏览进度</h2><p>打开 <code>/_config.yml</code> ,搜索关键字 <code>scrollpercent</code> ,把 <code>false</code> 改为 <code>true</code>。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Scroll percent label in b2t button</span></span><br><span class="line">  <span class="attr">scrollpercent:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>如果想把 top按钮放在侧边栏,打开 <code>/_config.yml</code> ,搜索关键字 <code>b2t</code> ,把 <code>false</code> 改为 <code>true</code>。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Back to top in sidebar</span></span><br><span class="line">  <span class="attr">b2t:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Scroll percent label in b2t button</span></span><br><span class="line">  <span class="attr">scrollpercent:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="侧边栏设置">侧边栏设置</h2><h3 id="社交链接">社交链接</h3><p>打开 <code>/_config.yml</code> 文件,搜索关键字 <code>social</code> ,然后添加社交站点名称与地址即可。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Sidebar Settings </span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Social Links</span></span><br><span class="line"><span class="comment"># Key is the link label showing to end users.</span></span><br><span class="line"><span class="comment"># Value is the target link (E.g. GitHub: https://github.com/iissnan)</span></span><br><span class="line"><span class="comment">#social:</span></span><br><span class="line">  <span class="comment">#LinkLabel: Link</span></span><br><span class="line"><span class="attr">social:</span></span><br><span class="line">  <span class="attr">CSDN:</span> <span class="string">https://blog.csdn.net/yourname</span></span><br><span class="line">  <span class="attr">GitHub:</span> <span class="string">https://github.com/yourname</span></span><br></pre></td></tr></table></figure><h3 id="社交链接图标">社交链接图标</h3><p>与菜单栏的设置类似，打开 <code>/_config.yml</code> 文件,搜索关键字 <code>social_icons</code> ，添加社交站点名称（注意大小写）图标，<a href="http://fontawesome.dashgame.com">Font Awesome</a>图标地。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Social Links Icons</span></span><br><span class="line"><span class="comment"># Icon Mapping:</span></span><br><span class="line"><span class="comment">#   Map a menu item to a specific FontAwesome icon name.</span></span><br><span class="line"><span class="comment">#   Key is the name of the item and value is the name of FontAwesome icon. Key is case-senstive.</span></span><br><span class="line"><span class="comment">#   When an globe mask icon presenting up means that the item has no mapping icon.</span></span><br><span class="line"><span class="attr">social_icons:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Icon Mappings.</span></span><br><span class="line">  <span class="comment"># KeyMapsToSocialItemKey: NameOfTheIconFromFontAwesome</span></span><br><span class="line">  <span class="attr">GitHub:</span> <span class="string">github</span></span><br><span class="line">  <span class="attr">Twitter:</span> <span class="string">twitter</span></span><br><span class="line">  <span class="attr">Weibo:</span> <span class="string">weibo</span></span><br></pre></td></tr></table></figure><h3 id="rss设置">RSS设置</h3><p>当前 Next 主题好像可以直接使用RSS，可以在 <code>/_config.yml</code> 文件中搜索 <code>feed</code> 添加如下配置：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Atom feed</span></span><br><span class="line"><span class="attr">feed:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">atom.xml</span></span><br></pre></td></tr></table></figure><h3 id="友情链接">友情链接</h3><p>打开 <code>/_config.yml</code> 文件,搜索关键字 <code>Blog rolls</code>：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Blog rolls</span></span><br><span class="line"><span class="attr">links_title:</span> <span class="string">友情链接</span> <span class="comment">#标题</span></span><br><span class="line"><span class="attr">links_layout:</span> <span class="string">block</span> <span class="comment">#布局，一行一个连接</span></span><br><span class="line"><span class="comment">#links_layout: inline</span></span><br><span class="line"><span class="attr">links:</span> </span><br><span class="line">  <span class="attr">Title:</span> <span class="string">http://example.com/</span></span><br></pre></td></tr></table></figure><h2 id="主页文章添加边框阴影效果">主页文章添加边框阴影效果</h2><p>打开 <code>/_sass/_custom/custom.scss</code> ,向里面加代码:</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 主页文章添加阴影效果</span></span><br><span class="line"><span class="selector-class">.post</span> &#123;</span><br><span class="line">   <span class="attribute">margin-top</span>: <span class="number">0px</span>;</span><br><span class="line">   <span class="attribute">margin-bottom</span>: <span class="number">60px</span>;</span><br><span class="line">   <span class="attribute">padding</span>: <span class="number">25px</span>;</span><br><span class="line">   -webkit-<span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">5px</span> rgba(<span class="number">202</span>, <span class="number">203</span>, <span class="number">203</span>, .<span class="number">5</span>);</span><br><span class="line">   -moz-<span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">5px</span> rgba(<span class="number">202</span>, <span class="number">203</span>, <span class="number">204</span>, .<span class="number">5</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="代码块自定义样式">代码块自定义样式</h2><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Custom styles.</span></span><br><span class="line"><span class="selector-tag">code</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#ff7600</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#fbf7f8</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">2px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 边框的自定义样式</span></span><br><span class="line"><span class="selector-class">.highlight</span>, <span class="selector-tag">pre</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">5px</span> <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">5px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.highlight</span>, <span class="selector-tag">code</span>, <span class="selector-tag">pre</span> &#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#d6d6d6</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="开启版权声明">开启版权声明</h2><p>主题配置文件下,搜索关键字 <code>post_copyright</code> , <code>enable</code> 改为 <code>true</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Declare license on posts</span></span><br><span class="line"><span class="attr">post_copyright:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="string">ture</span></span><br><span class="line">  <span class="attr">license:</span> <span class="string">CC</span> <span class="string">BY-NC-SA</span> <span class="number">3.0</span></span><br><span class="line">  <span class="attr">license_url:</span> <span class="string">https://creativecommons.org/licenses/by-nc-sa/3.0/</span></span><br></pre></td></tr></table></figure><h2 id="在右上角或者左上角实现fork-me-on-github">在右上角或者左上角实现fork me on github</h2><p>可以在<a href="https://github.blog/2008-12-19-github-ribbons/">GitHub Ribbons</a>选择不同的样式,修改图片跳转链接,并复制文本框中的代码,将如下地方代码换为自己Github主页：</p><figure><img src="/images/Next/forkgithub.png" alt="png1" /><figcaption aria-hidden="true">png1</figcaption></figure><p>打开 <code>/_layouts/layout.html</code> 文件，把代码复制到 <code>&lt;div class="headband"&gt;&lt;/div&gt;</code> 下面。</p><h2 id="修改内容区域的宽度">修改内容区域的宽度</h2><p>打开 <font color = "red">_sass/_custom/custom.scss</font> 文件，新增变量：</p><p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 修改成你期望的宽度</span><br><span class="line">$content-desktop = 700px</span><br><span class="line"></span><br><span class="line">// 当视窗超过 1600px 后的宽度</span><br><span class="line">$content-desktop-large = 900px</span><br></pre></td></tr></table></figure> &gt; 此方法不适用于 Pisces Scheme</p><p>当你使用Pisces风格时可以用下面的方法：</p><ul><li><p>编辑 Pisces Scheme 的 <font color = "red">_sass/_schemes/Pisces/_layout.scss</font> 文件，在最底部添加如下代码：<br /><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">header</span>&#123; <span class="attribute">width</span>: <span class="number">90%</span>; &#125;</span><br><span class="line"><span class="selector-class">.container</span> <span class="selector-class">.main-inner</span> &#123; <span class="attribute">width</span>: <span class="number">90%</span>; &#125;</span><br><span class="line"><span class="selector-class">.content-wrap</span> &#123; <span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">100%</span> - <span class="number">260px</span>); &#125;</span><br></pre></td></tr></table></figure> &gt; 对于有些浏览器或是移动设备，效果可能不是太好</p></li><li><p>编辑 Pisces Scheme 的 <font color = "red">_sass/_schemes/Pisces/_layout.scss</font> 文件，修改以下内容：<br /><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// 将 .header 中的 </span><br><span class="line">width: $main-desktop;</span><br><span class="line">// 改为：</span><br><span class="line"><span class="selector-tag">width</span>: 80%;</span><br><span class="line"></span><br><span class="line">// 将 .container .main-inner 中的：</span><br><span class="line">width: $main-desktop;</span><br><span class="line">// 改为：</span><br><span class="line"><span class="selector-tag">width</span>: 80%;</span><br><span class="line"></span><br><span class="line">// 将 .content-wrap 中的：</span><br><span class="line">width: $content-desktop;</span><br><span class="line">// 改为：</span><br><span class="line"><span class="selector-tag">width</span>: <span class="selector-tag">calc</span>(100% <span class="selector-tag">-</span> 260<span class="selector-tag">px</span>);</span><br></pre></td></tr></table></figure></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> blog </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
            <tag> jekyll </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>R中的integer(0)</title>
      <link href="2019/06/15/interger0/"/>
      <url>2019/06/15/interger0/</url>
      
        <content type="html"><![CDATA[<h1 id="r语言的integer0">R语言的<code>integer(0)</code></h1><h2 id="举个例子">举个例子</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;x1=c(<span class="number">4</span>,<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">&gt;which(x1==<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">integer(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">&gt; length(integer(<span class="number">0</span>))</span><br><span class="line">[<span class="number">1</span>] <span class="number">0</span></span><br></pre></td></tr></table></figure><p>可以看出当<code>which()</code> 函数没有符合条件的返回值时会返回<code>integer(0)</code></p><p>虽然看起来<code>integer(0)</code>和<code>NULL</code>表示的含义是很像的，但实际上两者是完全不同的：</p><blockquote><p><code>integer(0)</code>是一个整数向量，长度为0；<code>NULL</code> 表示的是空的意思</p></blockquote><h2 id="integer0numeric0logical0nullna-的区别"><code>integer(0)</code>，<code>numeric(0)</code>，<code>logical(0)</code>，<code>NULL</code>，<code>NA</code> 的区别</h2><p><code>logical(0)</code> 不等于 <code>numeric(0)</code>。两者都不是<code>NULL</code>值，即<code>is.null(logical(0))</code>和<code>is.null(numeric(0))</code>都会返回FALSE。<strong>说明长度为零的值有时却不会为空值，<code>NULL</code>的定义是函数中没有被赋值的参数，特征就是没有值</strong>。如何区分<code>NULL</code>和<code>NA</code>？很简单，后者的logical length是1，而前者的logical length是0，意思是假如用<code>is.logical</code>判断NA的逻辑值，得到的结果是TRUE。<code>NA</code>可以为正无穷或负无穷，但<code>NULL</code>永远代表的是没有这个值，一个空集的概念。</p><blockquote><p>总的来说：<br />1. <code>numeric(0) == numeric(0)</code>和<code>numeric(0) != numeric(0)</code>，返回TRUE。<br />2. <code>logical(0)</code>, <code>numeric(0)</code>, <code>NULL</code>，返回FALSE。<br />3. <code>is.logical(NA)</code>，返回TRUE。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTML基本语法</title>
      <link href="2019/06/10/html/"/>
      <url>2019/06/10/html/</url>
      
        <content type="html"><![CDATA[<h1 id="html">HTML</h1><p>超文本标记语言（英语：HyperText Markup Language，简称：HTML）是一种用于创建网页的标准标记语言。HTML可以用 来建立自己的 WEB 站点，HTML 运行在浏览器上，由浏览器来解析。</p><p>HTML 不是一种编程语言，而是一种<strong>标记</strong>语言，它使用一套标记标签(markup tag)来描述网页；HTML文档包含了HTML标签和文本内容，HTML文档也被称为web页面。</p><h2 id="html-元素">html 元素</h2><p>HTML文档由 <strong>HTML 元素</strong>定义。HTML元素包括：<strong>开始标签</strong>，<strong>元素内容</strong>，<strong>结束标签</strong></p><h3 id="html-元素语法">HTML 元素语法</h3><ul><li>HTML 元素以<strong>开始标签</strong>起始</li><li>HTML 元素以<strong>结束标签</strong>终止</li><li><strong>元素的内容</strong>是开始标签与结束标签之间的内容</li><li>某些 HTML 元素具有<strong>空内容（empty content）</strong></li><li>空元素<strong>在开始标签中进行关闭</strong>（以开始标签的结束而结束）</li><li>大多数 HTML 元素可拥有<strong>属性</strong></li></ul><blockquote><p>HTML 文档是由嵌套的 HTML 元素构成的</p></blockquote><h2 id="html-属性">HTML 属性</h2><p>属性是 HTML 元素提供的附加信息。</p><ul><li>HTML 元素可以设置<strong>属性</strong></li><li>属性可以在元素中添加<strong>附加信息</strong></li><li>属性一般描述于<strong>开始标签</strong></li><li>属性总是以名称/值对的形式出现，<strong>比如：name="value"</strong>。</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://www.runoob.com&quot;</span>&gt;</span>这是一个链接<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="html-标题">HTML 标题</h2><p>在 HTML 文档中，标题很重要。标题（Heading）是通过 <code>&lt;h1&gt; - &lt;h6&gt;</code> 标签进行定义的.<code>&lt;h1&gt;</code> 定义最大的标题。 <code>&lt;h6&gt;</code> 定义最小的标题。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>这是一个标题。<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>这是一个标题。<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>这是一个标题。<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>请确保将 HTML 标题 标签<strong>只用于标题</strong>。不要仅仅是为了生成<strong>粗体</strong>或<strong>大号</strong>的文本而使用标题。</p></blockquote><h3 id="html-水平线">HTML 水平线</h3><p><code>&lt;hr&gt;</code>标签在 HTML 页面中创建水平线。 用于分隔内容。</p><h3 id="html注释">HTML注释</h3><p>可以将注释插入 HTML 代码中，这样可以提高其可读性，使代码更易被人理解。浏览器会忽略注释，也不会显示它们。</p><p>注释写法如下:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 这是一个注释 --&gt;</span></span><br></pre></td></tr></table></figure><h2 id="html-段落">HTML 段落</h2><p>段落是通过 <code>&lt;p&gt;</code>标签定义的。如果在不产生新段落的情况下换行需要使用<code>&lt;br&gt;</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>这个<span class="tag">&lt;<span class="name">br</span>&gt;</span>段落<span class="tag">&lt;<span class="name">br</span>&gt;</span>演示了分行的效果<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p><code>&lt;br /&gt;</code>元素是一个空的 HTML 元素。由于关闭标签没有任何意义，因此它没有结束标签。</p></blockquote><h2 id="html-格式化标签">HTML 格式化标签</h2><h3 id="html-文本格式化标签">HTML 文本格式化标签</h3><table><thead><tr class="header"><th>标签</th><th>描述</th></tr></thead><tbody><tr class="odd"><td><code>&lt;b&gt;</code></td><td>定义粗体文本</td></tr><tr class="even"><td><code>&lt;em&gt;</code></td><td>定义着重文字</td></tr><tr class="odd"><td><code>&lt;i&gt;</code></td><td>定义斜体字</td></tr><tr class="even"><td><code>&lt;small&gt;</code></td><td>定义小号字</td></tr><tr class="odd"><td><code>&lt;strong&gt;</code></td><td>定义加重语气</td></tr><tr class="even"><td><code>&lt;sub&gt;</code></td><td>定义下标字</td></tr><tr class="odd"><td><code>&lt;sup&gt;</code></td><td>定义上标字</td></tr><tr class="even"><td><code>&lt;ins&gt;</code></td><td>定义插入字</td></tr><tr class="odd"><td><code>&lt;del&gt;</code></td><td>定义删除字</td></tr></tbody></table><h3 id="html-计算机输出-标签">HTML "计算机输出" 标签</h3><table><thead><tr class="header"><th>标签</th><th>描述</th></tr></thead><tbody><tr class="odd"><td><code>&lt;code&gt;</code></td><td>定义计算机代码</td></tr><tr class="even"><td><code>&lt;kbd&gt;</code></td><td>定义键盘码</td></tr><tr class="odd"><td><code>&lt;samp&gt;</code></td><td>定义计算机代码样本</td></tr><tr class="even"><td><code>&lt;var&gt;</code></td><td>定义变量</td></tr><tr class="odd"><td><code>&lt;pre&gt;</code></td><td>定义预格式文本</td></tr></tbody></table><h3 id="html-引文-引用-及标签定义">HTML 引文, 引用, 及标签定义</h3><table><thead><tr class="header"><th>标签</th><th>描述</th></tr></thead><tbody><tr class="odd"><td><code>&lt;abbr&gt;</code></td><td>定义缩写</td></tr><tr class="even"><td><code>&lt;address&gt;</code></td><td>定义地址</td></tr><tr class="odd"><td><code>&lt;bdo&gt;</code></td><td>定义文字方向</td></tr><tr class="even"><td><code>&lt;blockquote&gt;</code></td><td>定义长的引用</td></tr><tr class="odd"><td><code>&lt;q&gt;</code></td><td>定义短的引用语</td></tr><tr class="even"><td><code>&lt;cite&gt;</code></td><td>定义引用、引证</td></tr><tr class="odd"><td><code>&lt;dfn&gt;</code></td><td>定义一个定义项目</td></tr></tbody></table><h2 id="html头部信息">HTML头部信息</h2><h3 id="html-head-元素">HTML <code>&lt;head&gt;</code> 元素</h3><p><code>&lt;head&gt;</code>元素包含了所有的头部标签元素。在 <code>&lt;head&gt;</code>元素中你可以插入脚本（scripts）, 样式文件（CSS），及各种meta信息。</p><p>可以添加在头部区域的元素标签为: <code>&lt;title&gt;</code>,<code>&lt;style&gt;</code>, <code>&lt;meta&gt;</code>, <code>&lt;link&gt;</code>,<code>&lt;script&gt;</code>,<code>&lt;noscript&gt;</code>, and <code>&lt;base&gt;</code>.</p><h3 id="html-title-元素">HTML <code>&lt;title&gt;</code> 元素</h3><p><code>&lt;title&gt;</code> 标签定义了不同文档的标题，在HTML/XHTML 文档中是必须的。</p><ul><li>定义了浏览器工具栏的标题</li><li>当网页添加到收藏夹时，显示在收藏夹中的标题</li><li>显示在搜索引擎结果页面的标题</li></ul><h3 id="html-base-元素">HTML <code>&lt;base&gt;</code> 元素</h3><p><code>&lt;base&gt;</code> 标签描述了基本的链接地址/链接目标，该标签作为HTML文档中所有的链接标签的默认链接.</p><h3 id="html-link-元素">HTML <code>&lt;link&gt;</code> 元素</h3><p><code>&lt;link&gt;</code> 标签定义了文档与外部资源之间的关系，通常用于链接到样式表.</p><h3 id="html-style-元素">HTML <code>&lt;style&gt;</code> 元素</h3><p><code>&lt;style&gt;</code> 标签定义了HTML文档的样式文件引用地址，也可以直接添加样式来渲染 HTML 文档</p><h3 id="html-meta-元素">HTML <code>&lt;meta&gt;</code> 元素</h3><p><code>&lt;meta&gt;</code> 标签提供了元数据.<strong>元数据也不显示在页面上，但会被浏览器解析</strong>。META 元素通常用于指定网页的描述，关键词，文件的最后修改时间，作者，和其他元数据。元数据可以使用于浏览器（如何显示内容或重新加载页面），搜索引擎（关键词），或其他Web服务。<code>&lt;meta&gt;</code> 一般放置于 <code>&lt;head&gt;</code> 区域</p><h3 id="html-script-元素">HTML <code>&lt;script&gt;</code> 元素</h3><p><code>&lt;script&gt;</code>标签用于加载脚本文件，如： JavaScript</p><h3 id="html-head-元素汇总">HTML head 元素汇总</h3><table><thead><tr class="header"><th>标签</th><th>描述</th></tr></thead><tbody><tr class="odd"><td><code>&lt;head&gt;</code></td><td>定义了文档的信息</td></tr><tr class="even"><td><code>&lt;title&gt;</code></td><td>定义了文档的标题</td></tr><tr class="odd"><td><code>&lt;base&gt;</code></td><td>定义了页面链接标签的默认链接地址</td></tr><tr class="even"><td><code>&lt;link&gt;</code></td><td>定义了一个文档和外部资源之间的关系</td></tr><tr class="odd"><td><code>&lt;meta&gt;</code></td><td>定义了HTML文档中的元数据</td></tr><tr class="even"><td><code>&lt;script&gt;</code></td><td>定义了客户端的脚本文件</td></tr><tr class="odd"><td><code>&lt;style&gt;</code></td><td>定义了HTML文档的样式文件</td></tr></tbody></table><h2 id="html-样式--css">HTML 样式- CSS</h2><p>CSS (Cascading Style Sheets) 用于渲染HTML元素标签的样式.CSS 可以通过以下方式添加到HTML中:</p><ul><li>内联样式- 在HTML元素中使用"style" <strong>属性</strong></li><li>内部样式表 -在HTML文档头部 <code>&lt;head&gt;</code> 区域使用<code>&lt;style&gt;</code> <strong>元素</strong> 来包含CSS</li><li>外部引用 - 使用外部 CSS <strong>文件</strong></li></ul><blockquote><p>使用CSS最好的方式是通过外部引用CSS文件.</p></blockquote><h2 id="html-图像">HTML 图像</h2><p>在 HTML 中，图像由<code>&lt;img&gt;</code> 标签定义。<code>&lt;img&gt;</code> 是空标签，意思是说，它只包含属性，并且没有闭合标签。</p><blockquote><p>空格<code>&lt;br&gt;</code>也是没有闭合标签的</p></blockquote><p>定义图像的一般语法：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;url&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;some_text&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="alt属性">Alt属性</h3><p>alt 属性用来为图像定义一串预备的可替换的文本。在浏览器无法载入图像时，替换文本属性告诉读者她们失去的信息。此时，浏览器将显示这个替代性的文本而不是图像。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;boat.gif&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;Big Boat&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="设置图像的高度与宽度">设置图像的高度与宽度</h3><p>height（高度） 与 width（宽度）属性用于设置图像的高度与宽度。</p><p>属性值默认单位为像素:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;pulpit.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;Pulpit rock&quot;</span> <span class="attr">width</span>=<span class="string">&quot;304&quot;</span> <span class="attr">height</span>=<span class="string">&quot;228&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="html-表格">HTML 表格</h2><p>表格由 <code>&lt;table&gt;</code> 标签来定义。每个表格均有若干行（由 <code>&lt;tr&gt;</code> 标签定义），每行被分割为若干单元格（由<code>&lt;td&gt;</code> 标签定义）。字母 td 指表格数据（table data），即数据单元格的内容。数据单元格可以包含文本、图片、列表、段落、表单、水平线、表格等等。</p><p>表格的表头使用 <code>&lt;th&gt;</code> 标签进行定义。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>Header 1<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>Header 2<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>row 1, cell 1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>row 1, cell 2<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>row 2, cell 1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>row 2, cell 2<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure><table border="1"><tr><th>Header 1</th><th>Header 2</th></tr><tr><td>row 1, cell 1</td><td>row 1, cell 2</td></tr><tr><td>row 2, cell 1</td><td>row 2, cell 2</td></tr></table><blockquote><p>大多数浏览器会把表头显示为粗体居中的文本</p></blockquote><table><thead><tr class="header"><th>标签</th><th>描述</th></tr></thead><tbody><tr class="odd"><td><code>&lt;table&gt;</code></td><td>定义表格</td></tr><tr class="even"><td><code>&lt;th&gt;</code></td><td>定义表格的表头</td></tr><tr class="odd"><td><code>&lt;tr&gt;</code></td><td>定义表格的行</td></tr><tr class="even"><td><code>&lt;td&gt;</code></td><td>定义表格单元格</td></tr><tr class="odd"><td><code>&lt;caption&gt;</code></td><td>定义表格标题</td></tr><tr class="even"><td><code>&lt;colgroup&gt;</code></td><td>定义表格列的组</td></tr><tr class="odd"><td><code>&lt;col&gt;</code></td><td>定义用于表格列的属性</td></tr><tr class="even"><td><code>&lt;thead&gt;</code></td><td>定义表格的页眉</td></tr><tr class="odd"><td><code>&lt;tbody&gt;</code></td><td>定义表格的主体</td></tr><tr class="even"><td><code>&lt;tfoot&gt;</code></td><td>定义表格的页脚</td></tr></tbody></table><h2 id="html-列表">HTML 列表</h2><h3 id="html无序列表">HTML无序列表</h3><p>无序列表是一个项目的列表，此列项目使用粗体圆点（典型的小黑圆圈）进行标记。</p><p>无序列表使用 <code>&lt;ul&gt;</code> 标签</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>Coffee<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>Milk<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>Coffee</li><li>Milk</li></ul><h3 id="html-有序列表">HTML 有序列表</h3><p>有序列表也是一列项目，列表项目使用数字进行标记。 有序列表始于 <code>&lt;ol&gt;</code> 标签。每个列表项始于 <code>&lt;li&gt;</code> 标签。列表项使用数字来标记。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ol</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>Coffee<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>Milk<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>Coffee</li><li>Milk</li></ol><h3 id="html-自定义列表">HTML 自定义列表</h3><p>自定义列表不仅仅是一列项目，而是项目及其注释的组合。</p><p>自定义列表以 <code>&lt;dl&gt;</code> 标签开始。每个自定义列表项以 <code>&lt;dt&gt;</code> 开始。每个自定义列表项的定义以 <code>&lt;dd&gt;</code> 开始。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dl</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dt</span>&gt;</span>Coffee<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dd</span>&gt;</span>- black hot drink<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dt</span>&gt;</span>Milk<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dd</span>&gt;</span>- white cold drink<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br></pre></td></tr></table></figure><dl><dt>Coffee</dt><dd><ul><li>black hot drink</dd><dt>Milk</dt><dd><ul><li>white cold drink</dd></dl></li></ul></li></ul><h2 id="html-区块">HTML 区块</h2><p>大多数 HTML 元素被定义为<strong>块级元素</strong>或<strong>内联元素</strong>。</p><p><strong>块级元素</strong>在浏览器显示时，通常会以新行来开始（和结束）。（如：<code>&lt;h1&gt;</code>, <code>&lt;p&gt;</code>, <code>&lt;ul&gt;</code>, <code>&lt;table&gt;</code>）</p><p><strong>内联元素</strong>在显示时通常不会以新行开始。（如：<code>&lt;b&gt;</code>, <code>&lt;td&gt;</code>, <code>&lt;a&gt;</code>, <code>&lt;img&gt;</code>）</p><p><strong><code>&lt;div&gt;</code> 元素是块级元素</strong>，它可用于组合其他 HTML 元素的容器。<code>&lt;div&gt;</code> 元素没有特定的含义。除此之外，由于它属于块级元素，浏览器会在其前后显示折行。如果与 CSS 一同使用，<code>&lt;div&gt;</code> 元素可用于对大的内容块设置样式属性。</p><p><strong><code>&lt;span&gt;</code> 元素是内联元素</strong>，可用作文本的容器。<code>&lt;span&gt;</code> 元素也没有特定的含义。当与 CSS 一同使用时，<code>&lt;span&gt;</code> 元素可用于为部分文本设置样式属性。</p><h2 id="html-布局">HTML 布局</h2><p>大多数网站可以使用 <code>&lt;div&gt;</code> 或者 <code>&lt;table&gt;</code> 元素来创建多列。CSS 用于对元素进行定位，或者为页面创建背景以及色彩丰富的外观。</p><p>例如：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;maxname&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:500px;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;hname&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background-color:#666FFF;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">&quot;margin-bottom:0;text-align:center;&quot;</span>&gt;</span>Div布局实例<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;menu&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background-color:#FFFFFF;height:200px;width:100px;float:left;&quot;</span>&gt;</span>    </span><br><span class="line">          菜单<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">          num1<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">          num2<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">          num3</span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;content&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background-color:#FFFF00;height:200px;width:300px;float:left;&quot;</span>&gt;</span></span><br><span class="line">        中间信息</span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;right&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background-color:#000000;color:#FFFFFF;height:200px;width:100px;float:right;&quot;</span>&gt;</span></span><br><span class="line">          右侧信息</span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;bool&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background-color:#F0F8FF;clear:both;text-align:center;&quot;</span>&gt;</span></span><br><span class="line">        整体布局测试</span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><html><head><meta charset="utf-8"><title>Demo</title></head><body><div id="maxname" style="width:500px;"><pre><code>  &lt;div id=&quot;hname&quot; style=&quot;background-color:#666FFF;&quot;&gt;    &lt;h1 style=&quot;margin-bottom:0;text-align:center;&quot;&gt;Div布局实例&lt;/h1&gt;  &lt;/div&gt;  &lt;div id=&quot;menu&quot; style=&quot;background-color:#FFFFFF;height:200px;width:100px;float:left;&quot;&gt;          菜单&lt;br/&gt;      num1&lt;br/&gt;      num2&lt;br/&gt;      num3  &lt;/div&gt;  &lt;div id=&quot;content&quot; style=&quot;background-color:#FFFF00;height:200px;width:300px;float:left;&quot;&gt;    中间信息  &lt;/div&gt;  &lt;div id=&quot;right&quot; style=&quot;background-color:#000000;color:#FFFFFF;height:200px;width:100px;float:right;&quot;&gt;      右侧信息  &lt;/div&gt;  &lt;div id=&quot;bool&quot; style=&quot;background-color:#F0F8FF;clear:both;text-align:center;&quot;&gt;    整体布局测试  &lt;/div&gt;</code></pre></div></body></html><h2 id="html-表单">HTML 表单</h2><p>表单是一个包含表单元素的区域。</p><p>表单元素是允许用户在表单中输入内容,比如：文本域(textarea)、下拉列表、单选框(radio-buttons)、复选框(checkboxes)等等。</p><p>表单的构建用<code>&lt;form&gt;</code>元素</p><h3 id="输入元素">输入元素</h3><p>多数情况下被用到的表单标签是输入标签（<code>&lt;input&gt;</code>）。输入类型是由类型属性（type）定义的。</p><h4 id="文本域text-fields">文本域（Text Fields）</h4><p>文本域通过<code>&lt;input type="text"&gt;</code> 标签来设定，用户可以在表单中键入字母、数字等内容</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">First name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;firstname&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">Last name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;lastname&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><form>First name: <input type="text" name="firstname"><br> Last name: <input type="text" name="lastname"></form><h4 id="密码字段">密码字段</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">Password: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;pwd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><form>Password: <input type="password" name="pwd"></form><h4 id="单选按钮radio-buttons">单选按钮（Radio Buttons）</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">value</span>=<span class="string">&quot;male&quot;</span>&gt;</span>Male<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">value</span>=<span class="string">&quot;female&quot;</span>&gt;</span>Female</span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><form><input type="radio" name="sex" value="male">Male<br> <input type="radio" name="sex" value="female">Female</form><h4 id="复选框checkboxes">复选框（Checkboxes）</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;vehicle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Bike&quot;</span>&gt;</span>I have a bike<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;vehicle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Car&quot;</span>&gt;</span>I have a car </span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><form><input type="checkbox" name="vehicle" value="Bike">I have a bike<br> <input type="checkbox" name="vehicle" value="Car">I have a car</form><h4 id="提交按钮submit-button">提交按钮(Submit Button)</h4><p><code>&lt;input type="submit"&gt;</code> 定义了提交按钮. 当用户单击确认按钮时，表单的内容会被传送到另一个文件。表单的动作属性定义了目的文件的文件名。由动作属性定义的这个文件通常会对接收到的输入数据进行相关的处理。:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">&quot;input&quot;</span> <span class="attr">action</span>=<span class="string">&quot;html_form_action.php&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line">Username: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><form name="input" action="html_form_action.php" method="get">Username: <input type="text" name="user"> <input type="submit" value="Submit"></form><h3 id="html-表单标签">HTML 表单标签</h3><table><thead><tr class="header"><th>标签</th><th>描述</th></tr></thead><tbody><tr class="odd"><td><code>&lt;form&gt;</code></td><td>定义供用户输入的表单</td></tr><tr class="even"><td><code>&lt;input&gt;</code></td><td>定义输入域</td></tr><tr class="odd"><td><code>&lt;textarea&gt;</code></td><td>定义文本域 (一个多行的输入控件)</td></tr><tr class="even"><td><code>&lt;label&gt;</code></td><td>定义了 <code>&lt;input&gt;</code> 元素的标签，一般为输入标题</td></tr><tr class="odd"><td><code>&lt;filedset&gt;</code></td><td>定义了一组相关的表单元素，并使用外框包含起来</td></tr><tr class="even"><td><code>&lt;legend&gt;</code></td><td>定义了 <code>&lt;fieldset&gt;</code> 元素的标题</td></tr><tr class="odd"><td><code>&lt;select&gt;</code></td><td>定义了下拉选项列表</td></tr><tr class="even"><td><code>&lt;optgroup&gt;</code></td><td>定义选项组</td></tr><tr class="odd"><td><code>&lt;option&gt;</code></td><td>定义下拉列表中的选项</td></tr><tr class="even"><td><code>&lt;button&gt;</code></td><td>定义一个点击按钮</td></tr><tr class="odd"><td><code>&lt;datalist&gt;</code></td><td>指定一个预先定义的输入控件选项列表</td></tr><tr class="even"><td><code>keygen</code></td><td>定义了表单的密钥对生成器字段</td></tr><tr class="odd"><td><code>&lt;output&gt;</code></td><td>定义一个计算结果</td></tr></tbody></table><h2 id="html-框架">HTML 框架</h2><p>通过使用框架，你可以在同一个浏览器窗口中镶嵌其他页面。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;demo_iframe.htm&quot;</span> <span class="attr">width</span>=<span class="string">&quot;200&quot;</span> <span class="attr">height</span>=<span class="string">&quot;200&quot;</span> <span class="attr">frameborder</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="html-脚本">HTML 脚本</h2><p><code>&lt;script&gt;</code> 标签用于定义客户端脚本，比如 JavaScript。<code>&lt;script&gt;</code> 元素既可包含脚本语句，也可通过 src 属性指向外部脚本文件。<code>&lt;noscript&gt;</code> 标签提供无法使用脚本时的替代内容，比方在浏览器禁用脚本时，或浏览器不支持客户端脚本时。<code>&lt;noscript&gt;</code>元素可包含普通 HTML 页面的 body 元素中能够找到的所有元素。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="built_in">document</span>.write(<span class="string">&quot;Hello World!&quot;</span>)</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">noscript</span>&gt;</span>抱歉，你的浏览器不支持 JavaScript!<span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></span><br></pre></td></tr></table></figure><hr /><h3 id="reference">Reference</h3><p><a href="https://www.runoob.com/html/html-tutorial.html">菜鸟教程</a></p>]]></content>
      
      
      <categories>
          
          <category> HTML </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HTML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python中的字符标准化方法</title>
      <link href="2019/06/09/chara-py/"/>
      <url>2019/06/09/chara-py/</url>
      
        <content type="html"><![CDATA[<p>   字符串格式化用于解决字符串和变量同时输出时的格式安排。Python中有str.format()，format()和%三种格式控制的方法，但主要采用str.format()方法进行字符串的格式化。</p><h2 id="str.format方法"><code>str.format()</code>方法</h2><p><code>str.format()</code>方法的基本使用格式：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;模板字符串&gt;.format(&lt;由逗号分隔的参数&gt;)</span><br></pre></td></tr></table></figure><p>其中模板字符串是由一系列的槽({})组成，用来控制修改字符串中嵌入值出现的位置，基本思路：将<code>str.format()</code>方法中逗号分隔的参数按照序号关系替换到模板字符串的槽中，槽用大括号({})来表示，如果大括号中没有序号，则按照出现顺序替换。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#123;1&#125; &#123;0&#125;&#x27;</span>.format(<span class="string">&#x27;abc&#x27;</span>, <span class="number">123</span>)  <span class="comment"># 可以不按顺序进行位置映射，输出&#x27;123 abc&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#123;&#125; &#123;&#125;&#x27;</span>.format(<span class="string">&#x27;abc&#x27;</span>, <span class="number">123</span>)  <span class="comment"># 可以不指定参数名称，输出&#x27;abc 123&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>注意</strong>：序号是从0开始，而不是1。</p></blockquote><p>槽的内部格式为：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&lt;参数序号&gt;：&lt;格式控制标记&gt;&#125;</span><br></pre></td></tr></table></figure><p>在复杂格式控制方面，format函数也提供了强大的控制方式，它的格式为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; : [[填充字符]对齐方式][符号标志][#][宽度][,][.精度][类型] &#125;</span><br></pre></td></tr></table></figure><table><thead><tr class="header"><th style="text-align: center;">类型</th><th style="text-align: center;">说明</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">:</td><td style="text-align: center;">引导符号，分割参数序号和格式控制标记</td></tr><tr class="even"><td style="text-align: center;">填充字符</td><td style="text-align: center;">用于填充的单个字符，不填时默认为空格</td></tr><tr class="odd"><td style="text-align: center;">对齐方式</td><td style="text-align: center;"><code>&lt;</code>左对齐，<code>&gt;</code>右对齐，<code>^</code>居中，不足部分会用填充字符填充</td></tr><tr class="even"><td style="text-align: center;">符号标志</td><td style="text-align: center;"><code>+</code>表示有符号（正数前显示+，负数前显示-），空格表示正数前加空格来和负数对齐</td></tr><tr class="odd"><td style="text-align: center;">#</td><td style="text-align: center;">表示是否在二、八、十六进制前显示0b、0o、0x等符号</td></tr><tr class="even"><td style="text-align: center;">宽度</td><td style="text-align: center;">输出字符串的宽度，不足部分自动用填充字符补齐</td></tr><tr class="odd"><td style="text-align: center;">,</td><td style="text-align: center;">英文状态下的逗号，数字的千分位分隔符，适用于整数和浮点数</td></tr><tr class="even"><td style="text-align: center;">精度</td><td style="text-align: center;">浮点数小数部分的精度</td></tr><tr class="odd"><td style="text-align: center;">类型</td><td style="text-align: center;">整数类型b，c，d，o，x，X，浮点数类型e，E，f，%</td></tr></tbody></table><p>举例如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#123;:S^+#016,.2f&#125;&#x27;</span>.format(<span class="number">1234</span>)  <span class="comment"># 输出&#x27;SSS+1,234.00SSSS&#x27;</span></span><br></pre></td></tr></table></figure><p>整数类型输出格式有6种：</p><ul><li>b：输出整数的二进制形式。</li><li>c：输出整数对应的Unicode字符。</li><li>d：输出整数的十进制形式。</li><li>o：输出整数的八进制形式。</li><li>x：输出整数的小写十六进制形式。</li><li>X：输出整数的大写十六进制形式。</li></ul><p>浮点数类型输出格式有4种：</p><ul><li>e：输出浮点数对应的小写字母e的指数形式。</li><li>E：输出浮点数对应的小写字母e的指数形式。</li><li>f：输出浮点数的标准浮点形式。</li><li>%：输出浮点数的百分形式。</li></ul><h2 id="format方法"><code>format</code>方法</h2><p><code>format()</code>方法和<code>str.format()</code>方法用法差不多，只不过，<code>format()</code>方法中槽的内部只有格式控制标记，没有参数序号和引导符号。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>format(<span class="string">&#x27;aksfhakefhk&#x27;</span>,<span class="string">&#x27;&lt;20&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;aksfhakefhk  </span></span><br><span class="line"><span class="string">&gt;&gt;&gt; format(&#x27;</span>lfajlajl<span class="string">&#x27;, &#x27;</span>*&gt;<span class="number">30</span><span class="string">&#x27;)    # 右对齐，填充*</span></span><br><span class="line"><span class="string">&#x27;</span>**********************lfajlajl<span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="f-string方法"><code>f-string</code>方法</h2><p>f-string就是以f''开头的字符串，字符串内容和format方法中的格式一样，但是可以直接将变量带入到字符串中，可读性进一步增加，例如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">amount = <span class="number">1234</span></span><br><span class="line"><span class="string">f&#x27;请转账给我<span class="subst">&#123;amount:,<span class="number">.2</span>f&#125;</span>元&#x27;</span>  <span class="comment"># &#x27;请转账给我1,234.00元&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="方法"><code>%</code>方法</h2><p>%方法类似于C和Fortran语言中的格式化输入输出，%s表示格式化为字符串，%d表示格式化为数字。</p><p>例如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">&quot;I&#x27;m %s. I&#x27;m %d year old&quot;</span> % (<span class="string">&#x27;jeason&#x27;</span>, <span class="number">23</span>))</span><br></pre></td></tr></table></figure><p>格式化字符串时，Python使用一个字符串作为<strong>模板</strong>。模板中有<strong>格式符</strong>，这些格式符为真实值预留位置，并说明真实数值应该呈现的格式。Python用一个tuple将多个值传递给模板，每个值对应一个格式符。在模板和tuple之间，有一个%号分隔，它代表了<strong>格式化操作</strong></p><p>格式符为真实值预留位置，并控制显示的格式。格式符可以包含有一个类型码，用以控制显示的类型，如下:</p><table><thead><tr class="header"><th style="text-align: center;">格式符</th><th style="text-align: center;">意义</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">%s</td><td style="text-align: center;">字符串 (采用str()的显示)</td></tr><tr class="even"><td style="text-align: center;">%r</td><td style="text-align: center;">字符串 (采用repr()的显示)</td></tr><tr class="odd"><td style="text-align: center;">%c</td><td style="text-align: center;">单个字符</td></tr><tr class="even"><td style="text-align: center;">%b</td><td style="text-align: center;">二进制整数</td></tr><tr class="odd"><td style="text-align: center;">%d</td><td style="text-align: center;">十进制整数</td></tr><tr class="even"><td style="text-align: center;">%i</td><td style="text-align: center;">十进制整数</td></tr><tr class="odd"><td style="text-align: center;">%o</td><td style="text-align: center;">八进制整数</td></tr><tr class="even"><td style="text-align: center;">%x</td><td style="text-align: center;">十六进制整数</td></tr><tr class="odd"><td style="text-align: center;">%e</td><td style="text-align: center;">指数 (基底写为e)</td></tr><tr class="even"><td style="text-align: center;">%E</td><td style="text-align: center;">指数 (基底写为E)</td></tr><tr class="odd"><td style="text-align: center;">%f</td><td style="text-align: center;">浮点数</td></tr><tr class="even"><td style="text-align: center;">%F</td><td style="text-align: center;">浮点数，与上相同</td></tr><tr class="odd"><td style="text-align: center;">%g</td><td style="text-align: center;">指数(e)或浮点数 (根据显示长度)</td></tr><tr class="even"><td style="text-align: center;">%G</td><td style="text-align: center;">指数(E)或浮点数 (根据显示长度)</td></tr><tr class="odd"><td style="text-align: center;">%%</td><td style="text-align: center;">字符"%"</td></tr></tbody></table><p>除了对数据类型的指定，%操作符也支持更复杂的格式控制：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%[数据名称][对齐标志][宽度].[精度]类型</span><br></pre></td></tr></table></figure><table><thead><tr class="header"><th style="text-align: center;">类型</th><th style="text-align: center;">说明</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">数据名称</td><td style="text-align: center;">数据名称用于字典赋值，如果不是就不用写</td></tr><tr class="even"><td style="text-align: center;">对齐标志</td><td style="text-align: center;">可以有+,-,' '或0。+表示右对齐。-表示左对齐。' '为一个空格，表示在正数的左侧填充一个空格，从而与负数对齐。0表示使用0填充。</td></tr><tr class="odd"><td style="text-align: center;">宽度</td><td style="text-align: center;">格式化后的字符长度，如果不够用0或者空格补齐</td></tr><tr class="even"><td style="text-align: center;">精度</td><td style="text-align: center;">小数点后的位数</td></tr><tr class="odd"><td style="text-align: center;">类型</td><td style="text-align: center;">数据类型</td></tr></tbody></table><hr /><h3 id="reference">Reference</h3><p><a href="https://www.cnblogs.com/vamei/archive/2013/03/12/2954938.html">Python补充05 字符串格式化 (%操作符)</a></p><p><a href="https://www.zhouzying.cn/84.html">python中的字符串的格式化</a></p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python基本数据类型</title>
      <link href="2019/06/09/dataformat/"/>
      <url>2019/06/09/dataformat/</url>
      
        <content type="html"><![CDATA[<h3 id="基本数据类型">基本数据类型</h3><ul><li>Number（数字）<br /></li><li>String（字符串）<br /></li><li>List（列表）<br /></li><li>Tuple（元组）<br /></li><li>Set（集合）<br /></li><li>Dictionary（字典）</li></ul><blockquote><p>不可变数据（3 个）：Number（数字）、String（字符串）、Tuple（元组）<br />可变数据（3 个）：List（列表）、Dictionary（字典）、Set（集合）</p></blockquote><h4 id="数字类型">数字类型</h4><p>Python3 支持 int、float、bool、complex（复数）。</p><p>内置的 <code>type()</code> 函数可以用来查询变量所指的对象类型。 <code>isinstance()</code> 用来判断数据类型</p><blockquote><p>isinstance 和 type 的区别在于:<br />+ <code>type()</code> 不会认为子类是一种父类类型<br />+ <code>isinstance()</code> 会认为子类是一种父类类型</p></blockquote><h4 id="string字符串">String（字符串）</h4><p>Python中的字符串用单引号 <code>'</code> 或双引号 <code>"</code> 括起来，同时使用反斜杠 <code>\</code> 转义特殊字符。</p><p>Python 使用反斜杠(<code>\</code>)转义特殊字符，如果你不想让反斜杠发生转义，可以在字符串前面添加一个 <code>r</code> ，表示原始字符串</p><p>另外，反斜杠(<code>\</code>)可以作为续行符，表示下一行是上一行的延续。也可以使用 <code>"""..."""</code> 或者 <code>'''...'''</code> 跨越多行。</p><p><strong>注意</strong>，Python 没有单独的字符类型，一个字符就是长度为1的字符串。</p><blockquote><ol type="1"><li>反斜杠可以用来转义，使用r可以让反斜杠不发生转义。<br /></li><li>字符串可以用+运算符连接在一起，用*运算符重复。<br /></li><li>Python中的字符串有两种索引方式，从左往右以0开始，从右往左以-1开始。<br /></li><li>Python中的字符串不能改变。</li></ol></blockquote><h4 id="list列表">List（列表）</h4><p>列表可以完成大多数集合类的数据结构实现。列表中元素的类型可以不相同，它支持数字，字符串甚至可以包含列表（所谓嵌套）。</p><p>列表是写在方括号 [] 之间、用逗号分隔开的元素列表。</p><p>列表索引：<br /><img src="/images/dataformat/list_slicing1.png" alt="list_slicing1" /></p><p>与Python字符串不一样的是，列表中的元素是可以改变的。</p><blockquote><ol type="1"><li>List写在方括号之间，元素用逗号隔开。<br /></li><li>和字符串一样，list可以被索引和切片。<br /></li><li>List可以使用+操作符进行拼接。<br /></li><li>List中的元素是可以改变的。</li></ol></blockquote><h4 id="tuple元组">Tuple（元组）</h4><p>元组（tuple）与列表类似，不同之处在于元组的元素不能修改。元组写在小括号 <code>()</code> 里，元素之间用逗号隔开。元组中的元素类型也可以不相同。</p><p>虽然tuple的元素不可改变，但它可以包含可变的对象，比如list列表。</p><p>string、list 和 tuple 都属于 sequence（序列）。</p><p><strong>注意</strong>：</p><ol type="1"><li>与字符串一样，元组的元素不能修改。<br /></li><li>元组也可以被索引和切片，方法一样。<br /></li><li>注意构造包含 0 或 1 个元素的元组的特殊语法规则。<br /></li><li>元组也可以使用+操作符进行拼接。</li></ol><h4 id="set集合">Set（集合）</h4><p>集合（set）是由一个或数个形态各异的大小整体组成的，构成集合的事物或对象称作元素或是成员，是一个无序的不重复元素序列。</p><p>基本功能是进行成员关系测试和删除重复元素。</p><p>可以使用大括号 <code>&#123; &#125;</code> 或者 <code>set()</code> 函数创建集合，注意：创建一个空集合必须用 <code>set()</code> 而不是 <code>&#123; &#125;</code>，因为 <code>&#123; &#125;</code> 是用来创建一个空字典。</p><h4 id="dictionary字典">Dictionary（字典）</h4><p>字典（dictionary）是Python中另一个非常有用的内置数据类型。</p><p>列表是有序的对象集合，字典是无序的对象集合。两者之间的区别在于：字典当中的元素是通过键来存取的，而不是通过偏移存取。</p><p>字典是一种映射类型，字典用 { } 标识，它是一个无序的 键(key) : 值(value) 的集合。</p><p>键(key)必须使用不可变类型。</p><p>在同一个字典中，键(key)必须是唯一的。</p><blockquote><ol type="1"><li>字典是一种映射类型，它的元素是键值对。<br /></li><li>字典的关键字必须为不可变类型，且不能重复。<br /></li><li>创建空字典使用 <code>&#123; &#125;</code>。</li></ol></blockquote><h3 id="python数据类型转换">Python数据类型转换</h3><p>有时候，我们需要对数据内置的类型进行转换，数据类型的转换，你只需要将数据类型作为函数名即可。</p><p>以下几个内置的函数可以执行数据类型之间的转换。这些函数返回一个新的对象，表示转换的值。</p><table><thead><tr class="header"><th style="text-align: center;">函数</th><th style="text-align: center;">描述</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;"><code>int(x [,base])</code></td><td style="text-align: center;">将x转换为一个整数</td></tr><tr class="even"><td style="text-align: center;"><code>float(x)</code></td><td style="text-align: center;">将x转换到一个浮点数</td></tr><tr class="odd"><td style="text-align: center;"><code>complex(real [,imag])</code></td><td style="text-align: center;">创建一个复数</td></tr><tr class="even"><td style="text-align: center;"><code>str(x)</code></td><td style="text-align: center;">将对象 x 转换为字符串</td></tr><tr class="odd"><td style="text-align: center;"><code>repr(x)</code></td><td style="text-align: center;">将对象 x 转换为表达式字符串</td></tr><tr class="even"><td style="text-align: center;"><code>eval(str)</code></td><td style="text-align: center;">用来计算在字符串中的有效Python表达式,并返回一个对象</td></tr><tr class="odd"><td style="text-align: center;"><code>tuple(s)</code></td><td style="text-align: center;">将序列 s 转换为一个元组</td></tr><tr class="even"><td style="text-align: center;"><code>list(s)</code></td><td style="text-align: center;">将序列 s 转换为一个列表</td></tr><tr class="odd"><td style="text-align: center;"><code>set(s)</code></td><td style="text-align: center;">转换为可变集合</td></tr><tr class="even"><td style="text-align: center;"><code>dict(d)</code></td><td style="text-align: center;">创建一个字典。d 必须是一个序列 (key,value)元组。</td></tr><tr class="odd"><td style="text-align: center;"><code>frozenset(s)</code></td><td style="text-align: center;">转换为不可变集合</td></tr><tr class="even"><td style="text-align: center;"><code>chr(x)</code></td><td style="text-align: center;">将一个整数转换为一个字符</td></tr><tr class="odd"><td style="text-align: center;"><code>ord(x)</code></td><td style="text-align: center;">将一个字符转换为它的整数值</td></tr><tr class="even"><td style="text-align: center;"><code>hex(x)</code></td><td style="text-align: center;">将一个整数转换为一个十六进制字符串</td></tr><tr class="odd"><td style="text-align: center;"><code>oct(x)</code></td><td style="text-align: center;">将一个整数转换为一个八进制字符串</td></tr></tbody></table><h3 id="运算符">运算符</h3><h4 id="算术运算符">算术运算符</h4><p>加（<code>+</code>）、减（<code>-</code>）、乘（<code>*</code>）、除（<code>/</code>）、取余（<code>%</code>）、乘幂（<code>**</code>）、向下整除（<code>//</code>）</p><h4 id="比较运算符">比较运算符</h4><p>等于（<code>==</code>）、不等于（<code>!=</code>）、大于（<code>&gt;</code>）、小于（<code>&lt;</code>）、大于等于（<code>&gt;=</code>）、小于等于（<code>&lt;=</code>）</p><blockquote><p>返回布尔值：<strong>TRUE</strong>或<strong>FALSE</strong></p></blockquote><h4 id="赋值运算符">赋值运算符</h4><table><thead><tr class="header"><th style="text-align: center;">运算符</th><th style="text-align: center;">描述</th><th style="text-align: center;">实例</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">=</td><td style="text-align: center;">简单的赋值运算符</td><td style="text-align: center;">c = a + b 将 a + b 的运算结果赋值为 c</td></tr><tr class="even"><td style="text-align: center;">+=</td><td style="text-align: center;">加法赋值运算符</td><td style="text-align: center;">c += a 等效于 c = c + a</td></tr><tr class="odd"><td style="text-align: center;">-=</td><td style="text-align: center;">减法赋值运算符</td><td style="text-align: center;">c -= a 等效于 c = c - a</td></tr><tr class="even"><td style="text-align: center;">*=</td><td style="text-align: center;">乘法赋值运算符</td><td style="text-align: center;">c <em>= a 等效于 c = c </em> a</td></tr><tr class="odd"><td style="text-align: center;">/=</td><td style="text-align: center;">除法赋值运算符</td><td style="text-align: center;">c /= a 等效于 c = c / a</td></tr><tr class="even"><td style="text-align: center;">%=</td><td style="text-align: center;">取模赋值运算符</td><td style="text-align: center;">c %= a 等效于 c = c % a</td></tr><tr class="odd"><td style="text-align: center;">**=</td><td style="text-align: center;">幂赋值运算符</td><td style="text-align: center;">c <strong>= a 等效于 c = c </strong> a</td></tr><tr class="even"><td style="text-align: center;">//=</td><td style="text-align: center;">取整除赋值运算符</td><td style="text-align: center;">c //= a 等效于 c = c // a</td></tr></tbody></table><h4 id="按位运算符">按位运算符</h4><table><colgroup><col style="width: 3%" /><col style="width: 53%" /><col style="width: 43%" /></colgroup><thead><tr class="header"><th style="text-align: center;">运算符</th><th style="text-align: center;">描述</th><th style="text-align: center;">实例</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">&amp;</td><td style="text-align: center;">按位与运算符：参与运算的两个值,如果两个相应位都为1,则该位的结果为1,否则为0</td><td style="text-align: center;">(a &amp; b) 输出结果 12 ，二进制解释： 0000 1100</td></tr><tr class="even"><td style="text-align: center;"></td><td style="text-align: center;">按位或运算符：只要对应的二个二进位有一个为1时，结果位就为1。</td><td style="text-align: center;">(a</td></tr><tr class="odd"><td style="text-align: center;">^</td><td style="text-align: center;">按位异或运算符：当两对应的二进位相异时，结果为1</td><td style="text-align: center;">(a ^ b) 输出结果 49 ，二进制解释： 0011 0001</td></tr><tr class="even"><td style="text-align: center;">~</td><td style="text-align: center;">按位取反运算符：对数据的每个二进制位取反,即把1变为0,把0变为1。<code>~x</code> 类似于 <code>-x-1</code></td><td style="text-align: center;">(~a ) 输出结果 -61 ，二进制解释： 1100 0011， 在一个有符号二进制数的补码形式。</td></tr><tr class="odd"><td style="text-align: center;">&lt;&lt;</td><td style="text-align: center;">左移动运算符：运算数的各二进位全部左移若干位，由"&lt;&lt;"右边的数指定移动的位数，高位丢弃，低位补0。</td><td style="text-align: center;">a &lt;&lt; 2 输出结果 240 ，二进制解释： 1111 0000</td></tr><tr class="even"><td style="text-align: center;">&gt;&gt;</td><td style="text-align: center;">右移动运算符：把"&gt;&gt;"左边的运算数的各二进位全部右移若干位，"&gt;&gt;"右边的数指定移动的位数</td><td style="text-align: center;">a &gt;&gt; 2 输出结果 15 ，二进制解释： 0000 1111</td></tr></tbody></table><h4 id="逻辑运算符">逻辑运算符</h4><table><thead><tr class="header"><th style="text-align: center;">运算符</th><th style="text-align: center;">逻辑表达式</th><th style="text-align: center;">描述</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">and</td><td style="text-align: center;">x and y</td><td style="text-align: center;">布尔"与" - 如果 x 为 False，x and y 返回 False，否则它返回 y 的计算值。</td></tr><tr class="even"><td style="text-align: center;">or</td><td style="text-align: center;">x or y</td><td style="text-align: center;">布尔"或" - 如果 x 是 True，它返回 x 的值，否则它返回 y 的计算值。</td></tr><tr class="odd"><td style="text-align: center;">not</td><td style="text-align: center;">not x</td><td style="text-align: center;">布尔"非" - 如果 x 为 True，返回 False 。如果 x 为 False，它返回 True。</td></tr></tbody></table><h4 id="成员运算符">成员运算符</h4><table><colgroup><col style="width: 5%" /><col style="width: 50%" /><col style="width: 44%" /></colgroup><thead><tr class="header"><th style="text-align: center;">运算符</th><th style="text-align: center;">描述</th><th style="text-align: center;">实例</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">in</td><td style="text-align: center;">如果在指定的序列中找到值返回 True，否则返回 False。</td><td style="text-align: center;">x 在 y 序列中 , 如果 x 在 y 序列中返回 True。</td></tr><tr class="even"><td style="text-align: center;">not in</td><td style="text-align: center;">如果在指定的序列中没有找到值返回 True，否则返回 False。</td><td style="text-align: center;">x 不在 y 序列中 , 如果 x 不在 y 序列中返回 True。</td></tr></tbody></table><h4 id="身份运算符">身份运算符</h4><table><colgroup><col style="width: 4%" /><col style="width: 30%" /><col style="width: 65%" /></colgroup><thead><tr class="header"><th style="text-align: center;">运算符</th><th style="text-align: center;">描述</th><th style="text-align: center;">实例</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">is</td><td style="text-align: center;">is 是判断两个标识符是不是引用自一个对象</td><td style="text-align: center;">x is y, 类似 id(x) == id(y) , 如果引用的是同一个对象则返回 True，否则返回 False</td></tr><tr class="even"><td style="text-align: center;">is not</td><td style="text-align: center;">is not 是判断两个标识符是不是引用自不同对象</td><td style="text-align: center;">x is not y ， 类似 id(a) != id(b)。如果引用的不是同一个对象则返回结果 True，否则返回 False。</td></tr></tbody></table><h3 id="运算符优先级">运算符优先级</h3><p>运算符由高到低优先级为：</p><table><thead><tr class="header"><th style="text-align: center;">运算符</th><th style="text-align: center;">描述</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">**</td><td style="text-align: center;">指数 (最高优先级)</td></tr><tr class="even"><td style="text-align: center;">~ + -</td><td style="text-align: center;">按位翻转, 一元加号和减号 (最后两个的方法名为 +@ 和 -@)</td></tr><tr class="odd"><td style="text-align: center;">* / % //</td><td style="text-align: center;">乘，除，取模和取整除</td></tr><tr class="even"><td style="text-align: center;">+ -</td><td style="text-align: center;">加法减法</td></tr><tr class="odd"><td style="text-align: center;">&gt;&gt; &lt;&lt;</td><td style="text-align: center;">右移，左移运算符</td></tr><tr class="even"><td style="text-align: center;">&amp;</td><td style="text-align: center;">位 'AND'</td></tr><tr class="odd"><td style="text-align: center;">^ <code>|</code></td><td style="text-align: center;">位运算符</td></tr><tr class="even"><td style="text-align: center;">&lt;= &lt; &gt; &gt;=</td><td style="text-align: center;">比较运算符</td></tr><tr class="odd"><td style="text-align: center;">&lt;&gt; == !=</td><td style="text-align: center;">等于运算符</td></tr><tr class="even"><td style="text-align: center;">= %= /= //= -= += *= **=</td><td style="text-align: center;">赋值运算符</td></tr><tr class="odd"><td style="text-align: center;">is is not</td><td style="text-align: center;">身份运算符</td></tr><tr class="even"><td style="text-align: center;">in not in</td><td style="text-align: center;">成员运算符</td></tr><tr class="odd"><td style="text-align: center;">and or not</td><td style="text-align: center;">逻辑运算符</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>typeof class mode storage.mode 的区别</title>
      <link href="2019/05/31/typeof/"/>
      <url>2019/05/31/typeof/</url>
      
        <content type="html"><![CDATA[<h2 id="typeof-class-mode-storage.mode-的区别"><code>typeof</code> <code>class</code> <code>mode</code> <code>storage.mode</code> 的区别</h2><h3 id="class"><code>class</code></h3><p>根据 <code>class</code> 函数的帮助文档可知：</p><blockquote><p>R possesses a simple generic function mechanism which can be used for an object-oriented style of programming. Method dispatch takes place based on the class of the first argument to the generic function.</p></blockquote><p><code>class</code> 给出的是一个对象的抽象类型（也可以理解为对象的特定属性），主要针对的是R中的泛型函数，用于泛型函数的参数识别</p><blockquote><p>可以这样理解：R是一种基于对象(object)的语言，R中的所有内容都是对象，每个对象都有不同的属性（attribute），而对象最重要的属性是他们的类型（class），决定了对象在R中可以进行什么样的操作</p></blockquote><p>正常情况下，对于一般的R对象，如果没有类属性（class），那么它肯定有一个隐式的类属性（class），而隐式属性是类似于 <code>mode</code> 的结果</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">a &lt;- <span class="number">1</span> <span class="comment"># numeric</span></span><br><span class="line">class(a) <span class="comment"># 显示隐式类属性</span></span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;numeric&quot;</span></span><br><span class="line">attributes(a) <span class="comment"># attributes查看属性，不能看到隐式类属性</span></span><br><span class="line"><span class="literal">NULL</span></span><br><span class="line">a &lt;- structure(a, class = <span class="string">&quot;a&quot;</span>) <span class="comment"># 赋予显式类属性  </span></span><br><span class="line">class(a)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;a&quot;</span></span><br><span class="line">attributes(a) <span class="comment"># attributes查看属性，可以看到显式类属性</span></span><br><span class="line">$class</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;a&quot;</span></span><br></pre></td></tr></table></figure><p><strong>注意</strong>：<code>NULL</code> 对象是没有属性的，并且也不能对它赋予任何属性</p><blockquote><p><code>inherits</code> 函数用来判断对象是否具有某一类属性（class）</p></blockquote><h4 id="基本类型情况">基本类型情况</h4><ul><li>对于单个值或者向量，<code>class</code> 返回隐式属性（与 <code>mode</code> 结果一致）；如：numeric，character<br /></li><li>对于矩阵，数组，日期，因子，<code>class</code> 返回matrix，array，Date，factor<br /></li><li>对于数据框，<code>class</code> 返回data.frame<br /></li><li>对于列表，<code>class</code> 返回list</li></ul><h3 id="mode-storage.mode-typeof"><code>mode</code> <code>storage.mode</code> <code>typeof</code></h3><p><code>mode</code>、 <code>storage.mode</code>、 <code>typeof</code> 是同一类别的函数，它们识别的是<strong>对象在内存中的存储类型</strong>，即返回的是R中的<strong>基本数据类型</strong></p><blockquote><p>R中的基本数据类型："logical", "integer", "double", "complex", "raw","character", "list", "expression", "name", "symbol" 和 "function"</p></blockquote><p>对于 <code>mode</code>、 <code>storage.mode</code>、 <code>typeof</code> 三个函数来说，mode 是比较旧的版本，typeof 是更新的、也是更细的一种形式；三个函数检测的精细程度为：<code>mode</code> &gt; <code>storage.mode</code> &gt; <code>typeof</code></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mode(<span class="number">1</span>:<span class="number">5</span>) <span class="comment"># numeric</span></span><br><span class="line">storage.mode(<span class="number">1</span>:<span class="number">5</span>) <span class="comment"># integer</span></span><br><span class="line">typeof(<span class="number">1</span>:<span class="number">5</span>) <span class="comment"># integer</span></span><br><span class="line"></span><br><span class="line">mode(`+`) <span class="comment"># function</span></span><br><span class="line">storage.mode(`+`) <span class="comment"># function</span></span><br><span class="line">typeof(`+`) <span class="comment"># builtin</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>R语言高级程序设计</title>
      <link href="2019/05/27/advanceR/"/>
      <url>2019/05/27/advanceR/</url>
      
        <content type="html"><![CDATA[<h2 id="数据结构">数据结构</h2><p>R 语言的<strong>基础数据结构</strong>可以按照<strong>维度</strong>来划分(1 维、 2 维...n 维)；也可以按照它们<strong>所包含的数据类型是否相同</strong>来划分。 这样就产生了五种数据类型，它们是数据分析中最常用的：</p><table><thead><tr class="header"><th style="text-align: center;"></th><th style="text-align: center;">Homogeneous</th><th style="text-align: center;">Heterogeneous</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">1d</td><td style="text-align: center;">Atomic vector</td><td style="text-align: center;">List</td></tr><tr class="even"><td style="text-align: center;">2d</td><td style="text-align: center;">Matrix</td><td style="text-align: center;">Data frame</td></tr><tr class="odd"><td style="text-align: center;">nd</td><td style="text-align: center;">Array</td><td style="text-align: center;"></td></tr></tbody></table><h3 id="向量vector">向量（vector）</h3><p>向量包括：原子向量 （Atomic vector） 和列表 （List）。兩者都属于<strong>一维数据</strong>， 两者的区别在于： <strong>原子向量中的所有元素都必须是相同的类型；而列表中的元素可以是不同的类型</strong></p><blockquote><p><code>is.vector()</code>并不能测试一个对象是不是向量。 相反，仅当对象是除了名字以外，不包含其它属性时，它才返回 <code>TRUE</code>。 所以，请使用 <code>is.atomic(x) || is.list(x)</code> 来测试一个对象是不是向量。</p></blockquote><p>向量具有三个共同属性：</p><ol type="1"><li><strong>类型</strong>， <code>typeof()</code>，它是什么<br /></li><li><strong>长度</strong>， <code>length()</code>，它包含有多少元素<br /></li><li><strong>属性</strong>， <code>attributes()</code>，额外的任意元数据</li></ol><h4 id="原子向量-atomic-vector">原子向量 (Atomic vector)</h4><ul><li>原子向量类型：<strong>逻辑类型</strong> (logical)、 <strong>整数类型</strong> (integer)、 <strong>双精度数值类型</strong> (double)、 <strong>字符类型</strong> (character)、 复数类型 (complex)、 raw类型。<br /></li><li>缺失值用 <code>NA</code> 表示，是一个长度为1的逻辑向量，NA可根据所处整体环境强制转换成正确的类型，或者使用 <code>NA_real_</code>(双精度浮点数向量)、 <code>NA_integer_</code> 和 <code>NA_character_</code> 来创建一系列确定类型的 <code>NA</code><br /></li><li><code>typeof</code> 确定具体的数据类型，<code>is</code>开头的函数（如：<code>is.integer</code>）来确定是否属于某一特定类型<br /></li><li><code>is.atomic()</code> 是检测原子向量最通用的<br /></li><li>强制转换：一个原子向量中的所有元素都必须是相同的类型。 所以，当你试图合并不同类型的数据时，将向最灵活的类型进行强制转换。 以灵活程度排序，从小到大依次为：逻辑、 整数、双精度浮点数和字符。<br /></li><li>如果转换遇到歧义，则需要使用 <code>as.character()</code>、 <code>as.double()</code>、 <code>as.integer()</code>或者 <code>as.logical()</code>等函数，进行明确的强制转换。</li></ul><h4 id="列表list">列表(List)</h4><p>c()可以将几个向量合并成一个。 如果原子向量和列表同时存在，那么在合并之前， c()会将原子向量强制转换成列表</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">x &lt;- list(list(<span class="number">1</span>, <span class="number">2</span>), c(<span class="number">3</span>, <span class="number">4</span>))</span><br><span class="line">y &lt;- c(list(<span class="number">1</span>, <span class="number">2</span>), c(<span class="number">3</span>, <span class="number">4</span>))</span><br><span class="line">str(x)</span><br><span class="line"><span class="comment">#&gt; List of 2</span></span><br><span class="line"><span class="comment">#&gt; $ :List of 2</span></span><br><span class="line"><span class="comment">#&gt; ..$ : num 1</span></span><br><span class="line"><span class="comment">#&gt; ..$ : num 2</span></span><br><span class="line"><span class="comment">#&gt; $ : num [1:2] 3 4</span></span><br><span class="line">str(y)</span><br><span class="line"><span class="comment">#&gt; List of 4</span></span><br><span class="line"><span class="comment">#&gt; $ : num 1</span></span><br><span class="line"><span class="comment">#&gt; $ : num 2</span></span><br><span class="line"><span class="comment">#&gt; $ : num 3</span></span><br><span class="line"><span class="comment">#&gt; $ : num 4</span></span><br></pre></td></tr></table></figure><p>列表用来建立 R 语言中的许多更加复杂的数据结构。 比如， <strong>数据框</strong>和其他复杂对象</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">is.list(mtcars)</span><br><span class="line"><span class="comment">#&gt; [1] TRUE</span></span><br></pre></td></tr></table></figure><blockquote><p>这里说明一点：data.frame是比list更为复杂的数据结构</p></blockquote><h3 id="属性attributes">属性(Attributes)</h3><p>所有的对象都可以拥有任意多个附加属性， 附加属性用来存取与该对象相关的元数据。 属性可以看做是已命名的列表(带有不重复的名字)。 属性可以使用 <code>attr()</code>函数一个一个的访问，也可以使用 attributes()函数一次性访问。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">y &lt;- <span class="number">1</span>:<span class="number">10</span></span><br><span class="line">attr(y, <span class="string">&quot;my_attribute&quot;</span>) &lt;- <span class="string">&quot;This is a vector&quot;</span></span><br><span class="line">attr(y, <span class="string">&quot;alpha&quot;</span>) &lt;- <span class="string">&quot;This is a vector&quot;</span></span><br><span class="line">attr(y, <span class="string">&quot;my_attribute&quot;</span>)</span><br><span class="line"><span class="comment">#&gt; [1] &quot;This is a vector&quot;</span></span><br><span class="line">attributes(y)</span><br><span class="line"><span class="comment">#&gt; $my_attribute</span></span><br><span class="line"><span class="comment">#&gt; [1] &quot;This is a vector&quot;</span></span><br><span class="line"><span class="comment">#&gt; </span></span><br><span class="line"><span class="comment">#&gt; $alpha</span></span><br><span class="line"><span class="comment">#&gt; [1] &quot;This is a vector&quot;</span></span><br><span class="line">attr(y, <span class="string">&quot;my_attribute&quot;</span>) &lt;- <span class="string">&quot;alpha&quot;</span></span><br><span class="line">attributes(y)</span><br><span class="line"><span class="comment">#&gt; $my_attribute</span></span><br><span class="line"><span class="comment">#&gt; [1] &quot;alpha&quot;</span></span><br><span class="line"><span class="comment">#&gt; </span></span><br><span class="line"><span class="comment">#&gt; $alpha</span></span><br><span class="line"><span class="comment">#&gt; [1] &quot;This is a vector&quot;</span></span><br></pre></td></tr></table></figure><p><code>structure()</code> 函数返回一个带有属性的对象， 也可以用来修改属性</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">structure(y, alpha = <span class="string">&quot;alpha&quot;</span>)</span><br><span class="line"><span class="comment">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10</span></span><br><span class="line"><span class="comment">#&gt; attr(,&quot;my_attribute&quot;)</span></span><br><span class="line"><span class="comment">#&gt; [1] &quot;alpha&quot;</span></span><br><span class="line"><span class="comment">#&gt; attr(,&quot;alpha&quot;)</span></span><br><span class="line"><span class="comment">#&gt; [1] &quot;alpha&quot;</span></span><br></pre></td></tr></table></figure><p>默认情况下，当修改向量时，数据的大多数属性会丢失，但有三种重要的属性不会丢失：<strong>名字</strong>(name)，<strong>维度</strong>(dimension)，<strong>类</strong>(class)</p><blockquote><p>三个特殊属性需要使用特定函数<code>names(x)</code>、 <code>class(x)</code>和 <code>dim(x)</code> 访问，而不是 <code>attr(x, "names")</code>、 <code>attr(x, "class")</code> 和 <code>attr(x, "dim")</code></p></blockquote><h3 id="数据框data-frame">数据框(data frame)</h3><p>数据框是<strong>由等长向量构成的列表</strong>。 它也是二维结构，所以它具有<strong>矩阵</strong>和<strong>列表</strong>双重属性。也就是说，数据框拥有 <code>names()</code>、 <code>colnames()</code>和 <code>rownames()</code>，尽管 <code>names()</code>和 <code>colnames()</code>对数据框来说是一样的。 数据框的 <code>length()</code>是列表的长度，所以和 <code>ncol()</code>相同； <code>nrow()</code>则得到行数。</p><p>由于数据框是一个包含向量的列表，所以数据框的某个是列表类型是有可能的：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">df &lt;- data.frame(x = <span class="number">1</span>:<span class="number">3</span>)</span><br><span class="line">df$y &lt;- list(<span class="number">1</span>:<span class="number">2</span>, <span class="number">1</span>:<span class="number">3</span>, <span class="number">1</span>:<span class="number">4</span>)</span><br><span class="line">df</span><br><span class="line"><span class="comment">#&gt; x y</span></span><br><span class="line"><span class="comment">#&gt; 1 1 1, 2</span></span><br><span class="line"><span class="comment">#&gt; 2 2 1, 2, 3</span></span><br><span class="line"><span class="comment">#&gt; 3 3 1, 2, 3, 4</span></span><br></pre></td></tr></table></figure><blockquote><p>当把列表传入 <code>data.frame()</code>函数时，该函数将试图把列表的每一个元素都放到单独的一列中。一种绕开的方法是使用 <code>I()</code>函数，它使得 <code>data.frame()</code>把列表看成一个整体单元</p></blockquote><h3 id="r中的对象">R中的对象</h3><h4 id="s3对象">S3对象</h4><p>S3 对象是由原子向量、数组和列表组成的，所以你可以使用上面描述的技术对 S3 对象进行取子集操作。 你可以通过 <code>str()</code>函数获得的它们的结构信息。</p><h4 id="s4对象">S4对象</h4><p>对 S4 对象来说，有另外两种取子集操作符: <code>@</code>(相当于<code>$</code>)和 <code>slot()</code>(相当于<code>[[</code>)。 <code>@</code>比<code>$</code>更加严格，如果槽(slot)不存在，那么它会返回错误。</p><hr /><p><a href="http://adv-r.had.co.nz/">Advanced R</a></p>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>R并行运算</title>
      <link href="2019/05/14/parallel/"/>
      <url>2019/05/14/parallel/</url>
      
        <content type="html"><![CDATA[<h2 id="r的并行运算">R的并行运算</h2><p>R作为主要流行的统计分析软件之一，其处理数据一般都是单线程的。随着数据量的增大，R运行的时间会大大增加；为了充分发挥计算机的性能和进一步提升R运行速度，使用并行运算不失为一种有效的手段。</p><p>简单的说R的并行化计算其实没有改变其整个并行环境，而是先启动N个附属进程，然后将数据分割成N块在N个核上进行运行，等待附属进程结束返回结果。与单线程运算相比，会大大节省运算时间</p><h3 id="parallel">parallel</h3><p>R内置了parallel包（R version &gt; 2.14），强化了R的并行计算能力。parallel包的思路和lapply函数很相似，都是将输入数据分割、计算、整合结果。只不过并行计算是用到了不同的cpu内核来运算。两个核心的函数为<code>mclapply</code>和<code>parlapply</code>。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## lapply</span></span><br><span class="line">system.time(&#123;</span><br><span class="line">res &lt;- lapply(<span class="number">1</span>:<span class="number">5000000</span>, <span class="keyword">function</span>(x) x+<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">user  system elapsed</span><br><span class="line"><span class="number">21.42</span>    <span class="number">1.74</span>   <span class="number">25.70</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## parlapply</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># load parallel</span></span><br><span class="line"><span class="keyword">library</span>(parallel)</span><br><span class="line"></span><br><span class="line"><span class="comment"># check numrber of cores</span></span><br><span class="line">clnum&lt;-detectCores() </span><br><span class="line"></span><br><span class="line"><span class="comment">#设置参与并行的CPU核数目</span></span><br><span class="line">cl &lt;- makeCluster(getOption(<span class="string">&quot;cl.cores&quot;</span>, clnum));</span><br><span class="line"></span><br><span class="line"><span class="comment">#运行</span></span><br><span class="line">system.time(&#123;</span><br><span class="line">res &lt;- parLapply(cl, <span class="number">1</span>:<span class="number">5000000</span>,  <span class="keyword">function</span>(x) x + <span class="number">1</span>)</span><br><span class="line">&#125;);</span><br><span class="line">user system elapsed</span><br><span class="line"><span class="number">6.54</span> <span class="number">0.34</span> <span class="number">19.95</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭并行计算</span></span><br><span class="line">stopCluster(cl);</span><br><span class="line"></span><br><span class="line"><span class="comment">## mclapply ==&gt; mclapply适用于类Unix系统的操作</span></span><br><span class="line">mc &lt;- getOption(<span class="string">&quot;mc.cores&quot;</span>, <span class="number">3</span>)</span><br><span class="line">system.time(&#123;</span><br><span class="line">res &lt;- mclapply(<span class="number">1</span>:<span class="number">5000000</span>, <span class="keyword">function</span>(x)&#123;x+<span class="number">1</span>&#125;, mc.cores = mc);</span><br><span class="line">&#125;);</span><br><span class="line">user system elapsed</span><br><span class="line"><span class="number">6.657</span> <span class="number">0.500</span> <span class="number">7.181</span></span><br></pre></td></tr></table></figure><h3 id="furrr">furrr</h3><p><code>furrr</code>是<code>future</code>和<code>purrr</code>包的结合，提供了一系列的并行操作适用于<code>*map</code>家族函数</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(furrr)</span><br><span class="line"><span class="keyword">library</span>(tictoc)</span><br><span class="line"></span><br><span class="line"><span class="comment"># This should take 6 seconds in total running sequentially</span></span><br><span class="line">plan(sequential)</span><br><span class="line">tic()</span><br><span class="line">nothingness &lt;- future_map(c(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>), ~Sys.sleep(.x))</span><br><span class="line">toc()</span><br><span class="line"><span class="comment">#&gt; 6.08 sec elapsed</span></span><br><span class="line"><span class="comment"># This should take ~2 seconds running in parallel, with a little overhead</span></span><br><span class="line">plan(multiprocess)</span><br><span class="line">tic()</span><br><span class="line">nothingness &lt;- future_map(c(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>), ~Sys.sleep(.x))</span><br><span class="line">toc()</span><br><span class="line"><span class="comment">#&gt; 2.212 sec elapsed</span></span><br></pre></td></tr></table></figure><p>与<code>parallel</code>相比更喜欢<code>furrr</code>的傻瓜式操作，且其与其他R包的交互使用更为方便。</p><h3 id="其他">其他</h3><p>其他一些并行相关的R包：<br /><a href="https://github.com/HenrikBengtsson/future">future</a> : 强大的分布式处理并行包<br /><a href="https://github.com/HenrikBengtsson/future.apply">future.apply</a> : 基于<code>future</code>包开发的<code>*apply</code>家族函数并行包</p>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>purrr实现函数式编程的迭代</title>
      <link href="2019/04/07/purrr/"/>
      <url>2019/04/07/purrr/</url>
      
        <content type="html"><![CDATA[<h2 id="purrr">purrr</h2><p>purrr包是Hadley Wickham大神编写的高级函数编程语言包，它提供了大量的类map函数，使用函数式编程的思想，致力于减少R中的循环操作</p><h2 id="map族函数">map族函数</h2><h3 id="单参数计算">单参数计算</h3><p>map族函数输入的数据类型是向量，函数将向量中的每一个元素带入运算，返回的也是一个具有同样长度、同样变量名的向量，返回的向量类型由函数的后缀决定。</p><blockquote><p>map() # 返回一个列表（list）<br />map_lgl() # 返回一个逻辑型向量<br />map_int() # 返回一个整数型向量<br />map_dbl() # 返回双精度数值向量<br />map_chr() # 返回字符串向量<br />map_dfc() # 返回数据框（column bind）<br />map_dfr() # 返回数据框（row bind）</p></blockquote><h3 id="多参数计算">多参数计算</h3><p><code>purrr</code>中的<code>map</code>族函数提供了较<code>apply</code>族函数更为友好的数据输入形式，便于进行多参数操作</p><blockquote><p>map() # Apply a function to each element (类似于apply的操作)<br />map2() # Apply a function to pairs of elements (这个是2个输入参数的函数)<br />pmap() # Apply a function to groups of elements (多参数形式)<br />lmap() # Apply function to each list-element of a list or vector (类似于lapply)<br />imap() # Apply .f to each element of a list or vector and its index. (对索引和内容同时操作)<br />invoke_map() # Run each function in a list (每个元素使用不同的函数)</p></blockquote><p>这些函数使用的示意图如下所示：</p><figure><img src="/images/purrr/purrr_1.png" alt="purrr1" /><figcaption aria-hidden="true">purrr1</figcaption></figure><h2 id="walk族函数">walk族函数</h2><p>当我们使用函数的目的是向屏幕提供输出或将文件保存到磁盘——重要的是操作过程而不是返回值，我们应该使用游走函数，而不是map函数。</p><p>比如：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">x = list(<span class="number">1</span>, <span class="string">&quot;a&quot;</span>, <span class="number">3</span>)</span><br><span class="line">x %&gt;% </span><br><span class="line">    walk(print)</span><br><span class="line"><span class="comment">#&gt; [1] 1</span></span><br><span class="line"><span class="comment">#&gt; [1] &quot;a&quot;</span></span><br><span class="line"><span class="comment">#&gt; [1] 3</span></span><br></pre></td></tr></table></figure><p>一般来说，<code>walk()</code>函数不如<code>walk2()</code>和<code>pwalk()</code>实用。例如有一个图形列表和一个文件名向量，那么我们就可以使用<code>pwalk()</code>将每个文件保存到相应的磁盘位置：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(ggplot2)</span><br><span class="line">plots = mtcars %&gt;% </span><br><span class="line">    split(.$cyl) %&gt;% </span><br><span class="line">    map(~ggplot(., aes(mpg, wt)) + geom_point())</span><br><span class="line">paths = stringr::str_c(names(plots), <span class="string">&quot;.pdf&quot;</span>)</span><br><span class="line">pwalk(list(paths, plots), ggsave, path = tempdir())</span><br><span class="line"><span class="comment">#&gt; Saving 7 x 5 in image</span></span><br><span class="line"><span class="comment">#&gt; Saving 7 x 5 in image</span></span><br><span class="line"><span class="comment">#&gt; Saving 7 x 5 in image</span></span><br></pre></td></tr></table></figure><h2 id="list的处理操作">list的处理操作</h2><h3 id="filter-lists">FILTER LISTS</h3><h4 id="pluck和chuck"><strong><code>pluck</code>和<code>chuck</code></strong></h4><p><code>pluck</code>和<code>chuck</code>可以代替繁琐的<code>[[]]</code>操作，使list元素的选取更加简洁</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">&gt; obj1 &lt;- list(<span class="string">&quot;a&quot;</span>, list(<span class="number">1</span>, elt = <span class="string">&quot;foo&quot;</span>))</span><br><span class="line">&gt; obj2 &lt;- list(<span class="string">&quot;b&quot;</span>, list(<span class="number">2</span>, elt = <span class="string">&quot;bar&quot;</span>))</span><br><span class="line">&gt; x &lt;- list(obj1, obj2)</span><br><span class="line">&gt; x</span><br><span class="line">[[<span class="number">1</span>]]</span><br><span class="line">[[<span class="number">1</span>]][[<span class="number">1</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;a&quot;</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">1</span>]][[<span class="number">2</span>]]</span><br><span class="line">[[<span class="number">1</span>]][[<span class="number">2</span>]][[<span class="number">1</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">1</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">1</span>]][[<span class="number">2</span>]]$elt</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;foo&quot;</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span>]]</span><br><span class="line">[[<span class="number">2</span>]][[<span class="number">1</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;b&quot;</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span>]][[<span class="number">2</span>]]</span><br><span class="line">[[<span class="number">2</span>]][[<span class="number">2</span>]][[<span class="number">1</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">2</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span>]][[<span class="number">2</span>]]$elt</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;bar&quot;</span></span><br><span class="line">&gt; pluck(x, <span class="number">1</span>)</span><br><span class="line">[[<span class="number">1</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;a&quot;</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span>]]</span><br><span class="line">[[<span class="number">2</span>]][[<span class="number">1</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">1</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span>]]$elt</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;foo&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; pluck(x, <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">[[<span class="number">1</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">1</span></span><br><span class="line"></span><br><span class="line">$elt</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;foo&quot;</span></span><br><span class="line"></span><br><span class="line">&gt; pluck(x, <span class="number">1</span>, <span class="number">2</span>, <span class="string">&quot;elt&quot;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;foo&quot;</span></span><br><span class="line">&gt; chuck(x, <span class="number">1</span>)</span><br><span class="line">[[<span class="number">1</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;a&quot;</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span>]]</span><br><span class="line">[[<span class="number">2</span>]][[<span class="number">1</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">1</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span>]]$elt</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;foo&quot;</span></span><br><span class="line">&gt; chuck(x, <span class="number">1</span>)</span><br><span class="line">[[<span class="number">1</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;a&quot;</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span>]]</span><br><span class="line">[[<span class="number">2</span>]][[<span class="number">1</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">1</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span>]]$elt</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;foo&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>pluck和chuck的区别：当选取的元素不存在时，pluck返回NULL，而chuck会报错</p></blockquote><h4 id="条件选取"><strong>条件选取</strong></h4><p><code>keep</code>函数选取符合某一条件的元素<br /><code>discard</code>函数相反，选取不符合某一条件的元素<br /><code>compact</code>函数则去掉所有为空的元素</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&gt; x &lt;- list(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>) %&gt;% keep(<span class="keyword">function</span>(x)(x&gt;<span class="number">2</span>))</span><br><span class="line">&gt; x</span><br><span class="line">[[<span class="number">1</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">3</span></span><br><span class="line">&gt; x &lt;- list(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>) %&gt;% discard(<span class="keyword">function</span>(x)(x&gt;<span class="number">2</span>))</span><br><span class="line">&gt; x</span><br><span class="line">[[<span class="number">1</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">1</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">2</span></span><br><span class="line">&gt; x &lt;- list(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="literal">NULL</span>) %&gt;% compact()</span><br><span class="line">&gt; x</span><br><span class="line">[[<span class="number">1</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">1</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">2</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">3</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">3</span></span><br></pre></td></tr></table></figure><h4 id="head_while和tail_while"><strong><code>head_while</code>和<code>tail_while</code></strong></h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; pos &lt;- <span class="keyword">function</span>(x) x &gt;= <span class="number">0</span></span><br><span class="line">&gt; head_while(<span class="number">5</span>:-<span class="number">5</span>, pos)</span><br><span class="line">[<span class="number">1</span>] <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span> <span class="number">0</span></span><br><span class="line">&gt; pos &lt;- <span class="keyword">function</span>(x) x &lt; <span class="number">0</span></span><br><span class="line">&gt; tail_while(<span class="number">5</span>:-<span class="number">5</span>, pos)</span><br><span class="line">[<span class="number">1</span>] -<span class="number">1</span> -<span class="number">2</span> -<span class="number">3</span> -<span class="number">4</span> -<span class="number">5</span></span><br></pre></td></tr></table></figure><h3 id="summarise-lists">SUMMARISE LISTS</h3><h4 id="every和some"><code>every</code>和<code>some</code></h4><p>判断元素是否满足条件</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; y &lt;- list(<span class="number">0</span>:<span class="number">10</span>, <span class="number">5.5</span>)</span><br><span class="line">&gt; y %&gt;% every(is.numeric)</span><br><span class="line">[<span class="number">1</span>] <span class="literal">TRUE</span></span><br><span class="line">&gt; y %&gt;% every(is.integer)</span><br><span class="line">[<span class="number">1</span>] <span class="literal">FALSE</span></span><br><span class="line">&gt; y %&gt;% some(is.integer)</span><br><span class="line">[<span class="number">1</span>] <span class="literal">TRUE</span></span><br></pre></td></tr></table></figure><h4 id="has_element"><code>has_element</code></h4><p>判断是否包含某一对象</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; x &lt;- list(<span class="number">1</span>:<span class="number">10</span>, <span class="number">5</span>, <span class="number">9.9</span>)</span><br><span class="line">&gt; x %&gt;% has_element(<span class="number">1</span>:<span class="number">10</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="literal">TRUE</span></span><br><span class="line">&gt; x %&gt;% has_element(<span class="number">3</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="literal">FALSE</span></span><br></pre></td></tr></table></figure><h4 id="detect和detect_index"><code>detect</code>和<code>detect_index</code></h4><p>寻找匹配的第一个元素</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; is_even &lt;- <span class="keyword">function</span>(x) x %% <span class="number">2</span> == <span class="number">0</span></span><br><span class="line">&gt; <span class="number">3</span>:<span class="number">10</span> %&gt;% detect(is_even)</span><br><span class="line">[<span class="number">1</span>] <span class="number">4</span></span><br><span class="line">&gt; <span class="number">3</span>:<span class="number">10</span> %&gt;% detect_index(is_even)</span><br><span class="line">[<span class="number">1</span>] <span class="number">2</span></span><br></pre></td></tr></table></figure><h4 id="vec_depth"><code>vec_depth</code></h4><p>计算list的深度</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; x &lt;- list(</span><br><span class="line">+     list(),</span><br><span class="line">+     list(list()),</span><br><span class="line">+     list(list(list(<span class="number">1</span>)))</span><br><span class="line">+ )</span><br><span class="line">&gt; vec_depth(x)</span><br><span class="line">[<span class="number">1</span>] <span class="number">5</span></span><br><span class="line">&gt; x %&gt;% map_int(vec_depth)</span><br><span class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">2</span> <span class="number">4</span></span><br></pre></td></tr></table></figure><h3 id="transform-lists">TRANSFORM LISTS</h3><h4 id="modify"><code>modify</code></h4><p><code>modify</code>同样也是对列表或者向量中的元素进行函数运算，但是与<code>map</code>家族函数相比存在一些区别：</p><blockquote><p>map家族函数往往返回一个特定类型的对象（数值，逻辑）<br />modify函数返回的对象与输入对象的类型相一致<br />也就是说，modify是“真正”的对输入对象进行计算操作</p></blockquote><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; iris %&gt;%</span><br><span class="line">    modify_if(is.factor, as.character) %&gt;%</span><br><span class="line">    str()</span><br><span class="line"><span class="string">&#x27;data.frame&#x27;</span>:<span class="number">150</span> obs. of  <span class="number">5</span> variables:</span><br><span class="line"> $ Sepal.Length: num  <span class="number">5.1</span> <span class="number">4.9</span> <span class="number">4.7</span> <span class="number">4.6</span> <span class="number">5</span> <span class="number">5.4</span> <span class="number">4.6</span> <span class="number">5</span> <span class="number">4.4</span> <span class="number">4.9</span> <span class="keyword">...</span></span><br><span class="line"> $ Sepal.Width : num  <span class="number">3.5</span> <span class="number">3</span> <span class="number">3.2</span> <span class="number">3.1</span> <span class="number">3.6</span> <span class="number">3.9</span> <span class="number">3.4</span> <span class="number">3.4</span> <span class="number">2.9</span> <span class="number">3.1</span> <span class="keyword">...</span></span><br><span class="line"> $ Petal.Length: num  <span class="number">1.4</span> <span class="number">1.4</span> <span class="number">1.3</span> <span class="number">1.5</span> <span class="number">1.4</span> <span class="number">1.7</span> <span class="number">1.4</span> <span class="number">1.5</span> <span class="number">1.4</span> <span class="number">1.5</span> <span class="keyword">...</span></span><br><span class="line"> $ Petal.Width : num  <span class="number">0.2</span> <span class="number">0.2</span> <span class="number">0.2</span> <span class="number">0.2</span> <span class="number">0.2</span> <span class="number">0.4</span> <span class="number">0.3</span> <span class="number">0.2</span> <span class="number">0.2</span> <span class="number">0.1</span> <span class="keyword">...</span></span><br><span class="line"> $ Species     : chr  <span class="string">&quot;setosa&quot;</span> <span class="string">&quot;setosa&quot;</span> <span class="string">&quot;setosa&quot;</span> <span class="string">&quot;setosa&quot;</span> <span class="keyword">...</span></span><br></pre></td></tr></table></figure><p><code>modify</code>函数的变形与map家族函数的使用是类似的</p><h3 id="reshape-lists">RESHAPE LISTS</h3><h4 id="flatten"><code>flatten</code></h4><p>去除list的一层层级关系，相当于将list压缩扁平化，但是得到的对象的类型是稳定可预测的（可以自己设置结果的类型）</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&gt; x &lt;- rerun(<span class="number">2</span>, sample(<span class="number">3</span>))</span><br><span class="line">&gt; x</span><br><span class="line">[[<span class="number">1</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">2</span> <span class="number">1</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">3</span> <span class="number">1</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line">&gt; x %&gt;% flatten()</span><br><span class="line">[[<span class="number">1</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">2</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">1</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">3</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">3</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">4</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">3</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">5</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">1</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">6</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">2</span></span><br><span class="line"></span><br><span class="line">&gt; x %&gt;% flatten_int()</span><br><span class="line">[<span class="number">1</span>] <span class="number">2</span> <span class="number">1</span> <span class="number">3</span> <span class="number">3</span> <span class="number">1</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><h4 id="transpose"><code>transpose</code></h4><p>置换列表的索引顺序，其实就是将二级索引和一级索引的层级调换</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&gt; x &lt;- rerun(<span class="number">3</span>, x = runif(<span class="number">1</span>), y = runif(<span class="number">3</span>))</span><br><span class="line">&gt; x</span><br><span class="line">[[<span class="number">1</span>]]</span><br><span class="line">[[<span class="number">1</span>]]$x</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.9489699</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">1</span>]]$y</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.09894665</span> <span class="number">0.34629673</span> <span class="number">0.61291285</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span>]]</span><br><span class="line">[[<span class="number">2</span>]]$x</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.9344982</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span>]]$y</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.2195651</span> <span class="number">0.5119154</span> <span class="number">0.9527276</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[[<span class="number">3</span>]]</span><br><span class="line">[[<span class="number">3</span>]]$x</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.730148</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">3</span>]]$y</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.3331638</span> <span class="number">0.9099907</span> <span class="number">0.4129223</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; transpose(x)</span><br><span class="line">$x</span><br><span class="line">$x[[<span class="number">1</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.9489699</span></span><br><span class="line"></span><br><span class="line">$x[[<span class="number">2</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.9344982</span></span><br><span class="line"></span><br><span class="line">$x[[<span class="number">3</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.730148</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$y</span><br><span class="line">$y[[<span class="number">1</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.09894665</span> <span class="number">0.34629673</span> <span class="number">0.61291285</span></span><br><span class="line"></span><br><span class="line">$y[[<span class="number">2</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.2195651</span> <span class="number">0.5119154</span> <span class="number">0.9527276</span></span><br><span class="line"></span><br><span class="line">$y[[<span class="number">3</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.3331638</span> <span class="number">0.9099907</span> <span class="number">0.4129223</span></span><br></pre></td></tr></table></figure><h3 id="join-to-lists">JOIN (TO) LISTS</h3><h4 id="prepend"><code>prepend</code></h4><p>同<code>append</code>、<code>splice</code>函数共同实现list的合并</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&gt; x &lt;- as.list(<span class="number">1</span>:<span class="number">2</span>)</span><br><span class="line">&gt; x %&gt;% append(<span class="string">&quot;a&quot;</span>)</span><br><span class="line">[[<span class="number">1</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">1</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">2</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">3</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;a&quot;</span></span><br><span class="line"></span><br><span class="line">&gt; x %&gt;% prepend(<span class="string">&quot;a&quot;</span>)</span><br><span class="line">[[<span class="number">1</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;a&quot;</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">1</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">3</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">2</span></span><br><span class="line"></span><br><span class="line">&gt; x %&gt;% prepend(list(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>), before = <span class="number">2</span>)</span><br><span class="line">[[<span class="number">1</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">1</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;a&quot;</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">3</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;b&quot;</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">4</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">2</span></span><br><span class="line">&gt; splice(x, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>)</span><br><span class="line">[[<span class="number">1</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">1</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">2</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">3</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;a&quot;</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">4</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;b&quot;</span></span><br></pre></td></tr></table></figure><h3 id="work-with-lists">WORK WITH LISTS</h3><h4 id="array_branch和array_tree"><code>array_branch</code>和<code>array_tree</code></h4><p>这两个函数的用法相同，会强制把数组转化成list</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">x &lt;- array(<span class="number">1</span>:<span class="number">12</span>, c(<span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>))</span><br><span class="line">&gt; array_branch(x, <span class="number">2</span>)</span><br><span class="line">[[<span class="number">1</span>]]</span><br><span class="line">     [,<span class="number">1</span>] [,<span class="number">2</span>] [,<span class="number">3</span>]</span><br><span class="line">[<span class="number">1</span>,]    <span class="number">1</span>    <span class="number">5</span>    <span class="number">9</span></span><br><span class="line">[<span class="number">2</span>,]    <span class="number">2</span>    <span class="number">6</span>   <span class="number">10</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span>]]</span><br><span class="line">     [,<span class="number">1</span>] [,<span class="number">2</span>] [,<span class="number">3</span>]</span><br><span class="line">[<span class="number">1</span>,]    <span class="number">3</span>    <span class="number">7</span>   <span class="number">11</span></span><br><span class="line">[<span class="number">2</span>,]    <span class="number">4</span>    <span class="number">8</span>   <span class="number">12</span></span><br><span class="line"></span><br><span class="line">&gt; array_branch(x, <span class="number">3</span>)</span><br><span class="line">[[<span class="number">1</span>]]</span><br><span class="line">     [,<span class="number">1</span>] [,<span class="number">2</span>]</span><br><span class="line">[<span class="number">1</span>,]    <span class="number">1</span>    <span class="number">3</span></span><br><span class="line">[<span class="number">2</span>,]    <span class="number">2</span>    <span class="number">4</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span>]]</span><br><span class="line">     [,<span class="number">1</span>] [,<span class="number">2</span>]</span><br><span class="line">[<span class="number">1</span>,]    <span class="number">5</span>    <span class="number">7</span></span><br><span class="line">[<span class="number">2</span>,]    <span class="number">6</span>    <span class="number">8</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">3</span>]]</span><br><span class="line">     [,<span class="number">1</span>] [,<span class="number">2</span>]</span><br><span class="line">[<span class="number">1</span>,]    <span class="number">9</span>   <span class="number">11</span></span><br><span class="line">[<span class="number">2</span>,]   <span class="number">10</span>   <span class="number">12</span></span><br></pre></td></tr></table></figure><h2 id="总结">总结</h2><p><code>purrr</code>包作为tidyverse的核心R包之一，提供了一些更加强大的编程工具，优化函数式编程的操作，对于数据分析的高效快速处理是十分重要的。</p><figure><img src="/images/purrr/purrr_2.png" alt="purrr2" /><figcaption aria-hidden="true">purrr2</figcaption></figure><figure><img src="/images/purrr/purrr_3.png" alt="purrr3" /><figcaption aria-hidden="true">purrr3</figcaption></figure>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
            <tag> tidyverse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tidyr学习笔记</title>
      <link href="2019/04/04/tidyr/"/>
      <url>2019/04/04/tidyr/</url>
      
        <content type="html"><![CDATA[<h2 id="tidyr包进阶版reshape2">tidyr包：进阶版reshape2</h2><h3 id="tidyr包">tidyr包</h3><p>tidyr是reshape2的进阶版本，它提供了更加定制化的数据整洁功能，用于数据的合并、拆分以及长宽格式的转化</p><p>主要涉及的操作：</p><ol type="1"><li>缺失值的补充<br /></li><li>长形表变宽形表，宽形表变长形表<ul><li>gather-把宽度较大的数据转换成一个更长的形式，它类比于从reshape2包中melt函数的功能<br /></li><li>spread-把长的数据转换成一个更宽的形式，它类比于从reshape2包中cast函数的功能<br /></li></ul></li><li>列分割与列合并<ul><li>separate－将一列按分隔符分割为多列<br /></li><li>unite－将多列按指定分隔符合并为一列</li></ul></li></ol><h3 id="常见用法">常见用法</h3><h4 id="数据准备">数据准备</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">library</span>(tidyr)</span><br><span class="line">&gt; <span class="keyword">library</span>(tibble)</span><br><span class="line">&gt; mtcars &lt;- rownames_to_column(mtcars, var =<span class="string">&#x27;car&#x27;</span>)</span><br><span class="line">&gt; head(mtcars)</span><br><span class="line">                car  mpg cyl disp  hp drat    wt  qsec vs am gear carb</span><br><span class="line"><span class="number">1</span>         Mazda RX4 <span class="number">21.0</span>   <span class="number">6</span>  <span class="number">160</span> <span class="number">110</span> <span class="number">3.90</span> <span class="number">2.620</span> <span class="number">16.46</span>  <span class="number">0</span>  <span class="number">1</span>    <span class="number">4</span>    <span class="number">4</span></span><br><span class="line"><span class="number">2</span>     Mazda RX4 Wag <span class="number">21.0</span>   <span class="number">6</span>  <span class="number">160</span> <span class="number">110</span> <span class="number">3.90</span> <span class="number">2.875</span> <span class="number">17.02</span>  <span class="number">0</span>  <span class="number">1</span>    <span class="number">4</span>    <span class="number">4</span></span><br><span class="line"><span class="number">3</span>        Datsun <span class="number">710</span> <span class="number">22.8</span>   <span class="number">4</span>  <span class="number">108</span>  <span class="number">93</span> <span class="number">3.85</span> <span class="number">2.320</span> <span class="number">18.61</span>  <span class="number">1</span>  <span class="number">1</span>    <span class="number">4</span>    <span class="number">1</span></span><br><span class="line"><span class="number">4</span>    Hornet <span class="number">4</span> Drive <span class="number">21.4</span>   <span class="number">6</span>  <span class="number">258</span> <span class="number">110</span> <span class="number">3.08</span> <span class="number">3.215</span> <span class="number">19.44</span>  <span class="number">1</span>  <span class="number">0</span>    <span class="number">3</span>    <span class="number">1</span></span><br><span class="line"><span class="number">5</span> Hornet Sportabout <span class="number">18.7</span>   <span class="number">8</span>  <span class="number">360</span> <span class="number">175</span> <span class="number">3.15</span> <span class="number">3.440</span> <span class="number">17.02</span>  <span class="number">0</span>  <span class="number">0</span>    <span class="number">3</span>    <span class="number">2</span></span><br><span class="line"><span class="number">6</span>           Valiant <span class="number">18.1</span>   <span class="number">6</span>  <span class="number">225</span> <span class="number">105</span> <span class="number">2.76</span> <span class="number">3.460</span> <span class="number">20.22</span>  <span class="number">1</span>  <span class="number">0</span>    <span class="number">3</span>    <span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="数据重构reshape-data">数据重构（Reshape Data）</h4><h5 id="gather--宽数据转为长数据">gather--宽数据转为长数据</h5><blockquote><p>gather(data, key, value, …, na.rm = FALSE, convert = FALSE) data：需要被转换的宽形表 key：将原数据框中的所有列赋给一个新变量key value：将原数据框中的所有值赋给一个新变量value …：可以指定哪些列聚到同一列中 na.rm：是否删除缺失值</p></blockquote><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; mtcarsNew &lt;- gather(mtcars, attribute, value, -car) <span class="comment"># 除了car列外，其余列聚合成两列，分别命名为attribute和value</span></span><br><span class="line">&gt; head(mtcarsNew)</span><br><span class="line">                car attribute value</span><br><span class="line"><span class="number">1</span>         Mazda RX4       mpg  <span class="number">21.0</span></span><br><span class="line"><span class="number">2</span>     Mazda RX4 Wag       mpg  <span class="number">21.0</span></span><br><span class="line"><span class="number">3</span>        Datsun <span class="number">710</span>       mpg  <span class="number">22.8</span></span><br><span class="line"><span class="number">4</span>    Hornet <span class="number">4</span> Drive       mpg  <span class="number">21.4</span></span><br><span class="line"><span class="number">5</span> Hornet Sportabout       mpg  <span class="number">18.7</span></span><br><span class="line"><span class="number">6</span>           Valiant       mpg  <span class="number">18.1</span></span><br></pre></td></tr></table></figure><p>tidyr很好的一点是可以只gather若干列而其他列保持不变,这点要比melt更加灵活</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; mtcarsNew &lt;- mtcars %&gt;% gather(attribute, value, mpg:gear)</span><br><span class="line">&gt; head(mtcarsNew)</span><br><span class="line">                car carb attribute value</span><br><span class="line"><span class="number">1</span>         Mazda RX4    <span class="number">4</span>       mpg  <span class="number">21.0</span></span><br><span class="line"><span class="number">2</span>     Mazda RX4 Wag    <span class="number">4</span>       mpg  <span class="number">21.0</span></span><br><span class="line"><span class="number">3</span>        Datsun <span class="number">710</span>    <span class="number">1</span>       mpg  <span class="number">22.8</span></span><br><span class="line"><span class="number">4</span>    Hornet <span class="number">4</span> Drive    <span class="number">1</span>       mpg  <span class="number">21.4</span></span><br><span class="line"><span class="number">5</span> Hornet Sportabout    <span class="number">2</span>       mpg  <span class="number">18.7</span></span><br><span class="line"><span class="number">6</span>           Valiant    <span class="number">1</span>       mpg  <span class="number">18.1</span></span><br></pre></td></tr></table></figure><h5 id="spread--长数据转为宽数据">spread--长数据转为宽数据</h5><blockquote><p>spread(data, key, value, fill = NA, convert = FALSE, drop = TRUE) data：为需要转换的长形表 key：需要将变量值拓展为字段的变量 value：需要分散的值 fill：对于缺失值，可将fill的值赋值给被转型后的缺失值</p></blockquote><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; mtcarsSpread &lt;- mtcarsNew %&gt;% spread(attribute, value) <span class="comment"># 返回原来的数据格式</span></span><br><span class="line">&gt; head(mtcarsSpread)</span><br><span class="line">                 car carb am cyl disp drat gear  hp  mpg  qsec vs    wt</span><br><span class="line"><span class="number">1</span>        AMC Javelin    <span class="number">2</span>  <span class="number">0</span>   <span class="number">8</span>  <span class="number">304</span> <span class="number">3.15</span>    <span class="number">3</span> <span class="number">150</span> <span class="number">15.2</span> <span class="number">17.30</span>  <span class="number">0</span> <span class="number">3.435</span></span><br><span class="line"><span class="number">2</span> Cadillac Fleetwood    <span class="number">4</span>  <span class="number">0</span>   <span class="number">8</span>  <span class="number">472</span> <span class="number">2.93</span>    <span class="number">3</span> <span class="number">205</span> <span class="number">10.4</span> <span class="number">17.98</span>  <span class="number">0</span> <span class="number">5.250</span></span><br><span class="line"><span class="number">3</span>         Camaro Z28    <span class="number">4</span>  <span class="number">0</span>   <span class="number">8</span>  <span class="number">350</span> <span class="number">3.73</span>    <span class="number">3</span> <span class="number">245</span> <span class="number">13.3</span> <span class="number">15.41</span>  <span class="number">0</span> <span class="number">3.840</span></span><br><span class="line"><span class="number">4</span>  Chrysler Imperial    <span class="number">4</span>  <span class="number">0</span>   <span class="number">8</span>  <span class="number">440</span> <span class="number">3.23</span>    <span class="number">3</span> <span class="number">230</span> <span class="number">14.7</span> <span class="number">17.42</span>  <span class="number">0</span> <span class="number">5.345</span></span><br><span class="line"><span class="number">5</span>         Datsun <span class="number">710</span>    <span class="number">1</span>  <span class="number">1</span>   <span class="number">4</span>  <span class="number">108</span> <span class="number">3.85</span>    <span class="number">4</span>  <span class="number">93</span> <span class="number">22.8</span> <span class="number">18.61</span>  <span class="number">1</span> <span class="number">2.320</span></span><br><span class="line"><span class="number">6</span>   Dodge Challenger    <span class="number">2</span>  <span class="number">0</span>   <span class="number">8</span>  <span class="number">318</span> <span class="number">2.76</span>    <span class="number">3</span> <span class="number">150</span> <span class="number">15.5</span> <span class="number">16.87</span>  <span class="number">0</span> <span class="number">3.520</span></span><br></pre></td></tr></table></figure><blockquote><p>使用spread函数后，数据的排列顺序有一定的调整</p></blockquote><h4 id="数据分割与合并">数据分割与合并</h4><h5 id="unite--多列合并为一列">unite--多列合并为一列</h5><blockquote><p>unite(data, col, …, sep = “_”, remove = TRUE) data：为数据框 col：被组合的新列名称 …：指定哪些列需要被组合 sep：组合列之间的连接符，默认为下划线 remove：是否删除被组合的列</p></blockquote><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&gt; date &lt;- as.Date(<span class="string">&#x27;2019-04-01&#x27;</span>) + <span class="number">0</span>:<span class="number">14</span></span><br><span class="line">&gt; hour &lt;- sample(<span class="number">1</span>:<span class="number">24</span>, <span class="number">15</span>)</span><br><span class="line">&gt; min &lt;- sample(<span class="number">1</span>:<span class="number">60</span>, <span class="number">15</span>)</span><br><span class="line">&gt; second &lt;- sample(<span class="number">1</span>:<span class="number">60</span>, <span class="number">15</span>)</span><br><span class="line">&gt; event &lt;- sample(letters, <span class="number">15</span>)</span><br><span class="line">&gt; data &lt;- data.frame(date, hour, min, second, event)</span><br><span class="line">&gt; data</span><br><span class="line">         date hour min second event</span><br><span class="line"><span class="number">1</span>  <span class="number">2019</span>-<span class="number">04</span>-<span class="number">01</span>    <span class="number">7</span>  <span class="number">30</span>     <span class="number">29</span>     u</span><br><span class="line"><span class="number">2</span>  <span class="number">2019</span>-<span class="number">04</span>-<span class="number">02</span>    <span class="number">9</span>  <span class="number">43</span>     <span class="number">36</span>     a</span><br><span class="line"><span class="number">3</span>  <span class="number">2019</span>-<span class="number">04</span>-<span class="number">03</span>   <span class="number">13</span>  <span class="number">58</span>     <span class="number">60</span>     l</span><br><span class="line"><span class="number">4</span>  <span class="number">2019</span>-<span class="number">04</span>-<span class="number">04</span>   <span class="number">20</span>  <span class="number">22</span>     <span class="number">11</span>     q</span><br><span class="line"><span class="number">5</span>  <span class="number">2019</span>-<span class="number">04</span>-<span class="number">05</span>    <span class="number">5</span>  <span class="number">44</span>     <span class="number">47</span>     p</span><br><span class="line"><span class="number">6</span>  <span class="number">2019</span>-<span class="number">04</span>-<span class="number">06</span>   <span class="number">18</span>  <span class="number">52</span>     <span class="number">37</span>     k</span><br><span class="line"><span class="number">7</span>  <span class="number">2019</span>-<span class="number">04</span>-<span class="number">07</span>   <span class="number">19</span>  <span class="number">12</span>     <span class="number">43</span>     r</span><br><span class="line"><span class="number">8</span>  <span class="number">2019</span>-<span class="number">04</span>-<span class="number">08</span>   <span class="number">12</span>  <span class="number">35</span>      <span class="number">6</span>     i</span><br><span class="line"><span class="number">9</span>  <span class="number">2019</span>-<span class="number">04</span>-<span class="number">09</span>   <span class="number">11</span>   <span class="number">7</span>     <span class="number">38</span>     e</span><br><span class="line"><span class="number">10</span> <span class="number">2019</span>-<span class="number">04</span>-<span class="number">10</span>    <span class="number">1</span>  <span class="number">14</span>     <span class="number">21</span>     b</span><br><span class="line"><span class="number">11</span> <span class="number">2019</span>-<span class="number">04</span>-<span class="number">11</span>    <span class="number">3</span>  <span class="number">20</span>     <span class="number">42</span>     w</span><br><span class="line"><span class="number">12</span> <span class="number">2019</span>-<span class="number">04</span>-<span class="number">12</span>   <span class="number">14</span>   <span class="number">1</span>     <span class="number">32</span>     t</span><br><span class="line"><span class="number">13</span> <span class="number">2019</span>-<span class="number">04</span>-<span class="number">13</span>   <span class="number">23</span>  <span class="number">19</span>     <span class="number">52</span>     h</span><br><span class="line"><span class="number">14</span> <span class="number">2019</span>-<span class="number">04</span>-<span class="number">14</span>   <span class="number">21</span>  <span class="number">41</span>     <span class="number">26</span>     s</span><br><span class="line"><span class="number">15</span> <span class="number">2019</span>-<span class="number">04</span>-<span class="number">15</span>    <span class="number">8</span>  <span class="number">16</span>     <span class="number">25</span>     o</span><br><span class="line">&gt; dataNew &lt;- unite(data, datehour, date, hour, sep = <span class="string">&#x27; &#x27;</span>) <span class="comment"># 联合date 和 hour两列，以空格分割，合成datehour列</span></span><br><span class="line">&gt; dataNew</span><br><span class="line">        datehour min second event</span><br><span class="line"><span class="number">1</span>   <span class="number">2019</span>-<span class="number">04</span>-<span class="number">01</span> <span class="number">7</span>  <span class="number">30</span>     <span class="number">29</span>     u</span><br><span class="line"><span class="number">2</span>   <span class="number">2019</span>-<span class="number">04</span>-<span class="number">02</span> <span class="number">9</span>  <span class="number">43</span>     <span class="number">36</span>     a</span><br><span class="line"><span class="number">3</span>  <span class="number">2019</span>-<span class="number">04</span>-<span class="number">03</span> <span class="number">13</span>  <span class="number">58</span>     <span class="number">60</span>     l</span><br><span class="line"><span class="number">4</span>  <span class="number">2019</span>-<span class="number">04</span>-<span class="number">04</span> <span class="number">20</span>  <span class="number">22</span>     <span class="number">11</span>     q</span><br><span class="line"><span class="number">5</span>   <span class="number">2019</span>-<span class="number">04</span>-<span class="number">05</span> <span class="number">5</span>  <span class="number">44</span>     <span class="number">47</span>     p</span><br><span class="line"><span class="number">6</span>  <span class="number">2019</span>-<span class="number">04</span>-<span class="number">06</span> <span class="number">18</span>  <span class="number">52</span>     <span class="number">37</span>     k</span><br><span class="line"><span class="number">7</span>  <span class="number">2019</span>-<span class="number">04</span>-<span class="number">07</span> <span class="number">19</span>  <span class="number">12</span>     <span class="number">43</span>     r</span><br><span class="line"><span class="number">8</span>  <span class="number">2019</span>-<span class="number">04</span>-<span class="number">08</span> <span class="number">12</span>  <span class="number">35</span>      <span class="number">6</span>     i</span><br><span class="line"><span class="number">9</span>  <span class="number">2019</span>-<span class="number">04</span>-<span class="number">09</span> <span class="number">11</span>   <span class="number">7</span>     <span class="number">38</span>     e</span><br><span class="line"><span class="number">10</span>  <span class="number">2019</span>-<span class="number">04</span>-<span class="number">10</span> <span class="number">1</span>  <span class="number">14</span>     <span class="number">21</span>     b</span><br><span class="line"><span class="number">11</span>  <span class="number">2019</span>-<span class="number">04</span>-<span class="number">11</span> <span class="number">3</span>  <span class="number">20</span>     <span class="number">42</span>     w</span><br><span class="line"><span class="number">12</span> <span class="number">2019</span>-<span class="number">04</span>-<span class="number">12</span> <span class="number">14</span>   <span class="number">1</span>     <span class="number">32</span>     t</span><br><span class="line"><span class="number">13</span> <span class="number">2019</span>-<span class="number">04</span>-<span class="number">13</span> <span class="number">23</span>  <span class="number">19</span>     <span class="number">52</span>     h</span><br><span class="line"><span class="number">14</span> <span class="number">2019</span>-<span class="number">04</span>-<span class="number">14</span> <span class="number">21</span>  <span class="number">41</span>     <span class="number">26</span>     s</span><br><span class="line"><span class="number">15</span>  <span class="number">2019</span>-<span class="number">04</span>-<span class="number">15</span> <span class="number">8</span>  <span class="number">16</span>     <span class="number">25</span>     o</span><br></pre></td></tr></table></figure><h5 id="separate--将一列分离为多列">separate--将一列分离为多列</h5><blockquote><p>separate(data, col, into, sep = “[^[:alnum:]]+”, remove = TRUE, convert = FALSE, extra = “warn”, fill = “warn”, …) data：为数据框 col：需要被拆分的列 into：新建的列名，为字符串向量 sep：被拆分列的分隔符 remove：是否删除被分割的列</p></blockquote><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt; data1 &lt;- separate(dataNew, datehour, c(<span class="string">&#x27;date&#x27;</span>, <span class="string">&#x27;hour&#x27;</span>), sep = <span class="string">&#x27; &#x27;</span>) <span class="comment"># 江上编数据重新拆分成原样</span></span><br><span class="line">&gt; data1</span><br><span class="line">         date hour min second event</span><br><span class="line"><span class="number">1</span>  <span class="number">2019</span>-<span class="number">04</span>-<span class="number">01</span>    <span class="number">7</span>  <span class="number">30</span>     <span class="number">29</span>     u</span><br><span class="line"><span class="number">2</span>  <span class="number">2019</span>-<span class="number">04</span>-<span class="number">02</span>    <span class="number">9</span>  <span class="number">43</span>     <span class="number">36</span>     a</span><br><span class="line"><span class="number">3</span>  <span class="number">2019</span>-<span class="number">04</span>-<span class="number">03</span>   <span class="number">13</span>  <span class="number">58</span>     <span class="number">60</span>     l</span><br><span class="line"><span class="number">4</span>  <span class="number">2019</span>-<span class="number">04</span>-<span class="number">04</span>   <span class="number">20</span>  <span class="number">22</span>     <span class="number">11</span>     q</span><br><span class="line"><span class="number">5</span>  <span class="number">2019</span>-<span class="number">04</span>-<span class="number">05</span>    <span class="number">5</span>  <span class="number">44</span>     <span class="number">47</span>     p</span><br><span class="line"><span class="number">6</span>  <span class="number">2019</span>-<span class="number">04</span>-<span class="number">06</span>   <span class="number">18</span>  <span class="number">52</span>     <span class="number">37</span>     k</span><br><span class="line"><span class="number">7</span>  <span class="number">2019</span>-<span class="number">04</span>-<span class="number">07</span>   <span class="number">19</span>  <span class="number">12</span>     <span class="number">43</span>     r</span><br><span class="line"><span class="number">8</span>  <span class="number">2019</span>-<span class="number">04</span>-<span class="number">08</span>   <span class="number">12</span>  <span class="number">35</span>      <span class="number">6</span>     i</span><br><span class="line"><span class="number">9</span>  <span class="number">2019</span>-<span class="number">04</span>-<span class="number">09</span>   <span class="number">11</span>   <span class="number">7</span>     <span class="number">38</span>     e</span><br><span class="line"><span class="number">10</span> <span class="number">2019</span>-<span class="number">04</span>-<span class="number">10</span>    <span class="number">1</span>  <span class="number">14</span>     <span class="number">21</span>     b</span><br><span class="line"><span class="number">11</span> <span class="number">2019</span>-<span class="number">04</span>-<span class="number">11</span>    <span class="number">3</span>  <span class="number">20</span>     <span class="number">42</span>     w</span><br><span class="line"><span class="number">12</span> <span class="number">2019</span>-<span class="number">04</span>-<span class="number">12</span>   <span class="number">14</span>   <span class="number">1</span>     <span class="number">32</span>     t</span><br><span class="line"><span class="number">13</span> <span class="number">2019</span>-<span class="number">04</span>-<span class="number">13</span>   <span class="number">23</span>  <span class="number">19</span>     <span class="number">52</span>     h</span><br><span class="line"><span class="number">14</span> <span class="number">2019</span>-<span class="number">04</span>-<span class="number">14</span>   <span class="number">21</span>  <span class="number">41</span>     <span class="number">26</span>     s</span><br><span class="line"><span class="number">15</span> <span class="number">2019</span>-<span class="number">04</span>-<span class="number">15</span>    <span class="number">8</span>  <span class="number">16</span>     <span class="number">25</span>     o</span><br></pre></td></tr></table></figure><p><code>separate_rows</code>可以间该数据分割后储存在同一列</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&gt; head(table3)</span><br><span class="line"><span class="comment"># A tibble: 6 x 3</span></span><br><span class="line">  country      year rate             </span><br><span class="line">  &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;            </span><br><span class="line"><span class="number">1</span> Afghanistan  <span class="number">1999</span> <span class="number">745</span>/<span class="number">19987071</span>     </span><br><span class="line"><span class="number">2</span> Afghanistan  <span class="number">2000</span> <span class="number">2666</span>/<span class="number">20595360</span>    </span><br><span class="line"><span class="number">3</span> Brazil       <span class="number">1999</span> <span class="number">37737</span>/<span class="number">172006362</span>  </span><br><span class="line"><span class="number">4</span> Brazil       <span class="number">2000</span> <span class="number">80488</span>/<span class="number">174504898</span>  </span><br><span class="line"><span class="number">5</span> China        <span class="number">1999</span> <span class="number">212258</span>/<span class="number">1272915272</span></span><br><span class="line"><span class="number">6</span> China        <span class="number">2000</span> <span class="number">213766</span>/<span class="number">1280428583</span></span><br><span class="line">&gt; separate_rows(table3, rate)</span><br><span class="line"><span class="comment"># A tibble: 12 x 3</span></span><br><span class="line">   country      year rate      </span><br><span class="line">   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;     </span><br><span class="line"> <span class="number">1</span> Afghanistan  <span class="number">1999</span> <span class="number">745</span>       </span><br><span class="line"> <span class="number">2</span> Afghanistan  <span class="number">1999</span> <span class="number">19987071</span>  </span><br><span class="line"> <span class="number">3</span> Afghanistan  <span class="number">2000</span> <span class="number">2666</span>      </span><br><span class="line"> <span class="number">4</span> Afghanistan  <span class="number">2000</span> <span class="number">20595360</span>  </span><br><span class="line"> <span class="number">5</span> Brazil       <span class="number">1999</span> <span class="number">37737</span>     </span><br><span class="line"> <span class="number">6</span> Brazil       <span class="number">1999</span> <span class="number">172006362</span> </span><br><span class="line"> <span class="number">7</span> Brazil       <span class="number">2000</span> <span class="number">80488</span>     </span><br><span class="line"> <span class="number">8</span> Brazil       <span class="number">2000</span> <span class="number">174504898</span> </span><br><span class="line"> <span class="number">9</span> China        <span class="number">1999</span> <span class="number">212258</span>    </span><br><span class="line"><span class="number">10</span> China        <span class="number">1999</span> <span class="number">1272915272</span></span><br><span class="line"><span class="number">11</span> China        <span class="number">2000</span> <span class="number">213766</span>    </span><br><span class="line"><span class="number">12</span> China        <span class="number">2000</span> <span class="number">1280428583</span></span><br></pre></td></tr></table></figure><h4 id="数据拓展">数据拓展</h4><h5 id="complete--创建组合table">complete--创建组合table</h5><p><code>complete</code>和<code>expand</code>都会创建出一个包含所有组合的tibble，只是两者得到的结果是不一样的</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&gt; complete(mtcars, cyl, gear, carb)</span><br><span class="line"><span class="comment"># A tibble: 74 x 12</span></span><br><span class="line">     cyl  gear  carb car        mpg  disp    hp  drat    wt  qsec    vs    am</span><br><span class="line">   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span><br><span class="line"> <span class="number">1</span>     <span class="number">4</span>     <span class="number">3</span>     <span class="number">1</span> Toyota ~  <span class="number">21.5</span> <span class="number">120.</span>     <span class="number">97</span>  <span class="number">3.7</span>   <span class="number">2.46</span>  <span class="number">20.0</span>     <span class="number">1</span>     <span class="number">0</span></span><br><span class="line"> <span class="number">2</span>     <span class="number">4</span>     <span class="number">3</span>     <span class="number">2</span> <span class="literal">NA</span>        <span class="literal">NA</span>    <span class="literal">NA</span>      <span class="literal">NA</span> <span class="literal">NA</span>    <span class="literal">NA</span>     <span class="literal">NA</span>      <span class="literal">NA</span>    <span class="literal">NA</span></span><br><span class="line"> <span class="number">3</span>     <span class="number">4</span>     <span class="number">3</span>     <span class="number">3</span> <span class="literal">NA</span>        <span class="literal">NA</span>    <span class="literal">NA</span>      <span class="literal">NA</span> <span class="literal">NA</span>    <span class="literal">NA</span>     <span class="literal">NA</span>      <span class="literal">NA</span>    <span class="literal">NA</span></span><br><span class="line"> <span class="number">4</span>     <span class="number">4</span>     <span class="number">3</span>     <span class="number">4</span> <span class="literal">NA</span>        <span class="literal">NA</span>    <span class="literal">NA</span>      <span class="literal">NA</span> <span class="literal">NA</span>    <span class="literal">NA</span>     <span class="literal">NA</span>      <span class="literal">NA</span>    <span class="literal">NA</span></span><br><span class="line"> <span class="number">5</span>     <span class="number">4</span>     <span class="number">3</span>     <span class="number">6</span> <span class="literal">NA</span>        <span class="literal">NA</span>    <span class="literal">NA</span>      <span class="literal">NA</span> <span class="literal">NA</span>    <span class="literal">NA</span>     <span class="literal">NA</span>      <span class="literal">NA</span>    <span class="literal">NA</span></span><br><span class="line"> <span class="number">6</span>     <span class="number">4</span>     <span class="number">3</span>     <span class="number">8</span> <span class="literal">NA</span>        <span class="literal">NA</span>    <span class="literal">NA</span>      <span class="literal">NA</span> <span class="literal">NA</span>    <span class="literal">NA</span>     <span class="literal">NA</span>      <span class="literal">NA</span>    <span class="literal">NA</span></span><br><span class="line"> <span class="number">7</span>     <span class="number">4</span>     <span class="number">4</span>     <span class="number">1</span> Datsun ~  <span class="number">22.8</span> <span class="number">108</span>      <span class="number">93</span>  <span class="number">3.85</span>  <span class="number">2.32</span>  <span class="number">18.6</span>     <span class="number">1</span>     <span class="number">1</span></span><br><span class="line"> <span class="number">8</span>     <span class="number">4</span>     <span class="number">4</span>     <span class="number">1</span> Fiat <span class="number">128</span>  <span class="number">32.4</span>  <span class="number">78.7</span>    <span class="number">66</span>  <span class="number">4.08</span>  <span class="number">2.2</span>   <span class="number">19.5</span>     <span class="number">1</span>     <span class="number">1</span></span><br><span class="line"> <span class="number">9</span>     <span class="number">4</span>     <span class="number">4</span>     <span class="number">1</span> Toyota ~  <span class="number">33.9</span>  <span class="number">71.1</span>    <span class="number">65</span>  <span class="number">4.22</span>  <span class="number">1.84</span>  <span class="number">19.9</span>     <span class="number">1</span>     <span class="number">1</span></span><br><span class="line"><span class="number">10</span>     <span class="number">4</span>     <span class="number">4</span>     <span class="number">1</span> Fiat X1~  <span class="number">27.3</span>  <span class="number">79</span>      <span class="number">66</span>  <span class="number">4.08</span>  <span class="number">1.94</span>  <span class="number">18.9</span>     <span class="number">1</span>     <span class="number">1</span></span><br><span class="line"><span class="comment"># ... with 64 more rows</span></span><br><span class="line">&gt; expand(mtcars, cyl, gear, carb)</span><br><span class="line"><span class="comment"># A tibble: 54 x 3</span></span><br><span class="line">     cyl  gear  carb</span><br><span class="line">   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span><br><span class="line"> <span class="number">1</span>     <span class="number">4</span>     <span class="number">3</span>     <span class="number">1</span></span><br><span class="line"> <span class="number">2</span>     <span class="number">4</span>     <span class="number">3</span>     <span class="number">2</span></span><br><span class="line"> <span class="number">3</span>     <span class="number">4</span>     <span class="number">3</span>     <span class="number">3</span></span><br><span class="line"> <span class="number">4</span>     <span class="number">4</span>     <span class="number">3</span>     <span class="number">4</span></span><br><span class="line"> <span class="number">5</span>     <span class="number">4</span>     <span class="number">3</span>     <span class="number">6</span></span><br><span class="line"> <span class="number">6</span>     <span class="number">4</span>     <span class="number">3</span>     <span class="number">8</span></span><br><span class="line"> <span class="number">7</span>     <span class="number">4</span>     <span class="number">4</span>     <span class="number">1</span></span><br><span class="line"> <span class="number">8</span>     <span class="number">4</span>     <span class="number">4</span>     <span class="number">2</span></span><br><span class="line"> <span class="number">9</span>     <span class="number">4</span>     <span class="number">4</span>     <span class="number">3</span></span><br><span class="line"><span class="number">10</span>     <span class="number">4</span>     <span class="number">4</span>     <span class="number">4</span></span><br><span class="line"><span class="comment"># ... with 44 more rows</span></span><br></pre></td></tr></table></figure><h4 id="缺失值处理">缺失值处理</h4><h5 id="drop_na--去掉包含na的某些行">drop_na--去掉包含NA的某些行</h5><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">library</span>(dplyr)</span><br><span class="line">&gt; df &lt;- tibble(x = c(<span class="number">1</span>, <span class="number">2</span>, <span class="literal">NA</span>), y = c(<span class="string">&quot;a&quot;</span>, <span class="literal">NA</span>, <span class="string">&quot;b&quot;</span>))</span><br><span class="line">&gt; df</span><br><span class="line"><span class="comment"># A tibble: 3 x 2</span></span><br><span class="line">      x y    </span><br><span class="line">  &lt;dbl&gt; &lt;chr&gt;</span><br><span class="line"><span class="number">1</span>     <span class="number">1</span> a    </span><br><span class="line"><span class="number">2</span>     <span class="number">2</span> <span class="literal">NA</span>   </span><br><span class="line"><span class="number">3</span>    <span class="literal">NA</span> b  </span><br><span class="line">&gt; drop_na(df, x) <span class="comment"># 去掉x列包含NA的行</span></span><br><span class="line"><span class="comment"># A tibble: 2 x 2</span></span><br><span class="line">      x y    </span><br><span class="line">  &lt;dbl&gt; &lt;chr&gt;</span><br><span class="line"><span class="number">1</span>     <span class="number">1</span> a    </span><br><span class="line"><span class="number">2</span>     <span class="number">2</span> <span class="literal">NA</span> </span><br></pre></td></tr></table></figure><h5 id="fill--根据就近的非na值补充na数据">fill--根据就近的非NA值补充NA数据</h5><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&gt; df &lt;- data.frame(x1 = LETTERS[<span class="number">1</span>:<span class="number">5</span>], x2 =c(<span class="number">1</span>, <span class="literal">NA</span>, <span class="literal">NA</span>, <span class="number">3</span>, <span class="literal">NA</span>))</span><br><span class="line">&gt; df</span><br><span class="line">  x1 x2</span><br><span class="line"><span class="number">1</span>  A  <span class="number">1</span></span><br><span class="line"><span class="number">2</span>  B <span class="literal">NA</span></span><br><span class="line"><span class="number">3</span>  C <span class="literal">NA</span></span><br><span class="line"><span class="number">4</span>  D  <span class="number">3</span></span><br><span class="line"><span class="number">5</span>  E <span class="literal">NA</span></span><br><span class="line">&gt; fill(df, x2)</span><br><span class="line">  x1 x2</span><br><span class="line"><span class="number">1</span>  A  <span class="number">1</span></span><br><span class="line"><span class="number">2</span>  B  <span class="number">1</span></span><br><span class="line"><span class="number">3</span>  C  <span class="number">1</span></span><br><span class="line"><span class="number">4</span>  D  <span class="number">3</span></span><br><span class="line"><span class="number">5</span>  E  <span class="number">3</span></span><br><span class="line">&gt; fill(df, x2, .direction = <span class="string">&quot;up&quot;</span>)</span><br><span class="line">  x1 x2</span><br><span class="line"><span class="number">1</span>  A  <span class="number">1</span></span><br><span class="line"><span class="number">2</span>  B  <span class="number">3</span></span><br><span class="line"><span class="number">3</span>  C  <span class="number">3</span></span><br><span class="line"><span class="number">4</span>  D  <span class="number">3</span></span><br><span class="line"><span class="number">5</span>  E <span class="literal">NA</span></span><br><span class="line">&gt; fill(df, x2, .direction = <span class="string">&quot;down&quot;</span>)</span><br><span class="line">  x1 x2</span><br><span class="line"><span class="number">1</span>  A  <span class="number">1</span></span><br><span class="line"><span class="number">2</span>  B  <span class="number">1</span></span><br><span class="line"><span class="number">3</span>  C  <span class="number">1</span></span><br><span class="line"><span class="number">4</span>  D  <span class="number">3</span></span><br><span class="line"><span class="number">5</span>  E  <span class="number">3</span></span><br></pre></td></tr></table></figure><h5 id="replace_na--取代缺失值">replace_na--取代缺失值</h5><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; replace_na(df, list(x2 = <span class="number">2</span>))</span><br><span class="line">  x1 x2</span><br><span class="line"><span class="number">1</span>  A  <span class="number">1</span></span><br><span class="line"><span class="number">2</span>  B  <span class="number">2</span></span><br><span class="line"><span class="number">3</span>  C  <span class="number">2</span></span><br><span class="line"><span class="number">4</span>  D  <span class="number">3</span></span><br><span class="line"><span class="number">5</span>  E  <span class="number">2</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
            <tag> tidyverse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux screen 命令使用</title>
      <link href="2019/04/04/screen/"/>
      <url>2019/04/04/screen/</url>
      
        <content type="html"><![CDATA[<h3 id="screen">screen</h3><p><code>screen</code> 是一个非常有用的命令，提供从单个 SSH 会话中使用多个 shell 窗口（会话）的能力。当会话被分离或网络中断时，screen 会话中启动的进程仍将运行，你可以随时重新连接到 screen 会话。如果你想运行一个持久的进程或者从多个位置连接到 shell 会话，这也很方便。</p><h4 id="安装screen">安装screen</h4><p><code>screen</code> 在一些流行的发行版上已经预安装了。你可以使用下面的命令检查是否已经在你的服务器上安装了。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">screen -v</span><br><span class="line">Screen version 4.04.00 (GNU) 19-Jun-16</span><br></pre></td></tr></table></figure><p>如果没有，可以直接使用包管理器进行安装</p><h4 id="启动-screen-会话">启动 screen 会话</h4><p>你可以在命令行中输入 <code>screen</code> 来启动它，接着会有一个看上去和命令行提示符一样的 <code>screen</code> 会话启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">screen</span><br></pre></td></tr></table></figure><p>使用描述性名称启动屏幕会话是一个很好的做法，这样你可以轻松地记住会话中正在运行的进程。要使用会话名称创建新会话，请运行以下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">screen -S yourname</span><br></pre></td></tr></table></figure><h4 id="screen-会话分离">screen 会话分离</h4><p>要从当前的 screen 会话中分离，你可以按下 <code>Ctrl-A</code> 和 <code>d</code>。所有的 screen 会话仍将是活跃的，你之后可以随时重新连接。</p><h4 id="重新连接到-screen-会话">重新连接到 screen 会话</h4><p>如果你从一个会话分离，或者由于某些原因你的连接被中断了，你可以使用下面的命令重新连接：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">screen -r</span><br></pre></td></tr></table></figure><p>如果你有多个 screen 会话，你可以用 <code>ls</code> 参数列出它们。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">screen -ls</span><br><span class="line">There are screens on:</span><br><span class="line">7880.session    (Detached)</span><br><span class="line">7934.session2   (Detached)</span><br><span class="line">2 Sockets in /var/run/screen/S-root.</span><br></pre></td></tr></table></figure><p>如果你想要还原 “session2” 会话，你可以执行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">screen -r 7934</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">或者：  </span><br><span class="line"></span><br><span class="line">```shell</span><br><span class="line">screen -r -S session2</span><br></pre></td></tr></table></figure><h4 id="中止-screen">中止 screen</h4><p>你可以按下 <code>Ctrl+d</code>，或者在命令行中使用 <code>exit</code> 命令。</p><h4 id="更多语法">更多语法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">man screen</span><br><span class="line">NAME</span><br><span class="line">screen - screen manager with VT100/ANSI terminal emulation</span><br><span class="line">SYNOPSIS</span><br><span class="line">screen [ -options ] [ cmd [ args ] ]</span><br><span class="line">screen -r [[pid.]tty[.host]]</span><br><span class="line">screen -r sessionowner/[[pid.]tty[.host]]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Screen命令的使用</title>
      <link href="2019/04/04/screen-i/"/>
      <url>2019/04/04/screen-i/</url>
      
        <content type="html"><![CDATA[<p>screen常用命令</p><a id="more"></a><p>使用telnet或SSH远程登录linux时，如果连接非正常中断，重新连接时，系统将开一个新的session，无法恢复原来的 session.screen命令可以解决这个问题。Screen工具是一个终端多路转接器，在本质上，这意味着你能够使用一个单一的终端窗口运行多终端的应用。</p><p>screen命令介绍<br />1. screen -S 创建一个screen（可以用screen -S ID，打开一个指定的ID session） 2. screen -ls 显示所有的screen会话<br />3. screen -d 脱离当前screen ,返回正常shell<br />4. screen -r 进入指定screen<br />5. screen -S SEEION_NAME -X quit 删除镜像</p><p>Screen 操作快捷键<br />+ ctrl-a c：创建一个新的 Shell<br />+ ctrl-a ctrl-a：在 Shell 间切换<br />+ ctrl-a n：切换到下一个 Shell<br />+ ctrl-a p：切换到上一个 Shell<br />+ ctrl-a 0…9：同样是切换各个 Shell<br />+ ctrl-a d：退出 Screen 会话</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> screen </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>R的文件操作</title>
      <link href="2019/04/01/file-r/"/>
      <url>2019/04/01/file-r/</url>
      
        <content type="html"><![CDATA[<p>在R中操作文件</p><a id="more"></a><h2 id="目录操作">目录操作</h2><h3 id="查看目录">查看目录</h3><p><code>getwd()</code> 列出当前工作路径</p><p><code>setwd()</code> 设置工作路径</p><p><code>list.files()</code>和<code>dir()</code>的用法相同，可以列出路径下的文件和目录</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">list.files(path =<span class="string">&quot;.&quot;</span>, pattern = <span class="literal">NULL</span>, all.files = <span class="literal">FALSE</span>,</span><br><span class="line"></span><br><span class="line">           full.names = <span class="literal">FALSE</span>, recursive =<span class="literal">FALSE</span>,</span><br><span class="line"></span><br><span class="line">           ignore.case = <span class="literal">FALSE</span>, include.dirs =<span class="literal">FALSE</span>, no.. = <span class="literal">FALSE</span>)</span><br><span class="line"></span><br><span class="line">dir(path =<span class="string">&quot;.&quot;</span>, pattern = <span class="literal">NULL</span>, all.files = <span class="literal">FALSE</span>,</span><br><span class="line"></span><br><span class="line">    full.names = <span class="literal">FALSE</span>, recursive = <span class="literal">FALSE</span>,</span><br><span class="line"></span><br><span class="line">    ignore.case = <span class="literal">FALSE</span>, include.dirs = <span class="literal">FALSE</span>,no.. = <span class="literal">FALSE</span>)</span><br></pre></td></tr></table></figure><p>函数<code>list.dirs()</code>只列出路径下所有目录,默认是递归进行的</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list.dirs(path = <span class="string">&quot;.&quot;</span>, full.names = <span class="literal">TRUE</span>, recursive = <span class="literal">TRUE</span>)</span><br></pre></td></tr></table></figure><p>参数介绍：</p><p><code>path</code> 路径，如不填则默认为当前工作路径，即<code>getwd()</code>得到的路径； <code>pattern</code> 正则表达式，若<code>pattern</code>不为<code>NULL</code>，返回文件（目录）名满足该正则表达式的文件（目录）； <code>all.files</code>若为<code>FALSE</code>则不显示隐藏文件（目录），若为<code>TRUE</code>则返回所有文件（目录）； <code>full.names</code> 若为<code>FALSE</code>则只返回文件（目录）名，若为<code>TRUE</code>则返回文件（目录）路径； <code>recursive</code> 若为<code>FALSE</code>则只返回该路径的子级文件（目录），若为<code>TRUE</code>则递归返回所有子、孙文件（目录）； <code>ignore.case</code> 若为<code>TRUE</code>则在匹配pattern时不区分大小写； <code>include.dirs</code> 在recursive为TURE，即显示所有子、孙文件时，若<code>include.dirs</code>为FALSE则只列出最终端的文件名，而不列出中间层级的目录名； <code>no..</code>若为TRUE，则不显示“.”和“..”。</p><h3 id="查看目录的权限">查看目录的权限</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; file.info(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">  size isdir mode               mtime               ctime               atime exe</span><br><span class="line">.    <span class="number">0</span>  <span class="literal">TRUE</span>  <span class="number">555</span> <span class="number">2019</span>-<span class="number">03</span>-<span class="number">13</span> <span class="number">08</span>:<span class="number">10</span>:<span class="number">19</span> <span class="number">2018</span>-<span class="number">10</span>-<span class="number">13</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">40</span> <span class="number">2019</span>-<span class="number">04</span>-<span class="number">01</span> <span class="number">18</span>:<span class="number">54</span>:<span class="number">24</span>  no</span><br></pre></td></tr></table></figure><h3 id="创建目录">创建目录</h3><h4 id="创建单个目录">创建单个目录</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; dir.create(<span class="string">&quot;create&quot;</span>)</span><br><span class="line">&gt; list.dirs()</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;.&quot;</span>        <span class="string">&quot;./create&quot;</span> <span class="string">&quot;./tmp&quot;</span></span><br></pre></td></tr></table></figure><h4 id="递归创建目录">递归创建目录</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; dir.create(path=<span class="string">&quot;a1/b2/c3&quot;</span>,recursive = <span class="literal">TRUE</span>)</span><br><span class="line">&gt; list.dirs()</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;.&quot;</span>          <span class="string">&quot;./a1&quot;</span>       <span class="string">&quot;./a1/b2&quot;</span>    <span class="string">&quot;./a1/b2/c3&quot;</span> <span class="string">&quot;./create&quot;</span>  <span class="string">&quot;./tmp&quot;</span></span><br></pre></td></tr></table></figure><h4 id="检测目录是否存在">检测目录是否存在</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; file.exists(<span class="string">&quot;a&quot;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="literal">FALSE</span></span><br></pre></td></tr></table></figure><h4 id="检查目录的权限">检查目录的权限</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; df &lt;- dir(file.path(R.home(), <span class="string">&quot;bin&quot;</span>), full.names = <span class="literal">T</span>)</span><br><span class="line">&gt; file.access(df, mode = <span class="number">0</span>) == <span class="number">0</span></span><br><span class="line">  D:/Rcore/bin/config.sh       D:/Rcore/bin/R.exe D:/Rcore/bin/Rscript.exe </span><br><span class="line">                    <span class="literal">TRUE</span>                     <span class="literal">TRUE</span>                     <span class="literal">TRUE</span> </span><br><span class="line">        D:/Rcore/bin/x64 </span><br><span class="line">                    <span class="literal">TRUE</span></span><br></pre></td></tr></table></figure><p>mode = 0, 检查文件或目录是否存在 mode = 1, 检查文件或目录是否可执行 mode = 2, 检查文件或目录是否可写 mode = 4, 检查文件或目录是否可读</p><blockquote><p>file.access()返回的是逻辑值，file.info()返回的是详细的权限信息</p></blockquote><h4 id="修改目录权限">修改目录权限</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Sys.chmod(list.dirs(<span class="string">&quot;.&quot;</span>), <span class="string">&quot;777&quot;</span>)</span><br><span class="line">f &lt;- list.files(<span class="string">&quot;.&quot;</span>, all.files = <span class="literal">TRUE</span>, full.names = <span class="literal">TRUE</span>, recursive = <span class="literal">TRUE</span>)</span><br><span class="line">Sys.chmod(f, (file.info(f)$mode | <span class="string">&quot;664&quot;</span>))</span><br></pre></td></tr></table></figure><h4 id="对目录重名">对目录重名</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对tmp目录重命名</span></span><br><span class="line">&gt; file.rename(<span class="string">&quot;tmp&quot;</span>, <span class="string">&quot;tmp2&quot;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="literal">TRUE</span></span><br></pre></td></tr></table></figure><h4 id="删除目录">删除目录</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除tmp2目录</span></span><br><span class="line">&gt; unlink(<span class="string">&quot;tmp2&quot;</span>, recursive = <span class="literal">TRUE</span>)</span><br></pre></td></tr></table></figure><h4 id="其他功能">其他功能</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 拼接目录字符串</span></span><br><span class="line">&gt; file.path(<span class="string">&quot;p1&quot;</span>,<span class="string">&quot;p2&quot;</span>,<span class="string">&quot;p3&quot;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;p1/p2/p3&quot;</span></span><br><span class="line"><span class="comment"># 最底层子目录或文件名</span></span><br><span class="line">&gt; filename&lt;-<span class="string">&#x27;C:/test/lalala.txt&#x27;</span></span><br><span class="line">&gt; basename(filename)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;lalala.txt&quot;</span></span><br><span class="line"><span class="comment"># 最底层子目录</span></span><br><span class="line">&gt; dirname(filename)r</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;C:/test&quot;</span></span><br><span class="line"><span class="comment"># 转换扩展路径</span></span><br><span class="line">&gt; path.expand(<span class="string">&quot;~/foo&quot;</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">&quot;/home/conan/foo&quot;</span></span><br></pre></td></tr></table></figure><h2 id="常规文件操作">常规文件操作</h2><p>cat(“file A”, file=”A”) #创建一个文件A，文件内容是’file A’,’’表示换行，这是一个很好的习惯</p><p>cat(“file B”, file=”B”) #创建一个文件B</p><p>file.append(“A”, “B”) #将文件B的内容附到A内容的后面，注意没有空行</p><p>file.create(“A”) #创建一个文件A, 注意会覆盖原来的文件</p><p>file.append(“A”, rep(“B”, 10)) #将文件B的内容复制10便，并先后附到文件A内容后</p><p>file.show(“A”) #新开工作窗口显示文件A的内容</p><p>file.copy(“A”, “C”) #复制文件A保存为C文件，同一个文件夹</p><p>dir.create(“tmp”) #创建名为tmp的文件夹</p><p>file.copy(c(“A”, “B”), “tmp”) #将文件夹拷贝到tmp文件夹中</p><p>list.files(“tmp”) #查看文件夹tmp中的文件名</p><p>unlink(“tmp”, recursive=F) #如果文件夹tmp为空，删除文件夹tmp</p><p>unlink(“tmp”, recursive=TRUE) #删除文件夹tmp，如果其中有文件一并删除</p><p>file.remove(“A”, “B”, “C”) #移除三个文件</p><h2 id="特殊目录">特殊目录</h2><ul><li>R.home() 查看R软件的相关目录</li><li>.Library 查看R核心包的目录</li><li>.Library.site 查看R核心包的目录和root用户安装包目录</li><li>.libPaths() 查看R所有包的存放目录</li><li>system.file() 查看指定包所在的目录</li></ul>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> base </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>emoji表情收集</title>
      <link href="2019/03/31/emoji/"/>
      <url>2019/03/31/emoji/</url>
      
        <content type="html"><![CDATA[<h2 id="table-of-contents">Table of Contents</h2><ul><li><a href="#table-of-contents">Table of Contents</a><ul><li><a href="#people">People</a></li><li><a href="#nature">Nature</a></li><li><a href="#objects">Objects</a></li><li><a href="#places">Places</a></li><li><a href="#symbols">Symbols</a></li><li><a href="#uncategorized">Uncategorized</a></li></ul></li></ul><h3 id="people">People</h3><table><colgroup><col style="width: 5%" /><col style="width: 17%" /><col style="width: 29%" /><col style="width: 17%" /><col style="width: 29%" /></colgroup><thead><tr class="header"><th></th><th>ico</th><th>emoji</th><th>ico</th><th>emoji</th></tr></thead><tbody><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:bowtie:</td><td><code>:bowtie:</code></td><td>:smile:</td><td><code>:smile:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:laughing:</td><td><code>:laughing:</code></td><td>:blush:</td><td><code>:blush:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:smiley:</td><td><code>:smiley:</code></td><td>:relaxed:</td><td><code>:relaxed:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:smirk:</td><td><code>:smirk:</code></td><td>:heart_eyes:</td><td><code>:heart_eyes:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:kissing_heart:</td><td><code>:kissing_heart:</code></td><td>:kissing_closed_eyes:</td><td><code>:kissing_closed_eyes:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:flushed:</td><td><code>:flushed:</code></td><td>:relieved:</td><td><code>:relieved:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:satisfied:</td><td><code>:satisfied:</code></td><td>:grin:</td><td><code>:grin:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:wink:</td><td><code>:wink:</code></td><td>:stuck_out_tongue_winking_eye:</td><td><code>:stuck_out_tongue_winking_eye:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:stuck_out_tongue_closed_eyes:</td><td><code>:stuck_out_tongue_closed_eyes:</code></td><td>:grinning:</td><td><code>:grinning:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:kissing:</td><td><code>:kissing:</code></td><td>:kissing_smiling_eyes:</td><td><code>:kissing_smiling_eyes:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:stuck_out_tongue:</td><td><code>:stuck_out_tongue:</code></td><td>:sleeping:</td><td><code>:sleeping:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:worried:</td><td><code>:worried:</code></td><td>:frowning:</td><td><code>:frowning:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:anguished:</td><td><code>:anguished:</code></td><td>:open_mouth:</td><td><code>:open_mouth:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:grimacing:</td><td><code>:grimacing:</code></td><td>:confused:</td><td><code>:confused:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:hushed:</td><td><code>:hushed:</code></td><td>:expressionless:</td><td><code>:expressionless:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:unamused:</td><td><code>:unamused:</code></td><td>:sweat_smile:</td><td><code>:sweat_smile:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:sweat:</td><td><code>:sweat:</code></td><td>:disappointed_relieved:</td><td><code>:disappointed_relieved:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:weary:</td><td><code>:weary:</code></td><td>:pensive:</td><td><code>:pensive:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:disappointed:</td><td><code>:disappointed:</code></td><td>:confounded:</td><td><code>:confounded:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:fearful:</td><td><code>:fearful:</code></td><td>:cold_sweat:</td><td><code>:cold_sweat:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:persevere:</td><td><code>:persevere:</code></td><td>:cry:</td><td><code>:cry:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:sob:</td><td><code>:sob:</code></td><td>:joy:</td><td><code>:joy:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:astonished:</td><td><code>:astonished:</code></td><td>:scream:</td><td><code>:scream:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:neckbeard:</td><td><code>:neckbeard:</code></td><td>:tired_face:</td><td><code>:tired_face:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:angry:</td><td><code>:angry:</code></td><td>:rage:</td><td><code>:rage:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:triumph:</td><td><code>:triumph:</code></td><td>:sleepy:</td><td><code>:sleepy:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:yum:</td><td><code>:yum:</code></td><td>:mask:</td><td><code>:mask:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:sunglasses:</td><td><code>:sunglasses:</code></td><td>:dizzy_face:</td><td><code>:dizzy_face:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:imp:</td><td><code>:imp:</code></td><td>:smiling_imp:</td><td><code>:smiling_imp:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:neutral_face:</td><td><code>:neutral_face:</code></td><td>:no_mouth:</td><td><code>:no_mouth:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:innocent:</td><td><code>:innocent:</code></td><td>:alien:</td><td><code>:alien:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:yellow_heart:</td><td><code>:yellow_heart:</code></td><td>:blue_heart:</td><td><code>:blue_heart:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:purple_heart:</td><td><code>:purple_heart:</code></td><td>:heart:</td><td><code>:heart:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:green_heart:</td><td><code>:green_heart:</code></td><td>:broken_heart:</td><td><code>:broken_heart:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:heartbeat:</td><td><code>:heartbeat:</code></td><td>:heartpulse:</td><td><code>:heartpulse:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:two_hearts:</td><td><code>:two_hearts:</code></td><td>:revolving_hearts:</td><td><code>:revolving_hearts:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:cupid:</td><td><code>:cupid:</code></td><td>:sparkling_heart:</td><td><code>:sparkling_heart:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:sparkles:</td><td><code>:sparkles:</code></td><td>:star:</td><td><code>:star:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:star2:</td><td><code>:star2:</code></td><td>:dizzy:</td><td><code>:dizzy:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:boom:</td><td><code>:boom:</code></td><td>:collision:</td><td><code>:collision:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:anger:</td><td><code>:anger:</code></td><td>:exclamation:</td><td><code>:exclamation:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:question:</td><td><code>:question:</code></td><td>:grey_exclamation:</td><td><code>:grey_exclamation:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:grey_question:</td><td><code>:grey_question:</code></td><td>:zzz:</td><td><code>:zzz:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:dash:</td><td><code>:dash:</code></td><td>:sweat_drops:</td><td><code>:sweat_drops:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:notes:</td><td><code>:notes:</code></td><td>:musical_note:</td><td><code>:musical_note:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:fire:</td><td><code>:fire:</code></td><td>:hankey:</td><td><code>:hankey:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:poop:</td><td><code>:poop:</code></td><td>:shit:</td><td><code>:shit:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:+1:</td><td><code>:+1:</code></td><td>:thumbsup:</td><td><code>:thumbsup:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:-1:</td><td><code>:-1:</code></td><td>:thumbsdown:</td><td><code>:thumbsdown:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:ok_hand:</td><td><code>:ok_hand:</code></td><td>:punch:</td><td><code>:punch:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:facepunch:</td><td><code>:facepunch:</code></td><td>:fist:</td><td><code>:fist:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:v:</td><td><code>:v:</code></td><td>:wave:</td><td><code>:wave:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:hand:</td><td><code>:hand:</code></td><td>:raised_hand:</td><td><code>:raised_hand:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:open_hands:</td><td><code>:open_hands:</code></td><td>:point_up:</td><td><code>:point_up:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:point_down:</td><td><code>:point_down:</code></td><td>:point_left:</td><td><code>:point_left:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:point_right:</td><td><code>:point_right:</code></td><td>:raised_hands:</td><td><code>:raised_hands:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:pray:</td><td><code>:pray:</code></td><td>:point_up_2:</td><td><code>:point_up_2:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:clap:</td><td><code>:clap:</code></td><td>:muscle:</td><td><code>:muscle:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:metal:</td><td><code>:metal:</code></td><td>:fu:</td><td><code>:fu:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:runner:</td><td><code>:runner:</code></td><td>:running:</td><td><code>:running:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:couple:</td><td><code>:couple:</code></td><td>:family:</td><td><code>:family:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:two_men_holding_hands:</td><td><code>:two_men_holding_hands:</code></td><td>:two_women_holding_hands:</td><td><code>:two_women_holding_hands:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:dancer:</td><td><code>:dancer:</code></td><td>:dancers:</td><td><code>:dancers:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:ok_woman:</td><td><code>:ok_woman:</code></td><td>:no_good:</td><td><code>:no_good:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:information_desk_person:</td><td><code>:information_desk_person:</code></td><td>:raising_hand:</td><td><code>:raising_hand:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:bride_with_veil:</td><td><code>:bride_with_veil:</code></td><td>:person_with_pouting_face:</td><td><code>:person_with_pouting_face:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:person_frowning:</td><td><code>:person_frowning:</code></td><td>:bow:</td><td><code>:bow:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:couple_with_heart:</td><td><code>:couple_with_heart:</code></td><td>:massage:</td><td><code>:massage:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:haircut:</td><td><code>:haircut:</code></td><td>:nail_care:</td><td><code>:nail_care:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:boy:</td><td><code>:boy:</code></td><td>:girl:</td><td><code>:girl:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:woman:</td><td><code>:woman:</code></td><td>:man:</td><td><code>:man:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:baby:</td><td><code>:baby:</code></td><td>:older_woman:</td><td><code>:older_woman:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:older_man:</td><td><code>:older_man:</code></td><td>:person_with_blond_hair:</td><td><code>:person_with_blond_hair:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:man_with_gua_pi_mao:</td><td><code>:man_with_gua_pi_mao:</code></td><td>:man_with_turban:</td><td><code>:man_with_turban:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:construction_worker:</td><td><code>:construction_worker:</code></td><td>:cop:</td><td><code>:cop:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:angel:</td><td><code>:angel:</code></td><td>:princess:</td><td><code>:princess:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:smiley_cat:</td><td><code>:smiley_cat:</code></td><td>:smile_cat:</td><td><code>:smile_cat:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:heart_eyes_cat:</td><td><code>:heart_eyes_cat:</code></td><td>:kissing_cat:</td><td><code>:kissing_cat:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:smirk_cat:</td><td><code>:smirk_cat:</code></td><td>:scream_cat:</td><td><code>:scream_cat:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:crying_cat_face:</td><td><code>:crying_cat_face:</code></td><td>:joy_cat:</td><td><code>:joy_cat:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:pouting_cat:</td><td><code>:pouting_cat:</code></td><td>:japanese_ogre:</td><td><code>:japanese_ogre:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:japanese_goblin:</td><td><code>:japanese_goblin:</code></td><td>:see_no_evil:</td><td><code>:see_no_evil:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:hear_no_evil:</td><td><code>:hear_no_evil:</code></td><td>:speak_no_evil:</td><td><code>:speak_no_evil:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:guardsman:</td><td><code>:guardsman:</code></td><td>:skull:</td><td><code>:skull:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:feet:</td><td><code>:feet:</code></td><td>:lips:</td><td><code>:lips:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:kiss:</td><td><code>:kiss:</code></td><td>:droplet:</td><td><code>:droplet:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:ear:</td><td><code>:ear:</code></td><td>:eyes:</td><td><code>:eyes:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:nose:</td><td><code>:nose:</code></td><td>:tongue:</td><td><code>:tongue:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:love_letter:</td><td><code>:love_letter:</code></td><td>:bust_in_silhouette:</td><td><code>:bust_in_silhouette:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:busts_in_silhouette:</td><td><code>:busts_in_silhouette:</code></td><td>:speech_balloon:</td><td><code>:speech_balloon:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:thought_balloon:</td><td><code>:thought_balloon:</code></td><td>:feelsgood:</td><td><code>:feelsgood:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:finnadie:</td><td><code>:finnadie:</code></td><td>:goberserk:</td><td><code>:goberserk:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:godmode:</td><td><code>:godmode:</code></td><td>:hurtrealbad:</td><td><code>:hurtrealbad:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:rage1:</td><td><code>:rage1:</code></td><td>:rage2:</td><td><code>:rage2:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:rage3:</td><td><code>:rage3:</code></td><td>:rage4:</td><td><code>:rage4:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:suspect:</td><td><code>:suspect:</code></td><td>:trollface:</td><td><code>:trollface:</code></td></tr></tbody></table><h3 id="nature">Nature</h3><table><colgroup><col style="width: 5%" /><col style="width: 17%" /><col style="width: 29%" /><col style="width: 17%" /><col style="width: 29%" /></colgroup><thead><tr class="header"><th></th><th>ico</th><th>emoji</th><th>ico</th><th>emoji</th></tr></thead><tbody><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:sunny:</td><td><code>:sunny:</code></td><td>:umbrella:</td><td><code>:umbrella:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:cloud:</td><td><code>:cloud:</code></td><td>:snowflake:</td><td><code>:snowflake:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:snowman:</td><td><code>:snowman:</code></td><td>:zap:</td><td><code>:zap:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:cyclone:</td><td><code>:cyclone:</code></td><td>:foggy:</td><td><code>:foggy:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:ocean:</td><td><code>:ocean:</code></td><td>:cat:</td><td><code>:cat:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:dog:</td><td><code>:dog:</code></td><td>:mouse:</td><td><code>:mouse:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:hamster:</td><td><code>:hamster:</code></td><td>:rabbit:</td><td><code>:rabbit:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:wolf:</td><td><code>:wolf:</code></td><td>:frog:</td><td><code>:frog:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:tiger:</td><td><code>:tiger:</code></td><td>:koala:</td><td><code>:koala:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:bear:</td><td><code>:bear:</code></td><td>:pig:</td><td><code>:pig:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:pig_nose:</td><td><code>:pig_nose:</code></td><td>:cow:</td><td><code>:cow:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:boar:</td><td><code>:boar:</code></td><td>:monkey_face:</td><td><code>:monkey_face:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:monkey:</td><td><code>:monkey:</code></td><td>:horse:</td><td><code>:horse:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:racehorse:</td><td><code>:racehorse:</code></td><td>:camel:</td><td><code>:camel:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:sheep:</td><td><code>:sheep:</code></td><td>:elephant:</td><td><code>:elephant:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:panda_face:</td><td><code>:panda_face:</code></td><td>:snake:</td><td><code>:snake:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:bird:</td><td><code>:bird:</code></td><td>:baby_chick:</td><td><code>:baby_chick:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:hatched_chick:</td><td><code>:hatched_chick:</code></td><td>:hatching_chick:</td><td><code>:hatching_chick:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:chicken:</td><td><code>:chicken:</code></td><td>:penguin:</td><td><code>:penguin:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:turtle:</td><td><code>:turtle:</code></td><td>:bug:</td><td><code>:bug:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:honeybee:</td><td><code>:honeybee:</code></td><td>:ant:</td><td><code>:ant:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:beetle:</td><td><code>:beetle:</code></td><td>:snail:</td><td><code>:snail:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:octopus:</td><td><code>:octopus:</code></td><td>:tropical_fish:</td><td><code>:tropical_fish:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:fish:</td><td><code>:fish:</code></td><td>:whale:</td><td><code>:whale:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:whale2:</td><td><code>:whale2:</code></td><td>:dolphin:</td><td><code>:dolphin:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:cow2:</td><td><code>:cow2:</code></td><td>:ram:</td><td><code>:ram:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:rat:</td><td><code>:rat:</code></td><td>:water_buffalo:</td><td><code>:water_buffalo:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:tiger2:</td><td><code>:tiger2:</code></td><td>:rabbit2:</td><td><code>:rabbit2:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:dragon:</td><td><code>:dragon:</code></td><td>:goat:</td><td><code>:goat:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:rooster:</td><td><code>:rooster:</code></td><td>:dog2:</td><td><code>:dog2:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:pig2:</td><td><code>:pig2:</code></td><td>:mouse2:</td><td><code>:mouse2:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:ox:</td><td><code>:ox:</code></td><td>:dragon_face:</td><td><code>:dragon_face:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:blowfish:</td><td><code>:blowfish:</code></td><td>:crocodile:</td><td><code>:crocodile:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:dromedary_camel:</td><td><code>:dromedary_camel:</code></td><td>:leopard:</td><td><code>:leopard:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:cat2:</td><td><code>:cat2:</code></td><td>:poodle:</td><td><code>:poodle:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:paw_prints:</td><td><code>:paw_prints:</code></td><td>:bouquet:</td><td><code>:bouquet:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:cherry_blossom:</td><td><code>:cherry_blossom:</code></td><td>:tulip:</td><td><code>:tulip:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:four_leaf_clover:</td><td><code>:four_leaf_clover:</code></td><td>:rose:</td><td><code>:rose:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:sunflower:</td><td><code>:sunflower:</code></td><td>:hibiscus:</td><td><code>:hibiscus:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:maple_leaf:</td><td><code>:maple_leaf:</code></td><td>:leaves:</td><td><code>:leaves:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:fallen_leaf:</td><td><code>:fallen_leaf:</code></td><td>:herb:</td><td><code>:herb:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:mushroom:</td><td><code>:mushroom:</code></td><td>:cactus:</td><td><code>:cactus:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:palm_tree:</td><td><code>:palm_tree:</code></td><td>:evergreen_tree:</td><td><code>:evergreen_tree:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:deciduous_tree:</td><td><code>:deciduous_tree:</code></td><td>:chestnut:</td><td><code>:chestnut:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:seedling:</td><td><code>:seedling:</code></td><td>:blossom:</td><td><code>:blossom:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:ear_of_rice:</td><td><code>:ear_of_rice:</code></td><td>:shell:</td><td><code>:shell:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:globe_with_meridians:</td><td><code>:globe_with_meridians:</code></td><td>:sun_with_face:</td><td><code>:sun_with_face:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:full_moon_with_face:</td><td><code>:full_moon_with_face:</code></td><td>:new_moon_with_face:</td><td><code>:new_moon_with_face:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:new_moon:</td><td><code>:new_moon:</code></td><td>:waxing_crescent_moon:</td><td><code>:waxing_crescent_moon:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:first_quarter_moon:</td><td><code>:first_quarter_moon:</code></td><td>:waxing_gibbous_moon:</td><td><code>:waxing_gibbous_moon:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:full_moon:</td><td><code>:full_moon:</code></td><td>:waning_gibbous_moon:</td><td><code>:waning_gibbous_moon:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:last_quarter_moon:</td><td><code>:last_quarter_moon:</code></td><td>:waning_crescent_moon:</td><td><code>:waning_crescent_moon:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:last_quarter_moon_with_face:</td><td><code>:last_quarter_moon_with_face:</code></td><td>:first_quarter_moon_with_face:</td><td><code>:first_quarter_moon_with_face:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:crescent_moon:</td><td><code>:crescent_moon:</code></td><td>:earth_africa:</td><td><code>:earth_africa:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:earth_americas:</td><td><code>:earth_americas:</code></td><td>:earth_asia:</td><td><code>:earth_asia:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:volcano:</td><td><code>:volcano:</code></td><td>:milky_way:</td><td><code>:milky_way:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:partly_sunny:</td><td><code>:partly_sunny:</code></td><td>:octocat:</td><td><code>:octocat:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:squirrel:</td><td><code>:squirrel:</code></td><td></td><td></td></tr></tbody></table><h3 id="objects">Objects</h3><table><colgroup><col style="width: 5%" /><col style="width: 17%" /><col style="width: 29%" /><col style="width: 17%" /><col style="width: 29%" /></colgroup><thead><tr class="header"><th></th><th>ico</th><th>emoji</th><th>ico</th><th>emoji</th></tr></thead><tbody><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:bamboo:</td><td><code>:bamboo:</code></td><td>:gift_heart:</td><td><code>:gift_heart:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:dolls:</td><td><code>:dolls:</code></td><td>:school_satchel:</td><td><code>:school_satchel:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:mortar_board:</td><td><code>:mortar_board:</code></td><td>:flags:</td><td><code>:flags:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:fireworks:</td><td><code>:fireworks:</code></td><td>:sparkler:</td><td><code>:sparkler:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:wind_chime:</td><td><code>:wind_chime:</code></td><td>:rice_scene:</td><td><code>:rice_scene:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:jack_o_lantern:</td><td><code>:jack_o_lantern:</code></td><td>:ghost:</td><td><code>:ghost:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:santa:</td><td><code>:santa:</code></td><td>:christmas_tree:</td><td><code>:christmas_tree:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:gift:</td><td><code>:gift:</code></td><td>:bell:</td><td><code>:bell:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:no_bell:</td><td><code>:no_bell:</code></td><td>:tanabata_tree:</td><td><code>:tanabata_tree:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:tada:</td><td><code>:tada:</code></td><td>:confetti_ball:</td><td><code>:confetti_ball:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:balloon:</td><td><code>:balloon:</code></td><td>:crystal_ball:</td><td><code>:crystal_ball:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:cd:</td><td><code>:cd:</code></td><td>:dvd:</td><td><code>:dvd:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:floppy_disk:</td><td><code>:floppy_disk:</code></td><td>:camera:</td><td><code>:camera:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:video_camera:</td><td><code>:video_camera:</code></td><td>:movie_camera:</td><td><code>:movie_camera:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:computer:</td><td><code>:computer:</code></td><td>:tv:</td><td><code>:tv:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:iphone:</td><td><code>:iphone:</code></td><td>:phone:</td><td><code>:phone:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:telephone:</td><td><code>:telephone:</code></td><td>:telephone_receiver:</td><td><code>:telephone_receiver:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:pager:</td><td><code>:pager:</code></td><td>:fax:</td><td><code>:fax:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:minidisc:</td><td><code>:minidisc:</code></td><td>:vhs:</td><td><code>:vhs:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:sound:</td><td><code>:sound:</code></td><td>:speaker:</td><td><code>:speaker:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:mute:</td><td><code>:mute:</code></td><td>:loudspeaker:</td><td><code>:loudspeaker:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:mega:</td><td><code>:mega:</code></td><td>:hourglass:</td><td><code>:hourglass:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:hourglass_flowing_sand:</td><td><code>:hourglass_flowing_sand:</code></td><td>:alarm_clock:</td><td><code>:alarm_clock:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:watch:</td><td><code>:watch:</code></td><td>:radio:</td><td><code>:radio:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:satellite:</td><td><code>:satellite:</code></td><td>:loop:</td><td><code>:loop:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:mag:</td><td><code>:mag:</code></td><td>:mag_right:</td><td><code>:mag_right:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:unlock:</td><td><code>:unlock:</code></td><td>:lock:</td><td><code>:lock:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:lock_with_ink_pen:</td><td><code>:lock_with_ink_pen:</code></td><td>:closed_lock_with_key:</td><td><code>:closed_lock_with_key:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:key:</td><td><code>:key:</code></td><td>:bulb:</td><td><code>:bulb:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:flashlight:</td><td><code>:flashlight:</code></td><td>:high_brightness:</td><td><code>:high_brightness:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:low_brightness:</td><td><code>:low_brightness:</code></td><td>:electric_plug:</td><td><code>:electric_plug:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:battery:</td><td><code>:battery:</code></td><td>:calling:</td><td><code>:calling:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:email:</td><td><code>:email:</code></td><td>:mailbox:</td><td><code>:mailbox:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:postbox:</td><td><code>:postbox:</code></td><td>:bath:</td><td><code>:bath:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:bathtub:</td><td><code>:bathtub:</code></td><td>:shower:</td><td><code>:shower:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:toilet:</td><td><code>:toilet:</code></td><td>:wrench:</td><td><code>:wrench:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:nut_and_bolt:</td><td><code>:nut_and_bolt:</code></td><td>:hammer:</td><td><code>:hammer:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:seat:</td><td><code>:seat:</code></td><td>:moneybag:</td><td><code>:moneybag:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:yen:</td><td><code>:yen:</code></td><td>:dollar:</td><td><code>:dollar:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:pound:</td><td><code>:pound:</code></td><td>:euro:</td><td><code>:euro:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:credit_card:</td><td><code>:credit_card:</code></td><td>:money_with_wings:</td><td><code>:money_with_wings:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:e-mail:</td><td><code>:e-mail:</code></td><td>:inbox_tray:</td><td><code>:inbox_tray:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:outbox_tray:</td><td><code>:outbox_tray:</code></td><td>:envelope:</td><td><code>:envelope:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:incoming_envelope:</td><td><code>:incoming_envelope:</code></td><td>:postal_horn:</td><td><code>:postal_horn:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:mailbox_closed:</td><td><code>:mailbox_closed:</code></td><td>:mailbox_with_mail:</td><td><code>:mailbox_with_mail:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:mailbox_with_no_mail:</td><td><code>:mailbox_with_no_mail:</code></td><td>:package:</td><td><code>:package:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:door:</td><td><code>:door:</code></td><td>:smoking:</td><td><code>:smoking:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:bomb:</td><td><code>:bomb:</code></td><td>:gun:</td><td><code>:gun:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:hocho:</td><td><code>:hocho:</code></td><td>:pill:</td><td><code>:pill:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:syringe:</td><td><code>:syringe:</code></td><td>:page_facing_up:</td><td><code>:page_facing_up:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:page_with_curl:</td><td><code>:page_with_curl:</code></td><td>:bookmark_tabs:</td><td><code>:bookmark_tabs:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:bar_chart:</td><td><code>:bar_chart:</code></td><td>:chart_with_upwards_trend:</td><td><code>:chart_with_upwards_trend:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:chart_with_downwards_trend:</td><td><code>:chart_with_downwards_trend:</code></td><td>:scroll:</td><td><code>:scroll:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:clipboard:</td><td><code>:clipboard:</code></td><td>:calendar:</td><td><code>:calendar:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:date:</td><td><code>:date:</code></td><td>:card_index:</td><td><code>:card_index:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:file_folder:</td><td><code>:file_folder:</code></td><td>:open_file_folder:</td><td><code>:open_file_folder:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:scissors:</td><td><code>:scissors:</code></td><td>:pushpin:</td><td><code>:pushpin:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:paperclip:</td><td><code>:paperclip:</code></td><td>:black_nib:</td><td><code>:black_nib:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:pencil2:</td><td><code>:pencil2:</code></td><td>:straight_ruler:</td><td><code>:straight_ruler:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:triangular_ruler:</td><td><code>:triangular_ruler:</code></td><td>:closed_book:</td><td><code>:closed_book:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:green_book:</td><td><code>:green_book:</code></td><td>:blue_book:</td><td><code>:blue_book:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:orange_book:</td><td><code>:orange_book:</code></td><td>:notebook:</td><td><code>:notebook:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:notebook_with_decorative_cover:</td><td><code>:notebook_with_decorative_cover:</code></td><td>:ledger:</td><td><code>:ledger:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:books:</td><td><code>:books:</code></td><td>:bookmark:</td><td><code>:bookmark:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:name_badge:</td><td><code>:name_badge:</code></td><td>:microscope:</td><td><code>:microscope:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:telescope:</td><td><code>:telescope:</code></td><td>:newspaper:</td><td><code>:newspaper:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:football:</td><td><code>:football:</code></td><td>:basketball:</td><td><code>:basketball:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:soccer:</td><td><code>:soccer:</code></td><td>:baseball:</td><td><code>:baseball:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:tennis:</td><td><code>:tennis:</code></td><td>:8ball:</td><td><code>:8ball:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:rugby_football:</td><td><code>:rugby_football:</code></td><td>:bowling:</td><td><code>:bowling:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:golf:</td><td><code>:golf:</code></td><td>:mountain_bicyclist:</td><td><code>:mountain_bicyclist:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:bicyclist:</td><td><code>:bicyclist:</code></td><td>:horse_racing:</td><td><code>:horse_racing:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:snowboarder:</td><td><code>:snowboarder:</code></td><td>:swimmer:</td><td><code>:swimmer:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:surfer:</td><td><code>:surfer:</code></td><td>:ski:</td><td><code>:ski:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:spades:</td><td><code>:spades:</code></td><td>:hearts:</td><td><code>:hearts:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:clubs:</td><td><code>:clubs:</code></td><td>:diamonds:</td><td><code>:diamonds:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:gem:</td><td><code>:gem:</code></td><td>:ring:</td><td><code>:ring:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:trophy:</td><td><code>:trophy:</code></td><td>:musical_score:</td><td><code>:musical_score:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:musical_keyboard:</td><td><code>:musical_keyboard:</code></td><td>:violin:</td><td><code>:violin:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:space_invader:</td><td><code>:space_invader:</code></td><td>:video_game:</td><td><code>:video_game:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:black_joker:</td><td><code>:black_joker:</code></td><td>:flower_playing_cards:</td><td><code>:flower_playing_cards:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:game_die:</td><td><code>:game_die:</code></td><td>:dart:</td><td><code>:dart:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:mahjong:</td><td><code>:mahjong:</code></td><td>:clapper:</td><td><code>:clapper:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:memo:</td><td><code>:memo:</code></td><td>:pencil:</td><td><code>:pencil:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:book:</td><td><code>:book:</code></td><td>:art:</td><td><code>:art:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:microphone:</td><td><code>:microphone:</code></td><td>:headphones:</td><td><code>:headphones:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:trumpet:</td><td><code>:trumpet:</code></td><td>:saxophone:</td><td><code>:saxophone:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:guitar:</td><td><code>:guitar:</code></td><td>:shoe:</td><td><code>:shoe:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:sandal:</td><td><code>:sandal:</code></td><td>:high_heel:</td><td><code>:high_heel:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:lipstick:</td><td><code>:lipstick:</code></td><td>:boot:</td><td><code>:boot:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:shirt:</td><td><code>:shirt:</code></td><td>:tshirt:</td><td><code>:tshirt:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:necktie:</td><td><code>:necktie:</code></td><td>:womans_clothes:</td><td><code>:womans_clothes:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:dress:</td><td><code>:dress:</code></td><td>:running_shirt_with_sash:</td><td><code>:running_shirt_with_sash:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:jeans:</td><td><code>:jeans:</code></td><td>:kimono:</td><td><code>:kimono:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:bikini:</td><td><code>:bikini:</code></td><td>:ribbon:</td><td><code>:ribbon:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:tophat:</td><td><code>:tophat:</code></td><td>:crown:</td><td><code>:crown:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:womans_hat:</td><td><code>:womans_hat:</code></td><td>:mans_shoe:</td><td><code>:mans_shoe:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:closed_umbrella:</td><td><code>:closed_umbrella:</code></td><td>:briefcase:</td><td><code>:briefcase:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:handbag:</td><td><code>:handbag:</code></td><td>:pouch:</td><td><code>:pouch:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:purse:</td><td><code>:purse:</code></td><td>:eyeglasses:</td><td><code>:eyeglasses:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:fishing_pole_and_fish:</td><td><code>:fishing_pole_and_fish:</code></td><td>:coffee:</td><td><code>:coffee:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:tea:</td><td><code>:tea:</code></td><td>:sake:</td><td><code>:sake:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:baby_bottle:</td><td><code>:baby_bottle:</code></td><td>:beer:</td><td><code>:beer:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:beers:</td><td><code>:beers:</code></td><td>:cocktail:</td><td><code>:cocktail:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:tropical_drink:</td><td><code>:tropical_drink:</code></td><td>:wine_glass:</td><td><code>:wine_glass:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:fork_and_knife:</td><td><code>:fork_and_knife:</code></td><td>:pizza:</td><td><code>:pizza:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:hamburger:</td><td><code>:hamburger:</code></td><td>:fries:</td><td><code>:fries:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:poultry_leg:</td><td><code>:poultry_leg:</code></td><td>:meat_on_bone:</td><td><code>:meat_on_bone:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:spaghetti:</td><td><code>:spaghetti:</code></td><td>:curry:</td><td><code>:curry:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:fried_shrimp:</td><td><code>:fried_shrimp:</code></td><td>:bento:</td><td><code>:bento:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:sushi:</td><td><code>:sushi:</code></td><td>:fish_cake:</td><td><code>:fish_cake:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:rice_ball:</td><td><code>:rice_ball:</code></td><td>:rice_cracker:</td><td><code>:rice_cracker:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:rice:</td><td><code>:rice:</code></td><td>:ramen:</td><td><code>:ramen:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:stew:</td><td><code>:stew:</code></td><td>:oden:</td><td><code>:oden:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:dango:</td><td><code>:dango:</code></td><td>:egg:</td><td><code>:egg:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:bread:</td><td><code>:bread:</code></td><td>:doughnut:</td><td><code>:doughnut:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:custard:</td><td><code>:custard:</code></td><td>:icecream:</td><td><code>:icecream:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:ice_cream:</td><td><code>:ice_cream:</code></td><td>:shaved_ice:</td><td><code>:shaved_ice:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:birthday:</td><td><code>:birthday:</code></td><td>:cake:</td><td><code>:cake:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:cookie:</td><td><code>:cookie:</code></td><td>:chocolate_bar:</td><td><code>:chocolate_bar:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:candy:</td><td><code>:candy:</code></td><td>:lollipop:</td><td><code>:lollipop:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:honey_pot:</td><td><code>:honey_pot:</code></td><td>:apple:</td><td><code>:apple:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:green_apple:</td><td><code>:green_apple:</code></td><td>:tangerine:</td><td><code>:tangerine:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:lemon:</td><td><code>:lemon:</code></td><td>:cherries:</td><td><code>:cherries:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:grapes:</td><td><code>:grapes:</code></td><td>:watermelon:</td><td><code>:watermelon:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:strawberry:</td><td><code>:strawberry:</code></td><td>:peach:</td><td><code>:peach:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:melon:</td><td><code>:melon:</code></td><td>:banana:</td><td><code>:banana:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:pear:</td><td><code>:pear:</code></td><td>:pineapple:</td><td><code>:pineapple:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:sweet_potato:</td><td><code>:sweet_potato:</code></td><td>:eggplant:</td><td><code>:eggplant:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:tomato:</td><td><code>:tomato:</code></td><td>:corn:</td><td><code>:corn:</code></td></tr></tbody></table><h3 id="places">Places</h3><table><colgroup><col style="width: 5%" /><col style="width: 17%" /><col style="width: 29%" /><col style="width: 17%" /><col style="width: 29%" /></colgroup><thead><tr class="header"><th></th><th>ico</th><th>emoji</th><th>ico</th><th>emoji</th></tr></thead><tbody><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:house:</td><td><code>:house:</code></td><td>:house_with_garden:</td><td><code>:house_with_garden:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:school:</td><td><code>:school:</code></td><td>:office:</td><td><code>:office:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:post_office:</td><td><code>:post_office:</code></td><td>:hospital:</td><td><code>:hospital:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:bank:</td><td><code>:bank:</code></td><td>:convenience_store:</td><td><code>:convenience_store:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:love_hotel:</td><td><code>:love_hotel:</code></td><td>:hotel:</td><td><code>:hotel:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:wedding:</td><td><code>:wedding:</code></td><td>:church:</td><td><code>:church:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:department_store:</td><td><code>:department_store:</code></td><td>:european_post_office:</td><td><code>:european_post_office:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:city_sunrise:</td><td><code>:city_sunrise:</code></td><td>:city_sunset:</td><td><code>:city_sunset:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:japanese_castle:</td><td><code>:japanese_castle:</code></td><td>:european_castle:</td><td><code>:european_castle:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:tent:</td><td><code>:tent:</code></td><td>:factory:</td><td><code>:factory:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:tokyo_tower:</td><td><code>:tokyo_tower:</code></td><td>:japan:</td><td><code>:japan:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:mount_fuji:</td><td><code>:mount_fuji:</code></td><td>:sunrise_over_mountains:</td><td><code>:sunrise_over_mountains:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:sunrise:</td><td><code>:sunrise:</code></td><td>:stars:</td><td><code>:stars:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:statue_of_liberty:</td><td><code>:statue_of_liberty:</code></td><td>:bridge_at_night:</td><td><code>:bridge_at_night:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:carousel_horse:</td><td><code>:carousel_horse:</code></td><td>:rainbow:</td><td><code>:rainbow:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:ferris_wheel:</td><td><code>:ferris_wheel:</code></td><td>:fountain:</td><td><code>:fountain:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:roller_coaster:</td><td><code>:roller_coaster:</code></td><td>:ship:</td><td><code>:ship:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:speedboat:</td><td><code>:speedboat:</code></td><td>:boat:</td><td><code>:boat:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:sailboat:</td><td><code>:sailboat:</code></td><td>:rowboat:</td><td><code>:rowboat:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:anchor:</td><td><code>:anchor:</code></td><td>:rocket:</td><td><code>:rocket:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:airplane:</td><td><code>:airplane:</code></td><td>:helicopter:</td><td><code>:helicopter:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:steam_locomotive:</td><td><code>:steam_locomotive:</code></td><td>:tram:</td><td><code>:tram:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:mountain_railway:</td><td><code>:mountain_railway:</code></td><td>:bike:</td><td><code>:bike:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:aerial_tramway:</td><td><code>:aerial_tramway:</code></td><td>:suspension_railway:</td><td><code>:suspension_railway:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:mountain_cableway:</td><td><code>:mountain_cableway:</code></td><td>:tractor:</td><td><code>:tractor:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:blue_car:</td><td><code>:blue_car:</code></td><td>:oncoming_automobile:</td><td><code>:oncoming_automobile:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:car:</td><td><code>:car:</code></td><td>:red_car:</td><td><code>:red_car:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:taxi:</td><td><code>:taxi:</code></td><td>:oncoming_taxi:</td><td><code>:oncoming_taxi:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:articulated_lorry:</td><td><code>:articulated_lorry:</code></td><td>:bus:</td><td><code>:bus:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:oncoming_bus:</td><td><code>:oncoming_bus:</code></td><td>:rotating_light:</td><td><code>:rotating_light:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:police_car:</td><td><code>:police_car:</code></td><td>:oncoming_police_car:</td><td><code>:oncoming_police_car:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:fire_engine:</td><td><code>:fire_engine:</code></td><td>:ambulance:</td><td><code>:ambulance:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:minibus:</td><td><code>:minibus:</code></td><td>:truck:</td><td><code>:truck:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:train:</td><td><code>:train:</code></td><td>:station:</td><td><code>:station:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:train2:</td><td><code>:train2:</code></td><td>:bullettrain_front:</td><td><code>:bullettrain_front:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:bullettrain_side:</td><td><code>:bullettrain_side:</code></td><td>:light_rail:</td><td><code>:light_rail:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:monorail:</td><td><code>:monorail:</code></td><td>:railway_car:</td><td><code>:railway_car:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:trolleybus:</td><td><code>:trolleybus:</code></td><td>:ticket:</td><td><code>:ticket:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:fuelpump:</td><td><code>:fuelpump:</code></td><td>:vertical_traffic_light:</td><td><code>:vertical_traffic_light:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:traffic_light:</td><td><code>:traffic_light:</code></td><td>:warning:</td><td><code>:warning:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:construction:</td><td><code>:construction:</code></td><td>:beginner:</td><td><code>:beginner:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:atm:</td><td><code>:atm:</code></td><td>:slot_machine:</td><td><code>:slot_machine:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:busstop:</td><td><code>:busstop:</code></td><td>:barber:</td><td><code>:barber:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:hotsprings:</td><td><code>:hotsprings:</code></td><td>:checkered_flag:</td><td><code>:checkered_flag:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:crossed_flags:</td><td><code>:crossed_flags:</code></td><td>:izakaya_lantern:</td><td><code>:izakaya_lantern:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:moyai:</td><td><code>:moyai:</code></td><td>:circus_tent:</td><td><code>:circus_tent:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:performing_arts:</td><td><code>:performing_arts:</code></td><td>:round_pushpin:</td><td><code>:round_pushpin:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:triangular_flag_on_post:</td><td><code>:triangular_flag_on_post:</code></td><td>:jp:</td><td><code>:jp:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:kr:</td><td><code>:kr:</code></td><td>:cn:</td><td><code>:cn:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:us:</td><td><code>:us:</code></td><td>:fr:</td><td><code>:fr:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:es:</td><td><code>:es:</code></td><td>:it:</td><td><code>:it:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:ru:</td><td><code>:ru:</code></td><td>:gb:</td><td><code>:gb:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:uk:</td><td><code>:uk:</code></td><td>:de:</td><td><code>:de:</code></td></tr></tbody></table><h3 id="symbols">Symbols</h3><table><colgroup><col style="width: 5%" /><col style="width: 17%" /><col style="width: 29%" /><col style="width: 17%" /><col style="width: 29%" /></colgroup><thead><tr class="header"><th></th><th>ico</th><th>emoji</th><th>ico</th><th>emoji</th></tr></thead><tbody><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:one:</td><td><code>:one:</code></td><td>:two:</td><td><code>:two:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:three:</td><td><code>:three:</code></td><td>:four:</td><td><code>:four:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:five:</td><td><code>:five:</code></td><td>:six:</td><td><code>:six:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:seven:</td><td><code>:seven:</code></td><td>:eight:</td><td><code>:eight:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:nine:</td><td><code>:nine:</code></td><td>:keycap_ten:</td><td><code>:keycap_ten:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:1234:</td><td><code>:1234:</code></td><td>:zero:</td><td><code>:zero:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:hash:</td><td><code>:hash:</code></td><td>:symbols:</td><td><code>:symbols:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:arrow_backward:</td><td><code>:arrow_backward:</code></td><td>:arrow_down:</td><td><code>:arrow_down:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:arrow_forward:</td><td><code>:arrow_forward:</code></td><td>:arrow_left:</td><td><code>:arrow_left:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:capital_abcd:</td><td><code>:capital_abcd:</code></td><td>:abcd:</td><td><code>:abcd:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:abc:</td><td><code>:abc:</code></td><td>:arrow_lower_left:</td><td><code>:arrow_lower_left:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:arrow_lower_right:</td><td><code>:arrow_lower_right:</code></td><td>:arrow_right:</td><td><code>:arrow_right:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:arrow_up:</td><td><code>:arrow_up:</code></td><td>:arrow_upper_left:</td><td><code>:arrow_upper_left:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:arrow_upper_right:</td><td><code>:arrow_upper_right:</code></td><td>:arrow_double_down:</td><td><code>:arrow_double_down:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:arrow_double_up:</td><td><code>:arrow_double_up:</code></td><td>:arrow_down_small:</td><td><code>:arrow_down_small:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:arrow_heading_down:</td><td><code>:arrow_heading_down:</code></td><td>:arrow_heading_up:</td><td><code>:arrow_heading_up:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:leftwards_arrow_with_hook:</td><td><code>:leftwards_arrow_with_hook:</code></td><td>:arrow_right_hook:</td><td><code>:arrow_right_hook:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:left_right_arrow:</td><td><code>:left_right_arrow:</code></td><td>:arrow_up_down:</td><td><code>:arrow_up_down:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:arrow_up_small:</td><td><code>:arrow_up_small:</code></td><td>:arrows_clockwise:</td><td><code>:arrows_clockwise:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:arrows_counterclockwise:</td><td><code>:arrows_counterclockwise:</code></td><td>:rewind:</td><td><code>:rewind:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:fast_forward:</td><td><code>:fast_forward:</code></td><td>:information_source:</td><td><code>:information_source:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:ok:</td><td><code>:ok:</code></td><td>:twisted_rightwards_arrows:</td><td><code>:twisted_rightwards_arrows:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:repeat:</td><td><code>:repeat:</code></td><td>:repeat_one:</td><td><code>:repeat_one:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:new:</td><td><code>:new:</code></td><td>:top:</td><td><code>:top:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:up:</td><td><code>:up:</code></td><td>:cool:</td><td><code>:cool:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:free:</td><td><code>:free:</code></td><td>:ng:</td><td><code>:ng:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:cinema:</td><td><code>:cinema:</code></td><td>:koko:</td><td><code>:koko:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:signal_strength:</td><td><code>:signal_strength:</code></td><td>:u5272:</td><td><code>:u5272:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:u5408:</td><td><code>:u5408:</code></td><td>:u55b6:</td><td><code>:u55b6:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:u6307:</td><td><code>:u6307:</code></td><td>:u6708:</td><td><code>:u6708:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:u6709:</td><td><code>:u6709:</code></td><td>:u6e80:</td><td><code>:u6e80:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:u7121:</td><td><code>:u7121:</code></td><td>:u7533:</td><td><code>:u7533:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:u7a7a:</td><td><code>:u7a7a:</code></td><td>:u7981:</td><td><code>:u7981:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:sa:</td><td><code>:sa:</code></td><td>:restroom:</td><td><code>:restroom:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:mens:</td><td><code>:mens:</code></td><td>:womens:</td><td><code>:womens:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:baby_symbol:</td><td><code>:baby_symbol:</code></td><td>:no_smoking:</td><td><code>:no_smoking:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:parking:</td><td><code>:parking:</code></td><td>:wheelchair:</td><td><code>:wheelchair:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:metro:</td><td><code>:metro:</code></td><td>:baggage_claim:</td><td><code>:baggage_claim:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:accept:</td><td><code>:accept:</code></td><td>:wc:</td><td><code>:wc:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:potable_water:</td><td><code>:potable_water:</code></td><td>:put_litter_in_its_place:</td><td><code>:put_litter_in_its_place:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:secret:</td><td><code>:secret:</code></td><td>:congratulations:</td><td><code>:congratulations:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:m:</td><td><code>:m:</code></td><td>:passport_control:</td><td><code>:passport_control:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:left_luggage:</td><td><code>:left_luggage:</code></td><td>:customs:</td><td><code>:customs:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:ideograph_advantage:</td><td><code>:ideograph_advantage:</code></td><td>:cl:</td><td><code>:cl:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:sos:</td><td><code>:sos:</code></td><td>:id:</td><td><code>:id:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:no_entry_sign:</td><td><code>:no_entry_sign:</code></td><td>:underage:</td><td><code>:underage:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:no_mobile_phones:</td><td><code>:no_mobile_phones:</code></td><td>:do_not_litter:</td><td><code>:do_not_litter:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:non-potable_water:</td><td><code>:non-potable_water:</code></td><td>:no_bicycles:</td><td><code>:no_bicycles:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:no_pedestrians:</td><td><code>:no_pedestrians:</code></td><td>:children_crossing:</td><td><code>:children_crossing:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:no_entry:</td><td><code>:no_entry:</code></td><td>:eight_spoked_asterisk:</td><td><code>:eight_spoked_asterisk:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:sparkle:</td><td><code>:sparkle:</code></td><td>:eight_pointed_black_star:</td><td><code>:eight_pointed_black_star:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:heart_decoration:</td><td><code>:heart_decoration:</code></td><td>:vs:</td><td><code>:vs:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:vibration_mode:</td><td><code>:vibration_mode:</code></td><td>:mobile_phone_off:</td><td><code>:mobile_phone_off:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:chart:</td><td><code>:chart:</code></td><td>:currency_exchange:</td><td><code>:currency_exchange:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:aries:</td><td><code>:aries:</code></td><td>:taurus:</td><td><code>:taurus:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:gemini:</td><td><code>:gemini:</code></td><td>:cancer:</td><td><code>:cancer:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:leo:</td><td><code>:leo:</code></td><td>:virgo:</td><td><code>:virgo:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:libra:</td><td><code>:libra:</code></td><td>:scorpius:</td><td><code>:scorpius:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:sagittarius:</td><td><code>:sagittarius:</code></td><td>:capricorn:</td><td><code>:capricorn:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:aquarius:</td><td><code>:aquarius:</code></td><td>:pisces:</td><td><code>:pisces:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:ophiuchus:</td><td><code>:ophiuchus:</code></td><td>:six_pointed_star:</td><td><code>:six_pointed_star:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:negative_squared_cross_mark:</td><td><code>:negative_squared_cross_mark:</code></td><td>:a:</td><td><code>:a:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:b:</td><td><code>:b:</code></td><td>:ab:</td><td><code>:ab:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:o2:</td><td><code>:o2:</code></td><td>:diamond_shape_with_a_dot_inside:</td><td><code>:diamond_shape_with_a_dot_inside:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:recycle:</td><td><code>:recycle:</code></td><td>:end:</td><td><code>:end:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:back:</td><td><code>:back:</code></td><td>:on:</td><td><code>:on:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:soon:</td><td><code>:soon:</code></td><td>:clock1:</td><td><code>:clock1:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:clock130:</td><td><code>:clock130:</code></td><td>:clock10:</td><td><code>:clock10:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:clock1030:</td><td><code>:clock1030:</code></td><td>:clock11:</td><td><code>:clock11:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:clock1130:</td><td><code>:clock1130:</code></td><td>:clock12:</td><td><code>:clock12:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:clock1230:</td><td><code>:clock1230:</code></td><td>:clock2:</td><td><code>:clock2:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:clock230:</td><td><code>:clock230:</code></td><td>:clock3:</td><td><code>:clock3:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:clock330:</td><td><code>:clock330:</code></td><td>:clock4:</td><td><code>:clock4:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:clock430:</td><td><code>:clock430:</code></td><td>:clock5:</td><td><code>:clock5:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:clock530:</td><td><code>:clock530:</code></td><td>:clock6:</td><td><code>:clock6:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:clock630:</td><td><code>:clock630:</code></td><td>:clock7:</td><td><code>:clock7:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:clock730:</td><td><code>:clock730:</code></td><td>:clock8:</td><td><code>:clock8:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:clock830:</td><td><code>:clock830:</code></td><td>:clock9:</td><td><code>:clock9:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:clock930:</td><td><code>:clock930:</code></td><td>:heavy_dollar_sign:</td><td><code>:heavy_dollar_sign:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:copyright:</td><td><code>:copyright:</code></td><td>:registered:</td><td><code>:registered:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:tm:</td><td><code>:tm:</code></td><td>:x:</td><td><code>:x:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:heavy_exclamation_mark:</td><td><code>:heavy_exclamation_mark:</code></td><td>:bangbang:</td><td><code>:bangbang:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:interrobang:</td><td><code>:interrobang:</code></td><td>:o:</td><td><code>:o:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:heavy_multiplication_x:</td><td><code>:heavy_multiplication_x:</code></td><td>:heavy_plus_sign:</td><td><code>:heavy_plus_sign:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:heavy_minus_sign:</td><td><code>:heavy_minus_sign:</code></td><td>:heavy_division_sign:</td><td><code>:heavy_division_sign:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:white_flower:</td><td><code>:white_flower:</code></td><td>:100:</td><td><code>:100:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:heavy_check_mark:</td><td><code>:heavy_check_mark:</code></td><td>:ballot_box_with_check:</td><td><code>:ballot_box_with_check:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:radio_button:</td><td><code>:radio_button:</code></td><td>:link:</td><td><code>:link:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:curly_loop:</td><td><code>:curly_loop:</code></td><td>:wavy_dash:</td><td><code>:wavy_dash:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:part_alternation_mark:</td><td><code>:part_alternation_mark:</code></td><td>:trident:</td><td><code>:trident:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:black_small_square:</td><td><code>:black_small_square:</code></td><td>:white_small_square:</td><td><code>:white_small_square:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:black_medium_small_square:</td><td><code>:black_medium_small_square:</code></td><td>:white_medium_small_square:</td><td><code>:white_medium_small_square:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:black_medium_square:</td><td><code>:black_medium_square:</code></td><td>:white_medium_square:</td><td><code>:white_medium_square:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:black_large_square:</td><td><code>:black_large_square:</code></td><td>:white_large_square:</td><td><code>:white_large_square:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:white_check_mark:</td><td><code>:white_check_mark:</code></td><td>:black_square_button:</td><td><code>:black_square_button:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:white_square_button:</td><td><code>:white_square_button:</code></td><td>:black_circle:</td><td><code>:black_circle:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:white_circle:</td><td><code>:white_circle:</code></td><td>:red_circle:</td><td><code>:red_circle:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:large_blue_circle:</td><td><code>:large_blue_circle:</code></td><td>:large_blue_diamond:</td><td><code>:large_blue_diamond:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:large_orange_diamond:</td><td><code>:large_orange_diamond:</code></td><td>:small_blue_diamond:</td><td><code>:small_blue_diamond:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:small_orange_diamond:</td><td><code>:small_orange_diamond:</code></td><td>:small_red_triangle:</td><td><code>:small_red_triangle:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:small_red_triangle_down:</td><td><code>:small_red_triangle_down:</code></td><td>:shipit:</td><td><code>:shipit:</code></td></tr></tbody></table><h3 id="uncategorized">Uncategorized</h3><table><colgroup><col style="width: 5%" /><col style="width: 17%" /><col style="width: 29%" /><col style="width: 17%" /><col style="width: 29%" /></colgroup><thead><tr class="header"><th></th><th>ico</th><th>emoji</th><th>ico</th><th>emoji</th></tr></thead><tbody><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:1st_place_medal:</td><td><code>:1st_place_medal:</code></td><td>:2nd_place_medal:</td><td><code>:2nd_place_medal:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:3rd_place_medal:</td><td><code>:3rd_place_medal:</code></td><td>:afghanistan:</td><td><code>:afghanistan:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:aland_islands:</td><td><code>:aland_islands:</code></td><td>:albania:</td><td><code>:albania:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:alembic:</td><td><code>:alembic:</code></td><td>:algeria:</td><td><code>:algeria:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:american_samoa:</td><td><code>:american_samoa:</code></td><td>:amphora:</td><td><code>:amphora:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:andorra:</td><td><code>:andorra:</code></td><td>:angola:</td><td><code>:angola:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:anguilla:</td><td><code>:anguilla:</code></td><td>:antarctica:</td><td><code>:antarctica:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:antigua_barbuda:</td><td><code>:antigua_barbuda:</code></td><td>:argentina:</td><td><code>:argentina:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:armenia:</td><td><code>:armenia:</code></td><td>:artificial_satellite:</td><td><code>:artificial_satellite:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:aruba:</td><td><code>:aruba:</code></td><td>:asterisk:</td><td><code>:asterisk:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:athletic_shoe:</td><td><code>:athletic_shoe:</code></td><td>:atom:</td><td><code>:atom:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:atom_symbol:</td><td><code>:atom_symbol:</code></td><td>:australia:</td><td><code>:australia:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:austria:</td><td><code>:austria:</code></td><td>:avocado:</td><td><code>:avocado:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:azerbaijan:</td><td><code>:azerbaijan:</code></td><td>:bacon:</td><td><code>:bacon:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:badminton:</td><td><code>:badminton:</code></td><td>:baguette_bread:</td><td><code>:baguette_bread:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:bahamas:</td><td><code>:bahamas:</code></td><td>:bahrain:</td><td><code>:bahrain:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:balance_scale:</td><td><code>:balance_scale:</code></td><td>:ballot_box:</td><td><code>:ballot_box:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:bangladesh:</td><td><code>:bangladesh:</code></td><td>:barbados:</td><td><code>:barbados:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:basecamp:</td><td><code>:basecamp:</code></td><td>:basecampy:</td><td><code>:basecampy:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:basketball_man:</td><td><code>:basketball_man:</code></td><td>:basketball_woman:</td><td><code>:basketball_woman:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:bat:</td><td><code>:bat:</code></td><td>:beach_umbrella:</td><td><code>:beach_umbrella:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:bed:</td><td><code>:bed:</code></td><td>:bee:</td><td><code>:bee:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:belarus:</td><td><code>:belarus:</code></td><td>:belgium:</td><td><code>:belgium:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:belize:</td><td><code>:belize:</code></td><td>:bellhop_bell:</td><td><code>:bellhop_bell:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:benin:</td><td><code>:benin:</code></td><td>:bermuda:</td><td><code>:bermuda:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:bhutan:</td><td><code>:bhutan:</code></td><td>:biking_man:</td><td><code>:biking_man:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:biking_woman:</td><td><code>:biking_woman:</code></td><td>:biohazard:</td><td><code>:biohazard:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:black_flag:</td><td><code>:black_flag:</code></td><td>:black_heart:</td><td><code>:black_heart:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:blonde_man:</td><td><code>:blonde_man:</code></td><td>:blonde_woman:</td><td><code>:blonde_woman:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:bolivia:</td><td><code>:bolivia:</code></td><td>:bosnia_herzegovina:</td><td><code>:bosnia_herzegovina:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:botswana:</td><td><code>:botswana:</code></td><td>:bow_and_arrow:</td><td><code>:bow_and_arrow:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:bowing_man:</td><td><code>:bowing_man:</code></td><td>:bowing_woman:</td><td><code>:bowing_woman:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:boxing_glove:</td><td><code>:boxing_glove:</code></td><td>:brazil:</td><td><code>:brazil:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:british_indian_ocean_territory:</td><td><code>:british_indian_ocean_territory:</code></td><td>:british_virgin_islands:</td><td><code>:british_virgin_islands:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:brunei:</td><td><code>:brunei:</code></td><td>:building_construction:</td><td><code>:building_construction:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:bulgaria:</td><td><code>:bulgaria:</code></td><td>:burkina_faso:</td><td><code>:burkina_faso:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:burrito:</td><td><code>:burrito:</code></td><td>:burundi:</td><td><code>:burundi:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:business_suit_levitating:</td><td><code>:business_suit_levitating:</code></td><td>:butterfly:</td><td><code>:butterfly:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:call_me_hand:</td><td><code>:call_me_hand:</code></td><td>:cambodia:</td><td><code>:cambodia:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:camera_flash:</td><td><code>:camera_flash:</code></td><td>:cameroon:</td><td><code>:cameroon:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:camping:</td><td><code>:camping:</code></td><td>:canada:</td><td><code>:canada:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:canary_islands:</td><td><code>:canary_islands:</code></td><td>:candle:</td><td><code>:candle:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:canoe:</td><td><code>:canoe:</code></td><td>:cape_verde:</td><td><code>:cape_verde:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:card_file_box:</td><td><code>:card_file_box:</code></td><td>:card_index_dividers:</td><td><code>:card_index_dividers:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:caribbean_netherlands:</td><td><code>:caribbean_netherlands:</code></td><td>:carrot:</td><td><code>:carrot:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:cayman_islands:</td><td><code>:cayman_islands:</code></td><td>:central_african_republic:</td><td><code>:central_african_republic:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:chad:</td><td><code>:chad:</code></td><td>:chains:</td><td><code>:chains:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:champagne:</td><td><code>:champagne:</code></td><td>:cheese:</td><td><code>:cheese:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:chile:</td><td><code>:chile:</code></td><td>:chipmunk:</td><td><code>:chipmunk:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:christmas_island:</td><td><code>:christmas_island:</code></td><td>:cityscape:</td><td><code>:cityscape:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:clamp:</td><td><code>:clamp:</code></td><td>:classical_building:</td><td><code>:classical_building:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:clinking_glasses:</td><td><code>:clinking_glasses:</code></td><td>:cloud_with_lightning:</td><td><code>:cloud_with_lightning:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:cloud_with_lightning_and_rain:</td><td><code>:cloud_with_lightning_and_rain:</code></td><td>:cloud_with_rain:</td><td><code>:cloud_with_rain:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:cloud_with_snow:</td><td><code>:cloud_with_snow:</code></td><td>:clown_face:</td><td><code>:clown_face:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:cocos_islands:</td><td><code>:cocos_islands:</code></td><td>:coffin:</td><td><code>:coffin:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:colombia:</td><td><code>:colombia:</code></td><td>:comet:</td><td><code>:comet:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:comoros:</td><td><code>:comoros:</code></td><td>:computer_mouse:</td><td><code>:computer_mouse:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:congo_brazzaville:</td><td><code>:congo_brazzaville:</code></td><td>:congo_kinshasa:</td><td><code>:congo_kinshasa:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:construction_worker_man:</td><td><code>:construction_worker_man:</code></td><td>:construction_worker_woman:</td><td><code>:construction_worker_woman:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:control_knobs:</td><td><code>:control_knobs:</code></td><td>:cook_islands:</td><td><code>:cook_islands:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:costa_rica:</td><td><code>:costa_rica:</code></td><td>:cote_divoire:</td><td><code>:cote_divoire:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:couch_and_lamp:</td><td><code>:couch_and_lamp:</code></td><td>:couple_with_heart_man_man:</td><td><code>:couple_with_heart_man_man:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:couple_with_heart_woman_man:</td><td><code>:couple_with_heart_woman_man:</code></td><td>:couple_with_heart_woman_woman:</td><td><code>:couple_with_heart_woman_woman:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:couplekiss_man_man:</td><td><code>:couplekiss_man_man:</code></td><td>:couplekiss_man_woman:</td><td><code>:couplekiss_man_woman:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:couplekiss_woman_woman:</td><td><code>:couplekiss_woman_woman:</code></td><td>:cowboy_hat_face:</td><td><code>:cowboy_hat_face:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:crab:</td><td><code>:crab:</code></td><td>:crayon:</td><td><code>:crayon:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:cricket:</td><td><code>:cricket:</code></td><td>:croatia:</td><td><code>:croatia:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:croissant:</td><td><code>:croissant:</code></td><td>:crossed_fingers:</td><td><code>:crossed_fingers:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:crossed_swords:</td><td><code>:crossed_swords:</code></td><td>:cuba:</td><td><code>:cuba:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:cucumber:</td><td><code>:cucumber:</code></td><td>:curacao:</td><td><code>:curacao:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:cyprus:</td><td><code>:cyprus:</code></td><td>:czech_republic:</td><td><code>:czech_republic:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:dagger:</td><td><code>:dagger:</code></td><td>:dancing_men:</td><td><code>:dancing_men:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:dancing_women:</td><td><code>:dancing_women:</code></td><td>:dark_sunglasses:</td><td><code>:dark_sunglasses:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:deer:</td><td><code>:deer:</code></td><td>:denmark:</td><td><code>:denmark:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:derelict_house:</td><td><code>:derelict_house:</code></td><td>:desert:</td><td><code>:desert:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:desert_island:</td><td><code>:desert_island:</code></td><td>:desktop_computer:</td><td><code>:desktop_computer:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:detective:</td><td><code>:detective:</code></td><td>:djibouti:</td><td><code>:djibouti:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:dominica:</td><td><code>:dominica:</code></td><td>:dominican_republic:</td><td><code>:dominican_republic:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:dove:</td><td><code>:dove:</code></td><td>:drooling_face:</td><td><code>:drooling_face:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:drum:</td><td><code>:drum:</code></td><td>:duck:</td><td><code>:duck:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:eagle:</td><td><code>:eagle:</code></td><td>:ecuador:</td><td><code>:ecuador:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:egypt:</td><td><code>:egypt:</code></td><td>:el_salvador:</td><td><code>:el_salvador:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:electron:</td><td><code>:electron:</code></td><td>:envelope_with_arrow:</td><td><code>:envelope_with_arrow:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:equatorial_guinea:</td><td><code>:equatorial_guinea:</code></td><td>:eritrea:</td><td><code>:eritrea:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:estonia:</td><td><code>:estonia:</code></td><td>:ethiopia:</td><td><code>:ethiopia:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:eu:</td><td><code>:eu:</code></td><td>:european_union:</td><td><code>:european_union:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:eye:</td><td><code>:eye:</code></td><td>:eye_speech_bubble:</td><td><code>:eye_speech_bubble:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:face_with_head_bandage:</td><td><code>:face_with_head_bandage:</code></td><td>:face_with_thermometer:</td><td><code>:face_with_thermometer:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:falkland_islands:</td><td><code>:falkland_islands:</code></td><td>:family_man_boy:</td><td><code>:family_man_boy:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:family_man_boy_boy:</td><td><code>:family_man_boy_boy:</code></td><td>:family_man_girl:</td><td><code>:family_man_girl:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:family_man_girl_boy:</td><td><code>:family_man_girl_boy:</code></td><td>:family_man_girl_girl:</td><td><code>:family_man_girl_girl:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:family_man_man_boy:</td><td><code>:family_man_man_boy:</code></td><td>:family_man_man_boy_boy:</td><td><code>:family_man_man_boy_boy:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:family_man_man_girl:</td><td><code>:family_man_man_girl:</code></td><td>:family_man_man_girl_boy:</td><td><code>:family_man_man_girl_boy:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:family_man_man_girl_girl:</td><td><code>:family_man_man_girl_girl:</code></td><td>:family_man_woman_boy:</td><td><code>:family_man_woman_boy:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:family_man_woman_boy_boy:</td><td><code>:family_man_woman_boy_boy:</code></td><td>:family_man_woman_girl:</td><td><code>:family_man_woman_girl:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:family_man_woman_girl_boy:</td><td><code>:family_man_woman_girl_boy:</code></td><td>:family_man_woman_girl_girl:</td><td><code>:family_man_woman_girl_girl:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:family_woman_boy:</td><td><code>:family_woman_boy:</code></td><td>:family_woman_boy_boy:</td><td><code>:family_woman_boy_boy:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:family_woman_girl:</td><td><code>:family_woman_girl:</code></td><td>:family_woman_girl_boy:</td><td><code>:family_woman_girl_boy:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:family_woman_girl_girl:</td><td><code>:family_woman_girl_girl:</code></td><td>:family_woman_woman_boy:</td><td><code>:family_woman_woman_boy:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:family_woman_woman_boy_boy:</td><td><code>:family_woman_woman_boy_boy:</code></td><td>:family_woman_woman_girl:</td><td><code>:family_woman_woman_girl:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:family_woman_woman_girl_boy:</td><td><code>:family_woman_woman_girl_boy:</code></td><td>:family_woman_woman_girl_girl:</td><td><code>:family_woman_woman_girl_girl:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:faroe_islands:</td><td><code>:faroe_islands:</code></td><td>:female_detective:</td><td><code>:female_detective:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:ferry:</td><td><code>:ferry:</code></td><td>:field_hockey:</td><td><code>:field_hockey:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:fiji:</td><td><code>:fiji:</code></td><td>:file_cabinet:</td><td><code>:file_cabinet:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:film_projector:</td><td><code>:film_projector:</code></td><td>:film_strip:</td><td><code>:film_strip:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:finland:</td><td><code>:finland:</code></td><td>:fist_left:</td><td><code>:fist_left:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:fist_oncoming:</td><td><code>:fist_oncoming:</code></td><td>:fist_raised:</td><td><code>:fist_raised:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:fist_right:</td><td><code>:fist_right:</code></td><td>:fleur_de_lis:</td><td><code>:fleur_de_lis:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:flight_arrival:</td><td><code>:flight_arrival:</code></td><td>:flight_departure:</td><td><code>:flight_departure:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:flipper:</td><td><code>:flipper:</code></td><td>:fog:</td><td><code>:fog:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:footprints:</td><td><code>:footprints:</code></td><td>:fountain_pen:</td><td><code>:fountain_pen:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:fox_face:</td><td><code>:fox_face:</code></td><td>:framed_picture:</td><td><code>:framed_picture:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:french_guiana:</td><td><code>:french_guiana:</code></td><td>:french_polynesia:</td><td><code>:french_polynesia:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:french_southern_territories:</td><td><code>:french_southern_territories:</code></td><td>:fried_egg:</td><td><code>:fried_egg:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:frowning_face:</td><td><code>:frowning_face:</code></td><td>:frowning_man:</td><td><code>:frowning_man:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:frowning_woman:</td><td><code>:frowning_woman:</code></td><td>:funeral_urn:</td><td><code>:funeral_urn:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:gabon:</td><td><code>:gabon:</code></td><td>:gambia:</td><td><code>:gambia:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:gear:</td><td><code>:gear:</code></td><td>:georgia:</td><td><code>:georgia:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:ghana:</td><td><code>:ghana:</code></td><td>:gibraltar:</td><td><code>:gibraltar:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:goal_net:</td><td><code>:goal_net:</code></td><td>:golfing_man:</td><td><code>:golfing_man:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:golfing_woman:</td><td><code>:golfing_woman:</code></td><td>:gorilla:</td><td><code>:gorilla:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:greece:</td><td><code>:greece:</code></td><td>:green_salad:</td><td><code>:green_salad:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:greenland:</td><td><code>:greenland:</code></td><td>:grenada:</td><td><code>:grenada:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:guadeloupe:</td><td><code>:guadeloupe:</code></td><td>:guam:</td><td><code>:guam:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:guardswoman:</td><td><code>:guardswoman:</code></td><td>:guatemala:</td><td><code>:guatemala:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:guernsey:</td><td><code>:guernsey:</code></td><td>:guinea:</td><td><code>:guinea:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:guinea_bissau:</td><td><code>:guinea_bissau:</code></td><td>:guyana:</td><td><code>:guyana:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:haircut_man:</td><td><code>:haircut_man:</code></td><td>:haircut_woman:</td><td><code>:haircut_woman:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:haiti:</td><td><code>:haiti:</code></td><td>:hammer_and_pick:</td><td><code>:hammer_and_pick:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:hammer_and_wrench:</td><td><code>:hammer_and_wrench:</code></td><td>:handshake:</td><td><code>:handshake:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:heavy_heart_exclamation:</td><td><code>:heavy_heart_exclamation:</code></td><td>:hole:</td><td><code>:hole:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:honduras:</td><td><code>:honduras:</code></td><td>:hong_kong:</td><td><code>:hong_kong:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:hot_pepper:</td><td><code>:hot_pepper:</code></td><td>:hotdog:</td><td><code>:hotdog:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:houses:</td><td><code>:houses:</code></td><td>:hugs:</td><td><code>:hugs:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:hungary:</td><td><code>:hungary:</code></td><td>:ice_hockey:</td><td><code>:ice_hockey:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:ice_skate:</td><td><code>:ice_skate:</code></td><td>:iceland:</td><td><code>:iceland:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:india:</td><td><code>:india:</code></td><td>:indonesia:</td><td><code>:indonesia:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:iran:</td><td><code>:iran:</code></td><td>:iraq:</td><td><code>:iraq:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:ireland:</td><td><code>:ireland:</code></td><td>:isle_of_man:</td><td><code>:isle_of_man:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:israel:</td><td><code>:israel:</code></td><td>:jamaica:</td><td><code>:jamaica:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:jersey:</td><td><code>:jersey:</code></td><td>:jordan:</td><td><code>:jordan:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:joystick:</td><td><code>:joystick:</code></td><td>:kaaba:</td><td><code>:kaaba:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:kazakhstan:</td><td><code>:kazakhstan:</code></td><td>:kenya:</td><td><code>:kenya:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:keyboard:</td><td><code>:keyboard:</code></td><td>:kick_scooter:</td><td><code>:kick_scooter:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:kiribati:</td><td><code>:kiribati:</code></td><td>:kiwi_fruit:</td><td><code>:kiwi_fruit:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:knife:</td><td><code>:knife:</code></td><td>:kosovo:</td><td><code>:kosovo:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:kuwait:</td><td><code>:kuwait:</code></td><td>:kyrgyzstan:</td><td><code>:kyrgyzstan:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:label:</td><td><code>:label:</code></td><td>:lantern:</td><td><code>:lantern:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:laos:</td><td><code>:laos:</code></td><td>:latin_cross:</td><td><code>:latin_cross:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:latvia:</td><td><code>:latvia:</code></td><td>:lebanon:</td><td><code>:lebanon:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:lesotho:</td><td><code>:lesotho:</code></td><td>:level_slider:</td><td><code>:level_slider:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:liberia:</td><td><code>:liberia:</code></td><td>:libya:</td><td><code>:libya:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:liechtenstein:</td><td><code>:liechtenstein:</code></td><td>:lion:</td><td><code>:lion:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:lithuania:</td><td><code>:lithuania:</code></td><td>:lizard:</td><td><code>:lizard:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:loud_sound:</td><td><code>:loud_sound:</code></td><td>:luxembourg:</td><td><code>:luxembourg:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:lying_face:</td><td><code>:lying_face:</code></td><td>:macau:</td><td><code>:macau:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:macedonia:</td><td><code>:macedonia:</code></td><td>:madagascar:</td><td><code>:madagascar:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:malawi:</td><td><code>:malawi:</code></td><td>:malaysia:</td><td><code>:malaysia:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:maldives:</td><td><code>:maldives:</code></td><td>:male_detective:</td><td><code>:male_detective:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:mali:</td><td><code>:mali:</code></td><td>:malta:</td><td><code>:malta:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:man_artist:</td><td><code>:man_artist:</code></td><td>:man_astronaut:</td><td><code>:man_astronaut:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:man_cartwheeling:</td><td><code>:man_cartwheeling:</code></td><td>:man_cook:</td><td><code>:man_cook:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:man_dancing:</td><td><code>:man_dancing:</code></td><td>:man_facepalming:</td><td><code>:man_facepalming:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:man_factory_worker:</td><td><code>:man_factory_worker:</code></td><td>:man_farmer:</td><td><code>:man_farmer:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:man_firefighter:</td><td><code>:man_firefighter:</code></td><td>:man_health_worker:</td><td><code>:man_health_worker:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:man_in_tuxedo:</td><td><code>:man_in_tuxedo:</code></td><td>:man_judge:</td><td><code>:man_judge:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:man_juggling:</td><td><code>:man_juggling:</code></td><td>:man_mechanic:</td><td><code>:man_mechanic:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:man_office_worker:</td><td><code>:man_office_worker:</code></td><td>:man_pilot:</td><td><code>:man_pilot:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:man_playing_handball:</td><td><code>:man_playing_handball:</code></td><td>:man_playing_water_polo:</td><td><code>:man_playing_water_polo:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:man_scientist:</td><td><code>:man_scientist:</code></td><td>:man_shrugging:</td><td><code>:man_shrugging:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:man_singer:</td><td><code>:man_singer:</code></td><td>:man_student:</td><td><code>:man_student:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:man_teacher:</td><td><code>:man_teacher:</code></td><td>:man_technologist:</td><td><code>:man_technologist:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:mandarin:</td><td><code>:mandarin:</code></td><td>:mantelpiece_clock:</td><td><code>:mantelpiece_clock:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:marshall_islands:</td><td><code>:marshall_islands:</code></td><td>:martial_arts_uniform:</td><td><code>:martial_arts_uniform:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:martinique:</td><td><code>:martinique:</code></td><td>:massage_man:</td><td><code>:massage_man:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:massage_woman:</td><td><code>:massage_woman:</code></td><td>:mauritania:</td><td><code>:mauritania:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:mauritius:</td><td><code>:mauritius:</code></td><td>:mayotte:</td><td><code>:mayotte:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:medal_military:</td><td><code>:medal_military:</code></td><td>:medal_sports:</td><td><code>:medal_sports:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:men_wrestling:</td><td><code>:men_wrestling:</code></td><td>:menorah:</td><td><code>:menorah:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:mexico:</td><td><code>:mexico:</code></td><td>:micronesia:</td><td><code>:micronesia:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:middle_finger:</td><td><code>:middle_finger:</code></td><td>:milk_glass:</td><td><code>:milk_glass:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:moldova:</td><td><code>:moldova:</code></td><td>:monaco:</td><td><code>:monaco:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:money_mouth_face:</td><td><code>:money_mouth_face:</code></td><td>:mongolia:</td><td><code>:mongolia:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:montenegro:</td><td><code>:montenegro:</code></td><td>:montserrat:</td><td><code>:montserrat:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:moon:</td><td><code>:moon:</code></td><td>:morocco:</td><td><code>:morocco:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:mosque:</td><td><code>:mosque:</code></td><td>:motor_boat:</td><td><code>:motor_boat:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:motor_scooter:</td><td><code>:motor_scooter:</code></td><td>:motorcycle:</td><td><code>:motorcycle:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:motorway:</td><td><code>:motorway:</code></td><td>:mountain:</td><td><code>:mountain:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:mountain_biking_man:</td><td><code>:mountain_biking_man:</code></td><td>:mountain_biking_woman:</td><td><code>:mountain_biking_woman:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:mountain_snow:</td><td><code>:mountain_snow:</code></td><td>:mozambique:</td><td><code>:mozambique:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:mrs_claus:</td><td><code>:mrs_claus:</code></td><td>:myanmar:</td><td><code>:myanmar:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:namibia:</td><td><code>:namibia:</code></td><td>:national_park:</td><td><code>:national_park:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:nauru:</td><td><code>:nauru:</code></td><td>:nauseated_face:</td><td><code>:nauseated_face:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:nepal:</td><td><code>:nepal:</code></td><td>:nerd_face:</td><td><code>:nerd_face:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:netherlands:</td><td><code>:netherlands:</code></td><td>:new_caledonia:</td><td><code>:new_caledonia:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:new_zealand:</td><td><code>:new_zealand:</code></td><td>:newspaper_roll:</td><td><code>:newspaper_roll:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:next_track_button:</td><td><code>:next_track_button:</code></td><td>:ng_man:</td><td><code>:ng_man:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:ng_woman:</td><td><code>:ng_woman:</code></td><td>:nicaragua:</td><td><code>:nicaragua:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:niger:</td><td><code>:niger:</code></td><td>:nigeria:</td><td><code>:nigeria:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:night_with_stars:</td><td><code>:night_with_stars:</code></td><td>:niue:</td><td><code>:niue:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:no_good_man:</td><td><code>:no_good_man:</code></td><td>:no_good_woman:</td><td><code>:no_good_woman:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:norfolk_island:</td><td><code>:norfolk_island:</code></td><td>:north_korea:</td><td><code>:north_korea:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:northern_mariana_islands:</td><td><code>:northern_mariana_islands:</code></td><td>:norway:</td><td><code>:norway:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:oil_drum:</td><td><code>:oil_drum:</code></td><td>:ok_man:</td><td><code>:ok_man:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:old_key:</td><td><code>:old_key:</code></td><td>:om:</td><td><code>:om:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:oman:</td><td><code>:oman:</code></td><td>:open_book:</td><td><code>:open_book:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:open_umbrella:</td><td><code>:open_umbrella:</code></td><td>:orange:</td><td><code>:orange:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:orthodox_cross:</td><td><code>:orthodox_cross:</code></td><td>:owl:</td><td><code>:owl:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:paintbrush:</td><td><code>:paintbrush:</code></td><td>:pakistan:</td><td><code>:pakistan:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:palau:</td><td><code>:palau:</code></td><td>:palestinian_territories:</td><td><code>:palestinian_territories:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:panama:</td><td><code>:panama:</code></td><td>:pancakes:</td><td><code>:pancakes:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:paperclips:</td><td><code>:paperclips:</code></td><td>:papua_new_guinea:</td><td><code>:papua_new_guinea:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:paraguay:</td><td><code>:paraguay:</code></td><td>:parasol_on_ground:</td><td><code>:parasol_on_ground:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:passenger_ship:</td><td><code>:passenger_ship:</code></td><td>:pause_button:</td><td><code>:pause_button:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:peace_symbol:</td><td><code>:peace_symbol:</code></td><td>:peanuts:</td><td><code>:peanuts:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:pen:</td><td><code>:pen:</code></td><td>:person_fencing:</td><td><code>:person_fencing:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:peru:</td><td><code>:peru:</code></td><td>:philippines:</td><td><code>:philippines:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:pick:</td><td><code>:pick:</code></td><td>:ping_pong:</td><td><code>:ping_pong:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:pitcairn_islands:</td><td><code>:pitcairn_islands:</code></td><td>:place_of_worship:</td><td><code>:place_of_worship:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:plate_with_cutlery:</td><td><code>:plate_with_cutlery:</code></td><td>:play_or_pause_button:</td><td><code>:play_or_pause_button:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:poland:</td><td><code>:poland:</code></td><td>:policeman:</td><td><code>:policeman:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:policewoman:</td><td><code>:policewoman:</code></td><td>:popcorn:</td><td><code>:popcorn:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:portugal:</td><td><code>:portugal:</code></td><td>:potato:</td><td><code>:potato:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:pout:</td><td><code>:pout:</code></td><td>:pouting_man:</td><td><code>:pouting_man:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:pouting_woman:</td><td><code>:pouting_woman:</code></td><td>:prayer_beads:</td><td><code>:prayer_beads:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:pregnant_woman:</td><td><code>:pregnant_woman:</code></td><td>:previous_track_button:</td><td><code>:previous_track_button:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:prince:</td><td><code>:prince:</code></td><td>:printer:</td><td><code>:printer:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:puerto_rico:</td><td><code>:puerto_rico:</code></td><td>:qatar:</td><td><code>:qatar:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:racing_car:</td><td><code>:racing_car:</code></td><td>:radioactive:</td><td><code>:radioactive:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:railway_track:</td><td><code>:railway_track:</code></td><td>:rainbow_flag:</td><td><code>:rainbow_flag:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:raised_back_of_hand:</td><td><code>:raised_back_of_hand:</code></td><td>:raised_hand_with_fingers_splayed:</td><td><code>:raised_hand_with_fingers_splayed:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:raising_hand_man:</td><td><code>:raising_hand_man:</code></td><td>:raising_hand_woman:</td><td><code>:raising_hand_woman:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:record_button:</td><td><code>:record_button:</code></td><td>:reminder_ribbon:</td><td><code>:reminder_ribbon:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:rescue_worker_helmet:</td><td><code>:rescue_worker_helmet:</code></td><td>:reunion:</td><td><code>:reunion:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:rhinoceros:</td><td><code>:rhinoceros:</code></td><td>:right_anger_bubble:</td><td><code>:right_anger_bubble:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:robot:</td><td><code>:robot:</code></td><td>:rofl:</td><td><code>:rofl:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:roll_eyes:</td><td><code>:roll_eyes:</code></td><td>:romania:</td><td><code>:romania:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:rosette:</td><td><code>:rosette:</code></td><td>:rowing_man:</td><td><code>:rowing_man:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:rowing_woman:</td><td><code>:rowing_woman:</code></td><td>:running_man:</td><td><code>:running_man:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:running_woman:</td><td><code>:running_woman:</code></td><td>:rwanda:</td><td><code>:rwanda:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:samoa:</td><td><code>:samoa:</code></td><td>:san_marino:</td><td><code>:san_marino:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:sao_tome_principe:</td><td><code>:sao_tome_principe:</code></td><td>:saudi_arabia:</td><td><code>:saudi_arabia:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:scorpion:</td><td><code>:scorpion:</code></td><td>:selfie:</td><td><code>:selfie:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:senegal:</td><td><code>:senegal:</code></td><td>:serbia:</td><td><code>:serbia:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:seychelles:</td><td><code>:seychelles:</code></td><td>:shallow_pan_of_food:</td><td><code>:shallow_pan_of_food:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:shamrock:</td><td><code>:shamrock:</code></td><td>:shark:</td><td><code>:shark:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:shield:</td><td><code>:shield:</code></td><td>:shinto_shrine:</td><td><code>:shinto_shrine:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:shopping:</td><td><code>:shopping:</code></td><td>:shopping_cart:</td><td><code>:shopping_cart:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:shrimp:</td><td><code>:shrimp:</code></td><td>:sierra_leone:</td><td><code>:sierra_leone:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:singapore:</td><td><code>:singapore:</code></td><td>:sint_maarten:</td><td><code>:sint_maarten:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:skier:</td><td><code>:skier:</code></td><td>:skull_and_crossbones:</td><td><code>:skull_and_crossbones:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:sleeping_bed:</td><td><code>:sleeping_bed:</code></td><td>:slightly_frowning_face:</td><td><code>:slightly_frowning_face:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:slightly_smiling_face:</td><td><code>:slightly_smiling_face:</code></td><td>:slovakia:</td><td><code>:slovakia:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:slovenia:</td><td><code>:slovenia:</code></td><td>:small_airplane:</td><td><code>:small_airplane:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:sneezing_face:</td><td><code>:sneezing_face:</code></td><td>:snowman_with_snow:</td><td><code>:snowman_with_snow:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:solomon_islands:</td><td><code>:solomon_islands:</code></td><td>:somalia:</td><td><code>:somalia:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:south_africa:</td><td><code>:south_africa:</code></td><td>:south_georgia_south_sandwich_islands:</td><td><code>:south_georgia_south_sandwich_islands:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:south_sudan:</td><td><code>:south_sudan:</code></td><td>:speaking_head:</td><td><code>:speaking_head:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:spider:</td><td><code>:spider:</code></td><td>:spider_web:</td><td><code>:spider_web:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:spiral_calendar:</td><td><code>:spiral_calendar:</code></td><td>:spiral_notepad:</td><td><code>:spiral_notepad:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:spoon:</td><td><code>:spoon:</code></td><td>:squid:</td><td><code>:squid:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:sri_lanka:</td><td><code>:sri_lanka:</code></td><td>:st_barthelemy:</td><td><code>:st_barthelemy:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:st_helena:</td><td><code>:st_helena:</code></td><td>:st_kitts_nevis:</td><td><code>:st_kitts_nevis:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:st_lucia:</td><td><code>:st_lucia:</code></td><td>:st_pierre_miquelon:</td><td><code>:st_pierre_miquelon:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:st_vincent_grenadines:</td><td><code>:st_vincent_grenadines:</code></td><td>:stadium:</td><td><code>:stadium:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:star_and_crescent:</td><td><code>:star_and_crescent:</code></td><td>:star_of_david:</td><td><code>:star_of_david:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:stop_button:</td><td><code>:stop_button:</code></td><td>:stop_sign:</td><td><code>:stop_sign:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:stopwatch:</td><td><code>:stopwatch:</code></td><td>:studio_microphone:</td><td><code>:studio_microphone:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:stuffed_flatbread:</td><td><code>:stuffed_flatbread:</code></td><td>:sudan:</td><td><code>:sudan:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:sun_behind_large_cloud:</td><td><code>:sun_behind_large_cloud:</code></td><td>:sun_behind_rain_cloud:</td><td><code>:sun_behind_rain_cloud:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:sun_behind_small_cloud:</td><td><code>:sun_behind_small_cloud:</code></td><td>:surfing_man:</td><td><code>:surfing_man:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:surfing_woman:</td><td><code>:surfing_woman:</code></td><td>:suriname:</td><td><code>:suriname:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:swaziland:</td><td><code>:swaziland:</code></td><td>:sweden:</td><td><code>:sweden:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:swimming_man:</td><td><code>:swimming_man:</code></td><td>:swimming_woman:</td><td><code>:swimming_woman:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:switzerland:</td><td><code>:switzerland:</code></td><td>:synagogue:</td><td><code>:synagogue:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:syria:</td><td><code>:syria:</code></td><td>:taco:</td><td><code>:taco:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:taiwan:</td><td><code>:taiwan:</code></td><td>:tajikistan:</td><td><code>:tajikistan:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:tanzania:</td><td><code>:tanzania:</code></td><td>:thailand:</td><td><code>:thailand:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:thermometer:</td><td><code>:thermometer:</code></td><td>:thinking:</td><td><code>:thinking:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:tickets:</td><td><code>:tickets:</code></td><td>:timer_clock:</td><td><code>:timer_clock:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:timor_leste:</td><td><code>:timor_leste:</code></td><td>:tipping_hand_man:</td><td><code>:tipping_hand_man:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:tipping_hand_woman:</td><td><code>:tipping_hand_woman:</code></td><td>:togo:</td><td><code>:togo:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:tokelau:</td><td><code>:tokelau:</code></td><td>:tonga:</td><td><code>:tonga:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:tornado:</td><td><code>:tornado:</code></td><td>:tr:</td><td><code>:tr:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:trackball:</td><td><code>:trackball:</code></td><td>:trinidad_tobago:</td><td><code>:trinidad_tobago:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:tumbler_glass:</td><td><code>:tumbler_glass:</code></td><td>:tunisia:</td><td><code>:tunisia:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:turkey:</td><td><code>:turkey:</code></td><td>:turkmenistan:</td><td><code>:turkmenistan:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:turks_caicos_islands:</td><td><code>:turks_caicos_islands:</code></td><td>:tuvalu:</td><td><code>:tuvalu:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:uganda:</td><td><code>:uganda:</code></td><td>:ukraine:</td><td><code>:ukraine:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:unicorn:</td><td><code>:unicorn:</code></td><td>:united_arab_emirates:</td><td><code>:united_arab_emirates:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:upside_down_face:</td><td><code>:upside_down_face:</code></td><td>:uruguay:</td><td><code>:uruguay:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:us_virgin_islands:</td><td><code>:us_virgin_islands:</code></td><td>:uzbekistan:</td><td><code>:uzbekistan:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:vanuatu:</td><td><code>:vanuatu:</code></td><td>:vatican_city:</td><td><code>:vatican_city:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:venezuela:</td><td><code>:venezuela:</code></td><td>:vietnam:</td><td><code>:vietnam:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:volleyball:</td><td><code>:volleyball:</code></td><td>:vulcan_salute:</td><td><code>:vulcan_salute:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:walking:</td><td><code>:walking:</code></td><td>:walking_man:</td><td><code>:walking_man:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:walking_woman:</td><td><code>:walking_woman:</code></td><td>:wallis_futuna:</td><td><code>:wallis_futuna:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:wastebasket:</td><td><code>:wastebasket:</code></td><td>:weight_lifting_man:</td><td><code>:weight_lifting_man:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:weight_lifting_woman:</td><td><code>:weight_lifting_woman:</code></td><td>:western_sahara:</td><td><code>:western_sahara:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:wheel_of_dharma:</td><td><code>:wheel_of_dharma:</code></td><td>:white_flag:</td><td><code>:white_flag:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:wilted_flower:</td><td><code>:wilted_flower:</code></td><td>:wind_face:</td><td><code>:wind_face:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:woman_artist:</td><td><code>:woman_artist:</code></td><td>:woman_astronaut:</td><td><code>:woman_astronaut:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:woman_cartwheeling:</td><td><code>:woman_cartwheeling:</code></td><td>:woman_cook:</td><td><code>:woman_cook:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:woman_facepalming:</td><td><code>:woman_facepalming:</code></td><td>:woman_factory_worker:</td><td><code>:woman_factory_worker:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:woman_farmer:</td><td><code>:woman_farmer:</code></td><td>:woman_firefighter:</td><td><code>:woman_firefighter:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:woman_health_worker:</td><td><code>:woman_health_worker:</code></td><td>:woman_judge:</td><td><code>:woman_judge:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:woman_juggling:</td><td><code>:woman_juggling:</code></td><td>:woman_mechanic:</td><td><code>:woman_mechanic:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:woman_office_worker:</td><td><code>:woman_office_worker:</code></td><td>:woman_pilot:</td><td><code>:woman_pilot:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:woman_playing_handball:</td><td><code>:woman_playing_handball:</code></td><td>:woman_playing_water_polo:</td><td><code>:woman_playing_water_polo:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:woman_scientist:</td><td><code>:woman_scientist:</code></td><td>:woman_shrugging:</td><td><code>:woman_shrugging:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:woman_singer:</td><td><code>:woman_singer:</code></td><td>:woman_student:</td><td><code>:woman_student:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:woman_teacher:</td><td><code>:woman_teacher:</code></td><td>:woman_technologist:</td><td><code>:woman_technologist:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:woman_with_turban:</td><td><code>:woman_with_turban:</code></td><td>:women_wrestling:</td><td><code>:women_wrestling:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:world_map:</td><td><code>:world_map:</code></td><td>:writing_hand:</td><td><code>:writing_hand:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:yemen:</td><td><code>:yemen:</code></td><td>:yin_yang:</td><td><code>:yin_yang:</code></td></tr><tr class="even"><td><a href="#table-of-contents">top</a></td><td>:zambia:</td><td><code>:zambia:</code></td><td>:zimbabwe:</td><td><code>:zimbabwe:</code></td></tr><tr class="odd"><td><a href="#table-of-contents">top</a></td><td>:zipper_mouth_face:</td><td><code>:zipper_mouth_face:</code></td><td></td><td></td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Markdown </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Markdown </tag>
            
            <tag> emoji </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jekyll-theme-next添加Valine评论系统</title>
      <link href="2019/03/18/valine/"/>
      <url>2019/03/18/valine/</url>
      
        <content type="html"><![CDATA[<p>给Jekyll添加Valine评论系统</p><a id="more"></a><p>一直想给博客配置一款简洁的评论系统，但是没有发现合适的，最近倒腾一下Valine之后，发现效果还不错☺️</p><p>详情请访问官网：<a href="https://valine.js.org/">https://valine.js.org</a></p><p>这个评论系统是基于LeanCloud的，对Jekyll的博客是支持的，官网网址：<a href="https://leancloud.cn/">https://leancloud.cn</a></p><h4 id="获取-app-id-和-app-key">获取 APP ID 和 APP KEY</h4><p>需要注册登录LeanCloud然后创建应用获取</p><ol type="1"><li><p><a href="https://leancloud.cn/dashboard/login.html#/signup">点击这里登录或注册Leancloud</a></p></li><li><p>然后<a href="https://leancloud.cn/dashboard/applist.html#/newapp">创建应用</a></p><figure><img src="/images/valine/blog1.png" alt="blog" /><figcaption aria-hidden="true">blog</figcaption></figure></li><li><p>选择刚刚创建的<code>应用</code>&gt;<code>设置</code>&gt;<code>应用 Key</code>，然后你就能看到你的<code>APP ID</code>和<code>APP KEY</code></p><figure><img src="/images/valine/blog2.png" alt="blog2" /><figcaption aria-hidden="true">blog2</figcaption></figure></li><li><p>然后填写<code>应用</code>&gt;<code>设置</code>&gt;<code>安全设置</code>中的<code>Web 安全域名</code></p><figure><img src="/images/valine/blog3.png" alt="blog3" /><figcaption aria-hidden="true">blog3</figcaption></figure></li></ol><h4 id="在blog中添加valine评论系统">在blog中添加valine评论系统</h4><blockquote><p>由于我使用的是<a href="https://github.com/Simpleyyt/jekyll-theme-next">jekyll-theme-next</a>, 所以可能在其他模板中不适用</p></blockquote><h5 id="创建valine.html">创建valine.html</h5><p>在 <code>/_includes/_third-party/comments</code>文件夹中添加一个文件<code>valine.html</code> 在文件里添加代码：</p><figure><img src="/images/valine/blog6.png" alt="blog4" /><figcaption aria-hidden="true">blog4</figcaption></figure><p>中间几行需要配置在_config.yml文件当中</p><h5 id="添加_config.yml配置">添加_config.yml配置</h5><p>将<code>app_id</code>，<code>app_key</code>， <code>placeholde</code>等信息添加到_config.yml配置当中 具体使用代码：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">valine_comment:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment"># app_id</span></span><br><span class="line">  <span class="attr">leancloud_appid:</span> <span class="string">XXX</span></span><br><span class="line"><span class="comment"># app_key</span></span><br><span class="line">  <span class="attr">leancloud_appkey:</span> <span class="string">XXX</span></span><br><span class="line"><span class="comment"># placeholde</span></span><br><span class="line">  <span class="attr">placeholder:</span> <span class="string">“Just</span> <span class="string">go</span> <span class="string">go”</span></span><br></pre></td></tr></table></figure><h5 id="更改调用valine.html">更改调用valine.html</h5><p>由于前面创建了valine.html，要jekyll博客能够运行这个页面的代码，使评论框显示在每篇文章的页面，需要在<code>/_includes/_third-party/comments/index.html</code>里面适当位置添加以下代码：</p><figure><img src="/images/valine/blog7.png" alt="blog5" /><figcaption aria-hidden="true">blog5</figcaption></figure><p>此外，在<code>/_includes/_partials/comments.html</code>里面插入下列代码：</p><figure><img src="/images/valine/blog4.png" alt="blog6" /><figcaption aria-hidden="true">blog6</figcaption></figure><p>最后生成的评论框如下：</p><figure><img src="/images/valine/blog5.png" alt="blog7" /><figcaption aria-hidden="true">blog7</figcaption></figure><p>感觉还不错！！</p>]]></content>
      
      
      <categories>
          
          <category> Jekyll </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>进击的tibble</title>
      <link href="2019/03/14/tibble/"/>
      <url>2019/03/14/tibble/</url>
      
        <content type="html"><![CDATA[<p><code>tibble</code>是升级版的<code>data.frame</code>，它保留了<code>data.famre</code>的优势，并且以更友好的方式展示出来</p><h3 id="构建tibble">构建tibble</h3><ul><li><code>readr</code>已知读入数据形成tibble<br /></li><li><code>tibble()</code>直接构建<br /></li><li><code>tribble()</code>直观构建<br /></li><li><code>as_tibble()</code>转换格式</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">df2 &lt;- read_csv(readr_example(<span class="string">&quot;challenge.csv&quot;</span>), guess_max = <span class="number">1001</span>)</span><br><span class="line"><span class="comment">#&gt;  Parsed with column specification:</span></span><br><span class="line"><span class="comment">#&gt;  cols(</span></span><br><span class="line"><span class="comment">#&gt;    x = col_double(),</span></span><br><span class="line"><span class="comment">#&gt;    y = col_date(format = &quot;&quot;)</span></span><br><span class="line"><span class="comment">#&gt;  )</span></span><br><span class="line">tibble(x = <span class="number">1</span>:<span class="number">3</span>, y = list(<span class="number">1</span>:<span class="number">5</span>, <span class="number">1</span>:<span class="number">10</span>, <span class="number">1</span>:<span class="number">20</span>))</span><br><span class="line"><span class="comment">#&gt;  # A tibble: 3 x 2</span></span><br><span class="line"><span class="comment">#&gt;        x y         </span></span><br><span class="line"><span class="comment">#&gt;    &lt;int&gt; &lt;list&gt;    </span></span><br><span class="line"><span class="comment">#&gt;  1     1 &lt;int [5]&gt; </span></span><br><span class="line"><span class="comment">#&gt;  2     2 &lt;int [10]&gt;</span></span><br><span class="line"><span class="comment">#&gt;  3     3 &lt;int [20]&gt;</span></span><br><span class="line">tribble(</span><br><span class="line">~x, ~y,</span><br><span class="line"><span class="string">&quot;a&quot;</span>, <span class="number">1</span>:<span class="number">3</span>,</span><br><span class="line"><span class="string">&quot;b&quot;</span>, <span class="number">4</span>:<span class="number">6</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">#&gt; A tibble: 2 x 2</span></span><br><span class="line"><span class="comment">#&gt;   x     y        </span></span><br><span class="line"><span class="comment">#&gt;   &lt;chr&gt; &lt;list&gt;   </span></span><br><span class="line"><span class="comment">#&gt; 1 a     &lt;int [3]&gt;</span></span><br><span class="line"><span class="comment">#&gt; 2 b     &lt;int [3]&gt;</span></span><br><span class="line">l &lt;- list(x = <span class="number">1</span>:<span class="number">500</span>, y = runif(<span class="number">500</span>), z = <span class="number">500</span>:<span class="number">1</span>)</span><br><span class="line">df &lt;- as_tibble(l)</span><br><span class="line"><span class="comment">#&gt;  A tibble: 500 x 3</span></span><br><span class="line"><span class="comment">#&gt;        x     y     z</span></span><br><span class="line"><span class="comment">#&gt;    &lt;int&gt; &lt;dbl&gt; &lt;int&gt;</span></span><br><span class="line"><span class="comment">#&gt;  1     1 0.311   500</span></span><br><span class="line"><span class="comment">#&gt;  2     2 0.512   499</span></span><br><span class="line"><span class="comment">#&gt;  3     3 0.440   498</span></span><br><span class="line"><span class="comment">#&gt;  4     4 0.501   497</span></span><br><span class="line"><span class="comment">#&gt;  5     5 0.131   496</span></span><br><span class="line"><span class="comment">#&gt;  6     6 0.566   495</span></span><br><span class="line"><span class="comment">#&gt;  7     7 0.647   494</span></span><br><span class="line"><span class="comment">#&gt;  8     8 0.200   493</span></span><br><span class="line"><span class="comment">#&gt;  9     9 0.121   492</span></span><br><span class="line"><span class="comment">#&gt; 10    10 0.315   491</span></span><br><span class="line"><span class="comment">#&gt; # ... with 490 more rows</span></span><br></pre></td></tr></table></figure><h3 id="tibble和data.frame的区别">tibble和data.frame的区别</h3><h4 id="print结果">print结果</h4><p><code>tibble</code>默认只展示前10行的信息</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">tibble(x = -<span class="number">5</span>:<span class="number">1000</span>)</span><br><span class="line"><span class="comment">#&gt; # A tibble: 1,006 x 1</span></span><br><span class="line"><span class="comment">#&gt;        x</span></span><br><span class="line"><span class="comment">#&gt;    &lt;int&gt;</span></span><br><span class="line"><span class="comment">#&gt;  1    -5</span></span><br><span class="line"><span class="comment">#&gt;  2    -4</span></span><br><span class="line"><span class="comment">#&gt;  3    -3</span></span><br><span class="line"><span class="comment">#&gt;  4    -2</span></span><br><span class="line"><span class="comment">#&gt;  5    -1</span></span><br><span class="line"><span class="comment">#&gt;  6     0</span></span><br><span class="line"><span class="comment">#&gt;  7     1</span></span><br><span class="line"><span class="comment">#&gt;  8     2</span></span><br><span class="line"><span class="comment">#&gt;  9     3</span></span><br><span class="line"><span class="comment">#&gt; 10     4</span></span><br><span class="line"><span class="comment">#&gt; # … with 996 more rows</span></span><br></pre></td></tr></table></figure><blockquote><p>可以使用<code>options(tibble.print_max = n, tibble.print_min = m)</code>参数设置展示的信息</p></blockquote><h4 id="子集提取">子集提取</h4><p><code>tibble</code>通过<code>[</code>提取子集返回的是一个<code>tibble</code>，如果提取某一列需要使用<code>[[</code>或者<code>$</code></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">df2 &lt;- tibble(x = <span class="number">1</span>:<span class="number">3</span>, y = <span class="number">3</span>:<span class="number">1</span>)</span><br><span class="line">class(df2)</span><br><span class="line"><span class="comment">#&gt; [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</span></span><br><span class="line">class(df2[, <span class="number">1</span>])</span><br><span class="line"><span class="comment">#&gt; [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</span></span><br><span class="line">class(df2[[<span class="number">1</span>]])</span><br><span class="line"><span class="comment">#&gt; [1] &quot;integer&quot;</span></span><br><span class="line">class(df2$x)</span><br><span class="line"><span class="comment">#&gt; [1] &quot;integer&quot;</span></span><br></pre></td></tr></table></figure><h4 id="自动填充">自动填充</h4><p>在构建<code>tibble</code>时，只有长度为1的值才会被循环填充</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">tibble(a = <span class="number">1</span>:<span class="number">3</span>, b = <span class="number">1</span>)</span><br><span class="line"><span class="comment">#&gt; # A tibble: 3 x 2</span></span><br><span class="line"><span class="comment">#&gt;       a     b</span></span><br><span class="line"><span class="comment">#&gt;   &lt;int&gt; &lt;dbl&gt;</span></span><br><span class="line"><span class="comment">#&gt; 1     1     1</span></span><br><span class="line"><span class="comment">#&gt; 2     2     1</span></span><br><span class="line"><span class="comment">#&gt; 3     3     1</span></span><br><span class="line">tibble(a = <span class="number">1</span>:<span class="number">3</span>, c = <span class="number">1</span>:<span class="number">2</span>)</span><br><span class="line"><span class="comment">#&gt; Error: Tibble columns must have consistent lengths, only values of length one are recycled:</span></span><br><span class="line"><span class="comment">#&gt; * Length 2: Column `c`</span></span><br><span class="line"><span class="comment">#&gt; * Length 3: Column `a`</span></span><br></pre></td></tr></table></figure><h4 id="没有行名">没有行名</h4><p><code>tibble</code>对象中是没有行名的，因此需要一些函数进行辅助操作</p><ul><li><code>has_rownames(.data)</code>：判断数据是否有行名<br /></li><li><code>remove_rownames(.data)</code>：去掉数据行名<br /></li><li><code>rownames_to_column(.data, var = "rowname")</code>：行名转为数据的第一列，<code>var</code>是行名所在列的名字<br /></li><li><code>rowid_to_column(.data, var = "rowid")</code>：行ID号转为数据的第一列，<code>var</code>是行名所在列的名字<br /></li><li><code>column_to_rownames(.data, var = "rowname")</code>：列转行名</li></ul><h3 id="常用操作">常用操作</h3><ul><li><code>add_column</code>和<code>add_row</code><br />添加行和列<br /><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">add_column(df, z = -<span class="number">1</span>:<span class="number">1</span>, w = <span class="number">0</span>)</span><br><span class="line"><span class="comment">#&gt;      # A tibble: 3 x 4</span></span><br><span class="line"><span class="comment">#&gt;        x     y     z     w</span></span><br><span class="line"><span class="comment">#&gt;     &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;</span></span><br><span class="line"><span class="comment">#&gt; 1     1     3    -1     0</span></span><br><span class="line"><span class="comment">#&gt; 2     2     2     0     0</span></span><br><span class="line"><span class="comment">#&gt; 3     3     1     1     0</span></span><br></pre></td></tr></table></figure></li><li><code>enframe</code>和<code>deframe</code><br />把向量变成<code>tibble</code>和把<code>tibble</code>变成向量<br /><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">enframe(c(a = <span class="number">5</span>, b = <span class="number">7</span>), name = <span class="string">&quot;name&quot;</span>, value = <span class="string">&quot;value&quot;</span>)</span><br><span class="line"><span class="comment">#&gt;   # A tibble: 2 x 2</span></span><br><span class="line"><span class="comment">#&gt;     name  value</span></span><br><span class="line"><span class="comment">#&gt;     &lt;chr&gt; &lt;dbl&gt;</span></span><br><span class="line"><span class="comment">#&gt;  1  a         5</span></span><br><span class="line"><span class="comment">#&gt;  2  b         7</span></span><br><span class="line">deframe(tibble(a = <span class="number">1</span>:<span class="number">3</span>))</span><br><span class="line"><span class="comment">#&gt; [1] 1 2 3</span></span><br></pre></td></tr></table></figure></li><li><code>glimpse()</code><br />相当于<code>tibble</code>的<code>str()</code><br /><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">glimpse(df)</span><br><span class="line"><span class="comment">#&gt;  Observations: 3</span></span><br><span class="line"><span class="comment">#&gt;  Variables: 2</span></span><br><span class="line"><span class="comment">#&gt;  $ x &lt;int&gt; 1, 2, 3</span></span><br><span class="line"><span class="comment">#&gt;  $ y &lt;int&gt; 3, 2, 1</span></span><br></pre></td></tr></table></figure></li><li><code>tbl_sum</code><br />提供简要数据信息 <figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tbl_sum(df)</span><br><span class="line"><span class="comment">#&gt; A tibble </span></span><br><span class="line"><span class="comment">#&gt; &quot;3 x 2&quot; </span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
            <tag> tidyverse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>readr包使用指南</title>
      <link href="2019/03/13/readr/"/>
      <url>2019/03/13/readr/</url>
      
        <content type="html"><![CDATA[<p><code>readr</code>包是<code>tidyverse</code>的一部分，它提供了一种快速友好的方式来读取规则的矩形文件（如：csv，tsv，fwf等）。</p><h3 id="安装">安装</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The easiest way to get readr is to install the whole tidyverse:</span></span><br><span class="line">install.packages(<span class="string">&quot;tidyverse&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Alternatively, install just readr:</span></span><br><span class="line">install.packages(<span class="string">&quot;readr&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Or the the development version from GitHub:</span></span><br><span class="line"><span class="comment"># install.packages(&quot;devtools&quot;)</span></span><br><span class="line">devtools::install_github(<span class="string">&quot;tidyverse/readr&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="使用指南">使用指南</h3><h4 id="数据读入">数据读入</h4><p>使用<code>readr</code>读取数据需要指定两个内容： 1. 整个文件的格式（csv、tsv、fwf）<br />2. 文件中每一列的特定属性（double、integer、numeric）</p><p>一般来说<code>readr</code>会自动猜测每一列的属性，并且自动赋予其最合适的数据类型</p><p><code>readr</code>提供了七个<code>read_*</code>函数，来适应不同格式文件的读取：</p><ul><li><a href="https://readr.tidyverse.org/reference/read_delim.html"><code>read_csv()</code></a>: 逗号分隔符文件（csv）<br /></li><li><a href="https://readr.tidyverse.org/reference/read_delim.html"><code>read_tsv()</code></a>: tab分隔符文件（tsv）<br /></li><li><a href="https://readr.tidyverse.org/reference/read_delim.html"><code>read_delim()</code></a>: 自定义分隔符文件<br /></li><li><a href="https://readr.tidyverse.org/reference/read_fwf.html"><code>read_fwf()</code></a>: 固定宽度的文件<br /></li><li><a href="https://readr.tidyverse.org/reference/read_table.html"><code>read_table()</code></a>: 空格分隔符的文件,类似于<code>read.table()</code><br /></li><li><a href="https://readr.tidyverse.org/reference/read_log.html"><code>read_log()</code></a>: 读取web log 文件</li></ul><blockquote><p>这些函数运行之后返回的是一个tibble对象，是data frame的进阶版</p></blockquote><p><code>readr</code>比较友好的是可以对 <code>.gz</code>, <code>.bz2</code>, <code>.xz</code>, <code>.zip</code>等文件自动解压，对 <code>http://</code>, <code>https://</code>, <code>ftp://</code>, <code>ftps://</code>等链接自动进行下载</p><h4 id="数据类型转换">数据类型转换</h4><p><code>readr</code>是将数据按照字符读入，然后自行判定数据的属性。因此<code>readr</code>提供了<code>parse_*</code>和<code>guess_parser()</code>来判断和指定元素的属性：</p><h5 id="判断属性">判断属性</h5><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">guess_parser(c(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>))</span><br><span class="line"><span class="comment">#&gt; [1] &quot;character&quot;</span></span><br><span class="line">guess_parser(c(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>))</span><br><span class="line"><span class="comment">#&gt; [1] &quot;double&quot;</span></span><br><span class="line">guess_parser(c(<span class="string">&quot;1,000&quot;</span>, <span class="string">&quot;2,000&quot;</span>, <span class="string">&quot;3,000&quot;</span>))</span><br><span class="line"><span class="comment">#&gt; [1] &quot;number&quot;</span></span><br><span class="line">guess_parser(c(<span class="string">&quot;2001/10/10&quot;</span>))</span><br><span class="line"><span class="comment">#&gt; [1] &quot;date&quot;</span></span><br></pre></td></tr></table></figure><h5 id="指定属性">指定属性</h5><blockquote><p><code>parse_*</code>函数类似于<code>as.numeric()</code>等函数</p></blockquote><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">parse_integer(c(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>))</span><br><span class="line"><span class="comment">#&gt; [1] 1 2 3</span></span><br><span class="line">parse_double(c(<span class="string">&quot;1.56&quot;</span>, <span class="string">&quot;2.34&quot;</span>, <span class="string">&quot;3.56&quot;</span>))</span><br><span class="line"><span class="comment">#&gt; [1] 1.56 2.34 3.56</span></span><br><span class="line">parse_logical(c(<span class="string">&quot;true&quot;</span>, <span class="string">&quot;false&quot;</span>))</span><br><span class="line"><span class="comment">#&gt; [1]  TRUE FALSE</span></span><br></pre></td></tr></table></figure><p>一般来说<code>parse_integer</code>和<code>parse_double</code>的判定方式比较严格，要求字符中不能包含除数字外的其他字符；<code>readr</code>提供了<code>parse_number</code>来更为灵活的读取数字，它会忽略掉字符串中的非数字字符。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">parse_number(c(<span class="string">&quot;0%&quot;</span>, <span class="string">&quot;10%&quot;</span>, <span class="string">&quot;150%&quot;</span>))</span><br><span class="line"><span class="comment">#&gt; [1]   0  10 150</span></span><br><span class="line">parse_number(c(<span class="string">&quot;$1,234.5&quot;</span>, <span class="string">&quot;$12.45&quot;</span>))</span><br><span class="line"><span class="comment">#&gt; [1] 1234.50   12.45</span></span><br></pre></td></tr></table></figure><p>读取向量作为因子时，需要设定<code>levels</code>顺序</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">parse_factor(c(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;a&quot;</span>), levels = c(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>))</span><br><span class="line"><span class="comment">#&gt; [1] a b a</span></span><br><span class="line"><span class="comment">#&gt; Levels: a b c</span></span><br></pre></td></tr></table></figure><h4 id="数据属性查看">数据属性查看</h4><p>可以使用<code>spec_*</code>等函数查看数据整体的列的属性</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">x &lt;- spec_csv(readr_example(<span class="string">&quot;challenge.csv&quot;</span>))</span><br><span class="line"><span class="comment">#&gt; Parsed with column specification:</span></span><br><span class="line"><span class="comment">#&gt; cols(</span></span><br><span class="line"><span class="comment">#&gt;   x = col_double(),</span></span><br><span class="line"><span class="comment">#&gt;   y = col_logical()</span></span><br><span class="line"><span class="comment">#&gt; )</span></span><br></pre></td></tr></table></figure><blockquote><p>注意：<code>readr</code>默认只查看数据的前1000行，当后续数据的属性发生变化时，是不能检测到的，因此如果查看全局属性，需要添加参数<code>guess_max</code></p></blockquote><p>对于特定的<code>tibble</code>对象，则使用<code>spec()</code>查看</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">spec(df1)</span><br><span class="line"><span class="comment">#&gt; cols(</span></span><br><span class="line"><span class="comment">#&gt;   x = col_double(),</span></span><br><span class="line"><span class="comment">#&gt;   y = col_logical()</span></span><br><span class="line"><span class="comment">#&gt; )</span></span><br><span class="line">spec(df2)</span><br><span class="line"><span class="comment">#&gt; cols(</span></span><br><span class="line"><span class="comment">#&gt;   x = col_double(),</span></span><br><span class="line"><span class="comment">#&gt;   y = col_date(format = &quot;&quot;)</span></span><br><span class="line"><span class="comment">#&gt; )</span></span><br></pre></td></tr></table></figure><h4 id="更改默认属性">更改默认属性</h4><p>在读取数据时，可以使用<code>col_type</code>参数手动设置每列数据的属性</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">df3 &lt;- read_csv(</span><br><span class="line">  readr_example(<span class="string">&quot;challenge.csv&quot;</span>), </span><br><span class="line">  col_types = cols(</span><br><span class="line">    x = col_double(),</span><br><span class="line">    y = col_date(format = <span class="string">&quot;&quot;</span>)</span><br><span class="line">  )</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>常用的属性设置和缩写如下：</p><table><thead><tr class="header"><th style="text-align: center;">属性</th><th style="text-align: center;">简写</th><th style="text-align: center;">备注</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;"><code>col_logical()</code></td><td style="text-align: center;"><code>l</code></td><td style="text-align: center;">containing only T, F, TRUE or FALSE</td></tr><tr class="even"><td style="text-align: center;"><code>col_integer()</code></td><td style="text-align: center;"><code>i</code></td><td style="text-align: center;">integers</td></tr><tr class="odd"><td style="text-align: center;"><code>col_double()</code></td><td style="text-align: center;"><code>d</code></td><td style="text-align: center;">doubles</td></tr><tr class="even"><td style="text-align: center;"><code>col_character()</code></td><td style="text-align: center;"><code>c</code></td><td style="text-align: center;">everything else</td></tr><tr class="odd"><td style="text-align: center;"><code>col_factor(levels, ordered)</code></td><td style="text-align: center;"><code>f</code></td><td style="text-align: center;">a fixed set of values</td></tr><tr class="even"><td style="text-align: center;"><code>col_date(format = "")</code></td><td style="text-align: center;"><code>D</code></td><td style="text-align: center;">with the locale’s date_format</td></tr><tr class="odd"><td style="text-align: center;"><code>col_time(format = "")</code></td><td style="text-align: center;"><code>t</code></td><td style="text-align: center;">with the locale’s time_format</td></tr><tr class="even"><td style="text-align: center;"><code>col_datetime(format = "")</code></td><td style="text-align: center;"><code>T</code></td><td style="text-align: center;">ISO8601 date times</td></tr><tr class="odd"><td style="text-align: center;"><code>col_number()</code></td><td style="text-align: center;"><code>n</code></td><td style="text-align: center;">numbers</td></tr><tr class="even"><td style="text-align: center;"><code>col_skip()</code></td><td style="text-align: center;"><code>_</code> or <code>-</code></td><td style="text-align: center;">don’t import this column</td></tr><tr class="odd"><td style="text-align: center;"><code>col_guess()</code></td><td style="text-align: center;"><code>?</code></td><td style="text-align: center;">parse using the “best” type based on the input</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
            <tag> tidyverse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浅识apply家族</title>
      <link href="2019/03/11/apply/"/>
      <url>2019/03/11/apply/</url>
      
        <content type="html"><![CDATA[<p>apply 家族函数 <a id="more"></a></p><h3 id="apply函数">apply函数</h3><p>apply函数是最常用的代替for循环的函数。apply函数可以对矩阵、数据框、数组(二维、多维)，按行或列进行循环计算，对子元素进行迭代，并把子元素以参数传递的形式给自定义的FUN函数中，并以返回计算结果。</p><h4 id="函数定义">函数定义</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply(X, MARGIN, FUN, <span class="keyword">...</span>)</span><br></pre></td></tr></table></figure><h4 id="参数列表">参数列表</h4><p><code>X</code>：矩阵、数据框、数组</p><p><code>MARGIN</code>：按行计算或按按列计算，1表示按行，2表示按列</p><p><code>FUN</code>: 自定义函数</p><p><code>…</code>: 自定义参数</p><h4 id="应用">应用</h4><ol type="1"><li><p>对于矩阵行求和</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x&lt;-matrix(<span class="number">1</span>:<span class="number">12</span>,ncol=<span class="number">3</span>)</span><br><span class="line">apply(x,<span class="number">1</span>,sum)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## [1] 15 18 21 24</span><br></pre></td></tr></table></figure></li><li><p>自定义函数的使用</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  生成data.frame  </span></span><br><span class="line">x &lt;- cbind(x1 = <span class="number">3</span>, x2 = c(<span class="number">4</span>:<span class="number">1</span>, <span class="number">2</span>:<span class="number">5</span>)); x</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">##      x1 x2</span><br><span class="line">## [1,]  3  4</span><br><span class="line">## [2,]  3  3</span><br><span class="line">## [3,]  3  2</span><br><span class="line">## [4,]  3  1</span><br><span class="line">## [5,]  3  2</span><br><span class="line">## [6,]  3  3</span><br><span class="line">## [7,]  3  4</span><br><span class="line">## [8,]  3  5</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自定义函数myFUN，第一个参数x为数据</span></span><br><span class="line"><span class="comment"># 第二、三个参数为自定义参数，可以通过apply的&#x27;...&#x27;进行传入。</span></span><br><span class="line">myFUN&lt;- <span class="keyword">function</span>(x, c1, c2) &#123;</span><br><span class="line">   c(sum(x[c1],<span class="number">1</span>), mean(x[c2])) </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 把数据框按行做循环，每行分别传递给myFUN函数，设置c1,c2对应myFUN的第二、三个参数</span></span><br><span class="line">apply(x,<span class="number">1</span>,myFUN,c1=<span class="string">&#x27;x1&#x27;</span>,c2=c(<span class="string">&#x27;x1&#x27;</span>,<span class="string">&#x27;x2&#x27;</span>))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">##      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]</span><br><span class="line">## [1,]  4.0    4  4.0    4  4.0    4  4.0    4</span><br><span class="line">## [2,]  3.5    3  2.5    2  2.5    3  3.5    4</span><br></pre></td></tr></table></figure></li></ol><h3 id="lapply函数">lapply函数</h3><p>lapply函数是一个最基础循环操作函数之一。主要操作对象是list、data.frame，并返回和X长度同样的list结构作为结果集。</p><h4 id="函数定义-1">函数定义</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lapply(X, FUN, <span class="keyword">...</span>)</span><br></pre></td></tr></table></figure><h4 id="参数列表-1">参数列表</h4><p><code>X</code>：矩阵、数据框、数组 <code>FUN</code>: 自定义函数 <code>…</code>: 自定义参数</p><h4 id="应用-1">应用</h4><ol type="1"><li><p>对list进行操作</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x &lt;- list(a = c(<span class="number">1</span>:<span class="number">3</span>), b = c(<span class="number">4</span>:<span class="number">6</span>), d = c(<span class="number">10</span>:<span class="number">20</span>))</span><br><span class="line">lapply(x, sum)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">## $a</span><br><span class="line">## [1] 6</span><br><span class="line">## </span><br><span class="line">## $b</span><br><span class="line">## [1] 15</span><br><span class="line">## </span><br><span class="line">## $d</span><br><span class="line">## [1] 165</span><br></pre></td></tr></table></figure></li><li><p>对data.frame进行操作</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x &lt;- data.frame(x1=<span class="number">3</span>, x2=c(<span class="number">2</span>:<span class="number">1</span>,<span class="number">4</span>:<span class="number">5</span>))</span><br><span class="line">lapply(x, sum)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">## $x1</span><br><span class="line">## [1] 12</span><br><span class="line">## </span><br><span class="line">## $x2</span><br><span class="line">## [1] 12</span><br></pre></td></tr></table></figure></li></ol><h3 id="sapply函数">sapply函数</h3><p>sapply函数是一个简化版的lapply，sapply增加了2个参数simplify和USE.NAMES，主要就是让输出看起来更友好，返回值为向量，而不是list对象。</p><h4 id="函数定义-2">函数定义</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sapply(X, FUN, <span class="keyword">...</span>, simplify=<span class="literal">TRUE</span>, USE.NAMES = <span class="literal">TRUE</span>)</span><br></pre></td></tr></table></figure><h4 id="参数列表-2">参数列表</h4><p><code>X</code>：矩阵、数据框、数组 <code>FUN</code>: 自定义函数 <code>…</code>: 自定义参数 <code>simplify</code>：是否数组化，当值是array时，输出结果按数组进行分组 <code>USE.NAMES</code>：如果X为字符串，TRUE设置字符串为数据名，FALSE不设置</p><h4 id="应用-2">应用</h4><p>对上面的数据框<code>x</code>进行操作：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sapply(x, sum)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## x1 x2 </span><br><span class="line">## 12 12</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class(lapply(x, sum)) <span class="comment"># lapply返回list，sapply返回vector</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## [1] &quot;list&quot;</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class(sapply(x, sum))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## [1] &quot;numeric&quot;</span><br></pre></td></tr></table></figure><h3 id="vapply函数">vapply函数</h3><p>vapply类似于sapply，提供了FUN.VALUE参数，用来控制返回值的行名。</p><h4 id="函数定义-3">函数定义</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vapply(X, FUN, FUN.VALUE, <span class="keyword">...</span>, USE.NAMES = <span class="literal">TRUE</span>)</span><br></pre></td></tr></table></figure><h4 id="参数列表-3">参数列表</h4><p><code>X</code>：矩阵、数据框、数组 <code>FUN</code>: 自定义函数 <code>FUN.VALUE</code>：定义返回值的行名 <code>…</code>: 自定义参数 <code>USE.NAMES</code>：如果X为字符串，TRUE设置字符串为数据名，FALSE不设置</p><h4 id="应用-3">应用</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x &lt;- data.frame(cbind(x1=<span class="number">3</span>, x2=c(<span class="number">2</span>:<span class="number">1</span>,<span class="number">4</span>:<span class="number">5</span>)))</span><br><span class="line">vapply(x,cumsum,FUN.VALUE = c(<span class="string">&#x27;a&#x27;</span>=<span class="number">0</span>,<span class="string">&#x27;b&#x27;</span>=<span class="number">0</span>,<span class="string">&#x27;c&#x27;</span>=<span class="number">0</span>,<span class="string">&#x27;d&#x27;</span>=<span class="number">0</span>)) <span class="comment">#注意FUN.VALUE的用法</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">##   x1 x2</span><br><span class="line">## a  3  2</span><br><span class="line">## b  6  3</span><br><span class="line">## c  9  7</span><br><span class="line">## d 12 12</span><br></pre></td></tr></table></figure><h3 id="mapply函数">mapply函数</h3><p>相当于多参数版本的 sapply。第一次计算传入各组向量的第一个元素到FUN，进行结算得到结果；第二次传入各组向量的第二个元素，得到结果；第三次传入各组向量的第三个元素…以此类推。</p><h4 id="函数定义-4">函数定义</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mapply(FUN, <span class="keyword">...</span>, MoreArgs = <span class="literal">NULL</span>, SIMPLIFY = <span class="literal">TRUE</span>,USE.NAMES = <span class="literal">TRUE</span>)</span><br></pre></td></tr></table></figure><h4 id="参数列表-4">参数列表</h4><p>主要使用的参数有三个 <code>FUN</code>: 自定义函数 <code>FUN.VALUE</code>：定义返回值的行名 <code>…</code>: 自定义参数</p><h4 id="应用-4">应用</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mapply(rep, <span class="number">1</span>:<span class="number">4</span>, <span class="number">4</span>:<span class="number">1</span>) <span class="comment">#每一组参数都是对应的</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">## [[1]]</span><br><span class="line">## [1] 1 1 1 1</span><br><span class="line">## </span><br><span class="line">## [[2]]</span><br><span class="line">## [1] 2 2 2</span><br><span class="line">## </span><br><span class="line">## [[3]]</span><br><span class="line">## [1] 3 3</span><br><span class="line">## </span><br><span class="line">## [[4]]</span><br><span class="line">## [1] 4</span><br></pre></td></tr></table></figure><h3 id="tapply函数">tapply函数</h3><p>tapply用于分组的循环计算，通过INDEX参数可以把数据集X进行分组，相当于group by的操作。</p><h4 id="函数定义-5">函数定义</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tapply(X, INDEX, FUN = <span class="literal">NULL</span>, <span class="keyword">...</span>, simplify = <span class="literal">TRUE</span>)</span><br></pre></td></tr></table></figure><h4 id="参数列表-5">参数列表</h4><p><code>X</code>：向量 <code>INDEX</code>: 分组索引 <code>FUN</code>: 自定义函数 <code>…</code>: 接收多个数据 <code>simplify</code>：是否数组化，当值array时，输出结果按数组进行分组</p><h4 id="应用-5">应用</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对样本分组计数</span></span><br><span class="line">tapply(warpbreaks$breaks, warpbreaks[,-<span class="number">1</span>], sum)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">##     tension</span><br><span class="line">## wool   L   M   H</span><br><span class="line">##    A 401 216 221</span><br><span class="line">##    B 254 259 169</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> base </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tryCatch抓取错误</title>
      <link href="2019/03/06/trycatch/"/>
      <url>2019/03/06/trycatch/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="背景">背景</h2><p>在使用R进行循环操作时，出现错误，为了对错误进行分析，使用<code>tryCatch()</code>函数抓取处理错误</p><h2 id="使用">使用</h2><p>tryCatch常用的三种用法:</p><h3 id="抓取错误">抓取错误</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">tryCatch</span>(libray(test), error = <span class="keyword">function</span>(e)&#123;print(<span class="string">&quot;出现错误&quot;</span>)&#125; )</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## [1] &quot;出现错误&quot;</span><br></pre></td></tr></table></figure><p>释义：当加载<code>test</code>包时，出现错误，执行<code>error</code>函数</p><blockquote><p>这里很适合在循环中出现错误的情况，可以对错误的循环结果进行赋值</p></blockquote><h3 id="抓取警告和错误">抓取警告和错误</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">tryCatch</span>(<span class="keyword">stop</span>(<span class="string">&quot;test&quot;</span>), <span class="keyword">warning</span> = <span class="keyword">function</span>(w)&#123;print(<span class="string">&quot;出现警告&quot;</span>)&#125;,</span><br><span class="line">          finally=&#123;</span><br><span class="line">            print(<span class="string">&quot;test&quot;</span>)</span><br><span class="line">          &#125;)</span><br><span class="line"><span class="comment">## Error in doTryCatch(return(expr), name, parentenv, handler) : test</span></span><br><span class="line"><span class="comment">## [1] &quot;test&quot;</span></span><br></pre></td></tr></table></figure><p>释义：执行语句出错，打印出错误，并执行<code>finally</code>函数</p><blockquote><p>如果单独只有warning函数，则只是打印错误</p></blockquote><h3 id="继续执行">继续执行</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">tryCatch</span>(a = <span class="number">1</span>, finally=&#123;print(<span class="string">&quot;我是个测试&quot;</span>)&#125;)</span><br><span class="line"><span class="comment">## Error in tryCatchList(expr, classes, parentenv, handlers) : </span></span><br><span class="line"><span class="comment">##   argument &quot;expr&quot; is missing, with no default</span></span><br><span class="line"><span class="comment">## [1] &quot;我是个测试&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p><code>finally</code>函数无论错与对都会执行</p></blockquote><h2 id="封装函数">封装函数</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">log_calculator &lt;- <span class="keyword">function</span>(x)&#123;</span><br><span class="line">    <span class="keyword">tryCatch</span>(</span><br><span class="line">        expr = &#123;</span><br><span class="line">            message(log(x))</span><br><span class="line">            message(<span class="string">&quot;Successfully executed the log(x) call.&quot;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        error = <span class="keyword">function</span>(e)&#123;</span><br><span class="line">            message(<span class="string">&#x27;Caught an error!&#x27;</span>)</span><br><span class="line">            print(e)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="keyword">warning</span> = <span class="keyword">function</span>(w)&#123;</span><br><span class="line">            message(<span class="string">&#x27;Caught an warning!&#x27;</span>)</span><br><span class="line">            print(w)</span><br><span class="line">        &#125;,</span><br><span class="line">        finally = &#123;</span><br><span class="line">            message(<span class="string">&#x27;All done, quitting.&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    )    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试结果如下：</p><ul><li>如果<code>x</code>是有效数字，则<code>expr</code>和<code>finally</code>被执行：</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log_calculator(-<span class="number">10</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## Caught an warning!</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## &lt;simpleWarning in log(x): NaNs produced&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## All done, quitting.</span><br></pre></td></tr></table></figure><ul><li>如果<code>x</code>不是有效数字，则<code>expr</code>会报错，<code>warning</code>和<code>finally</code>被执行：</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log_calculator(<span class="string">&quot;10&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## Caught an error!</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## &lt;simpleError in log(x): non-numeric argument to mathematical function&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## All done, quitting.</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>数据拆分与合并</title>
      <link href="2019/03/05/split-combn/"/>
      <url>2019/03/05/split-combn/</url>
      
        <content type="html"><![CDATA[<p>长宽数据格式的转换</p><a id="more"></a><h2 id="背景">背景</h2><p>最近在使用ggplot2绘制图像时，发现ggplot2对于数据的格式要求极为严格，对于不规则的数据进行转换十分头疼。经过一番研究发现一些函数可以简化数据的整形过程，收集如下：</p><h2 id="数据的拆分与合并">数据的拆分与合并</h2><p>ggplot2的输入数据需要是data.frame的形式，因此需要将list等进行融合整形，此时使用reshape2包的<code>melt()</code>函数进行操作就比较方便，此外还有几个相似功能的函数，具体使用如下：</p><h3 id="reshape2">reshape2</h3><p><code>melt()</code>—把宽格式数据转化成长格式</p><p><code>cast()</code>—把长格式数据转化成宽格式【其中<code>dcast()</code>输出时返回一个数据框,<code>acast()</code>输出时返回一个向量/矩阵/数组】</p><h4 id="具体用法">具体用法</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mydata</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">##   ID Time X1 X2</span><br><span class="line">## 1 NA    1  5 NA</span><br><span class="line">## 2  1    2  3  5</span><br><span class="line">## 3  2   NA NA  1</span><br><span class="line">## 4  2    1  2  4</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">md &lt;- melt(mydata, id=c(<span class="string">&quot;ID&quot;</span>,<span class="string">&quot;Time&quot;</span>)) <span class="comment"># 等同于md &lt;- melt(mydata, id=1:2)</span></span><br><span class="line">md <span class="comment">#固定id，融合其他列</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">##   ID Time variable value</span><br><span class="line">## 1 NA    1       X1     5</span><br><span class="line">## 2  1    2       X1     3</span><br><span class="line">## 3  2   NA       X1    NA</span><br><span class="line">## 4  2    1       X1     2</span><br><span class="line">## 5 NA    1       X2    NA</span><br><span class="line">## 6  1    2       X2     5</span><br><span class="line">## 7  2   NA       X2     1</span><br><span class="line">## 8  2    1       X2     4</span><br></pre></td></tr></table></figure><blockquote><p>其实是固定id两列，将其他变量通过”variable”和”value”揉合在一起，结果产生了新的两列，一列是变量variable，指代是哪个揉合变量，另外一列是取值value，即变量对应的值</p></blockquote><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">newmd&lt;- dcast(md, ID~variable, mean)</span><br><span class="line">newmd</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">##   ID X1  X2</span><br><span class="line">## 1  1  3 5.0</span><br><span class="line">## 2  2 NA 2.5</span><br><span class="line">## 3 NA  5  NA</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acast(md, ID~variable, mean)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">##    X1  X2</span><br><span class="line">## 1   3 5.0</span><br><span class="line">## 2  NA 2.5</span><br><span class="line">## NA  5  NA</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acast(md, ID~Time~variable)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">## , , X1</span><br><span class="line">## </span><br><span class="line">##     1  2 NA</span><br><span class="line">## 1  NA  3 NA</span><br><span class="line">## 2   2 NA NA</span><br><span class="line">## NA  5 NA NA</span><br><span class="line">## </span><br><span class="line">## , , X2</span><br><span class="line">## </span><br><span class="line">##     1  2 NA</span><br><span class="line">## 1  NA  5 NA</span><br><span class="line">## 2   4 NA  1</span><br><span class="line">## NA NA NA NA</span><br></pre></td></tr></table></figure><blockquote><p><code>cast()</code>函数处理的对象应该是<code>melt()</code>函数的结果</p></blockquote><h3 id="其他函数">其他函数</h3><h4 id="tidyr包">tidyr包</h4><p><code>gather()</code>—-把宽度较大的数据转换成一个更长的形式，它类比于从reshape2包中<code>melt()</code>函数的功能</p><p><code>spread()</code>—-把长的数据转换成一个更宽的形式，它类比于从reshape2包中<code>cast()</code>函数的功能</p><h4 id="data.table包">data.table包</h4><p><code>data.table</code>包中的<code>melt()</code> 和<code>dcast()</code> 是<code>reshape2</code>包里同名函数的扩展</p><h3 id="总结">总结</h3><p>数据拆分和合并的关系可以用《R语言实战》中的图形表示</p><figure><img src="/images/split-combn/reshape.png" alt="rashape" /><figcaption aria-hidden="true">rashape</figcaption></figure>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> base </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GSEA-基因集富集分析</title>
      <link href="2019/02/24/gsea/"/>
      <url>2019/02/24/gsea/</url>
      
        <content type="html"><![CDATA[<h1>背景</h1><h2 id="富集分析">富集分析</h2><p>说到富集分析，富集分析是将基因根据一些先验的知识（也就是常见的注释）进行分类的过程。我们一般会想到最常见的是GO/KEGG富集，其思路是先筛选差异基因，然后确定这些差异基因的GO/KEGG注释，然后通过超几何分布计算出哪些通路富集到了，通常会选择一个阈值来卡一下，比如p值和FDR等。因此这会涉及到人为的阈值选择，具有一定的主观性，而且只能用于差异较大的基因，所以结果可能有一定的局限性。</p><h2 id="GSEA">GSEA</h2><p>由于一般的富集分析需要人为的选定阈值进行分析，那么对于未达到阈值要求的基因，它们对于生物学的影响该如何计算？GSEA就是为了解决这一问题而提出的，该方法不再强调单个基因的出现与否对富集造成的显著影响，而考虑到基因的表达等微量变化的叠加对于整个富集过程的影响。<br>GSEA分析主要有三个特点：（1）分析的是基因集合而不是单个基因；（2）将基因与预定义的基因集进行比较；（3）富集分析</p><h1>GSEA原理</h1><p>GSEA的思路最早发表于2005年的<a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC1239896/">Gene set enrichment analysis: a knowledge-based approach for interpreting genome-wide expression profiles</a>，主要包括两个概念：<strong>预先定义的基因集S</strong>和<strong>待测基因集L</strong>；GSEA目的就是为了判断S基因集中的基因是随机分布于L，还是聚集分布在L的顶部或者底部；如果待测基因集中的某些基因显著富集在L的顶部或者底部，这说明这些基因的表达对你定义的分组（预先分组）的差异有显著影响，从而找到我们关注的基因集。<br>从富集分析的算法来看，GSEA属于功能集打分法（Functional Class Scoring）。<br><img src="/images/gsea/GSEA-homegraphic.gif" alt="GSEA"></p><h1>GSEA的使用</h1><h2 id="软件下载">软件下载</h2><p>GSEA官网提供了各种版本的GSEA分析工具，包括java，R，GenePattern等平台的</p>]]></content>
      
      
      <categories>
          
          <category> bioinformatics </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>超几何分布和二项分布</title>
      <link href="2019/02/21/hypergeometric/"/>
      <url>2019/02/21/hypergeometric/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="超几何分布">超几何分布</h2><p><strong>超几何分布</strong>是统计学上一种离散概率分布。它描述了由有限个物件中抽出<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex" xmlns="http://www.w3.org/2000/svg" width="1.357ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 600 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container></span>个物件，成功抽出指定种类的物件的个数的概率（不归还）。</p><p><strong>黑白球问题解释</strong>：例如共有<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0" xmlns="http://www.w3.org/2000/svg" width="2.009ex" height="1.545ex" role="img" focusable="false" viewBox="0 -683 888 683"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></g></g></g></svg></mjx-container></span>个球，其中<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex" xmlns="http://www.w3.org/2000/svg" width="1.986ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 878 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container></span>个白球。超几何分布描述了在该<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0" xmlns="http://www.w3.org/2000/svg" width="2.009ex" height="1.545ex" role="img" focusable="false" viewBox="0 -683 888 683"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></g></g></g></svg></mjx-container></span>个球中抽出<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex" xmlns="http://www.w3.org/2000/svg" width="1.357ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 600 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container></span>个，其中<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex" xmlns="http://www.w3.org/2000/svg" width="1.179ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 521 705"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g></svg></mjx-container></span>个是白球的机率：<br><span class="math display"><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -2.805ex" xmlns="http://www.w3.org/2000/svg" width="26.186ex" height="6.854ex" role="img" focusable="false" viewBox="0 -1789.9 11574.3 3029.7"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"></path></g><g data-mml-node="mo" transform="translate(550, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(939, 0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mo" transform="translate(1460, 0)"><path data-c="3B" d="M78 370Q78 394 95 412T138 430Q162 430 180 414T199 371Q199 346 182 328T139 310T96 327T78 370ZM78 60Q78 85 94 103T137 121Q202 121 202 8Q202 -44 183 -94T144 -169T118 -194Q115 -194 106 -186T95 -174Q94 -171 107 -155T137 -107T160 -38Q161 -32 162 -22T165 -4T165 4Q165 5 161 4T142 0Q110 0 94 18T78 60Z"></path></g><g data-mml-node="mi" transform="translate(1904.7, 0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(2504.7, 0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mi" transform="translate(2949.3, 0)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(3827.3, 0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mi" transform="translate(4272, 0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></g><g data-mml-node="mo" transform="translate(5160, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(5826.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(6882.6, 0)"><g data-mml-node="mrow" transform="translate(220, 863)"><g data-mml-node="mrow"><g data-mml-node="TeXAtom" data-mjx-texclass="OPEN"><g data-mml-node="mo"><path data-c="28" d="M152 251Q152 646 388 850H416Q422 844 422 841Q422 837 403 816T357 753T302 649T255 482T236 250Q236 124 255 19T301 -147T356 -251T403 -315T422 -340Q422 -343 416 -349H388Q359 -325 332 -296T271 -213T212 -97T170 56T152 251Z"></path></g></g><g data-mml-node="mfrac" transform="translate(458, 0)"><g data-mml-node="mi" transform="translate(0, 444) scale(0.707)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(126.2, -345) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g><g data-mml-node="TeXAtom" data-mjx-texclass="CLOSE" transform="translate(1078.8, 0)"><g data-mml-node="mo"><path data-c="29" d="M305 251Q305 -145 69 -349H56Q43 -349 39 -347T35 -338Q37 -333 60 -307T108 -239T160 -136T204 27T221 250T204 473T160 636T108 740T60 807T35 839Q35 850 50 850H56H69Q197 743 256 566Q305 425 305 251Z"></path></g></g></g><g data-mml-node="mrow" transform="translate(1536.8, 0)"><g data-mml-node="TeXAtom" data-mjx-texclass="OPEN"><g data-mml-node="mo"><path data-c="28" d="M152 251Q152 646 388 850H416Q422 844 422 841Q422 837 403 816T357 753T302 649T255 482T236 250Q236 124 255 19T301 -147T356 -251T403 -315T422 -340Q422 -343 416 -349H388Q359 -325 332 -296T271 -213T212 -97T170 56T152 251Z"></path></g></g><g data-mml-node="mfrac" transform="translate(458, 0)"><g data-mml-node="mrow" transform="translate(0, 444) scale(0.707)"><g data-mml-node="mi"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></g><g data-mml-node="mo" transform="translate(888, 0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(1666, 0)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mrow" transform="translate(228, -345) scale(0.707)"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(600, 0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(1378, 0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g><g data-mml-node="TeXAtom" data-mjx-texclass="CLOSE" transform="translate(2256.9, 0)"><g data-mml-node="mo"><path data-c="29" d="M305 251Q305 -145 69 -349H56Q43 -349 39 -347T35 -338Q37 -333 60 -307T108 -239T160 -136T204 27T221 250T204 473T160 636T108 740T60 807T35 839Q35 850 50 850H56H69Q197 743 256 566Q305 425 305 251Z"></path></g></g></g></g><g data-mml-node="mrow" transform="translate(1573.9, -887)"><g data-mml-node="TeXAtom" data-mjx-texclass="OPEN"><g data-mml-node="mo"><path data-c="28" d="M152 251Q152 646 388 850H416Q422 844 422 841Q422 837 403 816T357 753T302 649T255 482T236 250Q236 124 255 19T301 -147T356 -251T403 -315T422 -340Q422 -343 416 -349H388Q359 -325 332 -296T271 -213T212 -97T170 56T152 251Z"></path></g></g><g data-mml-node="mfrac" transform="translate(458, 0)"><g data-mml-node="mi" transform="translate(0, 444) scale(0.707)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></g><g data-mml-node="mi" transform="translate(101.8, -345) scale(0.707)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="TeXAtom" data-mjx-texclass="CLOSE" transform="translate(1085.9, 0)"><g data-mml-node="mo"><path data-c="29" d="M305 251Q305 -145 69 -349H56Q43 -349 39 -347T35 -338Q37 -333 60 -307T108 -239T160 -136T204 27T221 250T204 473T160 636T108 740T60 807T35 839Q35 850 50 850H56H69Q197 743 256 566Q305 425 305 251Z"></path></g></g></g><rect width="4451.7" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container></span> 上式可如此理解：</p><p><span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.798ex" xmlns="http://www.w3.org/2000/svg" width="4.488ex" height="2.782ex" role="img" focusable="false" viewBox="0 -877 1983.9 1229.7"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mo"><path data-c="28" d="M152 251Q152 646 388 850H416Q422 844 422 841Q422 837 403 816T357 753T302 649T255 482T236 250Q236 124 255 19T301 -147T356 -251T403 -315T422 -340Q422 -343 416 -349H388Q359 -325 332 -296T271 -213T212 -97T170 56T152 251Z"></path></g><g data-mml-node="mfrac" transform="translate(458, 0)"><g data-mml-node="mi" transform="translate(220, 394) scale(0.707)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></g><g data-mml-node="mi" transform="translate(321.8, -345) scale(0.707)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><rect width="827.9" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(1525.9, 0)"><path data-c="29" d="M305 251Q305 -145 69 -349H56Q43 -349 39 -347T35 -338Q37 -333 60 -307T108 -239T160 -136T204 27T221 250T204 473T160 636T108 740T60 807T35 839Q35 850 50 850H56H69Q197 743 256 566Q305 425 305 251Z"></path></g></g></g></g></svg></mjx-container></span>表示所有在<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0" xmlns="http://www.w3.org/2000/svg" width="2.009ex" height="1.545ex" role="img" focusable="false" viewBox="0 -683 888 683"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></g></g></g></svg></mjx-container></span>个样本中抽出<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex" xmlns="http://www.w3.org/2000/svg" width="1.357ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 600 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container></span>个，而抽出的结果不一样的数目。</p><p><span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.798ex" xmlns="http://www.w3.org/2000/svg" width="4.472ex" height="2.72ex" role="img" focusable="false" viewBox="0 -849.5 1976.8 1202.3"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mo"><path data-c="28" d="M152 251Q152 646 388 850H416Q422 844 422 841Q422 837 403 816T357 753T302 649T255 482T236 250Q236 124 255 19T301 -147T356 -251T403 -315T422 -340Q422 -343 416 -349H388Q359 -325 332 -296T271 -213T212 -97T170 56T152 251Z"></path></g><g data-mml-node="mfrac" transform="translate(458, 0)"><g data-mml-node="mi" transform="translate(220, 394) scale(0.707)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(346.2, -345) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><rect width="820.8" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(1518.8, 0)"><path data-c="29" d="M305 251Q305 -145 69 -349H56Q43 -349 39 -347T35 -338Q37 -333 60 -307T108 -239T160 -136T204 27T221 250T204 473T160 636T108 740T60 807T35 839Q35 850 50 850H56H69Q197 743 256 566Q305 425 305 251Z"></path></g></g></g></g></svg></mjx-container></span>表示在<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex" xmlns="http://www.w3.org/2000/svg" width="1.986ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 878 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container></span>个样本中，抽出<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex" xmlns="http://www.w3.org/2000/svg" width="1.179ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 521 705"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g></svg></mjx-container></span>个的方法数目。剩下来的样本都是及格的，而及格的样本有<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex" xmlns="http://www.w3.org/2000/svg" width="6.761ex" height="1.731ex" role="img" focusable="false" viewBox="0 -683 2988.4 765"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></g><g data-mml-node="mo" transform="translate(1110.2, 0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(2110.4, 0)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container></span>个，剩下的抽法便有<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.912ex" xmlns="http://www.w3.org/2000/svg" width="7.138ex" height="2.905ex" role="img" focusable="false" viewBox="0 -880.9 3154.9 1283.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mo"><path data-c="28" d="M152 251Q152 646 388 850H416Q422 844 422 841Q422 837 403 816T357 753T302 649T255 482T236 250Q236 124 255 19T301 -147T356 -251T403 -315T422 -340Q422 -343 416 -349H388Q359 -325 332 -296T271 -213T212 -97T170 56T152 251Z"></path></g><g data-mml-node="mfrac" transform="translate(458, 0)"><g data-mml-node="TeXAtom" transform="translate(220, 398) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></g><g data-mml-node="mo" transform="translate(888, 0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(1666, 0)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="TeXAtom" transform="translate(448, -345) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(600, 0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(1378, 0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g><rect width="1998.9" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(2696.9, 0)"><path data-c="29" d="M305 251Q305 -145 69 -349H56Q43 -349 39 -347T35 -338Q37 -333 60 -307T108 -239T160 -136T204 27T221 250T204 473T160 636T108 740T60 807T35 839Q35 850 50 850H56H69Q197 743 256 566Q305 425 305 251Z"></path></g></g></g></g></svg></mjx-container></span>种。</p><blockquote><p>若<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex" xmlns="http://www.w3.org/2000/svg" width="5.506ex" height="1.692ex" role="img" focusable="false" viewBox="0 -666 2433.6 748"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(877.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(1933.6, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></svg></mjx-container></span>，超几何分布还原为伯努利分布。若<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0" xmlns="http://www.w3.org/2000/svg" width="2.009ex" height="1.545ex" role="img" focusable="false" viewBox="0 -683 888 683"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></g></g></g></svg></mjx-container></span>接近 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex" xmlns="http://www.w3.org/2000/svg" width="2.262ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 1000 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="221E" d="M55 217Q55 305 111 373T254 442Q342 442 419 381Q457 350 493 303L507 284L514 294Q618 442 747 442Q833 442 888 374T944 214Q944 128 889 59T743 -11Q657 -11 580 50Q542 81 506 128L492 147L485 137Q381 -11 252 -11Q166 -11 111 57T55 217ZM907 217Q907 285 869 341T761 397Q740 397 720 392T682 378T648 359T619 335T594 310T574 285T559 263T548 246L543 238L574 198Q605 158 622 138T664 94T714 61T765 51Q827 51 867 100T907 217ZM92 214Q92 145 131 89T239 33Q357 33 456 193L425 233Q364 312 334 337Q285 380 233 380Q171 380 132 331T92 214Z"></path></g></g></g></svg></mjx-container></span>，超几何分布可视为二项分布</p></blockquote><h2 id="二项分布">二项分布</h2><p>在概率论和统计学中，<strong>二项分布</strong>（英语：Binomial distribution）是<strong>n个独立的是/非试验中成功的次数的离散概率分布</strong>，其中每次试验的成功概率为<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.439ex" xmlns="http://www.w3.org/2000/svg" width="1.138ex" height="1.439ex" role="img" focusable="false" viewBox="0 -442 503 636"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g></g></g></svg></mjx-container></span>。这样的单次成功/失败试验又称为伯努利试验。实际上，当<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex" xmlns="http://www.w3.org/2000/svg" width="5.506ex" height="1.692ex" role="img" focusable="false" viewBox="0 -666 2433.6 748"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(877.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(1933.6, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></svg></mjx-container></span>时，二项分布就是伯努利分布。</p><p><strong>具体解释：</strong></p><p>假设进行<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex" xmlns="http://www.w3.org/2000/svg" width="1.357ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 600 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container></span>次独立实验，每次实验“成功”的概率为<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.439ex" xmlns="http://www.w3.org/2000/svg" width="1.138ex" height="1.439ex" role="img" focusable="false" viewBox="0 -442 503 636"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g></g></g></svg></mjx-container></span>，失败的概率为<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.439ex" xmlns="http://www.w3.org/2000/svg" width="5.035ex" height="1.946ex" role="img" focusable="false" viewBox="0 -666 2225.4 860"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(722.2, 0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(1722.4, 0)"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g></g></g></svg></mjx-container></span>，所有成功的次数X就是一个参数为<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex" xmlns="http://www.w3.org/2000/svg" width="1.357ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 600 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container></span>和<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.439ex" xmlns="http://www.w3.org/2000/svg" width="1.138ex" height="1.439ex" role="img" focusable="false" viewBox="0 -442 503 636"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g></g></g></svg></mjx-container></span>的二项随机变量.数学公式定义为：<br><span class="math display"><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -2.148ex" xmlns="http://www.w3.org/2000/svg" width="28.086ex" height="5.428ex" role="img" focusable="false" viewBox="0 -1449.5 12414.1 2399"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mo" transform="translate(503, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(892, 0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mo" transform="translate(1413, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(2079.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mrow" transform="translate(3135.6, 0)"><g data-mml-node="TeXAtom" data-mjx-texclass="OPEN"><g data-mml-node="mo"><path data-c="28" d="M701 -940Q701 -943 695 -949H664Q662 -947 636 -922T591 -879T537 -818T475 -737T412 -636T350 -511T295 -362T250 -186T221 17T209 251Q209 962 573 1361Q596 1386 616 1405T649 1437T664 1450H695Q701 1444 701 1441Q701 1436 681 1415T629 1356T557 1261T476 1118T400 927T340 675T308 359Q306 321 306 250Q306 -139 400 -430T690 -924Q701 -936 701 -940Z"></path></g></g><g data-mml-node="mfrac" transform="translate(736, 0)"><g data-mml-node="mi" transform="translate(0, 676)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(39.5, -686)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g><g data-mml-node="TeXAtom" data-mjx-texclass="CLOSE" transform="translate(1336, 0)"><g data-mml-node="mo"><path data-c="29" d="M34 1438Q34 1446 37 1448T50 1450H56H71Q73 1448 99 1423T144 1380T198 1319T260 1238T323 1137T385 1013T440 864T485 688T514 485T526 251Q526 134 519 53Q472 -519 162 -860Q139 -885 119 -904T86 -936T71 -949H56Q43 -949 39 -947T34 -937Q88 -883 140 -813Q428 -430 428 251Q428 453 402 628T338 922T245 1146T145 1309T46 1425Q44 1427 42 1429T39 1433T36 1436L34 1438Z"></path></g></g></g><g data-mml-node="mo" transform="translate(5429.8, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="msup" transform="translate(6152, 0)"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mi" transform="translate(503, 413) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g><g data-mml-node="mo" transform="translate(7295.6, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(8017.8, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(8406.8, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(9129.1, 0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(10129.3, 0)"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="msup" transform="translate(10632.3, 0)"><g data-mml-node="mo"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="TeXAtom" transform="translate(389, 413) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(600, 0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(1378, 0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g></g></g></svg></mjx-container></span> 二项分布公式基于伯努利分布得到，因为二项分布中每项实验都是独立的，因此每一次实验都是一次伯努利实验，在<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex" xmlns="http://www.w3.org/2000/svg" width="1.357ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 600 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container></span>次实验中，成功<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex" xmlns="http://www.w3.org/2000/svg" width="1.179ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 521 705"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g></svg></mjx-container></span>次，排列方式有<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.798ex" xmlns="http://www.w3.org/2000/svg" width="4.028ex" height="2.72ex" role="img" focusable="false" viewBox="0 -849.5 1780.3 1202.3"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mo"><path data-c="28" d="M152 251Q152 646 388 850H416Q422 844 422 841Q422 837 403 816T357 753T302 649T255 482T236 250Q236 124 255 19T301 -147T356 -251T403 -315T422 -340Q422 -343 416 -349H388Q359 -325 332 -296T271 -213T212 -97T170 56T152 251Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(458, 0)"><g data-mml-node="mfrac"><g data-mml-node="mi" transform="translate(220, 394) scale(0.707)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(247.9, -345) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><rect width="624.3" height="60" x="120" y="220"></rect></g></g><g data-mml-node="mo" transform="translate(1322.3, 0)"><path data-c="29" d="M305 251Q305 -145 69 -349H56Q43 -349 39 -347T35 -338Q37 -333 60 -307T108 -239T160 -136T204 27T221 250T204 473T160 636T108 740T60 807T35 839Q35 850 50 850H56H69Q197 743 256 566Q305 425 305 251Z"></path></g></g></g></g></svg></mjx-container></span>种，根据乘法原理，即可得到二项分布的公式。</p><h2 id="总结">总结</h2><p>超几何分布相当于连续抽取<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex" xmlns="http://www.w3.org/2000/svg" width="1.357ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 600 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container></span>次成功的概率（不放回抽样），二项分布是重复抽<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex" xmlns="http://www.w3.org/2000/svg" width="1.357ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 600 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container></span>次成功的概率（放回抽样）。</p>]]></content>
      
      
      <categories>
          
          <category> statistics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stats </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fisher精确检验</title>
      <link href="2019/02/19/fisher/"/>
      <url>2019/02/19/fisher/</url>
      
        <content type="html"><![CDATA[<a id="more"></a>  <h2 id="基本概念">基本概念</h2><p>Fisher精确检验是用于分析列联表的统计显着性检验。虽然在实践中它适用于样本量较小的情况，但实际上它适用于所有样本量。它可以精确的计算出差异的显著性p值，而不是卡方检验得到的近似p值。</p><h2 id="理论依据">理论依据</h2><p>Fisher精确检验是基于超几何分布计算的，它分为两种，分别是单边检验（等同于超几何检验）和双边检验。</p><blockquote><p>超几何分布是统计学上一种离散概率分布。它描述了由有限个物件中抽出n个物件，成功抽出指定种类的物件的次数（不归还）。称为超几何分布，是因为其形式与“超几何函数”的级数展式的系数有关。超几何分布的一个形象例子是：有N件物品，M件为次品，求取n件，其中有k件为次品的概率 = <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -1.685ex" xmlns="http://www.w3.org/2000/svg" width="8.989ex" height="4.582ex" role="img" focusable="false" viewBox="0 -1280.4 3973 2025.3"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220, 625) scale(0.707)"><g data-mml-node="mrow"><g data-mml-node="TeXAtom" data-mjx-texclass="OPEN"><g data-mml-node="mo"><path data-c="28" d="M152 251Q152 646 388 850H416Q422 844 422 841Q422 837 403 816T357 753T302 649T255 482T236 250Q236 124 255 19T301 -147T356 -251T403 -315T422 -340Q422 -343 416 -349H388Q359 -325 332 -296T271 -213T212 -97T170 56T152 251Z"></path></g></g><g data-mml-node="mfrac" transform="translate(458, 0)"><g data-mml-node="mi" transform="translate(0, 444) scale(0.707)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"></path></g><g data-mml-node="mi" transform="translate(187.4, -345) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g><g data-mml-node="TeXAtom" data-mjx-texclass="CLOSE" transform="translate(1201.2, 0)"><g data-mml-node="mo"><path data-c="29" d="M305 251Q305 -145 69 -349H56Q43 -349 39 -347T35 -338Q37 -333 60 -307T108 -239T160 -136T204 27T221 250T204 473T160 636T108 740T60 807T35 839Q35 850 50 850H56H69Q197 743 256 566Q305 425 305 251Z"></path></g></g></g><g data-mml-node="mo" transform="translate(1659.2, 0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mrow" transform="translate(2159.2, 0)"><g data-mml-node="TeXAtom" data-mjx-texclass="OPEN"><g data-mml-node="mo"><path data-c="28" d="M152 251Q152 646 388 850H416Q422 844 422 841Q422 837 403 816T357 753T302 649T255 482T236 250Q236 124 255 19T301 -147T356 -251T403 -315T422 -340Q422 -343 416 -349H388Q359 -325 332 -296T271 -213T212 -97T170 56T152 251Z"></path></g></g><g data-mml-node="mfrac" transform="translate(458, 0)"><g data-mml-node="mrow" transform="translate(0, 444) scale(0.707)"><g data-mml-node="mi"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></g><g data-mml-node="mo" transform="translate(888, 0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(1666, 0)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"></path></g></g><g data-mml-node="mrow" transform="translate(289.2, -345) scale(0.707)"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(600, 0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(1378, 0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g><g data-mml-node="TeXAtom" data-mjx-texclass="CLOSE" transform="translate(2379.2, 0)"><g data-mml-node="mo"><path data-c="29" d="M305 251Q305 -145 69 -349H56Q43 -349 39 -347T35 -338Q37 -333 60 -307T108 -239T160 -136T204 27T221 250T204 473T160 636T108 740T60 807T35 839Q35 850 50 850H56H69Q197 743 256 566Q305 425 305 251Z"></path></g></g></g></g><g data-mml-node="mrow" transform="translate(1440.6, -495.5) scale(0.707)"><g data-mml-node="TeXAtom" data-mjx-texclass="OPEN"><g data-mml-node="mo"><path data-c="28" d="M152 251Q152 646 388 850H416Q422 844 422 841Q422 837 403 816T357 753T302 649T255 482T236 250Q236 124 255 19T301 -147T356 -251T403 -315T422 -340Q422 -343 416 -349H388Q359 -325 332 -296T271 -213T212 -97T170 56T152 251Z"></path></g></g><g data-mml-node="mfrac" transform="translate(458, 0)"><g data-mml-node="mi" transform="translate(0, 444) scale(0.707)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></g><g data-mml-node="mi" transform="translate(101.8, -345) scale(0.707)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="TeXAtom" data-mjx-texclass="CLOSE" transform="translate(1085.9, 0)"><g data-mml-node="mo"><path data-c="29" d="M305 251Q305 -145 69 -349H56Q43 -349 39 -347T35 -338Q37 -333 60 -307T108 -239T160 -136T204 27T221 250T204 473T160 636T108 740T60 807T35 839Q35 850 50 850H56H69Q197 743 256 566Q305 425 305 251Z"></path></g></g></g><rect width="3733" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container></p></blockquote><h2 id="基本思想">基本思想</h2><p>在2*2列联表中，四格表周边和（即边际分布）计数固定不变的条件下，计算表内4个实际频数变动时的各种组合之概率Pi；再按照检验假设用单侧或双侧的累计概率P，依据所取的检验水准做出推断。</p><h2 id="具体操作">具体操作</h2><p>假如想要知道学习好坏是否和男女性别有关，那么现在随机抽出20个人，对应的统计列联表如下：</p><table><thead><tr><th style="text-align:left"></th><th style="text-align:left">男</th><th style="text-align:left">女</th><th style="text-align:left">行总数</th></tr></thead><tbody><tr><td style="text-align:left"><strong>好</strong></td><td style="text-align:left">9</td><td style="text-align:left">3</td><td style="text-align:left"><strong>12</strong></td></tr><tr><td style="text-align:left"><strong>坏</strong></td><td style="text-align:left">1</td><td style="text-align:left">7</td><td style="text-align:left"><strong>8</strong></td></tr><tr><td style="text-align:left"><strong>列总数</strong></td><td style="text-align:left"><strong>10</strong></td><td style="text-align:left"><strong>10</strong></td><td style="text-align:left"><strong>20</strong></td></tr></tbody></table><p><strong>零假设</strong>：男女性别和学习好坏无关</p><p>为了知道能否拒绝零假设，我们下面做个Fisher精确检验（单侧检验）</p><p><strong>第一步</strong>：在零假设成立时（即性别与学习好坏无关），我们随机一抽就能抽出这20个样本的概率是（超几何概率）：<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -2.795ex" xmlns="http://www.w3.org/2000/svg" width="21.91ex" height="6.722ex" role="img" focusable="false" viewBox="0 -1735.5 9684.3 2971"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mn" transform="translate(503, -150) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mo" transform="translate(1184.3, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2240.1, 0)"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220, 820.6)"><g data-mml-node="mrow"><g data-mml-node="TeXAtom" data-mjx-texclass="OPEN"><g data-mml-node="mo"><path data-c="28" d="M152 251Q152 646 388 850H416Q422 844 422 841Q422 837 403 816T357 753T302 649T255 482T236 250Q236 124 255 19T301 -147T356 -251T403 -315T422 -340Q422 -343 416 -349H388Q359 -325 332 -296T271 -213T212 -97T170 56T152 251Z"></path></g></g><g data-mml-node="mfrac" transform="translate(458, 0)"><g data-mml-node="mn" transform="translate(0, 444) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g><g data-mml-node="mn" transform="translate(176.8, -345) scale(0.707)"><path data-c="39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z"></path></g></g><g data-mml-node="TeXAtom" data-mjx-texclass="CLOSE" transform="translate(1165.1, 0)"><g data-mml-node="mo"><path data-c="29" d="M305 251Q305 -145 69 -349H56Q43 -349 39 -347T35 -338Q37 -333 60 -307T108 -239T160 -136T204 27T221 250T204 473T160 636T108 740T60 807T35 839Q35 850 50 850H56H69Q197 743 256 566Q305 425 305 251Z"></path></g></g></g><g data-mml-node="mrow" transform="translate(1623.1, 0)"><g data-mml-node="TeXAtom" data-mjx-texclass="OPEN"><g data-mml-node="mo"><path data-c="28" d="M152 251Q152 646 388 850H416Q422 844 422 841Q422 837 403 816T357 753T302 649T255 482T236 250Q236 124 255 19T301 -147T356 -251T403 -315T422 -340Q422 -343 416 -349H388Q359 -325 332 -296T271 -213T212 -97T170 56T152 251Z"></path></g></g><g data-mml-node="mfrac" transform="translate(458, 0)"><g data-mml-node="mn" transform="translate(0, 444) scale(0.707)"><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></g><g data-mml-node="mn" transform="translate(0, -345) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="TeXAtom" data-mjx-texclass="CLOSE" transform="translate(811.6, 0)"><g data-mml-node="mo"><path data-c="29" d="M305 251Q305 -145 69 -349H56Q43 -349 39 -347T35 -338Q37 -333 60 -307T108 -239T160 -136T204 27T221 250T204 473T160 636T108 740T60 807T35 839Q35 850 50 850H56H69Q197 743 256 566Q305 425 305 251Z"></path></g></g></g></g><g data-mml-node="mrow" transform="translate(854.8, -874.9)"><g data-mml-node="TeXAtom" data-mjx-texclass="OPEN"><g data-mml-node="mo"><path data-c="28" d="M152 251Q152 646 388 850H416Q422 844 422 841Q422 837 403 816T357 753T302 649T255 482T236 250Q236 124 255 19T301 -147T356 -251T403 -315T422 -340Q422 -343 416 -349H388Q359 -325 332 -296T271 -213T212 -97T170 56T152 251Z"></path></g></g><g data-mml-node="mfrac" transform="translate(458, 0)"><g data-mml-node="mn" transform="translate(0, 444) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g><g data-mml-node="mn" transform="translate(0, -345) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g></g><g data-mml-node="TeXAtom" data-mjx-texclass="CLOSE" transform="translate(1165.1, 0)"><g data-mml-node="mo"><path data-c="29" d="M305 251Q305 -145 69 -349H56Q43 -349 39 -347T35 -338Q37 -333 60 -307T108 -239T160 -136T204 27T221 250T204 473T160 636T108 740T60 807T35 839Q35 850 50 850H56H69Q197 743 256 566Q305 425 305 251Z"></path></g></g></g><rect width="3092.7" height="60" x="120" y="220"></rect></g></g><g data-mml-node="mo" transform="translate(5850.5, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(6906.3, 0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z" transform="translate(500, 0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(778, 0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1278, 0)"></path><path data-c="39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z" transform="translate(1778, 0)"></path><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" transform="translate(2278, 0)"></path></g></g></g></svg></mjx-container><br><strong>第二步</strong>：如果行总数与列总数（又叫边际总数）不变，零假设不成立时的极端情况应该是，男生学习都好，那么我们可以得到新的列联表：</p><table><thead><tr><th style="text-align:left">男</th><th style="text-align:left">女</th><th style="text-align:left">行总数</th><th></th></tr></thead><tbody><tr><td style="text-align:left"><strong>好</strong></td><td style="text-align:left">10</td><td style="text-align:left">2</td><td><strong>12</strong></td></tr><tr><td style="text-align:left"><strong>坏</strong></td><td style="text-align:left">0</td><td style="text-align:left">8</td><td><strong>8</strong></td></tr><tr><td style="text-align:left"><strong>列总数</strong></td><td style="text-align:left"><strong>10</strong></td><td style="text-align:left"><strong>10</strong></td><td><strong>20</strong></td></tr></tbody></table><p>这时，可以计算这个表格的超几何概率：<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -2.795ex" xmlns="http://www.w3.org/2000/svg" width="29.096ex" height="6.722ex" role="img" focusable="false" viewBox="0 -1735.5 12860.5 2971"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mn" transform="translate(503, -150) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mo" transform="translate(1184.3, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2240.1, 0)"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220, 820.6)"><g data-mml-node="mrow"><g data-mml-node="TeXAtom" data-mjx-texclass="OPEN"><g data-mml-node="mo"><path data-c="28" d="M152 251Q152 646 388 850H416Q422 844 422 841Q422 837 403 816T357 753T302 649T255 482T236 250Q236 124 255 19T301 -147T356 -251T403 -315T422 -340Q422 -343 416 -349H388Q359 -325 332 -296T271 -213T212 -97T170 56T152 251Z"></path></g></g><g data-mml-node="mfrac" transform="translate(458, 0)"><g data-mml-node="mn" transform="translate(0, 444) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g><g data-mml-node="mn" transform="translate(0, -345) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g></g><g data-mml-node="TeXAtom" data-mjx-texclass="CLOSE" transform="translate(1165.1, 0)"><g data-mml-node="mo"><path data-c="29" d="M305 251Q305 -145 69 -349H56Q43 -349 39 -347T35 -338Q37 -333 60 -307T108 -239T160 -136T204 27T221 250T204 473T160 636T108 740T60 807T35 839Q35 850 50 850H56H69Q197 743 256 566Q305 425 305 251Z"></path></g></g></g><g data-mml-node="mrow" transform="translate(1623.1, 0)"><g data-mml-node="TeXAtom" data-mjx-texclass="OPEN"><g data-mml-node="mo"><path data-c="28" d="M152 251Q152 646 388 850H416Q422 844 422 841Q422 837 403 816T357 753T302 649T255 482T236 250Q236 124 255 19T301 -147T356 -251T403 -315T422 -340Q422 -343 416 -349H388Q359 -325 332 -296T271 -213T212 -97T170 56T152 251Z"></path></g></g><g data-mml-node="mfrac" transform="translate(458, 0)"><g data-mml-node="mn" transform="translate(0, 444) scale(0.707)"><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></g><g data-mml-node="mn" transform="translate(0, -345) scale(0.707)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="TeXAtom" data-mjx-texclass="CLOSE" transform="translate(811.6, 0)"><g data-mml-node="mo"><path data-c="29" d="M305 251Q305 -145 69 -349H56Q43 -349 39 -347T35 -338Q37 -333 60 -307T108 -239T160 -136T204 27T221 250T204 473T160 636T108 740T60 807T35 839Q35 850 50 850H56H69Q197 743 256 566Q305 425 305 251Z"></path></g></g></g></g><g data-mml-node="mrow" transform="translate(854.8, -874.9)"><g data-mml-node="TeXAtom" data-mjx-texclass="OPEN"><g data-mml-node="mo"><path data-c="28" d="M152 251Q152 646 388 850H416Q422 844 422 841Q422 837 403 816T357 753T302 649T255 482T236 250Q236 124 255 19T301 -147T356 -251T403 -315T422 -340Q422 -343 416 -349H388Q359 -325 332 -296T271 -213T212 -97T170 56T152 251Z"></path></g></g><g data-mml-node="mfrac" transform="translate(458, 0)"><g data-mml-node="mn" transform="translate(0, 444) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g><g data-mml-node="mn" transform="translate(0, -345) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g></g><g data-mml-node="TeXAtom" data-mjx-texclass="CLOSE" transform="translate(1165.1, 0)"><g data-mml-node="mo"><path data-c="29" d="M305 251Q305 -145 69 -349H56Q43 -349 39 -347T35 -338Q37 -333 60 -307T108 -239T160 -136T204 27T221 250T204 473T160 636T108 740T60 807T35 839Q35 850 50 850H56H69Q197 743 256 566Q305 425 305 251Z"></path></g></g></g><rect width="3092.7" height="60" x="120" y="220"></rect></g></g><g data-mml-node="mo" transform="translate(5850.5, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(6906.3, 0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z" transform="translate(500, 0)"></path><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" transform="translate(778, 0)"></path><path data-c="37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z" transform="translate(1278, 0)"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(1778, 0)"></path><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z" transform="translate(2278, 0)"></path></g><g data-mml-node="mo" transform="translate(9906.5, 0)"><path data-c="D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path></g><g data-mml-node="msup" transform="translate(10906.8, 0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g><g data-mml-node="TeXAtom" transform="translate(1000, 413) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mn" transform="translate(778, 0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g></g></g></g></g></svg></mjx-container><br>那么Fisher精确检验的P value就是两者加和，即<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.439ex" xmlns="http://www.w3.org/2000/svg" width="16.17ex" height="1.946ex" role="img" focusable="false" viewBox="0 -666 7147.1 860"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mn" transform="translate(503, -150) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mo" transform="translate(1128.8, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="msub" transform="translate(2129, 0)"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mn" transform="translate(503, -150) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mo" transform="translate(3313.3, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(4369.1, 0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z" transform="translate(500, 0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(778, 0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1278, 0)"></path><path data-c="39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z" transform="translate(1778, 0)"></path><path data-c="39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z" transform="translate(2278, 0)"></path></g></g></g></svg></mjx-container><br>p值越小，我们越有信心拒绝零假设。如果我们以0.05为显著性水平判断值的话，我们可以认为，男生的学习更好</p><blockquote><p>注意：以上例子计算的是单侧检验的结果，对于双侧结果，一般是说在所有四格表的组合当中，将概率小于或等于原四格表的概率相加，得到双侧概率（需要进一步验证这种说法）</p></blockquote><h2 id="思考">思考</h2><p>Fisher精确检验是基于超几何分布检验的，相对于卡方检验来说，适用于小样本量的计算（卡方检验是通过大样本量来近似卡方分布求得近似的p值）</p>]]></content>
      
      
      <categories>
          
          <category> statistics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stats </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>富集分析</title>
      <link href="2019/02/18/enrichment/"/>
      <url>2019/02/18/enrichment/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="背景">背景</h2><p>不管是转录组，还是芯片数据，或者其他有关基因的组学分析，每当数据分析到后面，要想得到结果，都躲不过这个富集分析。对基因功能进行富集分析, 就有可能发现在生物学过程中起关键作用的生物通路, 并且帮助理解生物学过程的分子机制。</p><h2 id="介绍">介绍</h2><p><strong>基因集</strong>，即 gene set，是一群具有某一特征的基因构成的集合，比如这些基因可能是出现在同一条通路（pathway）中，或者是具有相同的生物学功能。假如现在有一堆基因，如果想要知道这些基因是属于哪一条生物学通路，或者具有什么样的功能我们应该怎么办？这时候就需要使用到富集分析。</p><h2 id="富集分析方法">富集分析方法</h2><h3 id="oraover-representation-analysis过表达分析最常使用">ORA(Over Representation Analysis)：过表达分析【最常使用】</h3><h4 id="原理">原理</h4><p>ORA其实可以通过黑白球问题来解释，假设现在有一堆球，包括m个黑球和n个白球；现在我从这一堆球中取出W个，那么最后要看的是这W个球中是黑色的多还是白色的多，即这W个球中主要富集黑色还是白色。</p><blockquote><p>需要注意的是该方法假设样本或者说基因间是相互独立的，忽略了样本之间的相互联系</p></blockquote><h4 id="常用统计学方法">常用统计学方法</h4><p>超几何分布检验，二项分布检验，卡方检验，Fisher精确检验</p><blockquote><p>实际上超几何分布是不放回的抽样，而二项分布是有放回的抽样，因此一般来说二项分布检验可以作为一个近似的估计</p></blockquote><h3 id="fcsfunctional-class-scoring-功能集打分法">FCS(Functional Class Scoring) 功能集打分法</h3><p>该种方法已经不再强调单个基因的出现与否对富集造成的显著影响，而考虑到基因的表达等微量变化的叠加对于整个富集过程的影响。</p><h4 id="具体方法">具体方法</h4><p>要求的输入是一个排序的基因列表和一个基因集合，不需要设置阈值。计算单个基因表达水平的统计值，采用如衡量差异基因的ANOVA、Q-statistic、t检验、Z-score、信噪比，进行打分或排序，或者直接使用排序好的基因表达谱。同一通路上所有基因的表达水平统计值进行整合，汇集成单个通路水平的分数或统计值，采用基因水平统计的和、均值或中位数，Wilcoxon rank sum, Maxmean statistic, Kolmogorov-Smirnov statistic。对通路水平的显著性进行评估：利用重抽样(bootstrap)的统计学方法</p><blockquote><p>该方法考虑了基因表达量的差异，相对于ORA来说更加细致化</p></blockquote><h3 id="ptpathway-topology通路拓扑学">PT(Pathway Topology)通路拓扑学</h3><p>在通路的富集分析中，一般上游基因的表达水平改变要显著大于下游基因对整个通路的影响。PT方法就是把基因在通路中的位置，和其他基因的互作和调控关系结合在一起，评估每个基因对通路的贡献并算出权重，然后把权重整合到富集分析。</p><h3 id="ntnetwork-topology网络拓扑学">NT(Network topology)网络拓扑学</h3><p>利用现有的全基因组范围的生物网络，提取数据库的基因相互作用关系（如：基因连接度、基因在网络中的距离），把基因的生物学属性整合到功能分析。利用网络拓扑结构来计算基因对特定生物通路的重要性并给予相应的权重，再利用传统的ORA 或 FCS 方法来评估特定生物通路的富集程度，如GANPA 和 LEGO。</p><h2 id="总结">总结</h2><p>在富集分析中，使用最多的应该是Over Representation Analysis，常见的GO富集分析和KEGG富集都是基于Over Representation Analysis</p>]]></content>
      
      
      <categories>
          
          <category> statistics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stats </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>paste()和paste0()用法</title>
      <link href="2019/01/16/paste/"/>
      <url>2019/01/16/paste/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h3 id="函数用法">函数用法</h3><p><strong>paste (…, sep = “ “, collapse = NULL)</strong></p><h3 id="用法详解">用法详解</h3><p>其中<code>...</code>表示一个或多个R可以被转化为字符型的对象；参数<code>sep</code>表示分隔符，默认为空格；参数<code>collapse</code>可选，如果不指定值，那么函数paste的返回值是自变量之间通过sep指定的分隔符连接后得到的一个字符型向量；如果为其指定了特定的值，那么自变量连接后的字符型向量会再被连接成一个字符串，之间通过collapse的值分隔。</p><h3 id="案例展示">案例展示</h3><p>当不添加后置参数时，paste函数和as.character函数的效果是一样的：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">paste(<span class="number">1</span>:<span class="number">12</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">##  [1] &quot;1&quot;  &quot;2&quot;  &quot;3&quot;  &quot;4&quot;  &quot;5&quot;  &quot;6&quot;  &quot;7&quot;  &quot;8&quot;  &quot;9&quot;  &quot;10&quot; &quot;11&quot; &quot;12&quot;</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">paste0(<span class="number">1</span>:<span class="number">12</span>) <span class="comment">#same</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">##  [1] &quot;1&quot;  &quot;2&quot;  &quot;3&quot;  &quot;4&quot;  &quot;5&quot;  &quot;6&quot;  &quot;7&quot;  &quot;8&quot;  &quot;9&quot;  &quot;10&quot; &quot;11&quot; &quot;12&quot;</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">as.character(<span class="number">1</span>:<span class="number">12</span>) <span class="comment">#same</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">##  [1] &quot;1&quot;  &quot;2&quot;  &quot;3&quot;  &quot;4&quot;  &quot;5&quot;  &quot;6&quot;  &quot;7&quot;  &quot;8&quot;  &quot;9&quot;  &quot;10&quot; &quot;11&quot; &quot;12&quot;</span><br></pre></td></tr></table></figure><p>paste函数把它的自变量连成一个字符串，中间默认用空格分开，如：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">paste(<span class="string">&quot;Hello&quot;</span>,<span class="string">&quot;world&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## [1] &quot;Hello world&quot;</span><br></pre></td></tr></table></figure><p>连接的自变量可以是向量，这时各对应元素连接起来，长度不相同时较短的向量被重复使用。如：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">paste(<span class="string">&quot;A&quot;</span>, <span class="number">1</span>:<span class="number">6</span>, sep = <span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## [1] &quot;A1&quot; &quot;A2&quot; &quot;A3&quot; &quot;A4&quot; &quot;A5&quot; &quot;A6&quot;</span><br></pre></td></tr></table></figure><p>如果希望返回的结果是一个元素，使用<code>paste(x,collapse)</code>来实现。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">paste(letters[<span class="number">1</span>:<span class="number">6</span>],collapse=<span class="string">&quot;,&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## [1] &quot;a,b,c,d,e,f&quot;</span><br></pre></td></tr></table></figure><p>同时，可以结合<code>sep</code>参数来使用：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">paste(<span class="string">&quot;A&quot;</span>, <span class="number">1</span>:<span class="number">6</span>, sep = <span class="string">&quot;&quot;</span>,collapse=<span class="string">&quot;,&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## [1] &quot;A1,A2,A3,A4,A5,A6&quot;</span><br></pre></td></tr></table></figure><blockquote><p>sep的优先级应该是高于collapse参数的，因此是先执行sep的操作，再执行collpase</p></blockquote><h3 id="paste0函数">paste0()函数</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">paste (<span class="keyword">...</span>, sep = <span class="string">&quot; &quot;</span>, collapse = <span class="literal">NULL</span>)</span><br><span class="line">paste0(<span class="keyword">...</span>, collapse = <span class="literal">NULL</span>)</span><br></pre></td></tr></table></figure><p>两者对比不难发现：</p><p><code>paste0(..., collapse)</code> 等同于 <code>paste(..., sep = "", collapse)</code>, 效率更高些，其他用法相同</p>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> base </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于C-index计算的相关问题</title>
      <link href="2019/01/07/cindex/"/>
      <url>2019/01/07/cindex/</url>
      
        <content type="html"><![CDATA[<h2 id="背景">背景</h2><p>在进行Cox模型的预后能力评估比较时，C-index作为一个重要的评价指标被广泛的使用。目前有多个R包 可以实现C-index的计算，如：Hmisc，survcomp等。但是，当进行计算时，发现一个问题，使用不同的 R包计算出的C-index值可能不同，虽然这一结果可能是由于对于<a href="http://zeegroom.com/">tied risk</a>事件的处理手段不同所造成的； 但是为了尽量获得可靠的C-index，决定采用Harrell本人开发的Hmisc包进行计算</p><h2 id="计算过程">计算过程</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">library</span>(survival)</span><br><span class="line">&gt; <span class="keyword">library</span>(Hmisc)</span><br><span class="line">&gt; data(colon)</span><br><span class="line">&gt; d &lt;- colon</span><br><span class="line">&gt; surv &lt;- y &lt;- Surv(d $time, <span class="number">1</span>-(d$ status))</span><br><span class="line">&gt; m1 &lt;- coxph(surv ~ rx+sex, data=d)</span><br><span class="line">&gt; m2 &lt;- coxph(surv ~ rx+sex+age, data=d)</span><br><span class="line">&gt; m1.cindex &lt;- rcorr.cens(-predict(m1), surv)</span><br><span class="line"><span class="comment">#m1的C-index和置信区间</span></span><br><span class="line">&gt; m1.cindex</span><br><span class="line">       C Index            Dxy           S.D.              n        missing     uncensored </span><br><span class="line">  <span class="number">5.266315e-01</span>   <span class="number">5.326294e-02</span>   <span class="number">2.170980e-02</span>   <span class="number">1.858000e+03</span>   <span class="number">0.000000e+00</span>   <span class="number">9.380000e+02</span> </span><br><span class="line">Relevant Pairs     Concordant      Uncertain </span><br><span class="line">  <span class="number">9.379880e+05</span>   <span class="number">4.939740e+05</span>   <span class="number">2.510688e+06</span></span><br><span class="line"></span><br><span class="line">&gt; CIndex &lt;- round(m1.cindex[<span class="string">&#x27;C Index&#x27;</span>], digits = <span class="number">4</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.5266</span> </span><br><span class="line">&gt; Lower &lt;- round(CIndex - <span class="number">1.96</span>*m1.cindex[<span class="string">&#x27;S.D.&#x27;</span>]/<span class="number">2</span>, digits = <span class="number">4</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.5053</span></span><br><span class="line">&gt; Upper &lt;- round(CIndex + <span class="number">1.96</span>*m1.cindex[<span class="string">&#x27;S.D.&#x27;</span>]/<span class="number">2</span>, digits = <span class="number">4</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.5479</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># C-index比较的p值</span></span><br><span class="line">&gt; (r &lt;- rcorrp.cens(predict(m1), predict(m2), surv))</span><br><span class="line">         Dxy        S.D. x1 more concordant x2 more concordant         n </span><br><span class="line">     <span class="number">6.069800e-02</span>    <span class="number">2.345218e-02</span>    <span class="number">5.282221e-01</span>    <span class="number">4.675241e-01</span>    <span class="number">1.858000e+03</span> </span><br><span class="line">       missing     uncensored   Relevant Pairs     Uncertain        C X1 </span><br><span class="line">     <span class="number">0.000000e+00</span>    <span class="number">9.380000e+02</span>    <span class="number">9.379880e+05</span>    <span class="number">2.510688e+06</span>    <span class="number">4.733685e-01</span> </span><br><span class="line">         C X2       Dxy X1       Dxy X2 </span><br><span class="line">     <span class="number">4.614846e-01</span>   -<span class="number">5.326294e-02</span>   -<span class="number">7.703084e-02</span> </span><br><span class="line">&gt; (p.value &lt;- round(<span class="number">2</span>*(<span class="number">1</span> - pnorm(r[[<span class="string">&#x27;Dxy&#x27;</span>]] / r[[<span class="string">&#x27;S.D.&#x27;</span>]])), digits=<span class="number">4</span>))</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.0096</span> </span><br></pre></td></tr></table></figure><h2 id="参考">参考</h2><p>https://stats.stackovernet.com/cn/q/30724</p>]]></content>
      
      
      <categories>
          
          <category> bioinformatics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stats </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>绘图配色</title>
      <link href="2019/01/07/color/"/>
      <url>2019/01/07/color/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="背景">背景</h2><p>本篇文章主要收集R语言绘图配色可能用到的一些方案，网站等信息，持续更新ing….</p><h2 id="网站">网站</h2><h3 id="colorbrewer"><a href="http://colorbrewer2.org/">colorbrewer</a></h3><p>这个网站中包含多种可视化主题，RColorBrewer包中的配色方案来源于此</p><h3 id="r语言中的色彩和调色板"><a href="http://iccm.cc/colors-and-palettes-in-r-language/">R语言中的色彩和调色板</a></h3><p>该博文中介绍了介绍了几种常见的R的色彩配色</p><h3 id="rgb颜色表"><a href="http://www.5tu.cn/colors/rgb-peisebiao.html">RGB颜色表</a></h3><p>提供了各种颜色对应的RGB和16色代码</p><p>更新ing… …</p>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> color </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>如何高效的使用谷歌</title>
      <link href="2018/12/20/google/"/>
      <url>2018/12/20/google/</url>
      
        <content type="html"><![CDATA[<p>谷歌是我们常用的搜索工具，对于谷歌的正确使用可以很大程度的节省我们的工作时间，提高工作效率，<strong>以下是几个常用的Google搜索技巧</strong>：</p><ul><li>使用双引号<strong>“搜索内容”</strong>进行精确的搜索</li></ul><p>在很多时候，精确搜索是非常必要的，加入引号后Google会自动进行精确的匹配，常用的环境有：软件安装，软件报错等。</p><ul><li>“减去”搜索内容的搜索</li></ul><p>一般情况下，我们在搜索时通常采用的是关键词的形式，这时候会搜索出大量的内容，如果需要去除某一类型的结果可以使用“-”的方法进行，这时谷歌会自动过滤掉这一类型的结果。</p><ul><li>具体文档类型的搜索</li></ul><p>当你在想要查找具体类型文档的时候非常有用。如你想要pdf版本的只需要在搜索内容的最后加上 filetype:pdf</p><ul><li>指定网站搜索</li></ul><p>如果我们想在某个特定的网站进行搜索的话，你可以在搜索内容之后加上site:<em>.com</em>，你得到的答案就全部来自这个网站了。</p>]]></content>
      
      
      <categories>
          
          <category> opinion </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>R的更新</title>
      <link href="2018/11/22/updateR/"/>
      <url>2018/11/22/updateR/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="背景">背景</h2><p>在windows中R和Rstudio的更新是非常头疼的问题，每次更新都需要把之前的版本删掉重新安装，甚是麻烦。所以一直在想是否有R包可以实现R的自动更新和配置。</p><h3 id="r的更新">R的更新</h3><p>目前R已经提供了<code>installr</code>包用于更新R版本及其相关的软件，目前这种方法只适合于Windows平台。</p><h4 id="installr安装"><code>installr</code>安装</h4><p>目前支持镜像安装，或者从<code>github</code>安装：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 镜像安装</span></span><br><span class="line">install.packages(<span class="string">&#x27;installr&#x27;</span>)  </span><br><span class="line"></span><br><span class="line"><span class="comment"># github安装</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">require</span>(<span class="string">&#x27;devtools&#x27;</span>)) install.packages(<span class="string">&#x27;devtools&#x27;</span>); <span class="comment"># make sure you have Rtools installed first! if not, then run:</span></span><br><span class="line"><span class="comment">#install.packages(&#x27;installr&#x27;)</span></span><br><span class="line"><span class="comment">#install.Rtools()</span></span><br><span class="line">devtools::install_github(<span class="string">&#x27;talgalili/installr&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="安装更新">安装更新</h4><p>直接运行<code>installr()</code>，就会出现下面的选项框，选择需要更新的内容即可</p><p><img src = "/images/updateR/updateR.png" align = "middle"></p><p>目前使用这种方法更新的下载速度比较慢，可能是由于镜像的原因，建议切换到清华的镜像</p><p><strong>注意</strong>：使用此方法更新Rstudio时，需要在R下运行，如果在Rstudio下将不能完成安装。</p>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> base </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Markdown常用语法</title>
      <link href="2018/11/20/markdown/"/>
      <url>2018/11/20/markdown/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h3 id="摘要">摘要</h3><ol type="1"><li><a href="#什么是markdown">什么是Markdown</a></li><li><a href="#亚伦·斯沃茨的传奇人生">亚伦·斯沃茨的传奇人生</a></li><li><a href="#markdown的优点">Markdown的优点</a></li><li><a href="#markdown常用语法">Markdown常用语法</a></li><li><a href="#扩展语法">扩展语法</a></li></ol><h3 id="什么是markdown">什么是Markdown</h3><p><strong>Markdown</strong>是一种<a href="https://zh.wikipedia.org/wiki/轻量级标记语言">轻量级标记语言</a>，创始人为<a href="https://zh.wikipedia.org/wiki/約翰·格魯伯">约翰·格鲁伯</a>（英语：John Gruber）。它允许人们“使用易读易写的纯文本格式编写文档，然后转换成有效的<a href="https://zh.wikipedia.org/wiki/XHTML">XHTML</a>（或者<a href="https://zh.wikipedia.org/wiki/HTML">HTML</a>）文档”。作为一种小型标记语言，Markdown很容易阅读，也很容易使用普通的文本编辑器编辑。</p><p><strong>Markdown</strong>也可以理解为将以MARKDOWN语法编写的语言转换成HTML内容的工具。</p><h3 id="亚伦斯沃茨的传奇人生">亚伦·斯沃茨的传奇人生</h3><p><strong>Markdown</strong>是由<a href="http://www.aaronsw.com/"><strong>Aaron Swartz</strong></a>和<strong>John Gruber</strong>共同设计的，<strong>Aaron Swartz</strong>就是那位于2013年自杀,有着<strong>开挂</strong>一般传奇人生经历的美国程序员。死后也被追授入<a href="https://zh.wikipedia.org/wiki/網際網路名人堂">互联网名人堂</a>。维基百科对他的评价是：<a href="https://zh.wikipedia.org/wiki/美国">美国</a><a href="https://zh.wikipedia.org/wiki/电脑程序员">计算机程序员</a>、<a href="https://zh.wikipedia.org/wiki/企业家">企业家</a>、<a href="https://zh.wikipedia.org/wiki/作家">作家</a>、<a href="https://zh.wikipedia.org/w/index.php?title=政治活动者&amp;action=edit&amp;redlink=1">政治活动者</a>和互联网<a href="https://zh.wikipedia.org/w/index.php?title=黑客主义&amp;action=edit&amp;redlink=1">黑客主义者</a></p><p>他的一生足以让我们膜拜：</p><ul><li>13岁时，斯沃茨赢得为创办“有用、有教育意义、协作而非商业的网站”的年轻人而设的<a href="https://zh.wikipedia.org/w/index.php?title=ArsDigita_Prize&amp;action=edit&amp;redlink=1">ArsDigita</a>奖。</li><li>14岁时，斯沃茨加入编写早期版本的<a href="https://zh.wikipedia.org/wiki/RSS">RSS</a>1.0版本的工作组。</li><li><strong>2004</strong>年入读<strong>斯坦福</strong>，2005年暑假之后就退学创业。。。</li><li><strong>2005</strong>年创建<a href="http://infogami.org/">Infogami</a>，之后与<a href="http://www.reddit.com/">Reddit</a>合并成为其合伙人，斯沃茨被给予公司联合创始人的头衔。</li><li>2008 年，斯沃茨创办了 Watchdog.net，“会咬人的优秀政府类网站”（”the good government site with teeth”），用于汇集政治人物相关的数据起来并进行数据可视化。此外，他最著名的项目之一是《DeadDrop》（之后更名为《<a href="https://zh.wikipedia.org/w/index.php?title=SecureDrop&amp;action=edit&amp;redlink=1">SecureDrop</a>》），一个致力于帮助记者和线人（<a href="https://zh.wikipedia.org/wiki/告密者">告密者</a>）安全沟通的平台。</li><li>2010年创立求进会（Demand Progress），积极参与禁止网络盗版法案（SOPA）活动，最终该提案被撤回。<ul><li><strong>2011</strong>年7月19日，因被控从MIT和JSTOR下载480万篇学术论文并以免费形式上传于网络被捕。</li><li><strong>2013</strong>年1月自杀身亡，死后仍然影响着世界各地的黑客。</li><li><strong>科里·多克托罗的评价</strong>：亚伦拥有无以伦比的政治洞见力、技术能力和处理人、事的智能。我认为他本可以彻底改变美国（及世界）政治。不过——他的遗产仍然可以在将来对政治做出影响。</li></ul></li></ul><p><img src = "/images/markdown/220px-Aaron_Swartz_profile.jpg" align = "middle"></p><h3 id="markdown的优点">Markdown的优点</h3><ul><li>易读（看起来舒服）、易写（语法简单）、易更改<strong>纯文本</strong></li><li>与HTML兼容，是属于程序员的Word</li><li>排版方便</li><li>越来越多的网站支持Markdown。（主要还是写博客方便😜）</li></ul><h3 id="markdown常用语法">Markdown常用语法</h3><h4 id="标题">标题</h4><p>标题一般有两种形式： 1）使用<code>=</code>和<code>-</code>标记一级和二级标题。</p><blockquote><p>一级标题</p><p><code>=========</code></p><p>二级标题</p><p><code>---------</code></p></blockquote><p>效果：</p><blockquote><h1 id="一级标题">一级标题</h1><h2 id="二级标题">二级标题</h2></blockquote><p>2）使用<code>#</code>，可表示1-6级标题。</p><blockquote><p><code># 一级标题</code></p><p><code>## 二级标题</code></p><p><code>### 三级标题</code></p><p><code>#### 四级标题</code></p><p><code>##### 五级标题</code></p><p><code>###### 六级标题</code></p></blockquote><p>效果:</p><blockquote><h1 id="一级标题-1">一级标题</h1><h2 id="二级标题-1">二级标题</h2><h3 id="三级标题">三级标题</h3><h4 id="四级标题">四级标题</h4><h5 id="五级标题">五级标题</h5><h6 id="六级标题">六级标题</h6></blockquote><h4 id="段落">段落</h4><p>Markdown的段落前后都要有空行，如果要段内强制换行，需要使用<strong>两个以上</strong><code>空格键</code>加上<code>回车键</code></p><h4 id="区块引用">区块引用</h4><p>在段落的每行或者只在第一行使用符号<code>&gt;</code>,还可使用多个嵌套引用，如：</p><blockquote><p>&gt;区块引用 &gt;&gt; 嵌套引用</p></blockquote><p>效果：</p><blockquote><p>区块引用</p><blockquote><p>嵌套引用</p></blockquote></blockquote><h4 id="插入代码块">插入代码块</h4><p>代码区块的建立有两种方法： 1）在每行加上4个空格或者一个制表符，如：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello Markdown</span><br></pre></td></tr></table></figure><p><strong>注意</strong>:和普通段落之间需要单独保留空行。</p><p>2）使用三个<strong>```</strong> 来作为代码开始的标志，如：</p><blockquote><p>``` Hello Markdown ```</p></blockquote><p>效果如下：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello Markdown</span><br></pre></td></tr></table></figure><h4 id="黑体和斜体">黑体和斜体</h4><p>在强调内容两侧分别加上<code>*</code>或者<code>_</code>，如：</p><blockquote><p>*斜体*，<em>斜体</em></p><p>**粗体**，<strong>粗体</strong></p></blockquote><h4 id="列表">列表</h4><p><strong>无序列表</strong> 使用<code>·</code>、<code>+</code>、或<code>-</code>标记无序列表，如：</p><blockquote><p>-（+*） 第一项</p><p>-（+*） 第二项</p><p>-（+*）第三项</p></blockquote><p><strong>注意</strong>：标记后面最少有一个_空格_或_制表符_。若不在引用区块中，必须和前方段落之间存在空行。</p><p>效果：</p><blockquote><ul><li>第一项</li><li>第二项</li><li>第三项</li></ul></blockquote><p>有序列表的标记方式是将上述的符号换成数字,并辅以<code>.</code>，如：</p><blockquote><p>1 . 第一项<br />2 . 第二项<br />3 . 第三项</p></blockquote><p>效果：</p><blockquote><ol type="1"><li>第一项</li><li>第二项</li><li>第三项</li></ol></blockquote><h4 id="分割线">分割线</h4><p>分割线最常使用就是三个或以上<code>*</code>，还可以使用<code>-</code>和<code>_</code>。</p><p><strong>注意</strong>： 第一二级标题会自带分割线</p><h4 id="链接">链接</h4><p>链接可以由两种形式生成：<strong>行内式</strong>和<strong>参考式</strong>。</p><p><strong>行内式</strong>：</p><blockquote><p>[**Aaron Swartz**](http://www.aaronsw.com/)</p></blockquote><p>效果：</p><p><a href="http://www.aaronsw.com/"><strong>Aaron Swartz</strong></a></p><p><strong>参考式</strong>： 就是以参考的形式给出链接</p><blockquote><p>[**Aaron Swartz**][1]</p><p>[**亚伦·斯沃茨**][2]</p></blockquote><p>效果：</p><p><a href="http://www.aaronsw.com/"><strong>Aaron Swartz</strong></a> <a href="http://www.aaronsw.com/"><strong>亚伦·斯沃茨</strong></a></p><h4 id="图像插入">图像插入</h4><p>插入图片的语法和插入超链接的语法基本一致，只是在最前面多一个 <code>!</code>。也可分为行内式和参考式两种。</p><blockquote><p>![亚伦·斯沃茨](https://upload.wikimedia.org/wikipedia/commons/thumb/0/06/Aaron_Swartz_profile.jpg/220px-Aaron_Swartz_profile.jpg)</p></blockquote><p>Markdown 不支持指定图片的显示大小，不过可以通过直接插入<code>&lt;img /&gt;</code>标签来指定相关属性。</p><h4 id="字符转义">字符转义</h4><p>反斜线（<code>\</code>）用于插入在 Markdown 语法中有特殊作用的字符。</p><h4 id="行内代码块">行内代码块</h4><p>起到标记作用。如：</p><blockquote><p>`hello`</p></blockquote><p>效果：</p><blockquote><p><code>hello</code></p></blockquote><h3 id="扩展语法">扩展语法</h3><h4 id="删除线">删除线</h4><p>使用<code>~~</code>表示</p><blockquote><p>~<sub>删除线</sub>~</p></blockquote><p>效果：</p><blockquote><p><del>删除线</del></p></blockquote><h4 id="表格">表格</h4><p>使用<code>|</code>表示表格纵向边界，表头和表内容用<code>-</code>隔开，并可用<code>:</code>进行对齐设置，两边都有<code>:</code>则表示居中，若不加<code>:</code>则默认左对齐。</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">| left | center | right |</span><br><span class="line">| :--- | :----: | ----: |</span><br><span class="line">| aaaa | bbbbbb | ccccc |</span><br><span class="line">| a    | b      | c     |</span><br></pre></td></tr></table></figure><p>效果如下：</p><table><thead><tr class="header"><th style="text-align: left;">left</th><th style="text-align: left;">center</th><th style="text-align: left;">right</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">aaaa</td><td style="text-align: left;">bbbbbb</td><td style="text-align: left;">ccccc</td></tr><tr class="even"><td style="text-align: left;">a</td><td style="text-align: left;">b</td><td style="text-align: left;">c</td></tr></tbody></table><p>表格中不仅可以加入字符，还可以是链接等信息。</p>]]></content>
      
      
      <categories>
          
          <category> Markdown </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Markdown </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>卡方检验</title>
      <link href="2018/11/12/chisq/"/>
      <url>2018/11/12/chisq/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="卡方检验">卡方检验</h2><p>卡方检验(Chi-square test/Chi-Square Goodness-of-Fit Test)</p><h3 id="基本概念">基本概念</h3><p>卡方检验是一种非参数假设检验，主要用于比较两个分类变量的关联性分析，其根本思想就是在于比较理论频数和实际频数的吻合程度或拟合优度问题。</p><p>它在分类资料统计推断中的应用，包括：两个率或两个构成比比较的卡方检验；多个率或多个构成比比较的卡方检验以及分类资料的相关分析等。</p><h3 id="基本原理">基本原理</h3><h4 id="基本思想">基本思想</h4><p>卡方检验是以χ2分布为基础的一种假设检验方法，它的原假设H0是：观察频数与期望频数没有差别。</p><p>首先假设H0成立，基于此前提下计算出χ2值，它表示观察值与理论值之间的偏离程度。根据χ2分布及自由度可以确定在H0假设成立的情况下获得当前统计量及更极端情况的概率P。如果P值很小，说明观察值与理论值偏离程度太大，应当拒绝无效假设，表示比较资料之间有显著差异；否则就不能拒绝无效假设，尚不能认为样本所代表的实际情况和理论假设有差别。</p><h4 id="卡方值的计算与意义">卡方值的计算与意义</h4><p>对于χ2统计量的计算，最初是由英国统计学家Karl Pearson在1900年首次提出的，因此也称之为Pearson χ2，其计算公式为<br><span class="math display"><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -2.819ex" xmlns="http://www.w3.org/2000/svg" width="86.544ex" height="6.757ex" role="img" focusable="false" viewBox="0 -1740.7 38252.4 2986.6"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mi"><path data-c="1D712" d="M576 -125Q576 -147 547 -175T487 -204H476Q394 -204 363 -157Q334 -114 293 26L284 59Q283 58 248 19T170 -66T92 -151T53 -191Q49 -194 43 -194Q36 -194 31 -189T25 -177T38 -154T151 -30L272 102L265 131Q189 405 135 405Q104 405 87 358Q86 351 68 351Q48 351 48 361Q48 369 56 386T89 423T148 442Q224 442 258 400Q276 375 297 320T330 222L341 180Q344 180 455 303T573 429Q579 431 582 431Q600 431 600 414Q600 407 587 392T477 270Q356 138 353 134L362 102Q392 -10 428 -89T490 -168Q504 -168 517 -156T536 -126Q539 -116 543 -115T557 -114T571 -115Q576 -118 576 -125Z"></path></g><g data-mml-node="mn" transform="translate(626, 413) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mo" transform="translate(1307.3, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mo" transform="translate(2363.1, 0)"><path data-c="2211" d="M60 948Q63 950 665 950H1267L1325 815Q1384 677 1388 669H1348L1341 683Q1320 724 1285 761Q1235 809 1174 838T1033 881T882 898T699 902H574H543H251L259 891Q722 258 724 252Q725 250 724 246Q721 243 460 -56L196 -356Q196 -357 407 -357Q459 -357 548 -357T676 -358Q812 -358 896 -353T1063 -332T1204 -283T1307 -196Q1328 -170 1348 -124H1388Q1388 -125 1381 -145T1356 -210T1325 -294L1267 -449L666 -450Q64 -450 61 -448Q55 -446 55 -439Q55 -437 57 -433L590 177Q590 178 557 222T452 366T322 544L56 909L55 924Q55 945 60 948Z"></path></g><g data-mml-node="mfrac" transform="translate(3973.8, 0)"><g data-mml-node="mrow" transform="translate(220, 710)"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(389, 0)"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="mo" transform="translate(1361.2, 0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(2361.4, 0)"><path data-c="1D438" d="M492 213Q472 213 472 226Q472 230 477 250T482 285Q482 316 461 323T364 330H312Q311 328 277 192T243 52Q243 48 254 48T334 46Q428 46 458 48T518 61Q567 77 599 117T670 248Q680 270 683 272Q690 274 698 274Q718 274 718 261Q613 7 608 2Q605 0 322 0H133Q31 0 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H757Q764 676 764 669Q764 664 751 557T737 447Q735 440 717 440H705Q698 445 698 453L701 476Q704 500 704 528Q704 558 697 578T678 609T643 625T596 632T532 634H485Q397 633 392 631Q388 629 386 622Q385 619 355 499T324 377Q347 376 372 376H398Q464 376 489 391T534 472Q538 488 540 490T557 493Q562 493 565 493T570 492T572 491T574 487T577 483L544 351Q511 218 508 216Q505 213 492 213Z"></path></g><g data-mml-node="msup" transform="translate(3125.4, 0)"><g data-mml-node="mo"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mn" transform="translate(389, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g><g data-mml-node="mi" transform="translate(1797, -686)"><path data-c="1D438" d="M492 213Q472 213 472 226Q472 230 477 250T482 285Q482 316 461 323T364 330H312Q311 328 277 192T243 52Q243 48 254 48T334 46Q428 46 458 48T518 61Q567 77 599 117T670 248Q680 270 683 272Q690 274 698 274Q718 274 718 261Q613 7 608 2Q605 0 322 0H133Q31 0 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H757Q764 676 764 669Q764 664 751 557T737 447Q735 440 717 440H705Q698 445 698 453L701 476Q704 500 704 528Q704 558 697 578T678 609T643 625T596 632T532 634H485Q397 633 392 631Q388 629 386 622Q385 619 355 499T324 377Q347 376 372 376H398Q464 376 489 391T534 472Q538 488 540 490T557 493Q562 493 565 493T570 492T572 491T574 487T577 483L544 351Q511 218 508 216Q505 213 492 213Z"></path></g><rect width="4118" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(8609.6, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="munderover" transform="translate(9665.3, 0)"><g data-mml-node="mo"><path data-c="2211" d="M60 948Q63 950 665 950H1267L1325 815Q1384 677 1388 669H1348L1341 683Q1320 724 1285 761Q1235 809 1174 838T1033 881T882 898T699 902H574H543H251L259 891Q722 258 724 252Q725 250 724 246Q721 243 460 -56L196 -356Q196 -357 407 -357Q459 -357 548 -357T676 -358Q812 -358 896 -353T1063 -332T1204 -283T1307 -196Q1328 -170 1348 -124H1388Q1388 -125 1381 -145T1356 -210T1325 -294L1267 -449L666 -450Q64 -450 61 -448Q55 -446 55 -439Q55 -437 57 -433L590 177Q590 178 557 222T452 366T322 544L56 909L55 924Q55 945 60 948Z"></path></g><g data-mml-node="TeXAtom" transform="translate(148.2, -1087.9) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(345, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(1123, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mi" transform="translate(537.8, 1150) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g><g data-mml-node="mfrac" transform="translate(11276, 0)"><g data-mml-node="mrow" transform="translate(220, 710)"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="msub" transform="translate(389, 0)"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="mi" transform="translate(750, -150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mo" transform="translate(1655.2, 0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="msub" transform="translate(2655.4, 0)"><g data-mml-node="mi"><path data-c="1D438" d="M492 213Q472 213 472 226Q472 230 477 250T482 285Q482 316 461 323T364 330H312Q311 328 277 192T243 52Q243 48 254 48T334 46Q428 46 458 48T518 61Q567 77 599 117T670 248Q680 270 683 272Q690 274 698 274Q718 274 718 261Q613 7 608 2Q605 0 322 0H133Q31 0 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H757Q764 676 764 669Q764 664 751 557T737 447Q735 440 717 440H705Q698 445 698 453L701 476Q704 500 704 528Q704 558 697 578T678 609T643 625T596 632T532 634H485Q397 633 392 631Q388 629 386 622Q385 619 355 499T324 377Q347 376 372 376H398Q464 376 489 391T534 472Q538 488 540 490T557 493Q562 493 565 493T570 492T572 491T574 487T577 483L544 351Q511 218 508 216Q505 213 492 213Z"></path></g><g data-mml-node="mi" transform="translate(738, -150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="msup" transform="translate(3687.3, 0)"><g data-mml-node="mo"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mn" transform="translate(389, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g><g data-mml-node="msub" transform="translate(1944, -686)"><g data-mml-node="mi"><path data-c="1D438" d="M492 213Q472 213 472 226Q472 230 477 250T482 285Q482 316 461 323T364 330H312Q311 328 277 192T243 52Q243 48 254 48T334 46Q428 46 458 48T518 61Q567 77 599 117T670 248Q680 270 683 272Q690 274 698 274Q718 274 718 261Q613 7 608 2Q605 0 322 0H133Q31 0 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H757Q764 676 764 669Q764 664 751 557T737 447Q735 440 717 440H705Q698 445 698 453L701 476Q704 500 704 528Q704 558 697 578T678 609T643 625T596 632T532 634H485Q397 633 392 631Q388 629 386 622Q385 619 355 499T324 377Q347 376 372 376H398Q464 376 489 391T534 472Q538 488 540 490T557 493Q562 493 565 493T570 492T572 491T574 487T577 483L544 351Q511 218 508 216Q505 213 492 213Z"></path></g><g data-mml-node="mi" transform="translate(738, -150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g><rect width="4679.9" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(16473.7, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="munderover" transform="translate(17529.5, 0)"><g data-mml-node="mo"><path data-c="2211" d="M60 948Q63 950 665 950H1267L1325 815Q1384 677 1388 669H1348L1341 683Q1320 724 1285 761Q1235 809 1174 838T1033 881T882 898T699 902H574H543H251L259 891Q722 258 724 252Q725 250 724 246Q721 243 460 -56L196 -356Q196 -357 407 -357Q459 -357 548 -357T676 -358Q812 -358 896 -353T1063 -332T1204 -283T1307 -196Q1328 -170 1348 -124H1388Q1388 -125 1381 -145T1356 -210T1325 -294L1267 -449L666 -450Q64 -450 61 -448Q55 -446 55 -439Q55 -437 57 -433L590 177Q590 178 557 222T452 366T322 544L56 909L55 924Q55 945 60 948Z"></path></g><g data-mml-node="TeXAtom" transform="translate(148.2, -1087.9) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(345, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(1123, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mi" transform="translate(537.8, 1150) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g><g data-mml-node="mfrac" transform="translate(19140.1, 0)"><g data-mml-node="mrow" transform="translate(220, 710)"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="msub" transform="translate(389, 0)"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="mi" transform="translate(750, -150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mo" transform="translate(1655.2, 0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(2655.4, 0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="msub" transform="translate(3255.4, 0)"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mi" transform="translate(503, -150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="msup" transform="translate(4052.3, 0)"><g data-mml-node="mo"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mn" transform="translate(389, 363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g><g data-mml-node="mrow" transform="translate(1944, -686)"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="msub" transform="translate(600, 0)"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mi" transform="translate(503, -150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g></g><rect width="5044.9" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(24702.8, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="884px" font-family="serif">　</text><text data-variant="normal" transform="translate(900, 0) matrix(1 0 0 -1 0 0)" font-size="884px" font-family="serif">　</text></g><g data-mml-node="mo" transform="translate(26780.6, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(27169.6, 0)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(27792.4, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(28848.1, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(29625.9, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="884px" font-family="serif">，</text></g><g data-mml-node="mn" transform="translate(30803.7, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mo" transform="translate(31581.5, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="884px" font-family="serif">，</text></g><g data-mml-node="mn" transform="translate(32759.2, 0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g><g data-mml-node="mo" transform="translate(33537, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="884px" font-family="serif">，</text></g><g data-mml-node="mo" transform="translate(34714.8, 0)"><path data-c="2026" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60ZM525 60Q525 84 542 102T585 120Q609 120 627 104T646 61Q646 36 629 18T586 0T543 17T525 60ZM972 60Q972 84 989 102T1032 120Q1056 120 1074 104T1093 61Q1093 36 1076 18T1033 0T990 17T972 60Z"></path></g><g data-mml-node="mo" transform="translate(36164.6, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="884px" font-family="serif">，</text></g><g data-mml-node="mi" transform="translate(37342.4, 0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mo" transform="translate(37863.4, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container></span></p><blockquote><p>其中，Ai为i水平的观察频数，Ei为i水平的期望频数，n为总频数，pi为i水平的期望频率。i水平的期望频数Ei等于总频数n×i水平的期望概率pi，k为单元格数。当n比较大时，χ2统计量近似服从k-1(计算Ei时用到的参数个数)个自由度的卡方分布。</p></blockquote><p>由卡方的计算公式可知，当观察频数与期望频数完全一致时，χ2值为0；观察频数与期望频数越接近，两者之间的差异越小，χ2值越小；反之，观察频数与期望频数差别越大，两者之间的差异越大，χ2值越大。换言之，大的χ2值表明观察频数远离期望频数，即表明远离假设。小的χ2值表明观察频数接近期望频数，接近假设。因此，χ2是观察频数与期望频数之间距离的一种度量指标，也是假设成立与否的度量指标。如果χ2值“小”，研究者就倾向于不拒绝H0；如果χ2值大，就倾向于拒绝H0。至于χ2在每个具体研究中究竟要大到什么程度才能拒绝H0，则要借助于卡方分布求出所对应的P值来确定。</p><h4 id="样本量要求">样本量要求</h4><p>卡方分布本身是连续型分布，但是在分类资料的统计分析中，显然频数只能以整数形式出现，因此计算出的统计量是非连续的。只有当样本量比较充足时，才可以忽略两者问的差异，否则将可能导致较大的偏差具体而言，一般认为对于卡方检验中的每一个单元格，要求其最小期望频数均大于1，且至少有4／5的单元格期望频数大于5，此时使用卡方分布计算出的概率值才是准确的。如果数据不符合要求，可以采用Fisher精确检验计算。</p><h3 id="卡方检验类型">卡方检验类型</h3><h4 id="四格表资料的卡方检验">四格表资料的卡方检验</h4><p>四格表资料的卡方检验用于进行两个率或两个构成比的比较。</p><ol type="1"><li>公式</li></ol><p>若四格表资料四个格子的频数分别为a，b，c，d，则四格表资料卡方检验的卡方值=<br><span class="math display"><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.566ex" xmlns="http://www.w3.org/2000/svg" width="41.767ex" height="2.565ex" role="img" focusable="false" viewBox="0 -883.9 18461.2 1133.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(389, 0)"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(918, 0)"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g><g data-mml-node="mo" transform="translate(1660.2, 0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(2660.4, 0)"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(3089.4, 0)"><path data-c="1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="msup" transform="translate(3522.4, 0)"><g data-mml-node="mo"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mn" transform="translate(389, 413) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mo" transform="translate(4537.2, 0)"><path data-c="D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path></g><g data-mml-node="mi" transform="translate(5537.4, 0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(6137.4, 0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></g></g><g data-mml-node="mo" transform="translate(6637.4, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(7026.4, 0)"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mo" transform="translate(7777.7, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(8777.9, 0)"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mo" transform="translate(9206.9, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(9595.9, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(9984.9, 0)"><path data-c="1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mo" transform="translate(10640.1, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(11640.3, 0)"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g><g data-mml-node="mo" transform="translate(12160.3, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(12549.3, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(12938.3, 0)"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mo" transform="translate(13689.6, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(14689.8, 0)"><path data-c="1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mo" transform="translate(15122.8, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(15511.8, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(15900.8, 0)"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mo" transform="translate(16552, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(17552.2, 0)"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g><g data-mml-node="mo" transform="translate(18072.2, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container></span> 自由度v=(行数-1)(列数-1)</p><ol start="2" type="1"><li>应用条件</li></ol><p>要求样本含量应大于40且每个格子中的理论频数不应小于5。当样本含量大于40但理论频数有小于5的情况时卡方值需要校正，当样本含量小于40时只能用Fisher精确检验计算概率。</p><h4 id="行列表资料的卡方检验">行×列表资料的卡方检验</h4><p>行×列表资料的卡方检验用于多个率或多个构成比的比较。</p><ol type="1"><li>公式</li></ol><p>r行c列表资料卡方检验的卡方值:<br><span class="math display"><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.566ex" xmlns="http://www.w3.org/2000/svg" width="46.096ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 20374.4 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(600, 0)"><path data-c="5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path></g><g data-mml-node="mo" transform="translate(878, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="msub" transform="translate(1267, 0)"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="TeXAtom" transform="translate(750, -150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" transform="translate(500, 0)"></path></g></g></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2774.1, 0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></g></g><g data-mml-node="msub" transform="translate(3274.1, 0)"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mn" transform="translate(600, -150) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="msub" transform="translate(4277.7, 0)"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mn" transform="translate(600, -150) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mo" transform="translate(5503.4, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="msub" transform="translate(6503.7, 0)"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="TeXAtom" transform="translate(750, -150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g></g></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(8010.8, 0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></g></g><g data-mml-node="msub" transform="translate(8510.8, 0)"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mn" transform="translate(600, -150) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="msub" transform="translate(9514.3, 0)"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mn" transform="translate(600, -150) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mo" transform="translate(10740.1, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mo" transform="translate(11740.3, 0)"><path data-c="22EF" d="M78 250Q78 274 95 292T138 310Q162 310 180 294T199 251Q199 226 182 208T139 190T96 207T78 250ZM525 250Q525 274 542 292T585 310Q609 310 627 294T646 251Q646 226 629 208T586 190T543 207T525 250ZM972 250Q972 274 989 292T1032 310Q1056 310 1074 294T1093 251Q1093 226 1076 208T1033 190T990 207T972 250Z"></path></g><g data-mml-node="mo" transform="translate(13134.5, 0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="msub" transform="translate(14134.8, 0)"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="TeXAtom" transform="translate(750, -150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(451, 0)"><path data-c="1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g></g></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(15559.8, 0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></g></g><g data-mml-node="msub" transform="translate(16059.8, 0)"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(600, -150) scale(0.707)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="msub" transform="translate(17028.7, 0)"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(600, -150) scale(0.707)"><path data-c="1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g></g><g data-mml-node="mo" transform="translate(17984.9, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(18596.1, 0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mn" transform="translate(19596.4, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(20096.4, 0)"><path data-c="5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path></g></g></g></svg></mjx-container></span> (2) 应用条件</p><p>要求每个格子中的理论频数T均大于5或1&lt;T&lt;5的格子数不超过总格子数的1/5。当有T&lt;1或1&lt;T&lt;5的格子较多时，可采用并行并列、删行删列、增大样本含量的办法使其符合行×列表资料卡方检验的应用条件。</p><h4 id="列联表资料的卡方检验">列联表资料的卡方检验</h4><p>同一组对象，观察每一个个体对两种分类方法的表现，结果构成双向交叉排列的统计表就是列联表。</p><h3 id="用途">用途</h3><ul><li>检验某个连续变量的分布是否与某种理论分布相一致。<br></li><li>检验某个分类变量各类的出现概率是否等于指定概率。<br></li><li>检验某两个分类变量是否相互独立。(最常见到的）<br></li><li>检验某两种方法的结果是否一致。</li></ul><h3 id="应用条件">应用条件</h3><ol type="1"><li>所有的理论数T≥5并且总样本量n≥40，用Pearson卡方进行检验。<br></li><li>如果理论数T＜5但T≥1，并且1≥40，用连续性校正的卡方进行检验。<br></li><li>如果有理论数T＜1或n＜40，则用Fisher’s检验。</li></ol><hr><h3 id="reference">Reference</h3><p><a href="https://wiki.mbalib.com/wiki/卡方检验">卡方检验-MBA智库百科</a></p>]]></content>
      
      
      <categories>
          
          <category> statistics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stats </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>R语言代码规范</title>
      <link href="2018/11/05/r-format/"/>
      <url>2018/11/05/r-format/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><p>R语言是一门主要用于统计计算和绘图的高级编程语言. 在使用R时，好的代码编写和注释规范，可以提高代码的可读性和工作效率. 然而，什么样的规范更有利于我们自己使用和第三方解读？在此，建议使用《来自Google的R语言编码风格指南》一文中推荐的代码写作风格，这个规则是由Google的R用户群体协同设计而成.</p><h2 id="概要-r编码风格约定">概要: R编码风格约定</h2><ol type="1"><li><a href="#文件命名">文件命名</a>: 以 .R (大写) 结尾</li><li><a href="#标识符命名">标识符命名</a>: variable.name, FunctionName, kConstantName</li><li><a href="#单行长度">单行长度</a>: 不超过80个字符</li><li><a href="#缩进">缩进</a>: 两个空格, 不使用制表符</li><li><a href="#空白">空白</a></li><li><a href="#花括号">花括号</a>: 前括号不折行写, 后括号独占一行</li><li><a href="#赋值">赋值符号</a>: 使用 &lt;-, 而非 =</li><li><a href="#分号">分号</a>: 不要用</li><li><a href="#总体布局和顺序">总体布局和顺序</a></li><li><a href="#注释准则">注释准则</a>: 所有注释以 # 开始, 后接一个空格; 行内注释需要在 # 前加两个空格</li><li><a href="#函数的定义和调用">函数的定义和调用</a></li><li><a href="#函数文档">函数文档</a></li><li><a href="#示例函数">示例函数</a></li><li><a href="#TODO书写风格">TODO书写风格</a>: TODO(您的用户名)</li></ol><h3 id="表示和命名">1. 表示和命名</h3><h4 id="文件命名">文件命名</h4><p>文件名应以 .R (大写) 结尾, 文件名本身要有意义. 如: <font color = "green">predict_ad_revenue.R</font></p><h4 id="标识符命名">标识符命名</h4><p>在标识符中不要使用下划线 ( _ ) 或连字符 ( - ). 标识符应根据如下惯例命名. 变量名应使用点 (.) 分隔所有的小写字母或单词; 函数名首字母大写, 不用点分隔 (所含单词首字母大写); 常数命名规则同函数, 但需使用一个 k 开头.</p><ul><li>变量命名 正例: <font color = "green">avg.clicks</font> 反例: <font color = "red">avg_Clicks , avgClicks</font></li><li>FunctionName 正例: <font color = "green">CalculateAvgClicks</font> 反例: <font color = "red">calculate_avg_clicks , calculateAvgClicks</font> 函数命名应为动词或动词性短语.</li></ul><p><em>例外: 当创建一个含类 (class) 属性的对象时, 函数名 (也是constructor) 和类名 (class) 应当匹配 (例如, lm).</em></p><ul><li><font color = "green">kConstantName</font></li></ul><h3 id="语法">2. 语法</h3><h4 id="单行长度">单行长度</h4><p>最大单行长度为 80 个字符.</p><h4 id="缩进">缩进</h4><p>使用两个空格来缩进代码. 永远不要使用制表符或混合使用二者. <em>例外: 当括号内发生折行时, 所折行与括号内的第一个字符对齐.</em></p><h4 id="空白">空白</h4><p>在所有二元操作符 (=, +, -, &lt;-, 等等) 的两侧加上空格. <em>例外: 在函数调用中传递参数时 = 两边的空格可加可不加</em>.</p><p>不可在逗号前加空格, 逗号后总须加空格.</p><p>例如:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tabPrior &lt;- table(df[df$daysFromOpt &lt; <span class="number">0</span>, <span class="string">&quot;campaignid&quot;</span>])</span><br><span class="line">        total &lt;- sum(x[, <span class="number">1</span>])</span><br><span class="line">        total &lt;- sum(x[<span class="number">1</span>, ])</span><br></pre></td></tr></table></figure><p>在前括号前加一个空格, 函数调用时除外. 例如：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (debug)</span><br></pre></td></tr></table></figure><p>多加空格 (即, 在行内使用多于一个空格) 也是可以的, 如果这样做能够改善等号或箭头 (&lt;-) 的对齐效果.</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">plot(x    = xCoord,</span><br><span class="line">     y    = dataMat[, makeColName(metric, ptiles[<span class="number">1</span>], <span class="string">&quot;roiOpt&quot;</span>)],</span><br><span class="line">     ylim = ylim,</span><br><span class="line">     xlab = <span class="string">&quot;dates&quot;</span>,</span><br><span class="line">     ylab = metric,</span><br><span class="line">     main = (paste(metric, <span class="string">&quot; for 3 samples &quot;</span>, sep=<span class="string">&quot;&quot;</span>)))</span><br></pre></td></tr></table></figure><p>不要向圆括号或方括号中的代码两侧加入空格. <em>例外: 逗号后总须加空格.</em></p><p>以下写法就是错误的：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( debug )  <span class="comment"># debug 的两边不要加空格</span></span><br><span class="line">x[<span class="number">1</span>,]  <span class="comment"># 需要在逗号后加一个空格</span></span><br></pre></td></tr></table></figure><h4 id="花括号">花括号</h4><p><strong>前括号永远不应该独占一行; 后括号应当总是独占一行</strong>. 您可以在代码块只含单个语句时省略花括号; 但在处理这类单个语句时, 您必须 前后一致地 要么全部使用花括号, 或者全部不用花括号.</p><p>例如：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (is.null(ylim)) &#123;</span><br><span class="line">  ylim &lt;- c(<span class="number">0</span>, <span class="number">0.06</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>或者：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (is.null(ylim))</span><br><span class="line">  ylim &lt;- c(<span class="number">0</span>, <span class="number">0.06</span>)</span><br></pre></td></tr></table></figure><p>总在新起的一行开始书写代码块的主体。</p><h4 id="赋值">赋值</h4><p>使用 <code>&lt;-</code> 进行赋值, 不用<code>=</code> 赋值</p><h4 id="分号">分号</h4><p>不要以分号结束一行, 也不要利用分号在同一行放多于一个命令. (分号是毫无必要的, 并且为了与其他Google编码风格指南保持一致, 此处同样略去.)</p><h3 id="代码组织">3. 代码组织</h3><h4 id="总体布局和顺序">总体布局和顺序</h4><p>如果所有人都以相同顺序安排代码内容, 我们就可以更加轻松快速地阅读并理解他人的脚本了.</p><ol type="1"><li>版权声明注释</li><li>作者信息注释</li><li>文件描述注释, 包括程序的用途, 输入和输出</li><li><font color = "green">source()</font> 和 <font color = "green">library()</font> 语句</li><li>函数定义</li><li>要执行的语句, 如果有的话 (例如, <font color = "green">print, plot</font>) 单元测试应在另一个名为 <font color = "green">原始的文件名_unittest.R</font> 的独立文件中进行</li></ol><h4 id="注释准则">注释准则</h4><p>注释您的代码. 整行注释应以 <code>#</code>后接一个空格开始.</p><p>行内短注释应在代码后接两个空格, <code>#</code>, 再接一个空格.</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create histogram of frequency of campaigns by pct budget spent.</span></span><br><span class="line">    hist(df$pctSpent,</span><br><span class="line">    breaks = <span class="string">&quot;scott&quot;</span>,  <span class="comment"># method for choosing number of buckets</span></span><br><span class="line">    main   = <span class="string">&quot;Histogram: fraction budget spent by campaignid&quot;</span>,</span><br><span class="line">    xlab   = <span class="string">&quot;Fraction of budget spent&quot;</span>,</span><br><span class="line">    ylab   = <span class="string">&quot;Frequency (count of campaignids)&quot;</span>)</span><br></pre></td></tr></table></figure><h4 id="函数的定义和调用">函数的定义和调用</h4><p><strong>函数定义应首先列出无默认值的参数, 然后再列出有默认值的参数.</strong></p><p>函数定义和函数调用中, 允许每行写多个参数; 折行只允许在赋值语句外进行.</p><p>例如：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PredictCTR &lt;- <span class="keyword">function</span>(query, property, numDays,</span><br><span class="line">    showPlot = <span class="literal">TRUE</span>)</span><br></pre></td></tr></table></figure><p>理想情况下, 单元测试应该充当函数调用的样例 (对于包中的程序来说).</p><h4 id="函数文档">函数文档</h4><p>函数在定义行下方都应当紧接一个注释区. 这些注释应当由如下内容组成: 此函数的一句话描述; 此函数的参数列表, 用 Args: 表示, 对每个参数的描述 (包括数据类型); 以及对于返回值的描述, 以 Returns: 表示. 这些注释应当描述得足够充分, 这样调用者无须阅读函数中的任何代码即可使用此函数.</p><h4 id="示例函数">示例函数</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">CalculateSampleCovariance &lt;- <span class="keyword">function</span>(x, y, verbose = <span class="literal">TRUE</span>) &#123;</span><br><span class="line">        <span class="comment"># Computes the sample covariance between two vectors.</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># Args:</span></span><br><span class="line">        <span class="comment">#   x: One of two vectors whose sample covariance is to be calculated.</span></span><br><span class="line">        <span class="comment">#   y: The other vector. x and y must have the same length, greater than one,</span></span><br><span class="line">        <span class="comment">#      with no missing values.</span></span><br><span class="line">        <span class="comment">#   verbose: If TRUE, prints sample covariance; if not, not. Default is TRUE.</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># Returns:</span></span><br><span class="line">        <span class="comment">#   The sample covariance between x and y.</span></span><br><span class="line">        n &lt;- length(x)</span><br><span class="line">        <span class="comment"># Error handling</span></span><br><span class="line">        <span class="keyword">if</span> (n &lt;= <span class="number">1</span> || n != length(y)) &#123;</span><br><span class="line">        <span class="keyword">stop</span>(<span class="string">&quot;Arguments x and y have invalid lengths: &quot;</span>,</span><br><span class="line">        length(x), <span class="string">&quot; and &quot;</span>, length(y), <span class="string">&quot;.&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">TRUE</span> %<span class="keyword">in</span>% is.na(x) || <span class="literal">TRUE</span> %<span class="keyword">in</span>% is.na(y)) &#123;</span><br><span class="line">        <span class="keyword">stop</span>(<span class="string">&quot; Arguments x and y must not have missing values.&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        covariance &lt;- var(x, y)</span><br><span class="line">        <span class="keyword">if</span> (verbose)</span><br><span class="line">        cat(<span class="string">&quot;Covariance = &quot;</span>, round(covariance, <span class="number">4</span>), <span class="string">&quot;.\n&quot;</span>, sep = <span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span>(covariance)</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h4 id="todo书写风格">TODO书写风格</h4><p>编码时通篇使用一种一致的风格来书写TODO. <font color = "green">TODO(您的用户名): 所要采取行动的明确描述</font></p><hr /><p><strong>Reference：</strong></p><p><a href="https://nanx.me/rstyle/">来自Google的R语言编码风格指南</a></p>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> base </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cut()函数的使用</title>
      <link href="2018/11/01/cut/"/>
      <url>2018/11/01/cut/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="函数名">函数名</h2><p><code>cut()</code></p><h2 id="功能">功能</h2><p>将一个数值向量根据间隔划分出不同的组，返回一个因子向量</p><h2 id="函数用法">函数用法</h2><p><code>cut(x, breaks, labels = NULL, include.lowest = FALSE, right = TRUE, dig.lab = 3, ordered_result = FALSE, ��)</code></p><h2 id="参数介绍">参数介绍</h2><p><code>x</code> ： 将要被分割的数值型向量</p><p><code>breaks</code> ：长度大于1的数值型向量，指定切割数据的分割点</p><p><code>labels</code> ：结果分组中每组的标签</p><p><code>right</code> ：逻辑值，指定分割区间是左闭右开“[)”还是左开右闭“(]”</p><p><code>ordered_result</code> : 逻辑值，结果因子是否是有序的？</p><h2 id="案例说明">案例说明</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">test &lt;- c(<span class="number">1</span>:<span class="number">10</span>)</span><br><span class="line">test</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">##  [1]  1  2  3  4  5  6  7  8  9 10</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cut(test, breaks = c(<span class="number">0</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">10</span>)) <span class="comment">#以3,6作为分割点进行分割 </span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">##  [1] (0,3]  (0,3]  (0,3]  (3,6]  (3,6]  (3,6]  (6,10] (6,10] (6,10] (6,10]</span><br><span class="line">## Levels: (0,3] (3,6] (6,10]</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cut(test, breaks = c(<span class="number">0</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">10</span>), include.lowest = <span class="literal">T</span>) <span class="comment">#参数include.lowest可以设置是否包括最小的那个值</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">##  [1] [0,3]  [0,3]  [0,3]  (3,6]  (3,6]  (3,6]  (6,10] (6,10] (6,10] (6,10]</span><br><span class="line">## Levels: [0,3] (3,6] (6,10]</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cut(test, breaks = c(<span class="number">0</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">10</span>),labels = c(<span class="string">&quot;0-3&quot;</span>, <span class="string">&quot;4-6&quot;</span>,<span class="string">&quot;7-10&quot;</span>)) <span class="comment">#参数lables设置每个类的标签</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">##  [1] 0-3  0-3  0-3  4-6  4-6  4-6  7-10 7-10 7-10 7-10</span><br><span class="line">## Levels: 0-3 4-6 7-10</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cut(test, breaks = c(<span class="number">0</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">10</span>), right = <span class="literal">F</span>) <span class="comment">#参数right可以设置区间是左开右闭还是左闭右开</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">##  [1] [0,3)  [0,3)  [3,6)  [3,6)  [3,6)  [6,10) [6,10) [6,10) [6,10) &lt;NA&gt;  </span><br><span class="line">## Levels: [0,3) [3,6) [6,10)</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cut(test, breaks = c(<span class="number">0</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">10</span>), ordered_result = <span class="literal">T</span>) <span class="comment">#参数ordered_result设置是否返回有序因子向量</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">##  [1] (0,3]  (0,3]  (0,3]  (3,6]  (3,6]  (3,6]  (6,10] (6,10] (6,10] (6,10]</span><br><span class="line">## Levels: (0,3] &lt; (3,6] &lt; (6,10]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> base </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>R for beginners学习笔记</title>
      <link href="2018/10/27/r-beginner/"/>
      <url>2018/10/27/r-beginner/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="r-for-beginners"><strong>R for beginners</strong></h2><h3 id="一基本原理和概念"><strong>一、基本原理和概念</strong></h3><ol type="1"><li>R是一种<strong>解释型语言</strong>， 而不是<strong>编译语言</strong>， 也就意味着输入的命令能够直接被执行， 而不需要像一些语言要首先构成一个完整的程序形式(如C， Fortan, Pascal, . . . )。<br /></li><li>当R运行时， 所有变量， 数据， 函数及结果都以对象(<em>objects</em>)的形式存在计算机的活动内存中， 并冠有相应的名字代号。<br /></li><li><strong>命名规范：</strong>对象的名字必须是以一个字母开头(A{Z 或a{z), 中间可以包含字母， 数字(0{9)， 点(.)及下划线( ). 因为R对对象的名字区分大小写， 所以x 和X就可以代表两个完全不同的对象。<br /></li><li>函数ls的功能是显示所有在内存中的对象，如果只要显示出在名称中带有某个指定字符的对象， 则通过设定选项pattern 来实现。如：<code>ls(pat = "m")</code>,会显示在名称中以<code>m</code>开头的对象<br /></li><li>运行函数ls.str()将会展示内存中所有对象的详细信息<br /></li><li>要在内存中删除某个对象， 可利用函数<code>rm</code>: 运行<code>rm(x)</code>将会删除对象<code>x</code>,运行<code>rm(x,y)</code> 将会删除对象<code>x</code>和<code>y</code>， 而运行<code>rm(list=ls())</code>则会删除内存中的所有对象. 在<code>ls()</code>函数中的一些选项同样也可以运用到<code>rm</code>中来， 以选择的删除一些对象， 如: <code>rm(list=ls(pat=”^m”))</code>。</li></ol><h3 id="二r的数据操作"><strong>二、R的数据操作</strong></h3><h4 id="对象"><strong>1. 对象</strong></h4><ol type="1"><li>在R中，操作的内容称作对象(<em>objects</em>)，对象的刻画主要通过：1）名称和内容；2）<strong>属性</strong><br /></li><li>所有的对象都有两个内在属性： <strong>类型</strong>和<strong>长度</strong>。 类型是对象元素的基本种类，共有四种： <code>数值型</code>， <code>字符型</code>， <code>复数型</code>和<code>逻辑型</code> ；长度是对象中元素的数目。对象的类型和长度可以分别通过函数mode和length得到。<br /></li><li>对象的类型是可以通过<code>as.something</code>这种形式的函数可以完成转换的。<br /></li><li>比较两个对象时，需要使用<code>identical</code>和<code>all.equal</code>函数，他们两者之间存在差别：<code>identical</code>比较数据的内在关系， 如果对象是严格相同的返回<code>TRUE</code>， 否则返回<code>FALSE</code>。 <code>all.equal</code>用来判断两个对象是否“ 近似相等” ， 返回结果为<code>TRUE</code>或者对二者差异的描述。 后一个函数在比较数值型变量时考虑到了计算过程中的近似。具体示例如下：</li></ol><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0.9</span> == (<span class="number">1</span> - <span class="number">0.1</span>)</span><br><span class="line">identical(<span class="number">0.9</span>, <span class="number">1</span> - <span class="number">0.1</span>)</span><br><span class="line">all.equal(<span class="number">0.9</span>, <span class="number">1</span> - <span class="number">0.1</span>)</span><br><span class="line"><span class="number">0.9</span> == (<span class="number">1.1</span> - <span class="number">0.2</span>)</span><br><span class="line">identical(<span class="number">0.9</span>, <span class="number">1.1</span> - <span class="number">0.2</span>)</span><br><span class="line">all.equal(<span class="number">0.9</span>, <span class="number">1.1</span> - <span class="number">0.2</span>)</span><br><span class="line">all.equal(<span class="number">0.9</span>, <span class="number">1.1</span> - <span class="number">0.2</span>, tolerance = <span class="number">1e-16</span>)</span><br></pre></td></tr></table></figure><h3 id="三r绘图"><strong>三、R绘图</strong></h3><ol type="1"><li>有两种绘图函数： 高级绘图函数（<em>high-level plotting functions</em>） 创建一个新的图形， 低级绘图函数（<em>low-level plotting functions</em>） 在现存的图形上添加元素。 绘图参数（<em>graphical parameters</em>） 控制绘图选项， 可以使用缺省值或者用函数par修改。<br /></li><li>绘图设备的切换选择：</li></ol><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dev.list() <span class="comment">#显示当前绘图设备列表</span></span><br><span class="line">dev.cur()  <span class="comment">#显示当前所在绘图设备</span></span><br><span class="line">dev.set()  <span class="comment">#切换绘图设备</span></span><br><span class="line">dev.off()  <span class="comment">#关闭某个绘图设备</span></span><br></pre></td></tr></table></figure><ol start="3" type="1"><li>图形设备面板的分割<ul><li>函数<code>split.screen</code>分割当前的绘图设备；<code>erase.screen()</code>删除最后绘制的图形。<br /></li><li>函数<code>layout</code>把当前的图形窗口分割为多个部份， 图形将一次显示在各部分中。 它主要的自变量是一个元素都是整数值的矩阵， 元素指示子窗口（-windows”） 的编号。如：<code>layout(matrix(1:4, 2, 2))</code>,把设备划分为4个相等的部分。<code>layout.show</code>查看创建的分割。</li></ul></li></ol>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> base </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ROC曲线和AUC</title>
      <link href="2018/10/10/roc-auc/"/>
      <url>2018/10/10/roc-auc/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="roc和auc简介">ROC和AUC简介</h2><p>ROC（Receiver Operating Characteristic）曲线和AUC常被用来评价一个二值分类器（binary classifier）的优劣，对两者的简单介绍见<a href="https://zh.wikipedia.org/wiki/ROC曲线">wiki百科</a>这篇博文主要简单介绍ROC和AUC的特点，以及如何通过R语言绘制ROC曲线和计算AUC值。</p><h3 id="roc曲线意义">ROC曲线意义</h3><p>在这里，我们只讨论二值分类的情况，即“非此即彼”。一般对于二分问题来说，预测分类的结果有四种情况：</p><ol type="1"><li><strong>真阳性（TP）</strong>：预测为正样本，真实也是正样本。</li><li><strong>伪阳性（FP）</strong>：预测为正样本，而真实是负样本。</li><li><strong>真阴性（TN）</strong>：预测为负样本，真实也是负样本。</li><li><strong>伪阴性（FN）</strong>：预测为负样本，而真实是正样本。 用列联表表示其结果，如下所示，1代表正样本，0代表负样本：</li></ol><p><img src="/images/roc-auc/table.png" /></p><p>在这里需要引入两个名词： <strong>真阳性率 (TPR, true positive rate)</strong> ：又称：命中率 (hit rate)、敏感度(sensitivity) TPR = TP / P = TP / (TP+FN) <strong>伪阳性率(FPR, false positive rate)</strong> ：又称：错误命中率，假警报率 (false alarm rate) FPR = FP / N = FP / (FP + TN)</p><p>给定一个<strong>二元分类</strong>模型和它的<strong>阈值</strong>，就能从所有样本的（阳性／阴性）真实值和预测值计算出一个 (X=FPR, Y=TPR) 座标点。如下图所示：</p><p><img src="/images/roc-auc/Roccurves.png" /></p><p>接下来，我们考虑ROC曲线图中的四个点和一条线。第一个点，(0,1)，即FPR=0, TPR=1，这意味着这是一个完美的分类器，它能够将所有的样本都正确分类。第二个点，(1,0)，即FPR=1，TPR=0，说明这个分类器完全无效能可言，将所有的样本都错误的分类。第三个点，(0,0)，即FPR=TPR=0，说明所有的样本全是负样本。类似的，第四个点（1,1），分类器实际上预测所有的样本都为正样本。经过以上的分析，我们可以发现ROC曲线越接近左上角，说明分类器的分类效能越好。</p><p>下面考虑ROC曲线图中的虚线y=x上的点。这条对角线上的点其实表示的是一个采用随机猜测策略的分类器的结果，例如(0.5,0.5)，表示该分类器随机对于一半的样本猜测其为正样本，另外一半的样本为负样本。</p><h3 id="roc曲线绘制原理">ROC曲线绘制原理</h3><p>对于一个分类器来说，其特点是“<strong>概率输出</strong>”,即分类一个样本是根据这个样本有多大概率是正样本（或负样本）来确定的。因此当分类器模型的<strong>阈值</strong>变化时，样本的分类情况也会发生改变，每种阈值的设定会得出不同的FPR和TPR。将<strong>同一分类器模型每个阈值</strong>的 (FPR, TPR) 座标都画在ROC空间里，就成为特定模型的ROC曲线。</p><p>假如我们已经得到了所有样本的概率输出（属于正样本的概率），现在的问题是如何改变“discrimination threashold”？我们根据每个测试样本属于正样本的概率值从大到小排序。下图是一个示例，图中共有20个测试样本，“Class”一栏表示每个测试样本真正的标签（p表示正样本，n表示负样本），“Score”表示每个测试样本属于正样本的概率</p><p><img src="/images/roc-auc/score-ranking.png" /></p><p>我们从高到低，依次将“Score”值作为阈值threshold，当测试样本属于正样本的概率大于或等于这个threshold时，我们认为它为正样本，否则为负样本。举例来说，对于图中的第4个样本，其“Score”值为0.6，那么样本1，2，3，4都被认为是正样本，因为它们的“Score”值都大于等于0.6，而其他样本则都认为是负样本。每次选取一个不同的threshold，我们就可以得到一组FPR和TPR，即ROC曲线上的一点。这样一来，我们一共得到了20组FPR和TPR的值，将它们画在ROC曲线的结果如下图：</p><p><img src="/images/roc-auc/roc-example.png" /></p><p>当我们将threshold设置为1和0时，分别可以得到ROC曲线上的(0,0)和(1,1)两个点。将这些(FPR,TPR)对连接起来，就得到了ROC曲线。当threshold取值越多，ROC曲线越平滑。</p><h3 id="auc的意义">AUC的意义</h3><p>AUC（Area Under Curve），又称为曲线下面积，其意义为随机抽取一个阳性样本和一个阴性样本，分类器正确判断阳性样本的值高于阴性样本的机率。<strong>AUC值越大，说明当前分类器分类的正确率越高，分类器模型也就越好。</strong></p><ul><li>AUC = 1，是完美分类器，采用这个预测模型时，存在至少一个阈值能得出完美预测。绝大多数预测的场合，不存在完美分类器。</li><li>0.5 &lt; AUC &lt; 1，优于随机猜测。这个分类器（模型）妥善设定阈值的话，能有预测价值。</li><li>AUC = 0.5，跟随机猜测一样（例：丢铜板），模型没有预测价值。</li><li>AUC &lt; 0.5，比随机猜测还差；但只要总是反预测而行，就优于随机猜测。</li></ul><p>图形示例如下：</p><p><img src="/images/roc-auc/Curvas.png" /></p><hr /><h2 id="reference">Reference</h2><ul><li><a href="http://alexkong.net/2013/06/introduction-to-auc-and-roc/">ROC和AUC介绍以及如何计算AUC</a></li><li><a href="https://zh.wikipedia.org/wiki/ROC曲线">ROC曲线- 维基百科，自由的百科全书</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> statistics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ROC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>同一电脑配置多个Github账户</title>
      <link href="2018/09/25/more-github/"/>
      <url>2018/09/25/more-github/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="场景">场景</h2><p>最近在使用github时发现自己日常的代码和博客是放在同一个账户上的，作为一个强迫症患者的我，自然是要再申请一个github账号托管博客:)</p><p>But！！！当我设置完毕后，发现并不能连接到远端进行克隆。。。简直是坑爹啊~有木有！经过一番研究终于找到解决办法，故记录如下：</p><h2 id="ssh协议">SSH协议</h2><p>Secure Shell（缩写为 SSH），是创建在应用层和传输层基础上的安全协议。目前主要用于远程登录会话和其他网络服务。连接github时，我们需要生成配对的SSH公钥和密钥来连接远程仓库。而一对公钥密钥只能识别一个账户。也就是说，当你设置连接两个远端github仓库时，你需要生成两对公钥密钥来进行身份识别。</p><h2 id="配置流程">配置流程</h2><p>以Github来举例说明（<strong>服务器的地址都是github.com，也可以是不同的地址</strong>），如何配置多用户，多地址提交项目。假设当前有两个账号：一个Github的账号是A，另一个Github的账号是B</p><h3 id="配置多个git账户">1. 配置多个Git账户</h3><p>这里分两种情况：</p><blockquote><ol type="1"><li>一个账户已经进行了配置，添加另外一个账户</li><li>同时配置两个git账户</li></ol></blockquote><p>假如之前你已经有账户进行了git的全局设置，那么首先需要解除git全局<code>用户名/邮箱</code>的设置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">git config --global --<span class="built_in">unset</span> <span class="string">&quot;user.name&quot;</span></span><br><span class="line">git config --global --<span class="built_in">unset</span> <span class="string">&quot;user.email&quot;</span></span><br><span class="line">```   </span><br><span class="line">如果之前并未进行全局设置，则直接开始设置每个仓库独立的用户和邮箱  </span><br><span class="line">```shell</span><br><span class="line"><span class="comment">#设置第一个用户/邮箱</span></span><br><span class="line">git config user.email <span class="string">&quot;A@gmail.com&quot;</span></span><br><span class="line">git config user.name <span class="string">&quot;A&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#设置第二个用户/邮箱</span></span><br><span class="line">git config user.email <span class="string">&quot;B@163.com&quot;</span></span><br><span class="line">git config user.name <span class="string">&quot;B&quot;</span></span><br></pre></td></tr></table></figure><h3 id="创建密钥公钥">2. 创建<code>密钥/公钥</code></h3><p>在进行单用户操作时我们只需要通过：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -f -C <span class="string">&quot;yourmail@xxx.com&quot;</span></span><br></pre></td></tr></table></figure><p>命令直接产生相应的<code>密钥/公钥</code>，但是在多用户的情况下,直接产生两次<code>密钥/公钥</code>会将第一次产生的<code>密钥/公钥</code>覆盖掉。因此，进行多用户操作时，需要指定产生的密钥名称，避免覆盖。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建A账户的密钥、公钥</span></span><br><span class="line">ssh-keygen -t rsa -f ~/.ssh/id_rsa_A -C <span class="string">&quot;A@gmail.com&quot;</span></span><br><span class="line">ssh-keygen -t rsa -f ~/.ssh/id_rsa_B -C <span class="string">&quot;B@163.com&quot;</span></span><br><span class="line">```  </span><br><span class="line">此时会在用户的`.ssh`文件夹下产生`id_rsa_A`、`id_rsa_A.pub`和`id_rsa_B`、`id_rsa_B.pub`两对`密钥/公钥`。  </span><br><span class="line"><span class="comment">##### 3. 设置config文件  </span></span><br><span class="line">在.ssh文件夹下创建config文件,配置不同的仓库指向不同的密钥文件。</span><br><span class="line">```shell</span><br><span class="line"><span class="comment"># A账号</span></span><br><span class="line">Host A <span class="comment">#host别名</span></span><br><span class="line">HostName github.com <span class="comment">#服务器域名</span></span><br><span class="line">User git <span class="comment">#A账号用户名</span></span><br><span class="line">IdentityFile ~/.ssh/id_rsa</span><br><span class="line"><span class="comment"># B账号</span></span><br><span class="line">Host B  <span class="comment">#host别名</span></span><br><span class="line">HostName github.com <span class="comment">#服务器域名</span></span><br><span class="line">User git <span class="comment">#B账号用户名</span></span><br><span class="line">IdentityFile ~/.ssh/id_rsa_x</span><br></pre></td></tr></table></figure><blockquote><p><strong>原理解析</strong> 1.ssh 客户端是通过类似 <a href="mailto:git@github.com">git@github.com</a>:githubUserName/repoName.git ** 的地址来识别使用本地的哪个私钥的，地址中的 User 是@前面的git， Host 是@后面的github.com。 2.如果所有账号的 User 和 Host 都为 git 和 github.com，那么就只能使用一个私钥。所以要对User 和 Host 进行配置，让每个账号使用自己的 Host，即使用上面的别名来代替域名。 3.配置了别名之后，新的地址就是git@A:githubUserName/repName.git**（在添加远程仓库时使用）。这样 ssh 在连接时就可以区别不同的账号了。</p></blockquote><h3 id="添加ssh公钥">4. 添加SSH公钥</h3><p>把相应的公钥添加到账户的SSH设置当中，这样git就可以识别不同的账户了。</p><hr /><h2 id="reference">Reference</h2><p>https://www.jianshu.com/p/04e9a885c5c8</p>]]></content>
      
      
      <categories>
          
          <category> git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>library和require的差别</title>
      <link href="2018/08/02/library-require/"/>
      <url>2018/08/02/library-require/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="背景">背景</h2><p>在R语言中，载入R包函数有两个：<code>library()</code> 和 <code>require()</code>，但是两者之间又存在很大的不同</p><h2 id="区别">区别</h2><ol type="1"><li>在初始环境下载入一个R包，如果这个包不存在，执行<code>library()</code>会提示Error，并且停止运行；执行<code>require()</code>会提示Warning，继续执行运算</li></ol><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(<span class="string">&quot;abc&quot;</span>)</span><br><span class="line">Error <span class="keyword">in</span> <span class="keyword">library</span>(<span class="string">&quot;abc&quot;</span>) : there is no package called <span class="string">&#x27;abc&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span>(<span class="string">&quot;abc&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## Loading required package: abc</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## Warning in library(package, lib.loc &#x3D; lib.loc, character.only &#x3D; TRUE, logical.return &#x3D; TRUE, :</span><br><span class="line">## there is no package called &#39;abc&#39;</span><br></pre></td></tr></table></figure><ol start="2" type="1"><li>在载入的包不存在时，<code>library()</code>只停止运算，只会显示错误提示，没有返回值；<code>require()</code>会返回一个逻辑值</li></ol><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">test &lt;- <span class="keyword">library</span>(<span class="string">&quot;abc&quot;</span>)</span><br><span class="line">Error <span class="keyword">in</span> <span class="keyword">library</span>(<span class="string">&quot;abc&quot;</span>) : there is no package called <span class="string">&#x27;abc</span></span><br><span class="line"><span class="string">test #显示错误提示</span></span><br><span class="line"><span class="string">Error: object &#x27;</span>test<span class="string">&#x27; not found</span></span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test &lt;- <span class="keyword">require</span>(<span class="string">&quot;abc&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## Loading required package: abc</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## Warning in library(package, lib.loc &#x3D; lib.loc, character.only &#x3D; TRUE, logical.return &#x3D; TRUE, :</span><br><span class="line">## there is no package called &#39;abc&#39;</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## [1] FALSE</span><br></pre></td></tr></table></figure><h2 id="应用">应用</h2><p>在自定义函数中，可以利用<code>require()</code>函数来检测运行环境，确保函数可以正确运行</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">require</span>(<span class="string">&quot;MASS&quot;</span>))&#123;</span><br><span class="line">    print(<span class="string">&quot;MASS is loaded correctly&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    print(<span class="string">&quot;you need install MASS package&quot;</span>)</span><br><span class="line">    install.packages(<span class="string">&quot;MASS&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">require</span>(MASS))&#123;</span><br><span class="line">        print(<span class="string">&quot;MASS installed and loaded&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">stop</span>(<span class="string">&quot;could not install MASS&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> base </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>组合多张ggplot2图片</title>
      <link href="2018/05/23/combine-ggplot2/"/>
      <url>2018/05/23/combine-ggplot2/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><p>在同一页面上安排<strong>多张ggplot2</strong>图片时，普通的标准R函数<code>par()</code>和<code>layout</code>已经不能使用。</p><p>目前基本的解决办法是使用名叫<code>ggExtra</code>的R包，它包含以下功能：<br />+ <code>grid.arrange（）</code>和<code>arrangeGrob（）</code>可以在一个页面上排列多个ggplots<br />+ <code>marrangeGrob（）</code>可用于在多个页面上排列多个ggplots</p><p>但是，这些功能不会尝试对齐绘图面板; 相反，这些图只是简单地放置在网格中，因此轴不对齐。</p><p>因此我们可以使用<code>ggpubr</code>包提供的<code>ggarrange（）</code>函数来实现多个ggplot图画的排布，并且提供统一的共同图例。</p><h2 id="创建图片">创建图片</h2><p>使用演示数据集 <em><strong>ToothGrowth</strong></em> 和 <em><strong>mtcars</strong></em>创建多个图形：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Box plot (bp)</span></span><br><span class="line">bxp &lt;- ggboxplot(ToothGrowth, x = <span class="string">&quot;dose&quot;</span>, y = <span class="string">&quot;len&quot;</span>,</span><br><span class="line">                 color = <span class="string">&quot;dose&quot;</span>, palette = <span class="string">&quot;jco&quot;</span>)</span><br><span class="line">bxp</span><br></pre></td></tr></table></figure><figure><img src="/images/combine-ggplot2/unnamed-chunk-2-1.png" alt="plot of chunk unnamed-chunk-2" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-2</figcaption></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Dot plot (dp)</span></span><br><span class="line">dp &lt;- ggdotplot(ToothGrowth, x = <span class="string">&quot;dose&quot;</span>, y = <span class="string">&quot;len&quot;</span>,</span><br><span class="line">                 color = <span class="string">&quot;dose&quot;</span>, palette = <span class="string">&quot;jco&quot;</span>, binwidth = <span class="number">1</span>)</span><br><span class="line">dp</span><br></pre></td></tr></table></figure><figure><img src="/images/combine-ggplot2/unnamed-chunk-2-2.png" alt="plot of chunk unnamed-chunk-2" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-2</figcaption></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">data(<span class="string">&quot;mtcars&quot;</span>)</span><br><span class="line">mtcars$name &lt;- rownames(mtcars)</span><br><span class="line">mtcars$cyl &lt;- as.factor(mtcars$cyl)</span><br><span class="line">head(mtcars[, c(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;wt&quot;</span>, <span class="string">&quot;mpg&quot;</span>, <span class="string">&quot;cyl&quot;</span>)])</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">##                                name   wt  mpg cyl</span><br><span class="line">## Mazda RX4                 Mazda RX4 2.62 21.0   6</span><br><span class="line">## Mazda RX4 Wag         Mazda RX4 Wag 2.88 21.0   6</span><br><span class="line">## Datsun 710               Datsun 710 2.32 22.8   4</span><br><span class="line">## Hornet 4 Drive       Hornet 4 Drive 3.21 21.4   6</span><br><span class="line">## Hornet Sportabout Hornet Sportabout 3.44 18.7   8</span><br><span class="line">## Valiant                     Valiant 3.46 18.1   6</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Bar plot (bp)</span></span><br><span class="line">bp &lt;- ggbarplot(mtcars, x = <span class="string">&quot;name&quot;</span>, y = <span class="string">&quot;mpg&quot;</span>,</span><br><span class="line">          fill = <span class="string">&quot;cyl&quot;</span>,               <span class="comment"># change fill color by cyl</span></span><br><span class="line">          color = <span class="string">&quot;white&quot;</span>,            <span class="comment"># Set bar border colors to white</span></span><br><span class="line">          palette = <span class="string">&quot;jco&quot;</span>,            <span class="comment"># jco journal color palett. see ?ggpar</span></span><br><span class="line">          sort.val = <span class="string">&quot;asc&quot;</span>,           <span class="comment"># Sort the value in ascending order</span></span><br><span class="line">          sort.by.groups = <span class="literal">TRUE</span>,      <span class="comment"># Sort inside each group</span></span><br><span class="line">          x.text.angle = <span class="number">90</span>           <span class="comment"># Rotate vertically x axis texts</span></span><br><span class="line">          )</span><br><span class="line">bp + font(<span class="string">&quot;x.text&quot;</span>, size = <span class="number">8</span>)</span><br></pre></td></tr></table></figure><figure><img src="/images/combine-ggplot2/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-4</figcaption></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Scatter plots (sp)</span></span><br><span class="line">sp &lt;- ggscatter(mtcars, x = <span class="string">&quot;wt&quot;</span>, y = <span class="string">&quot;mpg&quot;</span>,</span><br><span class="line">                add = <span class="string">&quot;reg.line&quot;</span>,               <span class="comment"># Add regression line</span></span><br><span class="line">                conf.int = <span class="literal">TRUE</span>,                <span class="comment"># Add confidence interval</span></span><br><span class="line">                color = <span class="string">&quot;cyl&quot;</span>, palette = <span class="string">&quot;jco&quot;</span>, <span class="comment"># Color by groups &quot;cyl&quot;</span></span><br><span class="line">                shape = <span class="string">&quot;cyl&quot;</span>                   <span class="comment"># Change point shape by groups &quot;cyl&quot;</span></span><br><span class="line">                )+</span><br><span class="line">  stat_cor(aes(color = cyl), label.x = <span class="number">3</span>)       <span class="comment"># Add correlation coefficient</span></span><br><span class="line">sp</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## &#96;geom_smooth()&#96; using formula &#39;y ~ x&#39;</span><br></pre></td></tr></table></figure><figure><img src="/images/combine-ggplot2/unnamed-chunk-4-2.png" alt="plot of chunk unnamed-chunk-4" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-4</figcaption></figure><h2 id="组合多张图片在一个面板上">组合多张图片在一个面板上</h2><p>使用<code>ggpubr</code>包的<code>ggarrange（）</code>进行以下操作：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggarrange(bxp, dp, bp + rremove(<span class="string">&quot;x.text&quot;</span>), </span><br><span class="line">          labels = c(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>),</span><br><span class="line">          ncol = <span class="number">2</span>, nrow = <span class="number">2</span>)</span><br></pre></td></tr></table></figure><figure><img src="/images/combine-ggplot2/unnamed-chunk-5-1.png" alt="plot of chunk unnamed-chunk-5" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-5</figcaption></figure><h2 id="给图片添加注释">给图片添加注释</h2><p><code>ggpubr</code>包提供了函数<code>annotate_figure()</code>可以对面板中图片整体或任意图片添加一定量的注释展示效果如下图:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">figure &lt;- ggarrange(sp, bp + font(<span class="string">&quot;x.text&quot;</span>, size = <span class="number">10</span>),</span><br><span class="line">                    ncol = <span class="number">1</span>, nrow = <span class="number">2</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## &#96;geom_smooth()&#96; using formula &#39;y ~ x&#39;</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">annotate_figure(figure,</span><br><span class="line">                top = text_grob(<span class="string">&quot;Visualizing mpg&quot;</span>, color = <span class="string">&quot;red&quot;</span>, face = <span class="string">&quot;bold&quot;</span>, size = <span class="number">14</span>),</span><br><span class="line">                bottom = text_grob(<span class="string">&quot;Data source: \n mtcars data set&quot;</span>, color = <span class="string">&quot;blue&quot;</span>,</span><br><span class="line">                                   hjust = <span class="number">1</span>, x = <span class="number">1</span>, face = <span class="string">&quot;italic&quot;</span>, size = <span class="number">10</span>),</span><br><span class="line">                left = text_grob(<span class="string">&quot;Figure arranged using ggpubr&quot;</span>, color = <span class="string">&quot;green&quot;</span>, rot = <span class="number">90</span>),</span><br><span class="line">                right = <span class="string">&quot;I&#x27;m done, thanks :-)!&quot;</span>,</span><br><span class="line">                fig.lab = <span class="string">&quot;Figure 1&quot;</span>, fig.lab.face = <span class="string">&quot;bold&quot;</span></span><br><span class="line">                )</span><br></pre></td></tr></table></figure><figure><img src="/images/combine-ggplot2/unnamed-chunk-6-1.png" alt="plot of chunk unnamed-chunk-6" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-6</figcaption></figure><h2 id="图片对齐">图片对齐</h2><p>最经典的例子就是在绘制生存曲线时，把risk table放在生存曲线图的下边。此时，我们需要调节表和图的大小和相对位置，使其分布更为合理</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Fit survival curves</span></span><br><span class="line"><span class="keyword">library</span>(survival)</span><br><span class="line">fit &lt;- survfit( Surv(time, status) ~ adhere, data = colon )</span><br><span class="line"><span class="comment"># Plot survival curves</span></span><br><span class="line"><span class="keyword">library</span>(survminer)</span><br><span class="line">ggsurv &lt;- ggsurvplot(fit, data = colon, </span><br><span class="line">                     palette = <span class="string">&quot;jco&quot;</span>,                              <span class="comment"># jco palette</span></span><br><span class="line">                     pval = <span class="literal">TRUE</span>, pval.coord = c(<span class="number">500</span>, <span class="number">0.4</span>),        <span class="comment"># Add p-value</span></span><br><span class="line">                     risk.table = <span class="literal">TRUE</span>                            <span class="comment"># Add risk table</span></span><br><span class="line">                     )</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## Warning: Vectorized input to &#96;element_text()&#96; is not officially supported.</span><br><span class="line">## Results may be unexpected or may change in future versions of ggplot2.</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ggarrange(ggsurv$plot, ggsurv$table, heights = c(<span class="number">2</span>, <span class="number">0.7</span>),</span><br><span class="line">          ncol = <span class="number">1</span>, nrow = <span class="number">2</span>)</span><br></pre></td></tr></table></figure><figure><img src="/images/combine-ggplot2/unnamed-chunk-7-1.png" alt="plot of chunk unnamed-chunk-7" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-7</figcaption></figure><p>此时，我们可以看出图和表并不是完全垂直对齐的，要对齐他们需要调用<code>align</code>参数</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ggarrange(ggsurv$plot, ggsurv$table, heights = c(<span class="number">2</span>, <span class="number">0.7</span>),</span><br><span class="line">          ncol = <span class="number">1</span>, nrow = <span class="number">2</span>, align = <span class="string">&quot;v&quot;</span>)</span><br></pre></td></tr></table></figure><figure><img src="/images/combine-ggplot2/unnamed-chunk-8-1.png" alt="plot of chunk unnamed-chunk-8" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-8</figcaption></figure><h2 id="改变图形的行列布局排布">改变图形的行列布局排布</h2><h3 id="使用ggpubr包">使用<code>ggpubr</code>包</h3><p>我们将使用嵌套的<code>ggarrange（）</code>函数来更改图的列/行跨度。</p><p>例如，我们使用下边的代码可以实现这样的布局</p><ul><li>散点图（sp）将位于第一行并跨越两列<br /></li><li>箱形图（bxp）和点图（dp）将首先排列，并且将在第二行中生活两列不同的列</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggarrange(sp,                                                 <span class="comment"># First row with scatter plot</span></span><br><span class="line">          ggarrange(bxp, dp, ncol = <span class="number">2</span>, labels = c(<span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>)), <span class="comment"># Second row with box and dot plots</span></span><br><span class="line">          nrow = <span class="number">2</span>, </span><br><span class="line">          labels = <span class="string">&quot;A&quot;</span>                                        <span class="comment"># Labels of the scatter plot</span></span><br><span class="line">          )</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## &#96;geom_smooth()&#96; using formula &#39;y ~ x&#39;</span><br></pre></td></tr></table></figure><figure><img src="/images/combine-ggplot2/unnamed-chunk-9-1.png" alt="plot of chunk unnamed-chunk-9" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-9</figcaption></figure><h3 id="使用cowplot包">使用<code>cowplot</code>包</h3><p>函数<code>ggdraw（）+ draw_plot（）+ draw_plot_label（）</code>的组合可用于将图形放置在特定大小的特定位置。</p><p><code>ggdraw（）</code>可以初始化一个空的绘图画布，默认情况是这样的：</p><figure><img src="%22/images/combine-ggplot2/canva.png%22" alt="canva" /><figcaption aria-hidden="true">canva</figcaption></figure><p><code>draw_plot（）</code>可以将绘图放置在绘图画布上的某处：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">draw_plot(plot, x = <span class="number">0</span>, y = <span class="number">0</span>, width = <span class="number">1</span>, height = <span class="number">1</span>)</span><br></pre></td></tr></table></figure><p><code>draw_plot_label()</code> 可以向图的左上角添加绘图标签。它可以处理带有关联坐标的标签向量。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">draw_plot_label(label, x = <span class="number">0</span>, y = <span class="number">1</span>, size = <span class="number">16</span>, <span class="keyword">...</span>)</span><br></pre></td></tr></table></figure><p>如果需要组合多张图形，可以通过类似于下边的代码来实现：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(<span class="string">&quot;cowplot&quot;</span>)</span><br><span class="line">ggdraw() +</span><br><span class="line">  draw_plot(bxp, x = <span class="number">0</span>, y = <span class="number">.5</span>, width = <span class="number">.5</span>, height = <span class="number">.5</span>) +</span><br><span class="line">  draw_plot(dp, x = <span class="number">.5</span>, y = <span class="number">.5</span>, width = <span class="number">.5</span>, height = <span class="number">.5</span>) +</span><br><span class="line">  draw_plot(bp, x = <span class="number">0</span>, y = <span class="number">0</span>, width = <span class="number">1</span>, height = <span class="number">0.5</span>) +</span><br><span class="line">  draw_plot_label(label = c(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>), size = <span class="number">15</span>,</span><br><span class="line">                  x = c(<span class="number">0</span>, <span class="number">0.5</span>, <span class="number">0</span>), y = c(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0.5</span>))</span><br></pre></td></tr></table></figure><figure><img src="/images/combine-ggplot2/unnamed-chunk-12-1.png" alt="plot of chunk unnamed-chunk-12" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-12</figcaption></figure><h3 id="使用gridextra包">使用<code>gridExtra</code>包</h3><p><code>gridExtra</code>包的使用方法和<code>ggpubr</code>包类似</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(<span class="string">&quot;gridExtra&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## </span><br><span class="line">## Attaching package: &#39;gridExtra&#39;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">## The following object is masked from &#39;package:dplyr&#39;:</span><br><span class="line">## </span><br><span class="line">##     combine</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grid.arrange(sp,                             <span class="comment"># First row with one plot spaning over 2 columns</span></span><br><span class="line">             arrangeGrob(bxp, dp, ncol = <span class="number">2</span>), <span class="comment"># Second row with 2 plots in 2 different columns</span></span><br><span class="line">             nrow = <span class="number">2</span>)       </span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## &#96;geom_smooth()&#96; using formula &#39;y ~ x&#39;</span><br></pre></td></tr></table></figure><figure><img src="/images/combine-ggplot2/unnamed-chunk-13-1.png" alt="plot of chunk unnamed-chunk-13" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-13</figcaption></figure><p>我们同样可以使用<code>gird.arrange()</code>函数中的<code>lay_matrix</code>参数来设置，使用方法如下：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grid.arrange(bp,                                    <span class="comment"># bar plot spaning two columns</span></span><br><span class="line">             bxp, sp,                               <span class="comment"># box plot and scatter plot</span></span><br><span class="line">             ncol = <span class="number">2</span>, nrow = <span class="number">2</span>, </span><br><span class="line">             layout_matrix = rbind(c(<span class="number">1</span>,<span class="number">1</span>), c(<span class="number">2</span>,<span class="number">3</span>)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## &#96;geom_smooth()&#96; using formula &#39;y ~ x&#39;</span><br></pre></td></tr></table></figure><figure><img src="/images/combine-ggplot2/unnamed-chunk-14-1.png" alt="plot of chunk unnamed-chunk-14" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-14</figcaption></figure><blockquote><p>在上面的R代码中，layout_matrix是一个2×2矩阵（2列和2行）。 第一行全是1，这是第一幅图占的地方，横跨两列; 第二行包含分别占据一列的图2和图3</p></blockquote><p>此时，如果需要对图形进行注释，<code>ggpubr</code>包已经不足以实现，需要我们使用<code>cowplot</code>包来进行进一步的注释</p><p>需要注意的是<code>grid.arrange（）</code>/ <code>arrangeGrob（）</code>输出的是一个<code>gtable</code>，首先需要使用<code>ggpubr</code>包中的<code>as_ggplot（）</code>函数将其转换为<code>ggplot</code>。 接下来，就可以使用函数<code>draw_plot_label（）</code>对其进行注释。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(<span class="string">&quot;gridExtra&quot;</span>)</span><br><span class="line"><span class="keyword">library</span>(<span class="string">&quot;cowplot&quot;</span>)</span><br><span class="line"><span class="comment"># Arrange plots using arrangeGrob</span></span><br><span class="line"><span class="comment"># returns a gtable (gt)</span></span><br><span class="line">gt &lt;- arrangeGrob(bp,                               <span class="comment"># bar plot spaning two columns</span></span><br><span class="line">             bxp, sp,                               <span class="comment"># box plot and scatter plot</span></span><br><span class="line">             ncol = <span class="number">2</span>, nrow = <span class="number">2</span>, </span><br><span class="line">             layout_matrix = rbind(c(<span class="number">1</span>,<span class="number">1</span>), c(<span class="number">2</span>,<span class="number">3</span>)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## &#96;geom_smooth()&#96; using formula &#39;y ~ x&#39;</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Add labels to the arranged plots</span></span><br><span class="line">p &lt;- as_ggplot(gt) +                                <span class="comment"># transform to a ggplot</span></span><br><span class="line">  draw_plot_label(label = c(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>), size = <span class="number">15</span>,</span><br><span class="line">                  x = c(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0.5</span>), y = c(<span class="number">1</span>, <span class="number">0.5</span>, <span class="number">0.5</span>)) <span class="comment"># Add labels</span></span><br><span class="line">p</span><br></pre></td></tr></table></figure><figure><img src="/images/combine-ggplot2/unnamed-chunk-15-1.png" alt="plot of chunk unnamed-chunk-15" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-15</figcaption></figure><blockquote><p>在上面的R代码中，我们使用了<code>arrangeGrob（）</code>而不<code>是grid.arrange（）</code>。<br />请注意，这两个函数的主要区别在于，<code>grid.arrange（）</code>会自动绘制排列好的图<br />由于我们要在绘制之前注释已排列的图，因此在这种情况下，函数<code>arrangeGrob（）</code>是首选。</p></blockquote><h2 id="使用grid包">使用<code>grid</code>包</h2><p>通过函数<code>grid.layout（）</code>，可以使用<code>gridR</code>包创建复杂的图像布局。 它还提供了函数<code>viewport（）</code>来定义布局上图像的区域或位置。 函数<code>print（）</code>用于将图放置在指定区域中。</p><p>总结起来共以下5个顺序步骤：<br />1. 创建绘图：p1，p2，p3，…<br />2. 使用函数<code>grid.newpage（）</code>创建画板<br />3. 创建画板布局2X2 - 列数= 2; 行数= 2<br />4. 定义图像输出位置：画板中图像显示的区域<br />5. 在画板中输出显示图片</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(grid)</span><br><span class="line"><span class="comment"># Move to a new page</span></span><br><span class="line">grid.newpage()</span><br><span class="line"><span class="comment"># Create layout : nrow = 3, ncol = 2</span></span><br><span class="line">pushViewport(viewport(layout = grid.layout(nrow = <span class="number">3</span>, ncol = <span class="number">2</span>)))</span><br><span class="line"><span class="comment"># A helper function to define a region on the layout</span></span><br><span class="line">define_region &lt;- <span class="keyword">function</span>(row, col)&#123;</span><br><span class="line">  viewport(layout.pos.row = row, layout.pos.col = col)</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment"># Arrange the plots</span></span><br><span class="line">print(sp, vp = define_region(row = <span class="number">1</span>, col = <span class="number">1</span>:<span class="number">2</span>))   <span class="comment"># Span over two columns</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## &#96;geom_smooth()&#96; using formula &#39;y ~ x&#39;</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(bxp, vp = define_region(row = <span class="number">2</span>, col = <span class="number">1</span>))</span><br><span class="line">print(dp, vp = define_region(row = <span class="number">2</span>, col = <span class="number">2</span>))</span><br><span class="line">print(bp + rremove(<span class="string">&quot;x.text&quot;</span>), vp = define_region(row = <span class="number">3</span>, col = <span class="number">1</span>:<span class="number">2</span>))</span><br></pre></td></tr></table></figure><figure><img src="/images/combine-ggplot2/unnamed-chunk-16-1.png" alt="plot of chunk unnamed-chunk-16" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-16</figcaption></figure><h2 id="通用图例的设定">通用图例的设定</h2><p>在我们绘制的图片当中，有的可能具有相同的图例，函数<code>ggarrange（）</code>可以与以下参数一起使用,使两幅图使用相同的图例</p><ul><li><code>common.legend = TRUE</code>：使用公共图例<br /></li><li><code>legend</code>:指定图例位置。 允许的值包括c（“top”，“bottom”，“left”，“right”）</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ggarrange(bxp, dp, labels = c(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>),</span><br><span class="line">          common.legend = <span class="literal">TRUE</span>, legend = <span class="string">&quot;bottom&quot;</span>)</span><br></pre></td></tr></table></figure><figure><img src="/images/combine-ggplot2/unnamed-chunk-17-1.png" alt="plot of chunk unnamed-chunk-17" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-17</figcaption></figure><h2 id="实战">实战</h2><p>给散点图添加边界密度图</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Scatter plot colored by groups (&quot;Species&quot;)</span></span><br><span class="line">sp &lt;- ggscatter(iris, x = <span class="string">&quot;Sepal.Length&quot;</span>, y = <span class="string">&quot;Sepal.Width&quot;</span>,</span><br><span class="line">                color = <span class="string">&quot;Species&quot;</span>, palette = <span class="string">&quot;jco&quot;</span>,</span><br><span class="line">                size = <span class="number">3</span>, alpha = <span class="number">0.6</span>)+</span><br><span class="line">  border()                                         </span><br><span class="line"><span class="comment"># Marginal density plot of x (top panel) and y (right panel)</span></span><br><span class="line">xplot &lt;- ggdensity(iris, <span class="string">&quot;Sepal.Length&quot;</span>, fill = <span class="string">&quot;Species&quot;</span>,</span><br><span class="line">                   palette = <span class="string">&quot;jco&quot;</span>)</span><br><span class="line">yplot &lt;- ggdensity(iris, <span class="string">&quot;Sepal.Width&quot;</span>, fill = <span class="string">&quot;Species&quot;</span>, </span><br><span class="line">                   palette = <span class="string">&quot;jco&quot;</span>)+</span><br><span class="line">  rotate()</span><br><span class="line"><span class="comment"># Cleaning the plots</span></span><br><span class="line">yplot &lt;- yplot + clean_theme() </span><br><span class="line">xplot &lt;- xplot + clean_theme()</span><br><span class="line"><span class="comment"># Arranging the plot</span></span><br><span class="line">ggarrange(xplot, <span class="literal">NULL</span>, sp, yplot, </span><br><span class="line">          ncol = <span class="number">2</span>, nrow = <span class="number">2</span>,  align = <span class="string">&quot;hv&quot;</span>, </span><br><span class="line">          widths = c(<span class="number">2</span>, <span class="number">1</span>), heights = c(<span class="number">1</span>, <span class="number">2</span>),</span><br><span class="line">          common.legend = <span class="literal">TRUE</span>)</span><br></pre></td></tr></table></figure><figure><img src="/images/combine-ggplot2/unnamed-chunk-18-1.png" alt="plot of chunk unnamed-chunk-18" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-18</figcaption></figure><hr /><h3 id="reference">Reference:</h3><p><a href="http://www.sthda.com/english/articles/24-ggpubr-publication-ready-plots/81-ggplot2-easy-way-to-mix-multiple-graphs-on-the-same-page/">ggplot2 - Easy Way to Mix Multiple Graphs on The Same Page</a></p>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ggplot2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git与github的使用简介</title>
      <link href="2018/05/23/git-github/"/>
      <url>2018/05/23/git-github/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><h2 id="git的基本使用方法">Git的基本使用方法</h2><h2 id="git简介">Git简介</h2><p>Git是一个功能强大的分布是版本控制系统，由linux系统的创始人Linus创建，用于优化管理linux源码。Git具有强大的分支管理能力，对于代码集成管理具有超越其他集中式版本控制系统的优势。</p><h2 id="git安装">Git安装</h2><p>在windows上安装Git，只需要从Git官网下载<a href="https://git-scm.com/">安装程序</a>，按照默认选项安装即可。</p><p>最终，安装完成后，在开始菜单里找到“Git”-&gt;“Git Bash”，蹦出一个类似命令行窗口的东西，就说明Git安装成功！</p><p>安装完成后需要进行一步设置，在Git Bash中输入命令行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">&quot;Your Name&quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;email@example.com&quot;</span></span><br></pre></td></tr></table></figure><p>因为Git是分布式版本控制系统，所以，每个电脑必须有自己的ID：你的名字和Email地址。</p><p>注意<code>git config</code>命令的<code>--global</code>参数，用了这个参数，表示你这台机器上所有的Git仓库都会使用这个配置，当然也可以对某个仓库指定不同的用户名和Email地址。</p><h3 id="git的基本原理">Git的基本原理</h3><p>在Git中,主要有两部分组成：工作区和版本库，而版本库又分为暂存区和分支。</p><p>当你创建编辑一个文件后，首先需要将文件从工作区添加到版本库的暂存区，然后再从暂存区提交的Git的分支系统上。</p><blockquote><p>个人认为，从工作区到暂存区的过程相当于将文件的所有更改日志依次保存在暂存区，而从暂存区提交到Git分支的过程则是一次性提交所有的更改</p></blockquote><h3 id="本地仓库的使用">本地仓库的使用</h3><blockquote><p>版本库又名仓库，英文名repository，可以理解成一个文件夹,这个文件夹下的所有文件都可以被Git管理起来，每个文件的修改、删除，Git都能跟踪，以便任何时刻都可以追踪历史，或者在将来某个时刻可以“还原”。</p></blockquote><h4 id="创建仓库">创建仓库</h4><p>找合适的地方，创建一个空目录，创建并进入，一般不要用中文的目录名，容易出现问题.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">makdir learngit</span><br><span class="line"><span class="built_in">cd</span> learngit</span><br></pre></td></tr></table></figure><h4 id="初始化仓库">初始化仓库</h4><p><code>git init</code> 命令将这个目录变成可以管理的版本仓库（git repository）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">Initialized empty Git repository <span class="keyword">in</span> /home/deepin/learngit/.git/</span><br></pre></td></tr></table></figure><p>此时你已经创建了一个空的版本库，可以发现当前目录下多了一个.git目录，这个目录就是git用来跟踪管理版本仓库的，不要去手动修改。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">deepin@deepin-PC:~/learngit$ ls -a</span><br><span class="line">.  ..  .git</span><br></pre></td></tr></table></figure><h4 id="添加文件到仓库">添加文件到仓库</h4><p>把文件添加到版本库，如果没有任何提示信息则为成功添加</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add README.md</span><br></pre></td></tr></table></figure><p>把文件提交到版本库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m <span class="string">&quot;this is a README.md file&quot;</span></span><br></pre></td></tr></table></figure><p>双引号中输入的是文件描述信息，是对此次文件提交的说明</p><p>同样，你也可以一次提交多个文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git add file1.txt</span><br><span class="line">git add file2.txt</span><br><span class="line">git add file3.txt</span><br><span class="line">git commit -m <span class="string">&quot;add 3 files.&quot;</span></span><br></pre></td></tr></table></figure><h3 id="添加远程仓库">添加远程仓库</h3><p>当你已经在本地创建了一个Git仓库后，又想在GitHub创建一个Git仓库，使两个仓库能够远程同步，以下操作可以帮你实现</p><ol type="1"><li>首先需要在远端github账户中创建自己的仓库<br /></li><li>在本地使用git命令添加远程仓库</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin &lt;adress&gt; <span class="comment">#最后是远程仓库地址</span></span><br></pre></td></tr></table></figure><p>添加后，远程库的名字就是<code>origin</code>，这是Git默认的叫法，也可以改成别的，但是<code>origin</code>这个名字一看就知道是远程库</p><ol start="3" type="1"><li>然后就可以向远端仓库<code>push</code>文件</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure><p>这条命令实际上是把本地<code>master</code>分支推送到远程仓库上，使用<code>-u</code>参数Git不但会把本地的<code>master</code>分支内容推送的远程新的<code>master</code>分支，还会把本地的<code>maste</code>r分支和远程的<code>master</code>分支关联起来，在以后的推送或者拉取时就可以简化命令。</p><h3 id="git的基本命令">Git的基本命令</h3><h4 id="添加文件">添加文件</h4><ul><li>使用命令<code>git add &lt;file&gt;</code>，注意，可反复多次使用，添加多个文件；<br /></li><li>使用命令<code>git commit -m &lt;message&gt;</code> 提交文件到仓库，添加提交注释信息</li></ul><h4 id="状态查看">状态查看</h4><p><code>git status</code>查看repository的状态，<code>git diff</code>查看修改了哪些内容</p><h4 id="文件修改">文件修改</h4><ul><li><code>git status</code>可以查看当前版本库中文件的提交状态<br /></li><li><code>git rm</code>可以删除某一文件</li></ul><h4 id="版本退回">版本退回</h4><ul><li><p><code>git reset</code>命令可以使文件退回之前的版本或者从之前的版本回到修改后的版本</p><blockquote><p>在Git中，用<code>HEAD</code>表示当前版本，上一个版本就是<code>HEAD^</code>，上上一个版本就是<code>HEAD^^</code>，当然往上100个版本写100个^比较容易数不过来，所以写成<code>HEAD~100</code>。</p></blockquote><ul><li><code>git log</code>命令可以查看提交历史，以便确定要回退到哪个版本。<br /></li><li><code>git reflog</code>可以查看命令历史，以便确定要回到未来的哪个版本。</li></ul><blockquote><p>回退到以前的版本A之后，用<code>git log</code>命令就找不到A之后的版本了，如果想回到之后的版本，需要<code>git reset --hard commitID</code>，但是如果不记得<code>commitID</code>,可以用<code>git reflog</code>，它记录了每一个命令</p></blockquote></li></ul><h3 id="常用的git命令">常用的git命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">git init <span class="comment">#使当前目录变成可以管理的版本仓库（git repository)</span></span><br><span class="line">git add filename <span class="comment">#将文件添加到版本仓库</span></span><br><span class="line">git commit -m <span class="string">&quot;description&quot;</span> <span class="comment">#把文件提交到仓库</span></span><br><span class="line">git status <span class="comment">#查看repository的状态</span></span><br><span class="line">git diff <span class="comment">#查看修改了哪些内容</span></span><br><span class="line">git <span class="built_in">log</span> <span class="comment">#查看提交日志</span></span><br><span class="line">git <span class="built_in">log</span> --pretty=oneline <span class="comment">#简洁地显示提交日志</span></span><br><span class="line">git reset --hard HEAD~&lt;3&gt; <span class="comment">#回退到某个版本，比如这里回退到第前3个版本</span></span><br><span class="line">git reset --hard &lt;commit ID&gt; <span class="comment">#回退到特定ID的版本</span></span><br><span class="line">git reflog <span class="comment">#记录了每个命令，可以用来查看每个操作的编号</span></span><br><span class="line">git checkout -b &lt;branch&gt; <span class="comment">#创建并切换分支</span></span><br><span class="line">git branch <span class="comment">#查看当前分支</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cox模型的R实现</title>
      <link href="2018/05/08/Cox-R/"/>
      <url>2018/05/08/Cox-R/</url>
      
        <content type="html"><![CDATA[<h3 id="载入需要的r包">载入需要的R包</h3><ul><li><p><strong>survival</strong>用于计算生存分析</p></li><li><p><strong>survminer</strong>用于可视化生存分析结果</p></li></ul><div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;survival&quot;</span>)</span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;survminer&quot;</span>)</span></code></pre></div><h3 id="计算cox-model-coxph">计算COX model : coxph()</h3><p><code>coxph</code> 可以用于构建计算 Cox proportional hazards regression model，常见用法如下：</p><div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(formula, data, method)</span></code></pre></div><blockquote><p>formula : 是通过 <code>Surv</code>构建的生存对象 ，如：<em>Surv(time, event)</em></p><p>data：包含变量的data.frame</p><p>method：计算各项指标所用的检验方法</p></blockquote><h3 id="univariate-cox-regression">Univariate Cox regression</h3><p>以<code>survival</code>包提供的<code>lung</code>数据为例，进行单变量的cox回归分析</p><div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>res.cox <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> sex, <span class="at">data =</span> lung)</span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>res.cox</span></code></pre></div><div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(time, status) <span class="sc">~</span> sex, <span class="at">data =</span> lung)</span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>      coef <span class="fu">exp</span>(coef) <span class="fu">se</span>(coef)     z      p</span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>sex <span class="sc">-</span><span class="fl">0.531</span>     <span class="fl">0.588</span>    <span class="fl">0.167</span> <span class="sc">-</span><span class="fl">3.18</span> <span class="fl">0.0015</span></span><span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>Likelihood ratio test<span class="ot">=</span><span class="fl">10.6</span>  on <span class="dv">1</span> df, p<span class="ot">=</span><span class="fl">0.00111</span></span><span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span> <span class="dv">228</span>, number of events<span class="ot">=</span> <span class="dv">165</span> </span></code></pre></div><p>使用<code>summary</code>函数显示更加详细的结果：</p><div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res.cox)</span></code></pre></div><div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span><span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(time, status) <span class="sc">~</span> sex, <span class="at">data =</span> lung)</span><span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  n<span class="ot">=</span> <span class="dv">228</span>, number of events<span class="ot">=</span> <span class="dv">165</span> </span><span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>       coef <span class="fu">exp</span>(coef) <span class="fu">se</span>(coef)      z <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>z<span class="sc">|</span>)   </span><span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>sex <span class="sc">-</span><span class="fl">0.5310</span>    <span class="fl">0.5880</span>   <span class="fl">0.1672</span> <span class="sc">-</span><span class="fl">3.176</span>  <span class="fl">0.00149</span> <span class="sc">**</span>  </span><span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span><span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span><span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">exp</span>(coef) <span class="fu">exp</span>(<span class="sc">-</span>coef) lower .<span class="dv">95</span> upper .<span class="dv">95</span></span><span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>sex     <span class="fl">0.588</span>      <span class="fl">1.701</span>    <span class="fl">0.4237</span>     <span class="fl">0.816</span></span><span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>Concordance<span class="ot">=</span> <span class="fl">0.579</span>  (<span class="at">se =</span> <span class="fl">0.022</span> )</span><span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>Rsquare<span class="ot">=</span> <span class="fl">0.046</span>   (max <span class="at">possible=</span> <span class="fl">0.999</span> )</span><span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>Likelihood ratio test<span class="ot">=</span> <span class="fl">10.63</span>  on <span class="dv">1</span> df,   p<span class="ot">=</span><span class="fl">0.001111</span></span><span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>Wald test            <span class="ot">=</span> <span class="fl">10.09</span>  on <span class="dv">1</span> df,   p<span class="ot">=</span><span class="fl">0.001491</span></span><span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="fu">Score</span> (logrank) test <span class="ot">=</span> <span class="fl">10.33</span>  on <span class="dv">1</span> df,   p<span class="ot">=</span><span class="fl">0.001312</span></span></code></pre></div><p>结果的各项指标解释如下：</p><ol type="1"><li><strong><em>Statistical significance</em></strong>. z值给出了Wald统计值。它对应于每个回归系数与其标准误差的比率（z = coef / se（coef））。 wald统计量评估给定变量的系数（β）是否在统计学上显著，由上可知，变量性别具有高度统计上显著的系数。<br /></li><li><strong><em>The regression coefficients</em></strong>. Cox模型结果中要注意的第二个特征是回归系数（coef）的符号。如果回归系数为正值，说明死亡风险高，预后差；为负值，则风险低，预后好。 R给出的是第二组相对于第一组的风险比（HR），即女性对男性。在这些数据中，性别的β系数= -0.53表明女性的死亡风险（低存活率）低于男性。</li><li><strong><em>Hazard ratios</em></strong>. 指数系数（exp（coef）= exp（-0.53）= 0.59）也称为风险比，给出协变量的效应大小。 例如，女性（性别= 2）的风险降低了0.59倍，即41％。 女性与预后良好相关。<br /></li><li><strong><em>Confidence intervals of the hazard ratios</em></strong>. 给出了风险比（exp（coef））的95％置信区间的上限和下限。<br /></li><li><strong><em>Global statistical significance of the model</em></strong>. 三个检验模型的P值：The likelihood-ratio test, Wald test, and score logrank statistics.这三种方法是类似的，如果样本量足够大，则三个方法会得到相同的结果，当样本量较小时，The likelihood-ratio test能得到较好的结果。</li></ol><h3 id="multivariate-cox-regression-analysis">Multivariate Cox regression analysis</h3><p>当我们纳入多个变量时，我们可以这样操作：</p><div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>res.cox <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> ph.ecog, <span class="at">data =</span>  lung)</span><span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res.cox)</span></code></pre></div><div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span><span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(time, status) <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> ph.ecog, <span class="at">data =</span> lung)</span><span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  n<span class="ot">=</span> <span class="dv">227</span>, number of events<span class="ot">=</span> <span class="dv">164</span> </span><span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>   (<span class="dv">1</span> observation deleted due to missingness)</span><span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>             coef <span class="fu">exp</span>(coef)  <span class="fu">se</span>(coef)      z <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>z<span class="sc">|</span>)    </span><span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>age      <span class="fl">0.011067</span>  <span class="fl">1.011128</span>  <span class="fl">0.009267</span>  <span class="fl">1.194</span> <span class="fl">0.232416</span>    </span><span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>sex     <span class="sc">-</span><span class="fl">0.552612</span>  <span class="fl">0.575445</span>  <span class="fl">0.167739</span> <span class="sc">-</span><span class="fl">3.294</span> <span class="fl">0.000986</span> <span class="sc">**</span><span class="er">*</span></span><span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>ph.ecog  <span class="fl">0.463728</span>  <span class="fl">1.589991</span>  <span class="fl">0.113577</span>  <span class="fl">4.083</span> <span class="fl">4.45e-05</span> <span class="sc">**</span><span class="er">*</span></span><span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span><span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span><span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">exp</span>(coef) <span class="fu">exp</span>(<span class="sc">-</span>coef) lower .<span class="dv">95</span> upper .<span class="dv">95</span></span><span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>age        <span class="fl">1.0111</span>     <span class="fl">0.9890</span>    <span class="fl">0.9929</span>    <span class="fl">1.0297</span></span><span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>sex        <span class="fl">0.5754</span>     <span class="fl">1.7378</span>    <span class="fl">0.4142</span>    <span class="fl">0.7994</span></span><span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>ph.ecog    <span class="fl">1.5900</span>     <span class="fl">0.6289</span>    <span class="fl">1.2727</span>    <span class="fl">1.9864</span></span><span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>Concordance<span class="ot">=</span> <span class="fl">0.637</span>  (<span class="at">se =</span> <span class="fl">0.026</span> )</span><span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>Rsquare<span class="ot">=</span> <span class="fl">0.126</span>   (max <span class="at">possible=</span> <span class="fl">0.999</span> )</span><span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>Likelihood ratio test<span class="ot">=</span> <span class="fl">30.5</span>  on <span class="dv">3</span> df,   p<span class="ot">=</span><span class="fl">1.083e-06</span></span><span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>Wald test            <span class="ot">=</span> <span class="fl">29.93</span>  on <span class="dv">3</span> df,   p<span class="ot">=</span><span class="fl">1.428e-06</span></span><span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="fu">Score</span> (logrank) test <span class="ot">=</span> <span class="fl">30.5</span>  on <span class="dv">3</span> df,   p<span class="ot">=</span><span class="fl">1.083e-06</span></span></code></pre></div><p>由上可知：在三种检验方法中，p值都是显著的。这表明了该模型的重要性。</p><p>在多变量Cox分析中，协变量<code>sex</code>和<code>ph.ecog</code>仍然显着（p &lt;0.05）。然而，协变量<code>age</code>并不显着（p = 0.23）。<br />&gt; &gt; &gt; &gt; <code>sex</code>的p值为0.000986，危险比HR = exp（coef）= 0.58，表明患者性别与死亡风险降低之间有很强的关系。协变量的风险比可以解释为对风险的倍增效应。例如，将其他协变量保持不变，即女性（<code>sex</code>= 2）可将风险降低0.58倍，即降低42％。我们的结论是，女性与良好的预后相关。<br />&gt; &gt; &gt; &gt; 类似地，<code>ph.ecog</code>的p值为4.45e-05，危险比HR = 1.59，表明<code>ph.ecog</code>值与死亡风险增加之间的强关系。保持其他协变量不变，<code>ph.ecog</code>的较高值与生存率较差相关。<br />&gt; &gt; &gt; &gt; 相比之下，<code>age</code>的p = 0.23。风险比HR = exp（coef）= 1.01，95％置信区间为0.99至1.03。由于HR的置信区间包括1，因此这些结果表明年龄在调整<code>ph.ecog</code>和<code>sex</code>后对HR差异的贡献较小，并且仅趋向于显着性。例如，将其他协变量保持不变，额外的一年会导致每日死亡风险的因数为exp（beta）= 1.01或1％，这不是一个重大贡献。<br />&gt;</p><h3 id="references">References:</h3><p>Cox Proportional Hazards Model<a href="http://www.sthda.com/english/wiki/cox-proportional-hazards-model">http://www.sthda.com/english/wiki/cox-proportional-hazards-model</a></p>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
            <tag> Cox </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cox回归分析</title>
      <link href="2018/04/23/cox-regression/"/>
      <url>2018/04/23/cox-regression/</url>
      
        <content type="html"><![CDATA[<p>Cox回归分析是在生存分析中最常用的影响因素分析，回归模型的前提假设只有一个：分析的因素必须满足<strong>比例风险假设</strong>，即协变量不随时间的变化而变化。</p><h2 id="cox比例风险模型">Cox比例风险模型</h2><p>Cox回归模型建模的主要对象是危险率（Hazard Rate），记作<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex" xmlns="http://www.w3.org/2000/svg" width="3.88ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 1715 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="210E" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(576, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(965, 0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(1326, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container></span>，它的基本形式：</p><p><img src="/images/cox-regression/pic1.png"></p><p>它表示已生存到时间<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex" xmlns="http://www.w3.org/2000/svg" width="0.817ex" height="1.441ex" role="img" focusable="false" viewBox="0 -626 361 637"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g></g></g></svg></mjx-container></span>的观察对象在t时刻的瞬时发生事件的概率，值为非负数。当<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex" xmlns="http://www.w3.org/2000/svg" width="6.85ex" height="1.805ex" role="img" focusable="false" viewBox="0 -716 3027.6 798"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="394" d="M51 0Q46 4 46 7Q46 9 215 357T388 709Q391 716 416 716Q439 716 444 709Q447 705 616 357T786 7Q786 4 781 0H51ZM507 344L384 596L137 92L383 91H630Q630 93 507 344Z"></path></g></g><g data-mml-node="mi" transform="translate(833, 0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(1471.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(2527.6, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></svg></mjx-container></span>时，此时风险函数表示的就是时刻t存活的个体在此后一个单位死亡概率。</p><p>Cox回归的假设是<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex" xmlns="http://www.w3.org/2000/svg" width="1.303ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 576 705"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="210E" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g></svg></mjx-container></span>满足这样的分布：</p><p><img src="/images/cox-regression/pic2.png"></p><p>其中<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex" xmlns="http://www.w3.org/2000/svg" width="4.793ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 2118.6 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="210E" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, -150) scale(0.707)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mo" transform="translate(979.6, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(1368.6, 0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(1729.6, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container></span>我们不要去管它,，表示的是基线风险，即协变量为0时的风险率。对于两个对象，它们危险率的比值（Hazard Ratio）是和<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex" xmlns="http://www.w3.org/2000/svg" width="4.793ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 2118.6 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="210E" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mn" transform="translate(576, -150) scale(0.707)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mo" transform="translate(979.6, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(1368.6, 0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(1729.6, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container></span>无关的。</p><p><img src="/images/cox-regression/pic3.png"></p><p><strong>对于每一个因素，如果回归系数的检验检验p值小于给定阈值，那么它的回归系数如果为正，该因素为风险因素，否则为保护因素（不利因素）。当确定该因素确实影响生存之后，影响力的大小可以用HR（hazard ratio）来表示。HR表示该影响因素增加一个单位风险率相对于原来增加多少倍。</strong></p><p>总结起来就是：</p><ul><li>P&lt;0.05,β&gt;0，HR&gt;1(95%CI &gt;1)，说明变量X增加时，危险率增加，即X是危险因素；<br></li><li>P&lt;0.05,β&lt;0，HR&lt;1(95%CI &lt;1)，说明变量X增加时，危险率下降，即X是保护因素；<br></li><li>P=0.05,β较大可能=0，HR较大可能=1，说明变量X增加时，危险率不变，即X是危险无关因素。</li></ul><h2 id="比例风险的假设的检验">比例风险的假设的检验</h2><p>该假设主要用于评估<strong>协变量是否可以用于cox风险回归模型。但是，一般都不需要进行评估。</strong></p><p>判断一个变量是否满足比例风险模型假设有以下三种方式：</p><ul><li>如果协变量为类协变量（即category var），那么每组别的K-M生存曲线无交叉，则满足比例风险假设；<br></li><li>以生存时间t为横轴，对数对数生存率ln[-ln(p)]为纵轴，绘制分类变量的每一组别的生存曲线，如果各组别对应的曲线直观上平行，则满足风险比例条件。<br></li><li>对于连续型协变量，可将每个协变量与对数生存时间的交互项X*ln(t)放入回归模型中，如果该将互相项没有统计学意义，则满足风险比例假设，如：</li></ul><p><img src="/images/cox-regression/pic4.png"></p><p><strong>当分析按比例风险的假定条件不成立是，可采用两种方法来解决</strong>：</p><ul><li>将这种不满足假定的协变量作为分层变量，然后再用其余变量进行多元Cox回归模型分析。（分层分析）<br></li><li>使用其他的参数模型。</li></ul><h2 id="注意事项">注意事项</h2><ol type="1"><li>年龄，作为连续变量，一般情况是默认服从比例风险假设的，可以直接进行回归分析。<br></li><li>单因素分析一方面可初步筛选出可能与预后有关的因素；另一方面去除那些根本不可能相关的因素，以减少建立多元回归模型时的“压力”。</li></ol>]]></content>
      
      
      <categories>
          
          <category> Survival </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cox </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>survminer包绘制生存曲线</title>
      <link href="2018/04/23/survminer/"/>
      <url>2018/04/23/survminer/</url>
      
        <content type="html"><![CDATA[<a id="more"></a><p><code>survminer</code>包是一个绘制生存曲线的R包，它的主要函数是<code>ggsurvplot()</code>函数，它可以绘制由<code>survival</code>包产生的<code>survfit</code>生存对象。</p><p>一般用法如下：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ggsurvplot(fit, data = <span class="literal">NULL</span>, fun = <span class="literal">NULL</span>, color = <span class="literal">NULL</span>, palette = <span class="literal">NULL</span>,</span><br><span class="line">  linetype = <span class="number">1</span>, conf.int = <span class="literal">FALSE</span>, pval = <span class="literal">FALSE</span>, pval.method = <span class="literal">FALSE</span>,</span><br><span class="line">  test.for.trend = <span class="literal">FALSE</span>, surv.median.line = <span class="string">&quot;none&quot;</span>, risk.table = <span class="literal">FALSE</span>,</span><br><span class="line">  cumevents = <span class="literal">FALSE</span>, cumcensor = <span class="literal">FALSE</span>, tables.height = <span class="number">0.25</span>,</span><br><span class="line">  group.by = <span class="literal">NULL</span>, facet.by = <span class="literal">NULL</span>, add.all = <span class="literal">FALSE</span>, combine = <span class="literal">FALSE</span>,</span><br><span class="line">  ggtheme = theme_survminer(), tables.theme = ggtheme, <span class="keyword">...</span>)</span><br></pre></td></tr></table></figure><h3 id="主要参数">主要参数</h3><p><code>fit</code> <code>survfit</code>产生的生存对象</p><p><code>data</code> 一个用于拟合生存曲线的数据集</p><p><code>fun</code> 定义生存曲线的函数类型。 经常使用的转换可以用字符参数指定：“事件”绘制累积事件（<code>f（y）= 1- y</code>），“cumhaz”绘制累积危险函数（<code>f（y）= -log（y）</code>）， “pct”为生存概率百分比。</p><p><code>color</code> 绘制生存曲线用的颜色，默认为<code>strata</code></p><p><code>palette</code> 绘制颜色所用的色板</p><p><code>conf.int</code> 是否绘制置信区间，逻辑向量</p><p><code>pval</code> 是否给出p值逻辑值，数字或字符串。如果逻辑和TRUE，p值将被添加到图上。如果是numeric，则将使用此参数传递的值替换computet的p值。如果是字符，则自定义的字符串会出现在图上。</p><p><code>surv.median.line</code> 在中位生存时绘制水平/垂直线。允许的值包括c（“none”，“hv”，“h”，“v”）中的一个。</p><p><code>risk.table</code> 允许的值有：<br />+ 是否显示风险表的TRUE或FALSE。 默认值为FALSE。</p><ul><li><p>“absolute” 或者”percentage” 。分别显示绝对数量和风险对象的百分比。</p></li><li><p>“abs_pct”显示绝对数量和百分比。</p></li><li><p>“nrisk_cumcensor” 和 “nrisk_cumevents”。分别显示风险数量和审查和事件的累计数量。</p></li><li><p>tables.height 数值在[0，1]之间，指定主要存活图下所有表的一般高度。</p></li></ul><p><code>ggtheme</code> 使用的ggplot2主题的名字。</p><h3 id="图例标题标签和位置">图例标题，标签和位置</h3><p><code>title</code> 主标题</p><p><code>xlab</code>,<code>ylab</code> x,y轴标签</p><p><code>legend</code> 指定图例位置的字符。允许的值是（“top”，“bottom”，“left”，“right”，“none”）之一。也可使 用数字表示</p><p><code>legend.title</code> 图例的title</p><p><code>legend.labs</code> 图例的标签</p><h3 id="例子">例子</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span>(<span class="string">&quot;survival&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## Loading required package: survival</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fit&lt;- survfit(Surv(time, status) ~ sex, data = lung)</span><br><span class="line"><span class="comment"># Drawing survival curves</span></span><br><span class="line">ggsurvplot(fit)</span><br></pre></td></tr></table></figure><figure><img src="/images/survminer/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-3</figcaption></figure><p>添加risk.table</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Add risk table and change risk table y text colors by strata</span></span><br><span class="line">ggsurvplot(fit, pval = <span class="literal">TRUE</span>, conf.int = <span class="literal">TRUE</span>,</span><br><span class="line">           risk.table = <span class="literal">TRUE</span>, risk.table.y.text.col = <span class="literal">TRUE</span>)</span><br></pre></td></tr></table></figure><figure><img src="/images/survminer/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4" /><figcaption aria-hidden="true">plot of chunk unnamed-chunk-4</figcaption></figure>]]></content>
      
      
      <categories>
          
          <category> R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> survminer </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
